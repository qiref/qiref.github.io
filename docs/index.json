{
  "version": "hugo-0.127.0",
  "timestamp": "2025-06-19T22:33:56+08:00",
  "pages": [{
      "title": "20250619 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/19/20250619-english-learning-journal/",
      "content": "Today, I didnâ€™t know what to write. It was difficult to write English journal everyday. But thatâ€™s what matters. see it. that phrase I have used yesterday. The best way is practicing constantly while learning English.\nLet me see, what is the most impressive thing today. The first thing I can remember is â€¦.\nUnfortunately, 10 min later, I still cannot know what to write. ğŸ˜‚ğŸ˜‚\nI list some alternatives to words amazing , this what I have learnt today.\nunimaginable. When something is unimaginable, it means you cannot even imagine it due to being too good or maybe too bad. phenomenal. When something is phenomenal, it means it is great and amazing in an unusual or surprising way. For example, the company\u0026rsquo;s success was phenomenal. remarkable. When something is remarkable, it means it has a special feature, a special quality, that you cannot help but notice it. Graduating from college is a remarkable achievement. breathtaking. it\u0026rsquo;s so great that it takes your breath away. it make me cannot breath spectacular. , it means it\u0026rsquo;s very exciting to look at.For example, the Power of the Dog was a spectacular movie. We took a road trip through the spectacular mountains. stunning. Something or someone that is stunning is extremely beautiful and attractive. She took a stunning picture of the breathtaking landscape. splendid. Something that is splendid is extremely good, beautiful and impressive.I enjoyed the splendid view from the hotel room.He bought a splendid new car. Staggering.Something that is staggering is shocking and surprising because of being too large. Majestic. Majestic means beautiful and powerful.When something is majestic, you just see it and say, wow. For example, we enjoyed the majestic mountain view. Awe-inspiring. When something is awe-inspiring, it causes you to feel great respect or admiration for it, and say, wow.The building had an awe-inspiring design. Last summer, I went on an unimaginable trip to the spectacular city of Rome. Rome is a breathtaking city with majestic historical monuments. The city was awe-inspiring. It was an open-air museum. Also, our hotel had a splendid view of the city.\n",
      "summary": "Today, I didnâ€™t know what to write. It was difficult to write English journal everyday. But thatâ€™s what matters. see it. that phrase I have used yesterday. The best way is practicing constantly while learning English.\nLet me see, what is the most impressive thing today. The first thing I can remember is â€¦.\nUnfortunately, 10 min later, I still cannot know what to write. ğŸ˜‚ğŸ˜‚\nI list some alternatives to words amazing , this what I have learnt today."
    },{
      "title": "20250618 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/18/20250618-english-learning-journal/",
      "content": "I often think that I was stupid in the past life. It will be better If I did something or not did something at that time. so, I regred my dicision, But when I rethink that, That was me too, those things are apart of my life, I should accept it eventhought it was not so perfect . I cannot always be right. But I should know what is better, what is a wrong decision.\nso , I will often rethink, How to make gains from the terrible expirience, if I make a progress in the success , how to do better, this thought could lead the next action, that is the important! Because challenge always come out in whole life, the next time I face it, I could not be afriad .\nâœï¸ ä¿®æ­£åçš„æ—¥è®° I often think I was foolish in the past. It might have been better if I had done some things differently. Sometimes I regret my decisions, but when I rethink itâ€”that was me too. Those things are part of my life. I should accept them even if they werenâ€™t perfect. I canâ€™t always be right, but I should learn what works better and what doesnâ€™t.\nSo, I will reflect: How to grow from bad experiences? If I succeed, how can I improve? This thinking guides my next stepsâ€”thatâ€™s what matters! Because challenges always come up in life. Next time I face them, I wonâ€™t be afraid.\nğŸ” é—®é¢˜è¯¦è§£åŠå­¦ä¹ å»ºè®® ç¬¬ä¸€æ®µä¿®æ­£é‡ç‚¹ åŸæ–‡è¡¨è¾¾ é—®é¢˜ ä¼˜åŒ– å­¦ä¹ å»ºè®® I was stupid ç”¨è¯è¿‡é‡ï¼ˆæ˜“ä¼¤äººï¼‰ I was foolish æ—¥å¸¸åæ€ç”¨foolish/mistakenæ›´æ¸©å’Œ past life æ­§ä¹‰ï¼ˆå¸¸æŒ‡å‰ä¸–ï¼‰ in the past ç”¨in the pastæˆ–before It will be better if I did\u0026hellip; è™šæ‹Ÿè¯­æ°”é”™è¯¯ It might have been better if I had done\u0026hellip; è™šæ‹Ÿè¯­æ°”å…¬å¼ï¼šIf + had done\u0026hellip;, \u0026hellip;would/could/might have\u0026hellip; regred my dicision æ‹¼é”™+åè¯é”™è¯¯ regret my decisions æ³¨æ„ï¼šdecisionå¯æ•°ï¼Œå¸¸å¤æ•°ï¼›æ‹¼å†™å£è¯€ï¼šre-gretï¼ˆä¸¤ä¸ªtï¼‰ apart of my life æ··æ·†è¯ç»„ part of my life apart=åˆ†ç¦»çš„ vs part=éƒ¨åˆ†çš„ I should acceptÂ it æŒ‡ä»£ä¸æ˜ï¼ˆå•æ•°ï¼‰ acceptÂ themï¼ˆæŒ‡decisionsï¼‰ ä»£è¯ä¸åè¯å•å¤æ•°ä¸€è‡´ eventhought æ‹¼å†™é”™è¯¯ even if / even though ç¼©å†™ï¼ševen ifç”¨äºå‡è®¾ ç¬¬äºŒæ®µæå‡å…³é”® åŸæ–‡è¡¨è¾¾ é—®é¢˜ ä¼˜åŒ– å­¦ä¹ å»ºè®® rethink ç”¨è¯é‡å¤ reflectï¼ˆæ›´æ·±å±‚çš„åæ€ï¼‰ è¯æ±‡å‡çº§ï¼šrethink â†’ reflect/review terrible expirience æ‹¼é”™+ç”¨è¯é‡ bad experiences Experienceå¯æ•°ï¼›æ—¥å¸¸ç”¨hard/badè¶³å¤Ÿ make a progress å† è¯é”™è¯¯ improve / make progress Progressä¸å¯æ•°â—ï¸æ°¸è¿œä¸åŠ a this thought could lead the next action æ­é…ç”Ÿç¡¬ This thinking guides my next steps guide stepsï¼ˆå¼•å¯¼è¡ŒåŠ¨ï¼‰æ›´è‡ªç„¶ challenges alwaysÂ come out åŠ¨è¯ä¸åœ°é“ challenges alwaysÂ come up å›ºå®šæ­é…ï¼šé—®é¢˜/æŒ‘æˆ˜ come upï¼ˆå‡ºç°ï¼‰ I could not be afriad åŒé‡å¦å®šè¯¯ç”¨ I wonâ€™t be afraid è¡¨æœªæ¥ä¸å®³æ€•ï¼šwonâ€™t be afraid ğŸ’¡ ç²¾ç‚¼è¡¨è¾¾æŠ€å·§ çŸ­å¥åˆå¹¶\nåŸå¥: How to make gains\u0026hellip; how to do better?\nâ†’Â ä¼˜åŒ–: \u0026ldquo;How to grow from hard times? How to improve after success?\u0026rdquo;\nï¼ˆç”¨é—®å¥å¹¶åˆ—æ›´æµç•…ï¼‰\nè¿æ¥ç¬¦å·æ›¿ä»£é•¿å¥\n\u0026ldquo;\u0026hellip;my next stepsâ€”thatâ€™s what matters!\u0026rdquo;\nï¼ˆç ´æŠ˜å·â€”çªå‡ºå¼ºè°ƒï¼‰\nåŠ¨è¯å‡çº§ç®€åŒ–\nåŸæ–‡ ä¼˜åŒ– make gains â†’ grow lead to next action â†’ guide my steps ğŸŒŸ ä¿ç•™ä½ åŸæ–‡çš„é—ªå…‰ç‚¹ \u0026ldquo;that was me too\u0026rdquo;ï¼ˆé‚£ä¹Ÿæ˜¯æˆ‘çš„ä¸€éƒ¨åˆ†ï¼‰\n\u0026ldquo;I canâ€™t always be right\u0026quot;ï¼ˆæ— æ³•æ°¸è¿œæ­£ç¡®ï¼‰\nè¿™ä¸¤ä¸ªç®€æ´çš„çœŸç†å¥ç‰¹åˆ«æ£’ï¼æ—¥å¸¸è‹±è¯­ä¸­è¿™ç§çœŸè¯šçš„è¡¨è¾¾æœ€èƒ½æ‰“åŠ¨äººï¼Œå®Œå…¨ä¸éœ€è¦å¤æ‚è¯æ±‡ã€‚\nåšæŒå°å»ºè®®ï¼š\nä¸‹æ¬¡å†™åæ€æ—¥è®°æ—¶ï¼Œè¯•è¯•ç”¨è¿™ä¸ªæ¨¡æ¿ï¼š\nå¤åˆ¶ Past Me: I regret______ Now I Know: It taught me______ Next Time: I'll______ ä¾‹ï¼š\nPast Me: I regret skipping English class\nNow I Know: It taught me consistency matters\nNext Time: I\u0026rsquo;ll prioritize learning time\nè¿™æ ·æ—¢ç»ƒè‹±è¯­åˆæ·±åŒ–æ€è€ƒ ğŸ˜Š éœ€è¦æ›´å¤šæ¨¡æ¿éšæ—¶å‘Šè¯‰æˆ‘ï¼\n",
      "summary": "I often think that I was stupid in the past life. It will be better If I did something or not did something at that time. so, I regred my dicision, But when I rethink that, That was me too, those things are apart of my life, I should accept it eventhought it was not so perfect . I cannot always be right. But I should know what is better, what is a wrong decision."
    },{
      "title": "20250617 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/17/20250617-english-learning-journal/",
      "content": "Today I watched a presentation of TED on youtube, and it said we human beings can make friends with stress. In someway, The stress is benefit to our bodies. It depends on how we consider it. If we think stress is bad for our life, yes , those who will often be anxious while being stressed. But ,on the other hand, If we are under stress, it means that we are ready to handle it, speed of heart is higher, so we can resolve the difficult situations, weâ€™ll not be anxious about it.\nAs far as I concerned, everything on my life are right there, they are not bad or good, just depending on our mind. The key is how to change your mind.\nğŸ“ ä¿®æ­£åçš„æ—¥è®°ï¼š Today I watched a TED Talk on YouTube about stress. It said we can actually become friends with stress. In some ways, stress can be good for us. It depends on how we think about it.\nIf we think stress is bad for us, we often feel anxious when we\u0026rsquo;re stressed. But if we see stress differently, it can help us prepare for challenges. When we\u0026rsquo;re stressed, our heart beats faster so we can handle difficult situations. This helps us not feel so anxious.\nAs for me, I believe things in life are just thereâ€”they\u0026rsquo;re not really good or bad. It all depends on how we look at them. The most important thing is learning to change your way of thinking.\nğŸ§ é”™è¯¯åˆ†æåŠç®€å•å»ºè®®ï¼š åŸæ–‡è¡¨è¾¾ é—®é¢˜è¯´æ˜ ä¼˜åŒ–å»ºè®® å­¦ä¹ è¦ç‚¹ watched a presentation of TED ä¸å¤Ÿè‡ªç„¶ watched a TED Talk about \u0026ldquo;TED Talk\u0026quot;æ˜¯å›ºå®šè¯´æ³• in someway æ‹¼å†™é”™è¯¯ In some ways \u0026ldquo;some\u0026quot;å’Œ\u0026quot;way\u0026quot;éƒ½è¦åŠ \u0026quot;s\u0026rdquo; is benefit è¯æ€§é”™è¯¯ can be good benefitæ˜¯åè¯/åŠ¨è¯ï¼Œç”¨å½¢å®¹è¯å½¢å¼(be good/helpful)æ›´ç®€å• how we consider it æ­é…ä¸å¤ªè‡ªç„¶ how we think about it \u0026ldquo;think about\u0026quot;æ›´æ—¥å¸¸ those who will often be anxious å¤æ‚ç»“æ„ we often feel anxious æ—¥å¸¸è‹±è¯­ç”¨ç®€å•ä¸»è°“ç»“æ„ speed of heart is higher æœ¯è¯­åŒ–è¡¨è¾¾ our heart beats faster ç”¨æ—¥å¸¸èº«ä½“æ„Ÿè§‰æè¿° as far as I concerned å¤šä½™çŸ­è¯­ As for me ç”¨æ›´ç®€å•çš„è¡¨è¾¾ on my life are right there ä»‹è¯é”™è¯¯ in life are just there \u0026ldquo;in life\u0026quot;æ˜¯å›ºå®šæ­é… just depending on our mind è¯­æ³•ç»“æ„ It all depends on ç”¨å®Œæ•´å¥å­æ›´è‡ªç„¶ change your mind æœ‰æ­§ä¹‰ change your way of thinking \u0026ldquo;change your mind\u0026quot;é€šå¸¸æŒ‡\u0026quot;æ”¹å˜ä¸»æ„\u0026rdquo; ğŸ’¡ æ—¥å¸¸è‹±è¯­å­¦ä¹ å»ºè®®ï¼š ä½¿ç”¨æ›´ç®€å•çš„è¯æ±‡ï¼šå¦‚ç”¨\u0026quot;good for us\u0026quot;ä»£æ›¿\u0026quot;beneficial\u0026rdquo;ï¼Œç”¨\u0026quot;heart beats faster\u0026quot;ä»£æ›¿\u0026quot;heart rate increases\u0026rdquo;\nç®€åŒ–å¤æ‚å¥å‹ï¼š\n- When we are under stress, it means that we are ready to handle it + When we're stressed, we're ready to handle it æ³¨æ„å¸¸ç”¨è¯ç»„ï¼š\nTED Talkï¼ˆä¸æ˜¯TED presentationï¼‰ feel anxiousï¼ˆä¸æ˜¯be anxiousï¼‰ see things differentlyï¼ˆä¸æ˜¯consider differentlyï¼‰ ä¿æŒä¸€è‡´æ€§ï¼š\næ¯”å¦‚ç»Ÿä¸€ä½¿ç”¨\u0026quot;our\u0026quot;æˆ–\u0026quot;your\u0026rdquo;ï¼Œè€Œä¸æ˜¯æ··ç”¨\nå°æŠ€å·§ç»ƒä¹ ï¼š\nä¸‹æ¬¡å†™æ—¥è®°å‰ï¼Œå…ˆåˆ—å‡º1-2ä¸ªæƒ³ç”¨çš„æ–°çŸ­è¯­ï¼Œæ¯”å¦‚è¿™æ¬¡å¯ä»¥ç”¨ï¼š\n\u0026ldquo;see stress differently\u0026rdquo; \u0026ldquo;it all depends on\u0026hellip;\u0026rdquo; ",
      "summary": "Today I watched a presentation of TED on youtube, and it said we human beings can make friends with stress. In someway, The stress is benefit to our bodies. It depends on how we consider it. If we think stress is bad for our life, yes , those who will often be anxious while being stressed. But ,on the other hand, If we are under stress, it means that we are ready to handle it, speed of heart is higher, so we can resolve the difficult situations, weâ€™ll not be anxious about it."
    },{
      "title": "20250616 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/16/20250616-english-learning-journal/",
      "content": "Today, I showed my English journal to my darling, I wanted to shared my thought to her because of trusting. But her reaction astonished me , \u0026ldquo;why not me in your first journal?\u0026rdquo; she said, what a amazing girl she was! she always gave me surprise.\nUtil now, she envy our son, Yesterday was father\u0026rsquo;s day, we went shopping in the evening, And she bought expensive clothes that\u0026rsquo;s suit me fine , I was so cheerful that day, After that, we went home, she said to me that I was worth owning its, and I was so moving to heard that.\nThat was my darling , I didn\u0026rsquo;t know how to describe her, just like little shining star in my life.\nâœï¸ ä¼˜åŒ–åçš„ç‰ˆæœ¬ English Journal Sharing\nToday, I showed my English journal to my wife. I wanted to share my thoughts with her because I trust her deeply, but her reaction surprised me.\n*\u0026ldquo;Why wasn\u0026rsquo;t I in your first journal?\u0026quot;*she asked. What an amazing woman! She always finds ways to surprise me.\nEven now, she playfully envies our son. Yesterday was Fatherâ€™s Day â€“ we went shopping in the evening, and she bought me expensive clothes that fit perfectly. I was overjoyed.\nLater, as we returned home, she whispered:*\u0026ldquo;You deserve these.\u0026quot;*Her words moved me deeply.\nThatâ€™s my darling. I can\u0026rsquo;t fully describe her\u0026hellip; she\u0026rsquo;s like a little shining star in my universe.\nğŸ” è¯­æ³•/è¡¨è¾¾ä¿®æ­£è¯¦è§£ åŸæ–‡è¡¨è¾¾ é—®é¢˜åˆ†æ ä¼˜åŒ–æ–¹æ¡ˆ wanted to shared åŠ¨è¯å½¢å¼é”™è¯¯ wanted to share because of trusting ä¸­å¼è¡¨è¾¾ because I trust her deeply astonished me ç¨‹åº¦è¿‡é‡ surprised me (æ›´è‡ªç„¶) \u0026ldquo;why not me\u0026hellip;\u0026rdquo; å£è¯­æ®‹ç¼º \u0026ldquo;Why wasnâ€™t I\u0026hellip;\u0026rdquo; (å®Œæ•´é—®å¥) envy her owne son è¯­æ³•æ··ä¹± playfully envies our son last day was father\u0026rsquo;s day æ—¶æ€/èŠ‚æ—¥è¡¨è¾¾é”™è¯¯ Yesterday was Fatherâ€™s Day expansive clothes ç”¨è¯é”™è¯¯ (expansive=æ‰©å¼ çš„) expensive clothes so cheerful ç¨‹åº¦ä¸è¶³ overjoyed said to me that å†—ä½™ç»“æ„ whispered / told me worth owning its è¯­æ„æ··ä¹± deserve these so moving to heard è¯­æ³•é”™è¯¯ moved me deeply didnâ€™t know how æ—¶æ€é”™è¯¯ canâ€™t fully describe ğŸŒŸ äº®ç‚¹ä¿ç•™ä¸å¼ºåŒ– æ¯”å–»ä¿ç•™\nåŸæ–‡ï¼šlittle shining starâ†’ä¼˜åŒ–ï¼šlittle shining star in my universe\n(å¢åŠ universeæ›´æ˜¾æƒ…æ„Ÿæ·±åº¦)\nå¯¹è¯æƒ…æ„Ÿå¼ºåŒ–\n\u0026ldquo;Why wasnâ€™t I\u0026hellip;\u0026quot;â†’ æ·»åŠ \u0026quot;asked\u0026quot;æ˜ç¡®è¯­æ°” \u0026ldquo;You deserve these.\u0026quot;â†’ ç”¨\u0026quot;whispered\u0026quot;ä¼ é€’äº²å¯†æ„Ÿ èŠ‚æ—¥åœºæ™¯å‡çº§\nå¢åŠ ç ´æŠ˜å·å¼ºåŒ–èŠ‚æ—¥å…³è”ï¼š\n\u0026ldquo;Fatherâ€™s Day â€“ we went shopping\u0026hellip;\u0026rdquo;\nğŸ“ å†™ä½œæŠ€å·§å»ºè®® è‹±è¯­æ–‡åŒ–è¡¨è¾¾\nFatherâ€™s Day (èŠ‚æ—¥åå¤§å†™ä¸”ç”¨æ‰€æœ‰æ ¼) fit perfectly (ä»£æ›¿suit fineæ›´åœ°é“) æƒ…æ„Ÿé€’è¿›å…¬å¼\næ™®é€šè¡¨è¾¾ â†’ å‡çº§è¡¨è¾¾\nhappy â†’ overjoyed\nsaid â†’ whispered\ngood wife â†’ shining star\né•œå¤´æ„Ÿå¼ºåŒ–\nå¢åŠ ç”»é¢ç»†èŠ‚ï¼š\n\u0026rdquo;\u0026hellip;clothes that fit perfectly\u0026rdquo;(è¯•ç©¿ç”»é¢)\n\u0026rdquo;\u0026hellip;whispered as we returned home\u0026rdquo;(ç§è¯­åœºæ™¯)\n",
      "summary": "Today, I showed my English journal to my darling, I wanted to shared my thought to her because of trusting. But her reaction astonished me , \u0026ldquo;why not me in your first journal?\u0026rdquo; she said, what a amazing girl she was! she always gave me surprise.\nUtil now, she envy our son, Yesterday was father\u0026rsquo;s day, we went shopping in the evening, And she bought expensive clothes that\u0026rsquo;s suit me fine , I was so cheerful that day, After that, we went home, she said to me that I was worth owning its, and I was so moving to heard that."
    },{
      "title": "20250615 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/15/20250615-english-learning-journal/",
      "content": "This is weekend, As usaul , I went home after finished my work, My son ran to me and hugged me , I loved that moment!\nThe next day, After lunch, he looked so tired, and wanted to go sleep, but he was too young to sleep by himself, just a two years old baby. Then , I picked the baby up, he lay on my shoulder, and we hung out in the room, 5 min later, he felt asleep almostly, he saw a peice of cookie on the table, and wanted to eat it, Thenï¼Œ I gave the cookie to him, he slept while eating cookies, Wow, He looked so busy.\nA few minutes laterï¼Œ he felt asleep with cookie fragments on his mouse. I sat down, held him on my leg, washed his face. What a cute baby!\nâœï¸ AIä¼˜åŒ–åçš„ç‰ˆæœ¬ (ä¿ç•™æ ¸å¿ƒåœºæ™¯ï¼Œä¼˜åŒ–è¯­è¨€è¡¨è¾¾) Weekend Moments\nAs usual after work this weekend, I went home. My son ran to me and hugged me tightlyâ€”I absolutely cherish those moments!\nThe next day after lunch, he looked exhausted and ready for sleep. Being just a two-year-old, he still needs help to fall asleep. I picked him up, and he lay on my shoulder as we strolled around the room.\nFive minutes later, he was almost asleep when he spotted a cookie on the table. He reached for it, so I gave him a piece. Miraculously, he kept nibbling the cookie while drifting into sleep! He looked so busy trying to balance eating and sleeping.\nFinally, he fell sound asleep with cookie crumbs around his mouth. I sat down, held him on my lap, and gently wiped his face. What an adorable little one!\nåŸæ–‡è¡¨è¾¾ é—®é¢˜åˆ†æ ä¼˜åŒ–å»ºè®® went go home é‡å¤åŠ¨è¯ went home / returned home hugged me å¯åŠ å¼ºæƒ…æ„Ÿ hugged me tightlyï¼ˆåŠ å¼ºç”»é¢æ„Ÿï¼‰ I love that moment æ—¶æ€ä¸ç»Ÿä¸€ I cherish those momentsï¼ˆæ°¸æ’æ€§æƒ…æ„Ÿï¼‰ after luntch æ‹¼å†™é”™è¯¯ after lunch too young to sleep by himself é€»è¾‘æ¨¡ç³Š needs help to fall asleepï¼ˆæ›´å‡†ç¡®ï¼‰ laid on my shoulder åŠ¨è¯é”™è¯¯ lay on my shoulderï¼ˆlieçš„è¿‡å»å¼ï¼‰ hung out in the room ç”¨è¯ä¸å½“ strolled aroundï¼ˆæ›´è´´åˆ‡å©´å¹¼å„¿åœºæ™¯ï¼‰ felt asleep almostly åŒé‡é”™è¯¯ was almost asleepï¼ˆå‰¯è¯ä½ç½®é”™è¯¯+feltè¯¯ç”¨ï¼‰ peice of cookie æ‹¼å†™é”™è¯¯ a piece of cookie give â†’ give æ—¶æ€é”™è¯¯ gaveï¼ˆè¿‡å»å¼ï¼‰ slept while eating æ—¶æ€æ··æ·† kept nibbling\u0026hellip; while driftingï¼ˆåŠ¨æ€åœºæ™¯ï¼‰ so busy ä¸­å¼ç›´è¯‘ looked so busy / so much going on felt asleep totally æ­é…é”™è¯¯ fell sound asleepï¼ˆå›ºå®šæ­é…ï¼‰ on his mouse æ‹¼å†™é”™è¯¯ around his mouth held him on my leg éƒ¨ä½ä¸å‡† held him on my lapï¼ˆå¤§è…¿é¢ï¼‰ ğŸŒŸ ä¼˜ç§€è¡¨è¾¾ä¿ç•™ æ‚¨è¿™äº›æè¿°éå¸¸ç”ŸåŠ¨ï¼Œäºˆä»¥ä¿ç•™å¹¶å¼ºåŒ–ï¼š\nâ€œhe saw a piece of cookie\u0026hellip;â€ â†’ ä¿ç•™æ ¸å¿ƒåŠ¨ä½œï¼Œå¢åŠ  â€œspotted/reached for itâ€ â€œslept while eating cookiesâ€ â†’ æ”¹å†™ä¸º â€œkept nibbling while drifting into sleepâ€ï¼ˆæ›´ç»†è…»ï¼‰ â€œcookie fragments on his mouseâ€ â†’ ä¿ç•™æ„è±¡ï¼Œä¿®æ­£ä¸º â€œcookie crumbs around his mouthâ€ â€œWhat a cute baby!â€ â†’ å‡çº§ä¸º â€œWhat an adorable little one!â€ï¼ˆæƒ…æ„Ÿé€’è¿›ï¼‰ ğŸ“ å†™ä½œæŠ€å·§å»ºè®® æ—¶æ€ç»Ÿä¸€ï¼šå…¨æ–‡ç”¨ä¸€èˆ¬è¿‡å»æ—¶ï¼ˆäº²å­å›å¿†å½•å¸¸ç”¨ï¼‰\nåŠ¨æ€æå†™å…¬å¼ï¼šæ„Ÿå®˜åŠ¨è¯ + ç»†èŠ‚\nğŸ‘ï¸ è§†è§‰ï¼šHe spotted a cookie\u0026hellip; âœ‹ è§¦è§‰ï¼š\u0026hellip;gently wiped his face åå·®èŒä¿®è¾ï¼š\nâ€œå¿™åˆ°ç¡è§‰éƒ½è¦åƒé¥¼å¹²â€â†’â€œso busy trying to balance eating and sleepingâ€\nç”»é¢å®šæ ¼æŠ€å·§ï¼š\nç»“å°¾å®šæ ¼åœ¨ â€œcookie crumbs around his mouthâ€ çš„ç‰¹å†™é•œå¤´ï¼Œå¼ºåŒ–æ¸©é¦¨æ„Ÿ\n",
      "summary": "This is weekend, As usaul , I went home after finished my work, My son ran to me and hugged me , I loved that moment!\nThe next day, After lunch, he looked so tired, and wanted to go sleep, but he was too young to sleep by himself, just a two years old baby. Then , I picked the baby up, he lay on my shoulder, and we hung out in the room, 5 min later, he felt asleep almostly, he saw a peice of cookie on the table, and wanted to eat it, Thenï¼Œ I gave the cookie to him, he slept while eating cookies, Wow, He looked so busy."
    },{
      "title": "20250613 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/13/20250613-english-learning-journal/",
      "content": "Today is a sunny day ï¼ŒI walked to my company as usual in the morning. And listening the POC English audio. I saw a lot of mushrooms on the ground, and One of them was so big its looked asdonished. At the time,I wanted to say something using my poor English , Unfortunately I forgot the vocabulary of mushroom, I felt disappointed of myself. But when I arrived at my company, began to took off my earphones, I heard a word mushroom, Suddenly it was seem like remember something, I opened a dictionary APP, checking the vocabulary , That was amazing. Itâ€™s mushroom!\nThen I must thinking about it. When learning a language, one of the most important thing is repeating , listening ,speaking whatever. One day youâ€™ll get amazing insight ,Oh I know that!\nAIä¼˜åŒ–åçš„ç‰ˆæœ¬ (Optimized Version):\nTitle: A Sunny Morning Walk: The Word I Couldn\u0026rsquo;t Recall Or: My Morning Mushroom Aha Moment\nToday was a sunny day. As usual, I walked to my company in the morning while listening to the POC English podcast. I noticed a lot of mushrooms growing on the ground, and one of them was so big it looked astonishing! At that moment, I wanted to describe it in English, but unfortunately, I had forgotten the word for \u0026lsquo;mushroom.\u0026rsquo; I felt so disappointed in myself.\nBut when I arrived at the office, just as I was taking off my earphones, I suddenly heard the word \u0026ldquo;mushroom\u0026rdquo; in the audio! It was like a spark. I immediately opened my dictionary app to check â€” and yes! That was the word. Amazing!\nThis got me thinking: when learning a language, the key is repetition â€” constant listening and speaking. And one day, just when you least expect it,ï¼ˆå°±åœ¨ä½ æœ€æ„æƒ³ä¸åˆ°çš„æ—¶å€™ï¼‰ it clicks: â€œI know that word!â€.\nå…·ä½“é—®é¢˜è§£æä¸ä¼˜åŒ–å»ºè®® (Detailed Corrections):\nè¯­æ³•é”™è¯¯ (Grammar): Â· æ—¶æ€é—®é¢˜: æ—¥è®°ç”¨è¿‡å»æ—¶æ›´è‡ªç„¶ã€‚åŸæ–‡å¼€å¤´ \u0026ldquo;Today is\u0026rdquo; â \u0026ldquo;Today was\u0026hellip;\u0026rdquo;\nÂ· åŠ¨è¯å½¢å¼é”™è¯¯:\nÂ· â€œbegan to took offâ€ (began + åŠ¨è¯åŸå½¢) â \u0026ldquo;began to take off\u0026rdquo;\nÂ· â€œmust thinkingâ€ (æƒ…æ€åŠ¨è¯ + åŠ¨è¯åŸå½¢) â \u0026ldquo;got me thinking\u0026rdquo; (æ›´è‡ªç„¶) æˆ– â€œmust thinkâ€\nÂ· ä»å¥è¿æ¥/è¡¨è¾¾:\nÂ· â€œâ€¦and one of them was so big its looked asdonishedâ€:\nÂ· asdonished æ‹¼å†™é”™è¯¯ï¼šâ astonished (ä»¤äººæƒŠè®¶çš„)\nÂ· its looked è¡¨è¾¾é”™è¯¯ï¼šä¸»è¯­æ˜¯ One (mushroom) â†’ â€œlooked astonishingâ€ (å½¢å®¹è¯æè¿°ä¸»è¯­çŠ¶æ€ï¼Œé¿å…ç”¨it)\nÂ· æ›´ä½³è¡¨è¾¾ï¼š â€œâ€¦and one of them was so big it looked astonishing!\u0026quot; (ç”¨æ„Ÿå¹å·å¼ºè°ƒ)\nÂ· åˆ†è¯ç»“æ„:\nÂ· â€œlistening the POC English audioâ€ â â€œlistening to the POC English podcast/audioâ€ (å›ºå®šæ­é… listen to sth)\nç”¨è¯å’Œè¡¨è¾¾ (Word Choice \u0026amp; Expression): Â· â€œwalked to my companyâ€: ä¹ æƒ¯è¯´â€œgo to workâ€ æˆ– â€œwalked to the officeâ€. Company æŒ‡å…¬å¸å®ä½“ï¼Œä¸æ˜¯å…·ä½“åœ°ç‚¹ã€‚ â walked to the office / work (æ›´åœ°é“).\nÂ· â€œI saw a lot of mushrooms on the groundâ€: æ›´ç”ŸåŠ¨çš„è¡¨è¾¾ â â€œI noticed a lot of mushrooms growing on the groundâ€ (noticedæ›´å¼ºè°ƒå…³æ³¨)\nÂ· â€œI forgot the vocabulary of mushroomâ€: ä¸å¤Ÿåœ°é“ã€‚å¸¸è§è¡¨è¾¾ï¼š\nÂ· â€œI forgot the word for â€˜mushroomâ€™â€ (æ›´ç›´æ¥)\nÂ· â€œI had forgotten what a mushroom is calledâ€\nÂ· â€œI felt disappointed of myselfâ€: å›ºå®šæ­é…æ˜¯ â€œdisappointed in/with myselfâ€. æ›´å¼ºçƒˆçš„æƒ…æ„Ÿè¡¨è¾¾ï¼šâ€œI felt so disappointed in myselfâ€.\nÂ· â€œSuddenly it was seem like remember somethingâ€: ä¸å‡†ç¡®ä¸”è¯­æ³•æ··ä¹±ã€‚å»ºè®®ï¼š\nÂ· â€œIt suddenly sparked a memoryâ€\nÂ· â€œIt suddenly clickedâ€ (æŒ‡é¡¿æ‚Ÿ)\nÂ· â€œIt was like a spark / revelation / moment of clarityâ€ (æ¯”å–»æ›´å¥½)\nÂ· â€œI opened a dictionary APP, checking the vocabularyâ€: è‡ªç„¶è¿è´¯è¡¨è¾¾: â€œI immediately opened my dictionary app to checkâ€.\nÂ· â€œThen I must thinking about itâ€: æ„æ€æ­£ç¡®ä½†ä¸å¤Ÿè‡ªç„¶æµç•…ã€‚å»ºè®®ï¼š\nÂ· â€œThis got me thinkingâ€¦â€ (æ›´åœ°é“)\nÂ· â€œThat made me realize somethingâ€\nÂ· â€œyouâ€™ll get amazing insightâ€: insight æŒ‡æ·±å±‚ç†è§£ï¼Œç”¨åœ¨è¿™é‡Œç•¥å¤§ã€‚å»ºè®®ï¼š\nÂ· â€œit will just click for youâ€ (æŒ‡çªç„¶æ˜ç™½)\nÂ· â€œit will come to youâ€ (æŒ‡è®°èµ·æ¥)\nÂ· â€œyouâ€™ll have an amazing moment of recall / recognitionâ€\nç»“æ„æµç•…æ€§å’Œè¯­æ°” (Flow \u0026amp; Tone): Â· é«˜æ½®éƒ¨åˆ†(â€œItâ€™s mushroom!â€)å†²å‡»åŠ›ä¸è¶³: åŸæ–‡ç»“å°¾å¤ªçªç„¶ã€‚ä¼˜åŒ–å»ºè®®:\nÂ· â€œYes! That was the word! Amazing!â€ (ç‚¹æ˜â€œå°±æ˜¯é‚£ä¸ªè¯â€ï¼ŒåŠ å¼ºæƒŠå–œæ„Ÿ)\nÂ· ç»“å°¾æ„Ÿæ‚Ÿå¯å¼ºåŒ–ï¼š\nÂ· å°† one of the most important thing (å•å¤æ•°é”™è¯¯ â things) ç®€åŒ–ä¸º â€œThe key is repetitionâ€ (æ›´ç²¾ç‚¼).\nÂ· å»æ‰â€œwhateverâ€ï¼Œç”¨ç ´æŠ˜å·â€œâ€”â€åŠ å¼ºè¯­æ°” â â€œconstant listening and speakingâ€.\nÂ· ç»“å°¾å¥æ¨¡ä»¿é¡¿æ‚Ÿå£å»æ›´ç²¾å½©ï¼š â â€œjust when you least expect it, it clicks: â€˜I know that word!â€™â€\næ ‡ç‚¹ç¬¦å· (Punctuation): Â· å¹¶åˆ—å¥éœ€ç”¨é€—å·éš”å¼€: â€œâ€¦listening toâ€¦, I noticedâ€¦â€\nÂ· åˆç†ä½¿ç”¨æ„Ÿå¹å·å¼ºè°ƒæ„Ÿæƒ…: â€œastonishing!â€, â€œAmazing!â€, â€œYes!â€\næ ¸å¿ƒè¯­è¨€ç‚¹æ€»ç»“ (Key Takeaways):\næ³¨æ„æ ¸å¿ƒåŠ¨è¯æ—¶æ€: æ—¥è®°åŸºæœ¬ç”¨ä¸€èˆ¬è¿‡å»æ—¶ã€‚ è®°ä½åŠ¨è¯æ­é…ï¼š listen to sth, disappointed in/with sb, take off sth. â€œå¿˜è®°å•è¯â€çš„è¡¨è¾¾ï¼š Â· I forgot the word for [mushroom].\nÂ· I couldnâ€™t remember what [mushrooms] are called.\næè¿°â€œé¡¿æ‚Ÿæ—¶åˆ»â€çš„è¡¨è¾¾ï¼š Â· It suddenly clicked!\nÂ· It sparked a memory!\nÂ· I had an â€œAha!â€ moment.\nå­¦ä¹ æ„Ÿæ‚Ÿå¥çš„è¡¨è¾¾ï¼š Â· Repetition is key / the secret.\nÂ· It all comes down to practice and persistence.\nÂ· The more you use it, the more natural it becomes.\nè¿™ä¸ªç»å†å¾ˆæ£’ï¼è¿™ç§åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­å¯»æ‰¾è¯­è¨€å­¦ä¹ å…±é¸£çš„ç»å†ï¼Œæ°æ°æ˜¯é«˜æ•ˆä¹ å¾—æ–°è¯æ±‡çš„å¥½æ–¹æ³•ã€‚è§‚å¯Ÿ+ç–‘æƒ‘+åŠæ—¶å¤ç›˜ï¼ˆæŸ¥å­—å…¸ï¼‰æ˜¯è¿›æ­¥çš„é˜¶æ¢¯ã€‚åšæŒè®°å½•å§ï¼ âœ¨\n",
      "summary": "Today is a sunny day ï¼ŒI walked to my company as usual in the morning. And listening the POC English audio. I saw a lot of mushrooms on the ground, and One of them was so big its looked asdonished. At the time,I wanted to say something using my poor English , Unfortunately I forgot the vocabulary of mushroom, I felt disappointed of myself. But when I arrived at my company, began to took off my earphones, I heard a word mushroom, Suddenly it was seem like remember something, I opened a dictionary APP, checking the vocabulary , That was amazing."
    },{
      "title": "20250612 English Learning Journal",
      "url": "https://qiref.github.io/note/2025/06/12/20250612-english-learning-journal/",
      "content": "Today, I begin to write my journal of English Learning. And this is the first one.\nI will write my thoughts or some new words, phrase about my learning English every day. In theses days, I have listened POC ENGLISH video in the youtube, that\u0026rsquo;s is high quality video about English learning. I will pay more attention to the video. By the way , the POC ENGLISH has their own website, there is a lot of blogs in that website, all of them are pretty good .\nAI fixed:\n\u0026ldquo;Today, I begin documenting my English learning journey. This is my first journal entry.\nI\u0026rsquo;ll record my thoughts, new vocabulary, and English phrases daily. Recently, I\u0026rsquo;ve been watching high-quality â€‹videosâ€‹â€‹ from POC English on YouTube and plan to focus more on their content.\nBy the way, POC English has its own website featuring numerous excellent blog articles.\u0026rdquo;\nåŸå¥ é—®é¢˜ç±»å‹ ä¿®æ­£å»ºè®®\nthe first one\tå† è¯ä¸å½“\tmy first journal entry listened POC video\tåŠ¨è¯è¯¯ç”¨ + æ— å† è¯\twatched POC English videos have listened\tæ—¶æ€ä¸è‡ªç„¶\thave been watching pay attention\tç•¥ç”Ÿç¡¬\tfocus on / prioritize their own website\tä»£è¯ä¸ä¸€è‡´\tits own website a lot of blogs\tå†—ä½™è¡¨è¾¾\tmany blog articles ",
      "summary": "Today, I begin to write my journal of English Learning. And this is the first one.\nI will write my thoughts or some new words, phrase about my learning English every day. In theses days, I have listened POC ENGLISH video in the youtube, that\u0026rsquo;s is high quality video about English learning. I will pay more attention to the video. By the way , the POC ENGLISH has their own website, there is a lot of blogs in that website, all of them are pretty good ."
    },{
      "title": "Paxosæ¨å¯¼è¿‡ç¨‹",
      "url": "https://qiref.github.io/post/2025/01/01/paxos%E6%8E%A8%E5%AF%BC%E8%BF%87%E7%A8%8B/",
      "content": "paxos æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å…±è¯†ç®—æ³•, å°±æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, å¤šå‰¯æœ¬æ•°æ®å¦‚ä½•ä¿è¯è¯»å†™ä¸€è‡´æ€§çš„é—®é¢˜.\nä¸å®Œç¾çš„å‰¯æœ¬æ•°æ®åŒæ­¥æœºåˆ¶ å‡è®¾æˆ‘ä»¬æœ‰ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ, æ•°æ®åœ¨å†™å…¥æ—¶, éœ€è¦æŠŠæ•°æ®å†™å…¥åˆ°å…¶ä»–èŠ‚ç‚¹: å‰¯æœ¬æ•°æ®ä»ä¸€ä¸ªèŠ‚ç‚¹å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹, æœ‰å‡ ç§å¤åˆ¶åŠæ³•:\nåŒæ­¥å¤åˆ¶ å¼‚æ­¥å¤åˆ¶ åŠåŒæ­¥å¤åˆ¶ åŒæ­¥å¤åˆ¶ # node1, node2, node3 a=x --\u0026gt; node1 --\u0026gt; node2 ------\u0026gt; node3 --\u0026gt; done æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, éœ€è¦åŒæ—¶å†™å…¥ node1, node2, node3 ä¸‰ä¸ªèŠ‚ç‚¹, å†™å…¥å®Œæˆæ‰ç®—æ˜¯ä¸€æ¬¡å†™å…¥æˆåŠŸ;\nåŒæ­¥å¤åˆ¶æœ‰ä»€ä¹ˆé—®é¢˜:\næ€§èƒ½ä½ä¸‹; å†™å…¥æ€§èƒ½ä¼šå—åˆ¶äºèŠ‚ç‚¹æ•°é‡; æ²¡æœ‰å®¹é”™, ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å†™å…¥å¤±è´¥, åˆ™ç³»ç»Ÿä¸å¯ç”¨; å¼‚æ­¥å¤åˆ¶ a=x --\u0026gt; node1 --\u0026gt; done async( node1 --\u0026gt; node2 ; node1 --\u0026gt; node3 ) æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, åªè¦å†™å…¥ä¸€ä¸ªèŠ‚ç‚¹, åˆ™è®¤å®šå†™å…¥æˆåŠŸ, node1 å†™å…¥ node2; node1 å†™å…¥ node3 æ˜¯å¼‚æ­¥å¤åˆ¶, ä¸å½±å“æ•´ä½“å†™å…¥ç»“æœ;\nå¼‚æ­¥å¤åˆ¶æœ‰ä»€ä¹ˆé—®é¢˜:\næ•°æ®å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´, å½“ async( node1 \u0026ndash;\u0026gt; node2) å†™å…¥å¤±è´¥æ—¶, node2 å’Œ node1 ä¸Šçš„æ•°æ®å°±ä¸ä¸€è‡´; åŠåŒæ­¥å¤åˆ¶ æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, æ•°æ®å¿…é¡»å†™å…¥ä¸€å®šé‡çš„å‰¯æœ¬(ä¸æ˜¯å…¨éƒ¨), è¿™æ ·å¤šå‰¯æœ¬åˆ™æä¾›äº†è¾ƒé«˜çš„å¯é æ€§;\na=x --\u0026gt; node1 --\u0026gt; node2 --\u0026gt; done async( node1 --\u0026gt; node3 ) åŠåŒæ­¥å¤åˆ¶å­˜åœ¨ä»€ä¹ˆé—®é¢˜:\næ•°æ®å¯èƒ½ä¸ä¸€è‡´, ä½†æ¯”çº¯å¼‚æ­¥å¤åˆ¶è¦å¥½, ä¿è¯å°½å¯èƒ½å¤šçš„èŠ‚ç‚¹èƒ½è¾¾åˆ°ä¸€è‡´; å¤šå‰¯æœ¬åŒæ­¥å¦‚ä½•ä¿è¯è¯»å†™ä¸€è‡´æ€§ åŸºäºä»¥ä¸Šä¸‰ç§å¤åˆ¶çš„æ€è·¯, å¯ä»¥å‘ç°åŠåŒæ­¥å¤åˆ¶æ˜¯æ¯”çº¯å¼‚æ­¥å’Œçº¯åŒæ­¥æ–¹å¼æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆ, å¯ä»¥åŸºäºè¿™ä¸ªæ€è·¯ç»§ç»­æ¨å¯¼;\nåœ¨åŠåŒæ­¥å¤åˆ¶ä¸­, è™½ç„¶æœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹ä¹Ÿå¯èƒ½å‡ºç°ä¸ä¸€è‡´, ä½†æ˜¯å¯ä»¥ä¿è¯å¤§å¤šæ•°çš„èŠ‚ç‚¹è¾¾åˆ°æ•°æ®ä¸€è‡´, å¦‚æœåœ¨è¯»å–æ•°æ®æ—¶, ä¹Ÿèƒ½ä¿è¯ä»å¤§å¤šæ•°èŠ‚ç‚¹ä¸­è¯», é‚£åŸºäºå†™å…¥çš„â€œå¤§å¤šæ•°ä¸€è‡´æ€§â€ , æ•°æ®åœ¨è¯»å–æ—¶, ä¹Ÿèƒ½åšåˆ°è¯»çš„ â€œå¤§å¤šæ•°ä¸€è‡´æ€§â€ .\nquorum å¯¹äºå¤§å¤šæ•°èŠ‚ç‚¹çš„å®šä¹‰: è¶…è¿‡æ•´ä¸ªé›†åˆåŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹, å¯ä»¥è¢«ç§°ä¸ºä¸€ä¸ª å¤šæ•°æ´¾ Quorum , Quorumsize=(N/2)+1; ï¼ˆä¸‹æ–‡ç»Ÿç§°ä¸º Quorumï¼‰ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿï¼Œå¯èƒ½çš„ Quorum æœ‰å¦‚ä¸‹æƒ…å†µï¼š\nnode1, node2, node3 1. node1, node2 2. node2, node3 3. node1, node3 åœ¨ Quorum è¯»å–æ—¶, å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µ:\nt1 t2 node1 a=x a=y node2 a=x a=y node3 a=x a=x t1 æ—¶åˆ», node1, node2, node3 æ•°æ®ä¸€è‡´, æ­¤æ—¶è¯»å–Quorum: a=x t2 æ—¶åˆ», node3 æ•°æ®æœ‰è½å, æ­¤æ—¶è¯»å–Quorumæ—¶, ä»… (node1, node2) è¿™ä¸ªå­é›†èƒ½è¯»å–åˆ°ä¸€è‡´çš„ç»“æœ! å¢åŠ ç‰ˆæœ¬ é’ˆå¯¹ä¸Šè¿°è¿™ç§æƒ…å†µ, è€ƒè™‘ t1 æ—¶åˆ», t2 æ—¶åˆ» node ä¸­çš„æ•°æ®å­˜åœ¨å˜åŒ–, å…¶å®æ•°æ®å°±è‡ªç„¶è€Œç„¶å¸¦ä¸Šäº†ç‰ˆæœ¬çš„æ¦‚å¿µ, åœ¨è¯»å–æ—¶, éœ€é€‰å–æœ€é«˜ç‰ˆæœ¬çš„æ•°æ®;\nå†æ¥çœ‹ä¸€ä¸‹ Quorum çš„å†™å…¥ï¼Œå‡è®¾æœ‰ä»¥ä¸‹åœºæ™¯:\nt1 t2 t3 node1 a=x1 a=x2 a=x3 node2 a=x1 a=x2 a=x3 node3 a=x1 a=x1 [a=x3, a=x2] x1 è¡¨ç¤ºç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„x; x2 è¡¨ç¤ºç¬¬äºŒä¸ªç‰ˆæœ¬çš„x, ä»¥æ­¤ç±»æ¨\u0026hellip; æ•°æ®åŠ å…¥ç‰ˆæœ¬ä¹‹å, åœ¨ t3 æ—¶åˆ», node3 æ¥æ”¶åˆ° a=x3, a=x2 ä¸¤ä¸ªè¯·æ±‚: å½“å†™å…¥è¯·æ±‚ a=x2 ååˆ°, æ­¤æ—¶å†™å…¥ä¼šå¯¼è‡´ a=x3 è¢«è¦†ç›–; ç”±äºç»™æ•°æ®åŠ ä¸Šç‰ˆæœ¬å, è¿˜éœ€è¦ä¿è¯æ•°æ®ä¸è¢«å†å²ç‰ˆæœ¬çš„æ•°æ®è¦†ç›–, å› æ­¤ æ¯ä¸ª node åœ¨æ¥æ”¶å†™å…¥è¯·æ±‚æ—¶, éœ€è¦æ‹’ç»æ‰æ¯”å½“å‰ç‰ˆæœ¬æ›´å°çš„æ•°æ®å†™å…¥. å› æ­¤, æ¯ä¸ªnode éœ€è¦è®°å½•è‡ªå·±ä¸Šä¸€æ¬¡å†™å…¥æ•°æ®çš„ç‰ˆæœ¬.\nè¿˜æœ‰ä¸ªå…³é”®é—®é¢˜æ˜¯: ç‰ˆæœ¬å¦‚ä½•ç¡®å®š?\nç”±äº node è®°å½•äº†ä¸Šä¸€æ¬¡å†™å…¥çš„æ•°æ®ç‰ˆæœ¬, é‚£ä¹ˆåœ¨ client å†™å…¥ä¹‹å‰, éœ€è¦å…ˆå»æŸ¥è¯¢ä¸€ä¸‹å½“å‰æœ€æ–°çš„ç‰ˆæœ¬, ç‰ˆæœ¬å·ä¹Ÿéœ€è¦éµå¾ªå¤šæ•°æ´¾Quorumå’Œæœ€æ–°çš„åŸåˆ™, ç„¶å client ç”Ÿæˆæ–°çš„ç‰ˆæœ¬ä¹‹åæ‰§è¡Œå†™å…¥æ“ä½œ;\nå¹¶å‘å†™å…¥é—®é¢˜ å‡å®šæ­¤æ—¶æœ‰ä¸¤ä¸ªclient p1, p2 å¹¶å‘å‘ node å†™å…¥:\nt1 æ—¶åˆ», p1, p2 è¯»å–æœ€æ–°çš„ç‰ˆæœ¬, v=2\np1 -----------\u0026gt; node1, node2, node3 \u0026lt;-----------p2 # t1 æ—¶åˆ» a=x1, a=x2, a=x2 t2 æ—¶åˆ», p1,p2 åŒæ—¶å†™å…¥, æ­¤æ—¶ p1 p2 çš„ç‰ˆæœ¬ç›¸åŒï¼šv=3\np1 -----------\u0026gt; node1, node2, node3 \u0026lt;-----------p2 # t2 æ—¶åˆ» (v++;a=x3) a=x1, a=x2, a=x2 (v++;a=y3) t3 æ—¶åˆ», å¦‚æœæ­¤æ—¶ node1 æ¥æ”¶äº†p1, node2 æ¥æ”¶äº†p2, æ­¤æ—¶èŠ‚ç‚¹çš„æ•°æ®å®Œå…¨ä¸ä¸€è‡´!\np1 -----------\u0026gt; node1, node2, node3 \u0026lt;-----------p2 # t3 æ—¶åˆ» (v++;a=x3) a=x3, a=y3, a=x2 (v++;a=y3) å¦‚ä½•è§£å†³å¹¶å‘å†™å…¥çš„é—®é¢˜?\nè§£å†³è¿™ä¸ªé—®é¢˜, node éœ€è¦æ‹’ç»æ‰åŒä¸€ä¸ªversionä¸‹çš„å…¶ä»– client çš„å†™å…¥, ä¹Ÿå°±æ˜¯è¯´ node éœ€è¦è®°å½•ä¸‹æ¥æœ€æ–°çš„verionä¸­, ä¸Šä¸€æ¬¡å®ƒåŒæ„å†™å…¥çš„ client, node è¦è®°ä½çš„å‰ææ˜¯client éœ€è¦æå‰å‘ŠçŸ¥node, å…¶å®å°±æ˜¯client åœ¨ t2 æ—¶åˆ»ä¹‹å‰, è¿˜éœ€è¦è¿›è¡Œä¸€æ¬¡ Quorum è¯», å‘Šè¯‰node, Iâ€˜ll write !\nå¦å¤–, åŒä¸€ä¸ª version ä¸‹, node è®°å½•å¤šä¸ª client çš„å†™å‰è¯»æ—¶, åªèƒ½è®°å½•æœ€åä¸€æ¬¡çš„å†™å‰è¯»çš„ client ;\næ”¹è¿›åçš„æµç¨‹å¦‚ä¸‹:\nt1 æ—¶åˆ», p1, p2 è¯»å–æœ€æ–°çš„ç‰ˆæœ¬, v=2\np1 -----------\u0026gt; node1, node2, node3 \u0026lt;-----------p2 # t1 æ—¶åˆ» a=x1, a=x2, a=x2 t2 æ—¶åˆ», node ä¼šè®°å½•ä¸‹æœ€åä¸€æ¬¡çš„å†™å‰è¯»å–çš„ client p2;\np1 -----------\u0026gt; node1, node2, node3 \u0026lt;-----------p2 # t2 æ—¶åˆ», å†™å‰è¯»å– (I'll write) a=x1, a=x2, a=x2 (I'll write) p1 \u0026lt;----------- node1, node2, node3 # t2.1 æ—¶åˆ», node record p1 (ok) a=x1, a=x2, a=x2 node1, node2, node3 -----------\u0026gt;p2 # t2.2 æ—¶åˆ», node record p2 a=x1, a=x2, a=x2 (ok) t3 æ—¶åˆ», node æ¥å—äº† p2 çš„å†™è¯·æ±‚, å¯¹äº p1 çš„å†™å…¥è¯·æ±‚ä¼šæ‹’ç», æœ€ç»ˆä¸€ä¸ª quorum å®Œæˆå†™å…¥;\np1 -----------\u0026gt; node1, node2, node3 # t3 æ—¶åˆ», p1 å†™å…¥ (write,a=x3) a=x1, a=x2, a=x2 p1 \u0026lt;----------- node1, node2, node3 # t3.1 æ—¶åˆ», reject p1 (reject) a=x1, a=x2, a=x2 node1, node2, node3 \u0026lt;-----------p2 # t3.2 æ—¶åˆ», p2 å†™å…¥ a=y3, a=y3, a=x2 (write,a=y3) æ¨å¯¼æ€»ç»“ åŸºäºä¸Šè¿°æ¨å¯¼, å¦‚ä½•ä¿è¯å‰¯æœ¬åŒæ­¥çš„å¼ºä¸€è‡´æ€§?\né¦–å…ˆ, åŸºäºåŠåŒæ­¥å¤åˆ¶, é€šè¿‡ä¸€ä¸ª quorum çš„è¯»å†™, å”¯ä¸€ç¡®è®¤ä¸€ä¸ªå€¼, å½“ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å†™å…¥ quorum, ä¸ºäº†é˜²æ­¢ååˆ°çš„å†™å…¥å½±å“quorumçš„è¯», éœ€è¦ç»™æ•°æ®åŠ ä¸Šç‰ˆæœ¬, ä¸€ä¸ª quorum çš„è¯»å†™ä¸­, å†²çªæ—¶é€‰æ‹©æœ€é«˜ç‰ˆæœ¬çš„å€¼;\nç”±äºæ•°æ®åŠ ä¸Šç‰ˆæœ¬, æ‰€ä»¥åœ¨å†™å…¥ä¹‹å‰, client éœ€è¦é€šè¿‡ä¸€æ¬¡ quorum è¯»ç¡®è®¤æœ€æ–°çš„ç‰ˆæœ¬;\nå½“å¤šä¸ª client å‘èµ· quorum å†™æ—¶, å­˜åœ¨å¹¶å‘é—®é¢˜, å¦‚æœä¸¤ä¸ª client å†™å‰åº¦æ‹¿åˆ°çš„æœ€æ–°çš„æ•°æ®ç‰ˆæœ¬ç›¸åŒæ—¶, æ­¤æ—¶éœ€è¦å”¯ä¸€ç¡®è®¤ä¸€ä¸ªä¸‹æ¬¡è¦å†™å…¥çš„å€¼, client è¿›è¡Œ quorum å†™ä¹‹å‰, éœ€è¦å…ˆé€šçŸ¥ quorum, node è®°å½•ä¸‹æ¬¡è¦å†™å…¥çš„ client, å¹¶æ‹’ç»æ‰å…¶ä»–çš„ client;\npaxos ç®—æ³•æè¿° è§’è‰²åˆ’åˆ† Proposerï¼šææ¡ˆå‘èµ·è€…ï¼Œè´Ÿè´£æå‡ºææ¡ˆï¼ˆProposalï¼‰ã€‚ Acceptorï¼šææ¡ˆæ¥å—è€…ï¼Œè´Ÿè´£å¯¹ææ¡ˆè¿›è¡ŒæŠ•ç¥¨å’Œå­˜å‚¨ã€‚ Learnerï¼šå­¦ä¹ æœ€ç»ˆè¢«æ¥å—çš„ææ¡ˆï¼ˆé€šå¸¸æ˜¯è¢«åŠ¨æ¥æ”¶ç»“æœçš„èŠ‚ç‚¹ï¼Œä¸å‚ä¸æŠ•ç¥¨ï¼‰ã€‚ æ³¨æ„è¿™é‡Œçš„ä¸‰ä¸ªè§’è‰²é‡Œæ²¡æœ‰å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œä¸‰ç§è§’è‰²éƒ½æ˜¯æœåŠ¡ç«¯ï¼Œç®—æ³•çš„æµç¨‹ä¹Ÿæ˜¯ä¾§é‡äºæœåŠ¡ç«¯å¤šä¸ªnodeå¦‚ä½•äº¤äº’ï¼›\nClient Proposer Acceptor Learner |----å†™è¯·æ±‚---\u0026gt;| | | | |---Prepare(n)----\u0026gt;| | | |\u0026lt;--Promise(n)-----| | | |---Accept(n,v)---\u0026gt;| | | |\u0026lt;--Accepted(n)----| | | | |----Learn(v)---\u0026gt;| |\u0026lt;----OK------| | | ç®—æ³•æµç¨‹ Prepare é˜¶æ®µ\nProposer ç”Ÿæˆ å…¨å±€å”¯ä¸€ä¸”é€’å¢çš„ææ¡ˆå· nï¼Œå‘æ‰€æœ‰ Acceptor å‘é€ Prepare(n)ã€‚ Acceptor æ”¶åˆ° Prepare(n) åï¼š è‹¥ n \u0026gt; max_received_nï¼š\nâœ… æ‰¿è¯º ä¸å†æ¥å— \u0026lt;n çš„ææ¡ˆï¼Œå¹¶è¿”å›å·²æ¥å—çš„æœ€é«˜ç¼–å·ææ¡ˆ (max_accepted_n, value)ã€‚\nâœ… æ›´æ–° max_received_n = nã€‚ è‹¥ n â‰¤ max_received_nï¼š\nâŒ æ‹’ç»è¯·æ±‚ã€‚ Accept é˜¶æ®µ\nProposer è‹¥æ”¶åˆ° å¤šæ•°æ´¾ Acceptor çš„ Prepare å“åº”ï¼š ä»æ‰€æœ‰å“åº”ä¸­é€‰æ‹© æœ€é«˜ max_accepted_n å¯¹åº”çš„ value ä½œä¸ºææ¡ˆå€¼ã€‚ è‹¥æ‰€æœ‰å“åº”æ— å†å²å€¼ï¼Œå¯è‡ªç”±å†³å®š valueã€‚ å‘ Acceptor å‘é€ Accept(n, value)ã€‚ Acceptor æ”¶åˆ° Accept(n, value) åï¼š è‹¥ n â‰¥ max_received_nï¼š\nâœ… æ¥å— ææ¡ˆï¼ŒæŒä¹…åŒ–å­˜å‚¨ (n, value)ã€‚ å¦åˆ™ï¼š\nâŒ æ‹’ç»è¯·æ±‚ã€‚ Learner ä¼ æ’­\nå½“ å¤šæ•°æ´¾ Acceptor æ¥å— (n, value) åï¼ŒLearner å°† value å¹¿æ’­ä¸ºæœ€ç»ˆå€¼ã€‚ max_received_n æ˜¯ç®—æ³•çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé¦–å…ˆï¼Œå…¶å¿…é¡»ä¸ºå•è°ƒé€’å¢ï¼Œä¿è¯åœ¨å¤šä¸ªææ¡ˆä¸­ï¼Œæ€»æœ‰ä¸€ä¸ªæœ€å¤§çš„ï¼Œä¹Ÿå°±æ˜¯ Acceptor åªä¿ç•™æœ€å¤§çš„ææ¡ˆå·ï¼Œå¹¶æ‹’ç»æ¯”æœ¬åœ°è®°å½•å°çš„ææ¡ˆï¼Œå½“ä¸€ä¸ªææ¡ˆè¢«æ‹’ç»æ—¶ï¼Œè¯´æ˜æ­¤æ—¶çš„ææ¡ˆå·å·²ç»ä¸æ˜¯æœ€æ–°çš„äº†ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆææ¡ˆï¼›\nåœ¨Accepté˜¶æ®µï¼Œè¯»å–ææ¡ˆçš„æ•°æ®æ—¶ï¼Œä¹Ÿéœ€è¦è¯»å– max_accepted_n æœ€å¤§ç‰ˆæœ¬çš„æ•°æ® value ï¼Œä¿è¯æ•°æ®æ˜¯æœ€æ–°çš„ï¼›Acceptor åœ¨æ­¤é˜¶æ®µæ¥å—åˆ°Acceptè¯·æ±‚æ—¶ï¼Œä¹Ÿåˆ¤æ–­ n â‰¥ max_received_nï¼Œå¹¶ä¸”æ‹’ç»æ‰æ›´å°ç¼–å·çš„ææ¡ˆï¼Œè¿™å°±æ„å‘³ç€åœ¨ä¸¤ä¸ªææ¡ˆåŒæ—¶å‘ç”Ÿæ—¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªè¢«æ‹’ç»ï¼š\nProposer A å‘èµ·ææ¡ˆn=5ï¼Œè¿›å…¥Accepté˜¶æ®µã€‚ Proposer B å‘èµ·ææ¡ˆn=6ï¼š åœ¨Prepareé˜¶æ®µï¼ŒAcceptoræ‰¿è¯ºn=6ã€‚ Proposer B å‘ç°å¤§å¤šæ•°Acceptoræ‰¿è¯ºäº†n=6ï¼Œè¿›å…¥Accepté˜¶æ®µã€‚ Proposer A çš„Acceptè¯·æ±‚å› n=5 \u0026lt; 6è¢«æ‹’ç»ï¼Œéœ€é‡æ–°å‘èµ·æ›´é«˜ç¼–å·çš„ææ¡ˆï¼ˆå¦‚n=7ï¼‰ã€‚ ç»“æœï¼šææ¡ˆn=6æˆåŠŸå–ä»£n=5ã€‚ ",
      "summary": "paxos æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å…±è¯†ç®—æ³•, å°±æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, å¤šå‰¯æœ¬æ•°æ®å¦‚ä½•ä¿è¯è¯»å†™ä¸€è‡´æ€§çš„é—®é¢˜.\nä¸å®Œç¾çš„å‰¯æœ¬æ•°æ®åŒæ­¥æœºåˆ¶ å‡è®¾æˆ‘ä»¬æœ‰ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ, æ•°æ®åœ¨å†™å…¥æ—¶, éœ€è¦æŠŠæ•°æ®å†™å…¥åˆ°å…¶ä»–èŠ‚ç‚¹: å‰¯æœ¬æ•°æ®ä»ä¸€ä¸ªèŠ‚ç‚¹å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹, æœ‰å‡ ç§å¤åˆ¶åŠæ³•:\nåŒæ­¥å¤åˆ¶ å¼‚æ­¥å¤åˆ¶ åŠåŒæ­¥å¤åˆ¶ åŒæ­¥å¤åˆ¶ # node1, node2, node3 a=x --\u0026gt; node1 --\u0026gt; node2 ------\u0026gt; node3 --\u0026gt; done æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, éœ€è¦åŒæ—¶å†™å…¥ node1, node2, node3 ä¸‰ä¸ªèŠ‚ç‚¹, å†™å…¥å®Œæˆæ‰ç®—æ˜¯ä¸€æ¬¡å†™å…¥æˆåŠŸ;\nåŒæ­¥å¤åˆ¶æœ‰ä»€ä¹ˆé—®é¢˜:\næ€§èƒ½ä½ä¸‹; å†™å…¥æ€§èƒ½ä¼šå—åˆ¶äºèŠ‚ç‚¹æ•°é‡; æ²¡æœ‰å®¹é”™, ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å†™å…¥å¤±è´¥, åˆ™ç³»ç»Ÿä¸å¯ç”¨; å¼‚æ­¥å¤åˆ¶ a=x --\u0026gt; node1 --\u0026gt; done async( node1 --\u0026gt; node2 ; node1 --\u0026gt; node3 ) æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, åªè¦å†™å…¥ä¸€ä¸ªèŠ‚ç‚¹, åˆ™è®¤å®šå†™å…¥æˆåŠŸ, node1 å†™å…¥ node2; node1 å†™å…¥ node3 æ˜¯å¼‚æ­¥å¤åˆ¶, ä¸å½±å“æ•´ä½“å†™å…¥ç»“æœ;\nå¼‚æ­¥å¤åˆ¶æœ‰ä»€ä¹ˆé—®é¢˜:\næ•°æ®å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´, å½“ async( node1 \u0026ndash;\u0026gt; node2) å†™å…¥å¤±è´¥æ—¶, node2 å’Œ node1 ä¸Šçš„æ•°æ®å°±ä¸ä¸€è‡´; åŠåŒæ­¥å¤åˆ¶ æ•°æ®åœ¨ä¸€æ¬¡å†™å…¥æ—¶, æ•°æ®å¿…é¡»å†™å…¥ä¸€å®šé‡çš„å‰¯æœ¬(ä¸æ˜¯å…¨éƒ¨), è¿™æ ·å¤šå‰¯æœ¬åˆ™æä¾›äº†è¾ƒé«˜çš„å¯é æ€§;"
    },{
      "title": "ä¸¤é˜¶æ®µæäº¤å’Œä¸‰é˜¶æ®µæäº¤",
      "url": "https://qiref.github.io/post/2024/07/25/%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E5%92%8C%E4%B8%89%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4/",
      "content": "åˆ†å¸ƒå¼å…±è¯†é—®é¢˜ åˆ†å¸ƒå¼å…±è¯†é—®é¢˜æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹æˆ–å‚ä¸è€…éœ€è¦å°±æŸä¸ªå…±åŒçš„ç»“æœè¾¾æˆä¸€è‡´æ„è§çš„é—®é¢˜ã€‚ä¾‹å¦‚ä¸»ä»åŒæ­¥é—®é¢˜, ç®€å•çš„ä¸»ä»åŒæ­¥å¯ä»¥å€ŸåŠ©ä¸¤é˜¶æ®µæäº¤å’Œä¸‰é˜¶æ®µæäº¤æ¥è§£å†³,ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„äº‹åŠ¡æ“ä½œèƒ½å¤Ÿä¿æŒä¸€è‡´æ€§ï¼Œå³è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚\nä¸¤é˜¶æ®µæäº¤ åœ¨ä¸»ä»åŒæ­¥çš„åœºæ™¯ä¸­, backup éœ€è¦ä» master åŒæ­¥æ•°æ®, ä»æ•°æ®å†™å…¥çš„åœºæ™¯æ¥è¯´, å‡å®šä¸»ä»èŠ‚ç‚¹æ˜¯åŒæ­¥å¤åˆ¶, å®é™…ä¸Šå°±æ˜¯ä¸€æ¬¡åˆ†å¸ƒå¼äº‹åŠ¡, backup å’Œ master çš„ä¸€æ¬¡å†™å…¥è¦ä¹ˆéƒ½æˆåŠŸ, è¦ä¹ˆéƒ½å¤±è´¥, æ‰èƒ½ä¿è¯ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§;\nå€ŸåŠ©ä¸¤é˜¶æ®µæäº¤, éœ€è¦å¼•å…¥ä¸€ä¸ªåè°ƒè€…: Coordinator, å¦‚ä¸‹:\nå°†æäº¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: PreCommitã€commit;\nåœ¨ PreCommit é˜¶æ®µ, æ‰§è¡Œ WAL æµç¨‹, æŠŠäº‹åŠ¡æ—¥å¿—æå‰å†™å…¥, ç„¶å Coordinator åœ¨æ”¶åˆ°å‚ä¸è€…çš„ PreCommit ack ä¹‹å, å¼€å¯ç¬¬äºŒé˜¶æ®µ commit, commit æˆåŠŸä¹‹å, æ•°æ®æ‰ç®—æ˜¯çœŸæ­£çš„å†™å…¥. å½“ PreCommit å¤±è´¥æ—¶, Coordinator ä¼šå‘èµ·äº‹åŠ¡å›æ»š, æ‰€æœ‰å‚ä¸è€…ä¼šåŸºäº WAL çš„äº‹åŠ¡æ—¥å¿—, å›æ»šæ­¤æ¬¡äº‹åŠ¡;\nå½“ Coordinator å’Œ Participant ç½‘ç»œå¼‚å¸¸æ—¶, å¦‚æœæ˜¯åœ¨ PreCommit é˜¶æ®µ, é‚£äº‹åŠ¡éƒ½ä¸ä¼šæäº¤, ç›¸å½“äºä¸€æ¬¡å†™å…¥å°±å¤±è´¥äº†; å¦‚æœåœ¨ commit é˜¶æ®µç½‘ç»œå¼‚å¸¸, Coordinator ä¼šé‡è¯•æ‰§è¡Œ, ç›´åˆ° Participant æ¢å¤, äº‹åŠ¡é‡æ–°æäº¤æˆ–è€…å›æ»š. ä½†åœ¨æ­¤æœŸé—´, å®¢æˆ·ç«¯çš„å†™å…¥éƒ½ä¼šè¢«æ‹’ç», æ­¤æ—¶åˆ†å¸ƒå¼ç³»ç»Ÿå¤„äºä¸å¯ç”¨çŠ¶æ€(ç›¸å½“äºä¿è¯äº†æ•°æ®ä¸€è‡´æ€§, ç‰ºç‰²äº†å¯ç”¨æ€§)\nä¸‰é˜¶æ®µæäº¤ ä¸‰é˜¶æ®µæäº¤çš„å·¥ä½œæµç¨‹ï¼š å‡†å¤‡é˜¶æ®µï¼š åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€CanCommitè¯·æ±‚ã€‚ å‚ä¸è€…åœ¨å‡†å¤‡å¥½åå›å¤Yesï¼Œå¦‚æœæœ‰ä¸€ä¸ªå‚ä¸è€…å›å¤Noæˆ–è€…è¶…æ—¶ï¼Œåˆ™åè°ƒè€…ä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€Abortè¯·æ±‚ï¼Œä¸­æ­¢äº‹åŠ¡ã€‚ é¢„æäº¤é˜¶æ®µï¼š å¦‚æœæ‰€æœ‰å‚ä¸è€…å›å¤Yesï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€PreCommitè¯·æ±‚ã€‚ å‚ä¸è€…åœ¨æ”¶åˆ°PreCommitè¯·æ±‚åï¼Œå°†äº‹åŠ¡å†™å…¥æ—¥å¿—ï¼Œä½†ä¸æäº¤ã€‚å¦‚æœæœ‰ä¸€ä¸ªå‚ä¸è€…å†™å…¥å¤±è´¥ï¼Œåˆ™åè°ƒè€…ä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€Abortè¯·æ±‚ã€‚ æäº¤é˜¶æ®µï¼š åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€DoCommitè¯·æ±‚ã€‚ å‚ä¸è€…åœ¨æ”¶åˆ°DoCommitè¯·æ±‚åï¼Œæäº¤äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æºã€‚å¦‚æœæœ‰ä¸€ä¸ªå‚ä¸è€…æäº¤å¤±è´¥ï¼Œåˆ™åè°ƒè€…ä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€Abortè¯·æ±‚ã€‚ ä¸ºäº†ç¼“è§£ä¸¤é˜¶æ®µæäº¤è¿‡ç¨‹ä¸­çš„å¯ç”¨æ€§é—®é¢˜, ä¸‰é˜¶æ®µåšäº†å¦‚ä¸‹æ”¹é€ :\nåœ¨ WAL ä¹‹å‰, å¢åŠ ä¸€ä¸ªé˜¶æ®µ, CanCommit, é¿å…åœ¨ PreCommit æ—¶, æœ‰å‚ä¸è€…å¤±è´¥, å¯¼è‡´åç»­è¿˜éœ€è¦å›æ»šäº‹åŠ¡, è®©å¼‚å¸¸è¯·æ±‚å°½é‡åœ¨æœ€å¼€å§‹å°±ä¸¢å¼ƒæ‰;\nåœ¨è¿›å…¥æœ€å DoCommit æ‰§è¡Œé˜¶æ®µçš„æ—¶å€™ï¼Œå¦‚æœå‚ä¸è€…ç­‰å¾…åè°ƒè€…è¶…æ—¶äº†ï¼Œé‚£ä¹ˆå‚ä¸è€…ä¸ä¼šä¸€ç›´åœ¨é‚£é‡Œæ­»ç­‰ï¼Œè€Œæ˜¯ä¼šæŠŠå·²ç»ç­”åº”çš„äº‹åŠ¡æ‰§è¡Œå®Œæˆ;\nç”±äºå‚ä¸è€…é»˜è®¤æäº¤äº‹åŠ¡çš„æœºåˆ¶, è™½ç„¶æå‡äº†ç³»ç»Ÿçš„å¯ç”¨æ€§, ä¸ä¼šé˜»å¡å®¢æˆ·ç«¯çš„å†™å…¥, ä½†æ˜¯ä¹Ÿä¼šå¼•å…¥ä¸€äº›æ–°çš„é—®é¢˜:\nå½“å‚ä¸è€…åœ¨ PreCommit é˜¶æ®µå¼‚å¸¸, åè°ƒè€…ä¼šå›æ»šæœ¬æ¬¡äº‹åŠ¡, å¦‚æœåœ¨å›æ»šè¿‡ç¨‹ä¸­, æœ‰å¦å¤–ä¸€ä¸ªå‚ä¸è€…ä¸åè°ƒè€…ç½‘ç»œä¸­æ–­, å¯¼è‡´å‚ä¸è€…æ— æ³•æ„ŸçŸ¥åˆ°äº‹åŠ¡å›æ»šå°±é»˜è®¤æäº¤äº‹åŠ¡äº†, æ­¤æ—¶ç³»ç»Ÿä¸­çš„æ•°æ®å°±ä¸ä¸€è‡´äº†! å®é™…ä¸Šï¼Œä¸‰é˜¶æ®µæäº¤ï¼Œå°±æ˜¯ä¸ºäº†å¯ç”¨æ€§ï¼Œç‰ºç‰²äº†ä¸€è‡´æ€§.\næ€»ç»“ åœ¨æ­£å¸¸åœºæ™¯ä¸‹, ä¸‰é˜¶æ®µæäº¤ä¼šæ¯”ä¸¤é˜¶æ®µæäº¤æœ‰æ›´å¥½çš„æ€§èƒ½, åŸå› æ˜¯åœ¨å‡ºç°ç½‘ç»œå¼‚å¸¸æ—¶, æŠŠPreCommitè¯·æ±‚é˜¶æ®µæ‹†åˆ†æˆ CanCommit å’Œ PreCommit ä¸¤ä¸ªåŠ¨ä½œï¼Œç¼©çŸ­äº†å„ä¸ªå‚ä¸è€…å‘ç”ŸåŒæ­¥é˜»å¡çš„æ—¶é—´ã€‚åŒæ—¶, åœ¨ DoCommit é˜¶æ®µ, å‚ä¸è€…é»˜è®¤æäº¤ä¹Ÿå¢å¼ºæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§;\nä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´æƒè¡¡, åœ¨å¤§æ•°æ®é‡çš„åœºæ™¯ä¸‹, è¿™ç§å°æ¦‚ç‡çš„å¼‚å¸¸äº‹ä»¶ä¹Ÿä¼šæˆä¸ºå¿…ç„¶, å¹¶ä¸”ä¸¤ç§æ–¹æ¡ˆéƒ½å­˜åœ¨å•ç‚¹é—®é¢˜: coordinator, å½“åè°ƒè€…ä¸å¯ç”¨æ—¶, æ•´ä¸ªäº‹åŠ¡æ— æ³•æ¨è¿›ä¸‹å»!\n",
      "summary": "åˆ†å¸ƒå¼å…±è¯†é—®é¢˜ åˆ†å¸ƒå¼å…±è¯†é—®é¢˜æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹æˆ–å‚ä¸è€…éœ€è¦å°±æŸä¸ªå…±åŒçš„ç»“æœè¾¾æˆä¸€è‡´æ„è§çš„é—®é¢˜ã€‚ä¾‹å¦‚ä¸»ä»åŒæ­¥é—®é¢˜, ç®€å•çš„ä¸»ä»åŒæ­¥å¯ä»¥å€ŸåŠ©ä¸¤é˜¶æ®µæäº¤å’Œä¸‰é˜¶æ®µæäº¤æ¥è§£å†³,ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„äº‹åŠ¡æ“ä½œèƒ½å¤Ÿä¿æŒä¸€è‡´æ€§ï¼Œå³è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚\nä¸¤é˜¶æ®µæäº¤ åœ¨ä¸»ä»åŒæ­¥çš„åœºæ™¯ä¸­, backup éœ€è¦ä» master åŒæ­¥æ•°æ®, ä»æ•°æ®å†™å…¥çš„åœºæ™¯æ¥è¯´, å‡å®šä¸»ä»èŠ‚ç‚¹æ˜¯åŒæ­¥å¤åˆ¶, å®é™…ä¸Šå°±æ˜¯ä¸€æ¬¡åˆ†å¸ƒå¼äº‹åŠ¡, backup å’Œ master çš„ä¸€æ¬¡å†™å…¥è¦ä¹ˆéƒ½æˆåŠŸ, è¦ä¹ˆéƒ½å¤±è´¥, æ‰èƒ½ä¿è¯ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§;\nå€ŸåŠ©ä¸¤é˜¶æ®µæäº¤, éœ€è¦å¼•å…¥ä¸€ä¸ªåè°ƒè€…: Coordinator, å¦‚ä¸‹:\nå°†æäº¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ: PreCommitã€commit;\nåœ¨ PreCommit é˜¶æ®µ, æ‰§è¡Œ WAL æµç¨‹, æŠŠäº‹åŠ¡æ—¥å¿—æå‰å†™å…¥, ç„¶å Coordinator åœ¨æ”¶åˆ°å‚ä¸è€…çš„ PreCommit ack ä¹‹å, å¼€å¯ç¬¬äºŒé˜¶æ®µ commit, commit æˆåŠŸä¹‹å, æ•°æ®æ‰ç®—æ˜¯çœŸæ­£çš„å†™å…¥. å½“ PreCommit å¤±è´¥æ—¶, Coordinator ä¼šå‘èµ·äº‹åŠ¡å›æ»š, æ‰€æœ‰å‚ä¸è€…ä¼šåŸºäº WAL çš„äº‹åŠ¡æ—¥å¿—, å›æ»šæ­¤æ¬¡äº‹åŠ¡;\nå½“ Coordinator å’Œ Participant ç½‘ç»œå¼‚å¸¸æ—¶, å¦‚æœæ˜¯åœ¨ PreCommit é˜¶æ®µ, é‚£äº‹åŠ¡éƒ½ä¸ä¼šæäº¤, ç›¸å½“äºä¸€æ¬¡å†™å…¥å°±å¤±è´¥äº†; å¦‚æœåœ¨ commit é˜¶æ®µç½‘ç»œå¼‚å¸¸, Coordinator ä¼šé‡è¯•æ‰§è¡Œ, ç›´åˆ° Participant æ¢å¤, äº‹åŠ¡é‡æ–°æäº¤æˆ–è€…å›æ»š. ä½†åœ¨æ­¤æœŸé—´, å®¢æˆ·ç«¯çš„å†™å…¥éƒ½ä¼šè¢«æ‹’ç», æ­¤æ—¶åˆ†å¸ƒå¼ç³»ç»Ÿå¤„äºä¸å¯ç”¨çŠ¶æ€(ç›¸å½“äºä¿è¯äº†æ•°æ®ä¸€è‡´æ€§, ç‰ºç‰²äº†å¯ç”¨æ€§)"
    },{
      "title": "å…³äºé”çš„æ€è€ƒå’Œæ€»ç»“(äºŒ)",
      "url": "https://qiref.github.io/post/2024/05/21/%E5%85%B3%E4%BA%8E%E9%94%81%E7%9A%84%E6%80%9D%E8%80%83%E5%92%8C%E6%80%BB%E7%BB%93%E4%BA%8C/",
      "content": "ä¹¦æ¥ä¸Šæ–‡, åœ¨å•æœºæ¨¡å¼ä¸‹, å¯ä»¥å€ŸåŠ©æ“ä½œç³»ç»Ÿèƒ½åŠ›, ä½¿ç”¨åŸå­æŒ‡ä»¤å»å®ç°é”, ä½†æ˜¯åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸­, è¿™ç§æ–¹æ¡ˆå°±ä¼šæ— æ³•å®ç°, å› ä¸ºè¦ç«äº‰é”çš„è¿›ç¨‹åœ¨ä¸åŒçš„æœºå™¨ä¸Š, åˆ†å¸ƒå¼é”å› æ­¤è€Œè¯ç”Ÿ.\nåˆ†å¸ƒå¼é”çš„å¸¸è§é—®é¢˜ ä¸¾ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¡ˆä¾‹, å¦‚æœæŸä¸ªæœåŠ¡ä¸ºäº†å®ç°é«˜å¯ç”¨è€Œé‡‡ç”¨äº†å¤šå‰¯æœ¬æ¨¡å¼, å½“æœåŠ¡ä¸­å­˜åœ¨å®šæ—¶ä»»åŠ¡, å¦‚ä½•ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨è¿è¡Œå‘¢? ä»è¿™é‡Œ, é—®é¢˜å°±å¼€å§‹å˜å¾—å¤æ‚.\nå¾ˆå¸¸è§„çš„æ€è·¯å°±æ˜¯å€ŸåŠ©æ•°æ®åº“, æ“ä½œç³»ç»Ÿæä¾›äº†åŸå­æŒ‡ä»¤, åŒæ ·, æ•°æ®åº“ä¹Ÿæä¾›äº†äº‹åŠ¡æ¥ä¿è¯åŸå­æ€§, é‚£ä¹ˆæ¡ˆä¾‹ä¸­çš„é—®é¢˜å¯ä»¥è¿™ä¹ˆè§£å†³:\nå¯ä»¥è®¾è®¡ä¸€å¼ è¡¨ lock, id, key ä¸¤ä¸ªå­—æ®µ, æŠŠ key è®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•; key çš„ä¸šåŠ¡æ„ä¹‰æ˜¯å®šæ—¶ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†; æ¯ä¸ªå®ä¾‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ä¹‹å‰, å¾€è¡¨é‡Œå†™å…¥ä¸€æ¡æ•°æ®: (1, tastA), ç”±äºäº‹åŠ¡æœºåˆ¶çš„å­˜åœ¨, å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–å®ä¾‹å¾€è¿™ä¸ªè¡¨é‡Œå†™æ•°æ®æ—¶å°±ä¼šå¤±è´¥, æ­¤æ—¶è·³è¿‡å½“å‰å®ä¾‹çš„å®šæ—¶ä»»åŠ¡; æ‰§è¡Œå®Œå®šæ—¶ä»»åŠ¡ä¹‹å, æŠŠ (1, taskA) è¿™æ¡è®°å½•åˆ é™¤; é—®é¢˜è§£å†³äº†å—? è€ƒè™‘ä¸€ä¸‹å¼‚å¸¸æƒ…å†µ: å½“å®ä¾‹Aæ‹¿åˆ°é”ä¹‹åæŒ‚äº†, é‚£å…¶ä»–å®ä¾‹æ°¸è¿œä¹Ÿæ‹¿ä¸åˆ°é”äº†;\nä¸€ä¸ªå¾ˆç›´è§‚çš„æ€è·¯å°±æ˜¯ç»™é”è®¾ç½®è¶…æ—¶æ—¶é—´, ä½†æ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´å°±éœ€è¦æƒè¡¡äº†, å¦‚æœå®šæ—¶ä»»åŠ¡æœ¬èº«çš„è€—æ—¶è·Ÿé”çš„è¶…æ—¶æ—¶é—´è¿˜è¦é•¿, é‚£å°±ä¼šå‡ºç°é”è¶…æ—¶è€Œå¯¼è‡´åŒæ—¶ä¸¤ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡, å› æ­¤, è¿™ä¸ªæ–¹æ¡ˆæ˜¯éœ€è¦ä¸€å®šçš„å‰æçš„, è¿™å–å†³äºå®é™…çš„ä¸šåŠ¡åœºæ™¯;\nå†æ›´è¿›ä¸€æ­¥æ€è€ƒ, å¦‚æœçœŸçš„å®šæ—¶ä»»åŠ¡æ¯”é”çš„è¶…æ—¶æ—¶é—´è¿˜é•¿, æ€ä¹ˆè§£å†³å‘¢? é”çš„è¶…æ—¶æ—¶é—´å¦‚æœèƒ½åŠ¨æ€å˜åŒ–, è¿™ä¸ªé—®é¢˜å°±å¼•åˆƒè€Œè§£äº†, è¿™å°±æ˜¯é”ç»­æœŸ;\nlock è¡¨ç»“æ„æ”¹ä¸º: id, key, createTime, expiredTime ; åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡æ—¶,å¾€è¡¨é‡Œå†™ä¸€æ¡æ•°æ® (1, tastA), åŒæ­¥å¼€ä¸€ä¸ªçº¿ç¨‹å»ç»™é”ç»­æœŸ, expiredTime æ—¶é—´å¢åŠ ; å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æŸæ—¶, ç»­æœŸçº¿ç¨‹é€€å‡º, åˆ é™¤è®°å½• (1, tastA); æ³¨æ„, ç»­æœŸçš„å‰ææ˜¯åŠ äº†é”è¶…æ—¶çš„æœºåˆ¶, å¦‚æœä½¿ç”¨æ•°æ®åº“çš„è¯, éœ€è¦å®šæœŸæ‰«æ, å‘ç°å·²ç»è¾¾åˆ° expiredTime æ—¶, å°±åˆ é™¤è®°å½•;\né—®é¢˜çœŸçš„è§£å†³äº†å—? æœ‰ä¸€ç§åœºæ™¯, æœ‰ A, B ä¸¤ä¸ªå®ä¾‹, A æ‹¿åˆ°é”äº†, ç„¶å A å¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡, ç„¶å A å¼€å§‹ full GC, GC æœŸé—´, é”å·²ç»è¿‡æœŸäº†, B ä¸­æ£€æµ‹é”è¿‡æœŸæ—¶, å‘ç°è¿‡æœŸäº†, ç„¶åå°±åˆ é™¤ lock çš„è®°å½•, æ­¤æ—¶ B å¯ä»¥æ‹¿åˆ°é”, å¦‚æœ B ç°åœ¨æ‹¿åˆ°é”äº†, å¹¶å¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡, å¦‚æœ A åˆæ¢å¤äº†, å¯¹äº A æ¥è¯´, æ­¤æ—¶æ˜¯æ‹¿åˆ°é”çš„çŠ¶æ€, A ä¹Ÿä¼šå¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡, é”å¤±æ•ˆ!\nè¿™ä¸ªé—®é¢˜å¯ä»¥å…ˆæ”¾ä¸€ä¸‹, çœ‹å®Œæ–‡ç« å¯èƒ½ä¼šæœ‰è‡ªå·±çš„ç†è§£å’Œæ€è€ƒ.\næ€»ç»“ä¸€ä¸‹, å®ç°åˆ†å¸ƒå¼é”ä¼šé‡åˆ°å“ªäº›é—®é¢˜\né—®é¢˜1: å¦‚ä½•ä¿è¯è·å–é”, é‡Šæ”¾é”çš„åŸå­æ€§? é—®é¢˜2: client æ‹¿åˆ°é”ä¹‹åæŒ‚äº†, é”å¦‚ä½•é‡Šæ”¾? é—®é¢˜3: é”åŠ äº†è¶…æ—¶æ—¶é—´å, å¦‚ä½•ç»­æœŸ? é—®é¢˜4: æ˜¯å¦éœ€è¦é‡Šæ”¾å…¶ä»– client çš„é”? åŸºäº redis çš„åˆ†å¸ƒå¼é” ä½¿ç”¨ redis å®ç°å¤©ç„¶å°±é¿å…äº†é—®é¢˜2, å› ä¸º redis æ”¯æŒè¿‡æœŸæ—¶é—´;\nåœ¨ redis ä¸­, SETNX å‘½ä»¤ï¼Œå®ƒç”¨äºè®¾ç½®é”®å€¼å¯¹çš„å€¼ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¿™ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œæ—¶ä¼šåˆ¤æ–­é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è®¾ç½®é”®å€¼å¯¹çš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ä¸åšä»»ä½•è®¾ç½®ã€‚\nSETNX key value // åŠ é” SETNX lock_key 1 // ä¸šåŠ¡é€»è¾‘ DO THINGS // é‡Šæ”¾é” DEL lock_key é‚£åœ¨ redis ä¸­, å¦‚ä½•ä¿è¯åŸå­æ€§å‘¢?\n# NX ä¸å­˜åœ¨å³è®¾ç½®,EX PX è®¾ç½®è¿‡æœŸæ—¶é—´ SET key value [EX seconds | PX milliseconds] [NX] å¯¹äºé‡Šæ”¾é”è€Œè¨€, DEL lock_key æœ¬èº«ä¸å­˜åœ¨åŸå­æ€§çš„é—®é¢˜; ä½†æ˜¯å¦‚æœè¦è§£å†³é—®é¢˜4, ä¿è¯ client åªé‡Šæ”¾è‡ªå·±çš„é”, æ­¤æ—¶åŠ é”æ—¶å°±éœ€è¦æŠŠ value è®¾ç½®ä¸º client çš„ä¸€ä¸ªæ ‡è¯†, ä¸æ­¤åŒæ—¶, é‡Šæ”¾é”æ—¶, ä¹Ÿéœ€è¦å…ˆåˆ¤æ–­å½“å‰ client æ˜¯å¦èƒ½é‡Šæ”¾é”, æ­¤æ—¶çš„å‘½ä»¤ä¸º:\n// åŠ é”, unique_valueä½œä¸ºå®¢æˆ·ç«¯å”¯ä¸€æ€§çš„æ ‡è¯† SET lock_key unique_value NX PX 10000 //é‡Šæ”¾é” æ¯”è¾ƒunique_valueæ˜¯å¦ç›¸ç­‰ï¼Œé¿å…è¯¯é‡Šæ”¾, ä½¿ç”¨ lua è„šæœ¬ä¿è¯åŸå­æ€§ if redis.call(\u0026quot;get\u0026quot;,KEYS[1]) == ARGV[1] then return redis.call(\u0026quot;del\u0026quot;,KEYS[1]) else return 0 end KEYS[1]è¡¨ç¤º lock_keyï¼ŒARGV[1]æ˜¯å½“å‰å®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯æˆ‘ä»¬åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥.\nredis-cli --eval unlock.script lock_key , unique_value redlock ä¸Šè¿°åŸºäºrediså®ç°çš„åˆ†å¸ƒå¼é”, redis æ˜¯å•å®ä¾‹çš„, å¦‚æœè¦å¢å¼ºé”çš„å¯é æ€§, å¯ä»¥åŸºäºå¤šä¸ªredisèŠ‚ç‚¹å»å®ç°, é—®é¢˜ä»è¿™é‡Œå¼€å§‹å˜å¾—å¤æ‚, ä¸šç•Œå·²ç»å‡ºç°äº†åŸºäºå¤šä¸ªrediså®ä¾‹å®ç°åˆ†å¸ƒå¼é”çš„ç®—æ³•, redlock.\nRedlock ç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼Œæ˜¯è®©å®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ä¾æ¬¡è¯·æ±‚åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„å®ä¾‹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°è·å¾—åˆ†å¸ƒå¼é”äº†ï¼Œå¦åˆ™åŠ é”å¤±è´¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æœ‰å•ä¸ª Redis å®ä¾‹å‘ç”Ÿæ•…éšœï¼Œå› ä¸ºé”å˜é‡åœ¨å…¶å®ƒå®ä¾‹ä¸Šä¹Ÿæœ‰ä¿å­˜ï¼Œæ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æ­£å¸¸åœ°è¿›è¡Œé”æ“ä½œï¼Œé”å˜é‡å¹¶ä¸ä¼šä¸¢å¤±ã€‚\nå‰ç½®: é€‰å– N ä¸ª redis èŠ‚ç‚¹, æ— éœ€ç»„æˆå“¨å…µæˆ–è€… cluster æ¨¡å¼, è¿™é‡Œå‡è®¾ N = 5 , å¯¹äºæ¯ä¸ª redis èŠ‚ç‚¹è€Œè¨€, è·å–é”/é‡Šæ”¾é”çš„æ–¹å¼è·Ÿå•æœºç‰ˆæœ¬çš„æ–¹å¼ä¸€è‡´;\nç®—æ³•æ­¥éª¤:\nåŠ é”\nå®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´æˆ³ T1; å®¢æˆ·ç«¯ä¾æ¬¡åœ¨æ¯ä¸ª redis èŠ‚ç‚¹å»è·å–é”, æ­¤æ—¶, ä½¿ç”¨ç›¸åŒçš„ key å’Œ random value; å®¢æˆ·ç«¯è·å–é”çš„è¯·æ±‚æœ‰è¶…æ—¶æ—¶é—´, è¿™ä¸ªæ—¶é—´å°äºé”çš„æ€»çš„è¶…æ—¶æ—¶é—´(ç¤ºä¾‹å€¼: lock 10s è¶…æ—¶, client è¯·æ±‚è¶…æ—¶æ—¶é—´ 5-50 ms), è¿™ä¸ªæœºåˆ¶æ˜¯ä¸ºäº†é˜²æ­¢æŸä¸ª redis å®ä¾‹ä¸å¯ç”¨å¯¼è‡´é˜»å¡å½±å“æ•´ä¸ªæµç¨‹; å®¢æˆ·ç«¯å†æ¬¡è·å–å½“å‰æ—¶é—´æˆ³ T2, å¦‚æœæ­¤æ—¶è·å–åˆ°åŠæ•°ä¹‹ä¸ŠèŠ‚ç‚¹çš„é”(N=5 æ—¶, éœ€è¦è·å– N/2+1=3 ä¸ªèŠ‚ç‚¹çš„é”), å¹¶ä¸” T2-T1 \u0026lt; lock expired time, åˆ™è®¤ä¸ºè·å–é”æˆåŠŸ; å¦‚æœå®¢æˆ·ç«¯è·å–åˆ°äº†é”, é”çš„æœ‰æ•ˆæ—¶é—´å°±æ˜¯ T2 - T1; å¦‚æœå®¢æˆ·ç«¯ç”±äºæŸç§åŸå› æœªèƒ½è·å¾—é”ï¼ˆè¦ä¹ˆæ— æ³•é”å®š N/2+1 ä¸ªå®ä¾‹ï¼Œè¦ä¹ˆæœ‰æ•ˆæ—¶é—´ä¸ºè´Ÿï¼‰ï¼Œå®¢æˆ·ç«¯å°†å°è¯•è§£é”æ‰€æœ‰å®ä¾‹ï¼ˆç”šè‡³æ˜¯å®¢æˆ·ç«¯è®¤ä¸ºæ²¡æœ‰é”å®šçš„å®ä¾‹)ã€‚ é‡Šæ”¾é”\né‡Šæ”¾é”å¾ˆç®€å•, å‘æ‰€æœ‰èŠ‚ç‚¹å‘é€é‡Šæ”¾é”çš„è¯·æ±‚, ä½¿ç”¨ lua è„šæœ¬ä¿è¯åŸå­æ€§;\nç®—æ³•ä¸­è¶…è¿‡åŠæ•°èŠ‚ç‚¹åŠ é”æˆåŠŸå¾ˆå¥½ç†è§£, ç±»ä¼¼äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é€‰ä¸¾é—®é¢˜, æ­¥éª¤3 è®¡ç®— T2-T1 \u0026lt; lock expired time æ‰ç®—æ˜¯åŠ é”æˆåŠŸæ˜¯ä¸ºä»€ä¹ˆå‘¢?\nç”±äºè¦è¯·æ±‚å¤šä¸ªèŠ‚ç‚¹, ç½‘ç»œæƒ…å†µæ˜¯ä¸å¯é¢„æœŸçš„, è¯·æ±‚è¶Šå¤š, å“åº”çš„å»¶è¿Ÿã€ä¸¢åŒ…ç­‰é—®é¢˜å‡ºç°çš„æ¦‚ç‡å°±è¶Šå¤§, å¦‚æœè·å–é”çš„æ—¶é—´éƒ½å·²ç»è¶…è¿‡äº†é”çš„è¶…æ—¶æ—¶é—´, é‚£æœ€å¼€å§‹åŠ é”æˆåŠŸèŠ‚ç‚¹ä¸Šçš„é”å°±ä¼šè¶…æ—¶å¤±æ•ˆäº†, é‚£æœ¬æ¬¡åŠ é”å°±æ²¡æœ‰æ„ä¹‰äº†.\nä¸ºä»€ä¹ˆé‡Šæ”¾é”è¦å‘æ‰€æœ‰èŠ‚ç‚¹å‘é€è¯·æ±‚?\nå‘æ‰€æœ‰èŠ‚ç‚¹è·å–é”çš„è¿‡ç¨‹ä¸ä¸€å®šéƒ½ä¼šæˆåŠŸ, æœ‰å¯èƒ½æœ‰çš„èŠ‚ç‚¹ç”±äºç½‘ç»œåŸå› , åŠ é”æ—¶é—´ç›¸å¯¹é•¿ç”šè‡³æ˜¯åŠ é”æˆåŠŸ, ä½†æ˜¯å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚å¤±è´¥äº†, æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»æ‹¿åˆ°é”äº†, å®¢æˆ·ç«¯æ˜¯æ— æ³•æ„ŸçŸ¥å“ªäº›èŠ‚ç‚¹åŠ é”æˆåŠŸ, ä¹Ÿä¸éœ€è¦æ„ŸçŸ¥å“ªäº›èŠ‚ç‚¹åŠ é”æˆåŠŸ, ç›´æ¥å‘æ‰€æœ‰èŠ‚ç‚¹å‘é€é‡Šæ”¾é”çš„è¯·æ±‚, è¿™æ ·å¤„ç†æ›´ä¸ºç®€æ´;\nåˆ†å¸ƒå¼é”çš„ä¸€äº›ä¸šç•Œäº‰è®º Martin å¯¹ Redlock çš„è´¨ç–‘ åœ¨ Redlock æ–¹æ¡ˆæå‡ºä¹‹å, åˆ†å¸ƒå¼é¢†åŸŸçš„å¦ä¸€ä½å¤§ä½¬ã€ŠDesigning Data-Intensive Applicationsã€‹ä½œè€… Martin åŸºäº Redlock æå‡ºäº†ä¸€äº›è´¨ç–‘:\nMartin è®¤ä¸º, åˆ†å¸ƒå¼é”çš„ç›®åœ°æ˜¯æ•ˆç‡å’Œæ­£ç¡®æ€§;\nå°±æ•ˆç‡è€Œè¨€, Redlock å¦‚æœä¿è¯åŠ é”çš„é«˜æ•ˆ, ä¾‹å¦‚å¤šä¸ªå®šæ—¶ä»»åŠ¡åŒæ—¶æ‰§è¡Œä¸€ä¸ª, å°±ç®—æ˜¯æ— æ³•åšåˆ°å®Œå…¨äº’æ–¥ä¹Ÿæ— ä¼¤å¤§é›…,è€Œ Redlock åœ¨æ•ˆç‡å±‚é¢è¡¨ç°ä¸å¤ªå¥½, å®ç°è¿‡äºé‡äº†, ä¿æŒé«˜æ•ˆç”¨å•ä½“çš„ redis å°±èƒ½è¾¾åˆ°ç›®çš„, å½“ç„¶è¿™æ ·ä¼šæŸå¤±ä¸€äº›æ­£ç¡®æ€§;\nå°±æ­£ç¡®æ€§è€Œè¨€, Redlock æ— æ³•ä¿è¯æ­£ç¡®æ€§, å¦‚ä¸‹å›¾:\nè¿™é‡Œçš„ GC åªæ˜¯ä¸€ç§ä¸¾ä¾‹, åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, NPC (Nï¼šNetwork Delayï¼Œç½‘ç»œå»¶è¿Ÿ; Pï¼šProcess Pauseï¼Œè¿›ç¨‹GC/é‡å¯; Cï¼šClock Driftï¼Œæ—¶é’Ÿæ¼‚ç§») é—®é¢˜éšå¤„å¯è§;\nfecing token æ–¹æ¡ˆ Martin ä¸ä»…è´¨ç–‘äº† Redlock, è¿˜ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆ, æ€è·¯æ˜¯åœ¨èµ„æºå±‚åšéš”ç¦», ä¿è¯ä¿®æ”¹å…±äº«èµ„æºçš„æ­£ç¡®æ€§, å…·ä½“æ€è·¯å¦‚ä¸‹å›¾:\nå®¢æˆ·ç«¯è·å–åˆ°é”æ—¶, ç”±é”æœåŠ¡æä¾›ä¸€ä¸ªé€’å¢çš„ token; æ“ä½œå…±äº«èµ„æºæ—¶å¸¦ä¸Šè¿™ä¸ª token; å…±äº«èµ„æºå±‚æ‹’ç»æ‰åæ¥è€…çš„æ“ä½œè¯·æ±‚, é¿å…å„ç§ NPC é—®é¢˜; Martin çš„è¿™ä¸ªæ€è·¯æ˜¯ç«¯åˆ°ç«¯çš„è§£å†³é—®é¢˜, è€Œä¸ä»…ä»…æ˜¯ç€çœ¼äºç®—æ³•å¦‚ä½•æ‰ç®—æ‹¿åˆ°å®‰å…¨çš„é”.\nRedlock ä½œè€…çš„åé©³ Antirez çš„åé©³ä¸»è¦é’ˆå¯¹ NPC çš„å„ç§é—®é¢˜, ä»¥åŠfecing token æ–¹æ¡ˆ;\nRedlock åº”å¯¹ NPC çš„é—®é¢˜ åœ¨æ­¤ä¹‹å‰, å…ˆæ¥å›é¡¾ä¸€ä¸‹ Redlock åŠ é”çš„æµç¨‹:\nå®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´æˆ³ T1; å®¢æˆ·ç«¯ä¾æ¬¡åœ¨æ¯ä¸ª redis èŠ‚ç‚¹å»è·å–é”, æ­¤æ—¶, ä½¿ç”¨ç›¸åŒçš„ key å’Œ random value; å®¢æˆ·ç«¯è·å–é”çš„è¯·æ±‚æœ‰è¶…æ—¶æ—¶é—´, è¿™ä¸ªæ—¶é—´å°äºé”çš„æ€»çš„è¶…æ—¶æ—¶é—´(ç¤ºä¾‹å€¼: lock 10s è¶…æ—¶, client è¯·æ±‚è¶…æ—¶æ—¶é—´ 5-50 ms), è¿™ä¸ªæœºåˆ¶æ˜¯ä¸ºäº†é˜²æ­¢æŸä¸ª redis å®ä¾‹ä¸å¯ç”¨å¯¼è‡´é˜»å¡å½±å“æ•´ä¸ªæµç¨‹; å®¢æˆ·ç«¯å†æ¬¡è·å–å½“å‰æ—¶é—´æˆ³ T2, å¦‚æœæ­¤æ—¶è·å–åˆ°åŠæ•°ä¹‹ä¸ŠèŠ‚ç‚¹çš„é”(N=5 æ—¶, éœ€è¦è·å– N/2+1=3 ä¸ªèŠ‚ç‚¹çš„é”), å¹¶ä¸” T2-T1 \u0026lt; lock expired time, åˆ™è®¤ä¸ºè·å–é”æˆåŠŸ; å¦‚æœå®¢æˆ·ç«¯è·å–åˆ°äº†é”, é”çš„æœ‰æ•ˆæ—¶é—´å°±æ˜¯ T2 - T1; å¦‚æœå®¢æˆ·ç«¯ç”±äºæŸç§åŸå› æœªèƒ½è·å¾—é”ï¼ˆè¦ä¹ˆæ— æ³•é”å®š N/2+1 ä¸ªå®ä¾‹ï¼Œè¦ä¹ˆæœ‰æ•ˆæ—¶é—´ä¸ºè´Ÿï¼‰ï¼Œå®¢æˆ·ç«¯å°†å°è¯•è§£é”æ‰€æœ‰å®ä¾‹ï¼ˆç”šè‡³æ˜¯å®¢æˆ·ç«¯è®¤ä¸ºæ²¡æœ‰é”å®šçš„å®ä¾‹)ã€‚ é¦–å…ˆå¯¹äº NPC çš„æ—¶é’Ÿé—®é¢˜, è¿™ä¸ªç¡®å®ä¼šå¯¹é”äº§ç”Ÿå½±å“, ä½†æ˜¯æ—¶é’Ÿé—®é¢˜å¯ä»¥é€šè¿‡æœ‰æ•ˆçš„è¿ç»´æ‰‹æ®µè§£å†³, æ¯”å¦‚: 1. ç³»ç»Ÿç®¡ç†å‘˜ä¿®æ”¹äº†æ—¶é’Ÿ; 2. ä»æ—¶é’ŸæœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ›´å¤§çš„æ—¶é’Ÿ; å¯¹äºè¿™ä¸¤ç§æƒ…å†µè€Œè¨€, æ˜¯å¯ä»¥é€šè¿‡è¿ç»´æ‰‹æ®µä¿è¯çš„, æ‰‹åŠ¨ä¿®æ”¹æ—¶é’Ÿè¿™ç§æƒ…å†µ, ç±»ä¼¼äºæœ‰äººæ‰‹åŠ¨ä¿®æ”¹ Raft çš„æ—¥å¿—, è¿™ç§æƒ…å†µä¸‹ Raft ä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œ; NTP server æ˜¯å¯ä»¥é€šè¿‡è°ƒæ•´é…ç½®æ¥ä¿è¯æ—¶é’Ÿä¸ä¼šå¤§å¹…åº¦è·³è·ƒ;\nè€Œå¯¹äº NPC çš„å¦å¤–ä¸¤ç§æƒ…å†µ, è¿›ç¨‹GC ã€ç½‘ç»œå»¶è¿Ÿ, è¿™ä¸¤ç§æƒ…å†µéƒ½å¯ä»¥åœ¨ç®—æ³•çš„ 1-4æ­¥å‘ç°, è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ T2-T1, å½“å‘ç° T2-T1 \u0026lt; lock expired time ä¸æˆç«‹æ—¶, åˆ™è·å–é”å¤±è´¥äº†, é‚£å°±æ‰§è¡Œè§£é”æµç¨‹å°±å¥½äº†. è€Œåœ¨ç¬¬4æ­¥ä¹‹å, client æ‹¿åˆ°é”é‡åˆ°å¼‚å¸¸æƒ…å†µ, è¿™å¹¶éæ˜¯ RedLock ç‹¬æœ‰çš„é—®é¢˜, ä»»ä½•ä¸€ç§åˆ†å¸ƒå¼é”å®ç°éƒ½ä¼šé¢ä¸´è¿™ä¸ªé—®é¢˜, ä¸åœ¨è®¨è®ºèŒƒç•´;\nå€¼å¾—ä¸€æçš„æ˜¯, Antirez è¿™é‡Œä¸ºä»€ä¹ˆè¦å•ç‹¬è§£é‡Šæ—¶é’Ÿé—®é¢˜, è¿™å…¶å®æ˜¯ Redlock ç®—æ³•çš„å‰æ, å¦‚æœè®¡ç®— T2-T1 \u0026lt; lock expired time T1 åˆ° T2 çš„æ—¶é’Ÿå‡ºç°è·³è·ƒ, é‚£å…¶å®é”çš„è¿‡æœŸæ—¶é—´å°±ä¼šè®¡ç®—æœ‰è¯¯, æ¯”å¦‚redis å®ä¾‹ä¸­çš„ value å…¶å®å·²ç»è¿‡æœŸ, ä½†æ˜¯å®¢æˆ·ç«¯è®¤ä¸ºè¿˜æ‹¿åˆ°é”äº†, è¿™ä¸ªæ‰æ˜¯ç®—æ³•çš„å…³é”®æ‰€åœ¨!\nè´¨ç–‘ fencing token æœºåˆ¶ Antirez é’ˆå¯¹ fencing token æœºåˆ¶æå‡ºä¸¤ç‚¹è´¨ç–‘:\nå±€é™æ€§, æ•°æ®é¢çš„éš”ç¦»éœ€è¦ä¾èµ–äºæ•°æ®å­˜å‚¨çš„å®¹å™¨, å¦‚æœæ˜¯ç±»ä¼¼äºmysqlçš„æ•°æ®, å¾ˆå®¹æ˜“å®ç°å¸¦æ¡ä»¶çš„æ›´æ–°, å¦‚æœæ˜¯æ— çŠ¶æ€çš„ http æœåŠ¡, æ— æ³•éš”ç¦»æ•°æ®, è¿™ç§æ–¹æ¡ˆå°±ä¸é€‚ç”¨äº†; æ•°æ®å±‚é¢å·²ç»åšäº†éš”ç¦», é‚£åˆ†å¸ƒå¼é”å­˜åœ¨è¿˜æœ‰å¿…è¦å—? ä¸ªäººè®¤ä¸º, åœ¨åˆ†å¸ƒå¼é¢†åŸŸæ²¡æœ‰é“¶å¼¹, éšå¤„å¯ä»¥è§å¦¥åå’ŒæŠ˜ä¸­çš„è®¾è®¡, ç»“åˆä¸šåŠ¡ç«¯åˆ°ç«¯çœ‹é—®é¢˜æ‰æ˜¯æ­£è§£, è¿™é‡Œ fencing token çš„å±€é™æ€§å®¢è§‚å­˜åœ¨, ä½†å…¶èƒŒåçš„æ€è·¯å´æ˜¯å¾ˆå€¼å¾—å€Ÿé‰´: å¦‚æœä¸šåŠ¡å¯¹æ•°æ®æ­£ç¡®æ€§è¦æ±‚éå¸¸é«˜, å¯¹ä¸Šå±‚çš„æœºåˆ¶çš„å¯é æ€§éœ€è¦æå‡ºè´¨ç–‘, æ•°æ®é¢çš„éš”ç¦»æ˜¯å¿…è¦çš„.\nåŸºäº zookeeper çš„åˆ†å¸ƒå¼é” åœ¨ZooKeeperä¸­ï¼ŒephemeralèŠ‚ç‚¹æ˜¯ä¸€ç§ä¸´æ—¶èŠ‚ç‚¹ï¼Œå®ƒä¸åˆ›å»ºå®ƒçš„å®¢æˆ·ç«¯ä¼šè¯ç›¸å…³è”ã€‚å½“åˆ›å»ºè¿™æ ·çš„èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯ç»“æŸï¼ˆä¾‹å¦‚å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æˆ–ä¼šè¯è¶…æ—¶ï¼‰ï¼Œè¿™äº›èŠ‚ç‚¹å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚ ä¸€äº›å…³äºZooKeeper ephemeralèŠ‚ç‚¹çš„é‡è¦ç‰¹æ€§åŒ…æ‹¬ï¼š\nä¸´æ—¶æ€§ï¼šèŠ‚ç‚¹ä¸å®¢æˆ·ç«¯ä¼šè¯ç›¸å…³è”ï¼Œä¼šè¯ç»“æŸæ—¶èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤ã€‚ é¡ºåºæ€§ï¼šå¯ä»¥ä¸ºephemeralèŠ‚ç‚¹è®¾ç½®é¡ºåºæ ‡å¿—ï¼Œä½¿èŠ‚ç‚¹æŒ‰ç…§åˆ›å»ºé¡ºåºè¿›è¡Œç¼–å·ã€‚ é€šçŸ¥æœºåˆ¶ï¼šZooKeeperå…è®¸å®¢æˆ·ç«¯æ³¨å†Œå¯¹èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬å™¨ï¼Œå½“ephemeralèŠ‚ç‚¹åˆ›å»ºæˆ–åˆ é™¤æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚ åŸºäº ZooKeeper ä»¥ä¸Šç‰¹æ€§, å¯ä»¥å®ç°åˆ†å¸ƒå¼é”:\nå®¢æˆ·ç«¯å°è¯•åˆ›å»ºä¸€ä¸ª znode èŠ‚ç‚¹(ephemeral)ï¼Œæ¯”å¦‚/lockã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å°±åˆ›å»ºæˆåŠŸäº†ï¼Œç›¸å½“äºæ‹¿åˆ°äº†é”ï¼›è€Œå…¶å®ƒçš„å®¢æˆ·ç«¯ä¼šåˆ›å»ºå¤±è´¥ï¼ˆznode å·²å­˜åœ¨ï¼‰ï¼Œè·å–é”å¤±è´¥ã€‚ æŒæœ‰é”çš„å®¢æˆ·ç«¯è®¿é—®å…±äº«èµ„æºå®Œæˆåï¼Œå°† znode åˆ æ‰ï¼Œè¿™æ ·å…¶å®ƒå®¢æˆ·ç«¯æ¥ä¸‹æ¥å°±èƒ½æ¥è·å–é”äº†ã€‚ å¦‚æœåˆ›å»º znode çš„é‚£ä¸ªå®¢æˆ·ç«¯å´©æºƒäº†ï¼Œé‚£ä¹ˆç›¸åº”çš„ znode ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚è¿™ä¿è¯äº†é”ä¸€å®šä¼šè¢«é‡Šæ”¾, å› æ­¤ä¸éœ€è¦è€ƒè™‘è¿‡æœŸçš„é—®é¢˜, ä¹Ÿéœ€è¦è®¾è®¡ç»­æœŸçš„æœºåˆ¶.\nä½†æ˜¯åŸºäº ZooKeeper å®ç°çš„åˆ†å¸ƒå¼é”, ä¾ç„¶ä¼šé¢ä¸´ NPC é—®é¢˜, å½“ client1 è·å–åˆ°é”ä¹‹å, è¿›å…¥é•¿æ—¶é—´ GC, æ­¤æ—¶ client1 ä¸ ZooKeeper çš„ seesion è¶…æ—¶, ephemeralèŠ‚ç‚¹ä¼šè¢«åˆ é™¤, æ­¤æ—¶å…¶ä»–å®¢æˆ·ç«¯å¯èƒ½ä¼šæ‹¿åˆ°é”, é”å¤±æ•ˆ.\næ€»ç»“ åŸºäºä¸Šæ–‡, å¯¹äºåˆ†å¸ƒå¼é”çš„å®ç°è€Œè¨€:\nåˆ†å¸ƒå¼é”å¹¶ä¸æ˜¯ 100% å®‰å…¨, æ— å…³äºå®ç°æ–¹å¼, redisã€zkã€æ•°æ®åº“; ä¸€ä¸ªä¸¥è°¨çš„åˆ†å¸ƒå¼é”æ¨¡å‹åº”è¯¥è€ƒè™‘é”ç§ŸæœŸã€é”å½’å±ã€NPC é—®é¢˜; å·¥ç¨‹å®è·µæ—¶, éœ€è¦æ ¹æ®ä¸šåŠ¡è¿›è¡Œå–èˆ; å¯¹äºä¸¥æ ¼è¦æ±‚æ•°æ®æ­£ç¡®æ€§çš„åœºæ™¯ä¸‹, éœ€è¦ç«¯åˆ°ç«¯çš„è€ƒè™‘æ•°æ®çš„æ­£ç¡®æ€§, ä¸åº”è¯¥å¼ºä¾èµ–äºåˆ†å¸ƒå¼é”æœºåˆ¶, åˆ†å¸ƒå¼é”å¯ä»¥åœ¨ä¸Šå±‚æ‹¦æˆªå¤§æ‰¹é‡è¯·æ±‚, åº•å±‚æ•°æ®é¢éœ€è¦æœ‰ç›¸åº”çš„å…œåº•ç­–ç•¥; Martin: For me, this is the most important point: I donâ€™t care who is right or wrong in this debate â€” I care about learning from othersâ€™ work, so that we can avoid repeating old mistakes, and make things better in future. So much great work has already been done for us: by standing on the shoulders of giants, we can build better software.\nå‚è€ƒ https://redis.io/docs/latest/develop/use/patterns/distributed-locks/ https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html\n",
      "summary": "ä¹¦æ¥ä¸Šæ–‡, åœ¨å•æœºæ¨¡å¼ä¸‹, å¯ä»¥å€ŸåŠ©æ“ä½œç³»ç»Ÿèƒ½åŠ›, ä½¿ç”¨åŸå­æŒ‡ä»¤å»å®ç°é”, ä½†æ˜¯åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸­, è¿™ç§æ–¹æ¡ˆå°±ä¼šæ— æ³•å®ç°, å› ä¸ºè¦ç«äº‰é”çš„è¿›ç¨‹åœ¨ä¸åŒçš„æœºå™¨ä¸Š, åˆ†å¸ƒå¼é”å› æ­¤è€Œè¯ç”Ÿ.\nåˆ†å¸ƒå¼é”çš„å¸¸è§é—®é¢˜ ä¸¾ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¡ˆä¾‹, å¦‚æœæŸä¸ªæœåŠ¡ä¸ºäº†å®ç°é«˜å¯ç”¨è€Œé‡‡ç”¨äº†å¤šå‰¯æœ¬æ¨¡å¼, å½“æœåŠ¡ä¸­å­˜åœ¨å®šæ—¶ä»»åŠ¡, å¦‚ä½•ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨è¿è¡Œå‘¢? ä»è¿™é‡Œ, é—®é¢˜å°±å¼€å§‹å˜å¾—å¤æ‚.\nå¾ˆå¸¸è§„çš„æ€è·¯å°±æ˜¯å€ŸåŠ©æ•°æ®åº“, æ“ä½œç³»ç»Ÿæä¾›äº†åŸå­æŒ‡ä»¤, åŒæ ·, æ•°æ®åº“ä¹Ÿæä¾›äº†äº‹åŠ¡æ¥ä¿è¯åŸå­æ€§, é‚£ä¹ˆæ¡ˆä¾‹ä¸­çš„é—®é¢˜å¯ä»¥è¿™ä¹ˆè§£å†³:\nå¯ä»¥è®¾è®¡ä¸€å¼ è¡¨ lock, id, key ä¸¤ä¸ªå­—æ®µ, æŠŠ key è®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•; key çš„ä¸šåŠ¡æ„ä¹‰æ˜¯å®šæ—¶ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†; æ¯ä¸ªå®ä¾‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ä¹‹å‰, å¾€è¡¨é‡Œå†™å…¥ä¸€æ¡æ•°æ®: (1, tastA), ç”±äºäº‹åŠ¡æœºåˆ¶çš„å­˜åœ¨, å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–å®ä¾‹å¾€è¿™ä¸ªè¡¨é‡Œå†™æ•°æ®æ—¶å°±ä¼šå¤±è´¥, æ­¤æ—¶è·³è¿‡å½“å‰å®ä¾‹çš„å®šæ—¶ä»»åŠ¡; æ‰§è¡Œå®Œå®šæ—¶ä»»åŠ¡ä¹‹å, æŠŠ (1, taskA) è¿™æ¡è®°å½•åˆ é™¤; é—®é¢˜è§£å†³äº†å—? è€ƒè™‘ä¸€ä¸‹å¼‚å¸¸æƒ…å†µ: å½“å®ä¾‹Aæ‹¿åˆ°é”ä¹‹åæŒ‚äº†, é‚£å…¶ä»–å®ä¾‹æ°¸è¿œä¹Ÿæ‹¿ä¸åˆ°é”äº†;\nä¸€ä¸ªå¾ˆç›´è§‚çš„æ€è·¯å°±æ˜¯ç»™é”è®¾ç½®è¶…æ—¶æ—¶é—´, ä½†æ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´å°±éœ€è¦æƒè¡¡äº†, å¦‚æœå®šæ—¶ä»»åŠ¡æœ¬èº«çš„è€—æ—¶è·Ÿé”çš„è¶…æ—¶æ—¶é—´è¿˜è¦é•¿, é‚£å°±ä¼šå‡ºç°é”è¶…æ—¶è€Œå¯¼è‡´åŒæ—¶ä¸¤ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡, å› æ­¤, è¿™ä¸ªæ–¹æ¡ˆæ˜¯éœ€è¦ä¸€å®šçš„å‰æçš„, è¿™å–å†³äºå®é™…çš„ä¸šåŠ¡åœºæ™¯;\nå†æ›´è¿›ä¸€æ­¥æ€è€ƒ, å¦‚æœçœŸçš„å®šæ—¶ä»»åŠ¡æ¯”é”çš„è¶…æ—¶æ—¶é—´è¿˜é•¿, æ€ä¹ˆè§£å†³å‘¢? é”çš„è¶…æ—¶æ—¶é—´å¦‚æœèƒ½åŠ¨æ€å˜åŒ–, è¿™ä¸ªé—®é¢˜å°±å¼•åˆƒè€Œè§£äº†, è¿™å°±æ˜¯é”ç»­æœŸ;\nlock è¡¨ç»“æ„æ”¹ä¸º: id, key, createTime, expiredTime ; åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡æ—¶,å¾€è¡¨é‡Œå†™ä¸€æ¡æ•°æ® (1, tastA), åŒæ­¥å¼€ä¸€ä¸ªçº¿ç¨‹å»ç»™é”ç»­æœŸ, expiredTime æ—¶é—´å¢åŠ ; å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æŸæ—¶, ç»­æœŸçº¿ç¨‹é€€å‡º, åˆ é™¤è®°å½• (1, tastA); æ³¨æ„, ç»­æœŸçš„å‰ææ˜¯åŠ äº†é”è¶…æ—¶çš„æœºåˆ¶, å¦‚æœä½¿ç”¨æ•°æ®åº“çš„è¯, éœ€è¦å®šæœŸæ‰«æ, å‘ç°å·²ç»è¾¾åˆ° expiredTime æ—¶, å°±åˆ é™¤è®°å½•;"
    },{
      "title": "å…³äºé”çš„æ€è€ƒå’Œæ€»ç»“(ä¸€)",
      "url": "https://qiref.github.io/post/2024/05/15/%E5%85%B3%E4%BA%8E%E9%94%81%E7%9A%84%E6%80%9D%E8%80%83%E5%92%8C%E6%80%BB%E7%BB%93%E4%B8%80/",
      "content": "func add (a *int) *int { *a++ // çº¿ç¨‹ä¸å®‰å…¨ return a } è¿™æ˜¯ä¸€æ®µå¾ˆå…¸å‹çš„çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹, åœ¨å¹¶å‘åœºæ™¯ä¸‹, a çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„, å¤§æ¦‚ç‡ä¼šå°äº 1000, åŸå› æ˜¯ a++ å¹¶éåŸå­æ“ä½œ, ä¼šå­˜åœ¨åŒæ—¶æœ‰ä¸¤ä¸ªåç¨‹è¯»å–åˆ° a çš„å€¼æ˜¯ç›¸åŒçš„æƒ…å†µ, æ‰§è¡Œ a++ä¹‹åå†é‡æ–°å›å†™æ—¶, açš„å€¼ä¹Ÿæ˜¯ç›¸åŒçš„, æƒ³è¦å˜ä¸ºçº¿ç¨‹å®‰å…¨, å°±éœ€è¦åœ¨æ“ä½œä¸´ç•Œèµ„æºä¹‹å‰åŠ é”;\nMutex åœ¨æ“ä½œå…±äº«èµ„æºä¹‹å‰åŠ é”, ç„¶åæ“ä½œå®Œä¸´ç•Œèµ„æºä¹‹åé‡Šæ”¾é”, ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªåç¨‹æ“ä½œä¸´ç•Œèµ„æº;\nvar mu sync.Mutex func addSafe(a *int) *int { mu.Lock() // åŠ é” defer mu.Unlock() // é‡Šæ”¾é” *a++ return a } é”åœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ç¯å¢ƒä¸­å®ç°èµ„æºçš„äº’æ–¥è®¿é—®ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æƒ³è¦è®¿é—®æŸä¸ªå…±äº«èµ„æºï¼ˆå¦‚æ•°æ®ç»“æ„ã€æ–‡ä»¶ç­‰ï¼‰æ—¶ï¼Œå®ƒå¿…é¡»é¦–å…ˆå°è¯•è·å–è¯¥èµ„æºå¯¹åº”çš„é”ã€‚å¦‚æœé”æœªè¢«å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹å ç”¨ï¼Œé‚£ä¹ˆè¯·æ±‚çš„çº¿ç¨‹æˆ–è¿›ç¨‹å°†è·å¾—é”å¹¶ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™ï¼Œå®ƒå°†ç­‰å¾…ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚\n// If the lock is already in use, the calling goroutine // blocks until the mutex is available. func (m *Mutex) Lock() { // Fast path: grab unlocked mutex. if atomic.CompareAndSwapInt32(\u0026amp;m.state, 0, mutexLocked) { if race.Enabled { race.Acquire(unsafe.Pointer(m)) } return } // Slow path (outlined so that the fast path can be inlined) m.lockSlow() } type Mutex struct { state int32 // state è¡¨ç¤ºå½“å‰äº’æ–¥é”çš„çŠ¶æ€ sema uint32 // sema æ˜¯ç”¨äºæ§åˆ¶é”çŠ¶æ€çš„ä¿¡å·é‡ } åœ¨ golang çš„å®ç°ä¸­, å¦‚æœé€šè¿‡ CompareAndSwapInt32 ä¹Ÿå°±æ˜¯ CAS èƒ½è·å–åˆ°é”, è¡¨æ˜åç¨‹å·²ç»èƒ½æ‹¿åˆ°é”äº†, æ­¤æ—¶ç›´æ¥è¿”å›;\nå¦‚æœé€šè¿‡ CAS æ— æ³•æ‹¿åˆ°é”, è¯´æ˜æœ‰å…¶ä»–åç¨‹æ‹¿åˆ°é”è¿˜æœªé‡Šæ”¾, è¿™æ—¶å€™çš„é€‰æ‹©å°±ä¼šå¾ˆå¤šäº†, å¯ä»¥åŸåœ°é‡è¯•, ä¹Ÿå°±æ˜¯è‡ªæ—‹çš„ç‰¹æ€§, ä¹Ÿå¯ä»¥è¿›å…¥é˜Ÿåˆ—ç­‰å¾…, ç­‰å¾…è¢«å”¤é†’;\nä¸€èˆ¬æ¥è¯´, ç¼–ç¨‹è¯­è¨€çš„å®ç°ä¸­, ä¼šä¼˜å…ˆé€‰æ‹©è‡ªæ—‹, å› ä¸ºæ­¤æ—¶è¿˜æ˜¯åœ¨ç”¨æˆ·æ€, ä½†æ˜¯å¹¶å‘é‡å¾ˆå¤§æ—¶, è‡ªæ—‹åè€Œä¼šé™ä½æ€§èƒ½.\n// lockSlow() ä»£ç ç‰‡æ®µ ... if atomic.CompareAndSwapInt32(\u0026amp;m.state, old, new) { if old\u0026amp;(mutexLocked|mutexStarving) == 0 { break // locked the mutex with CAS } // If we were already waiting before, queue at the front of the queue. queueLifo := waitStartTime != 0 if waitStartTime == 0 { waitStartTime = runtime_nanotime() } runtime_SemacquireMutex(\u0026amp;m.sema, queueLifo, 1) ... } å½“ CAS å’Œè‡ªæ—‹ä¹‹åä¾ç„¶æ²¡æœ‰è·å–åˆ°é”, ä¸ºäº†é˜²æ­¢å¤§æ‰¹é‡åç¨‹è‡ªæ—‹, lockSlow() ä¸­, runtime_SemacquireMutex(\u0026amp;m.sema, queueLifo, 1) ç»™å‡ºäº†ä¸€ç§æ–°çš„æ–¹å¼å»è·å–é”, ä»å…¥å‚æ¥çœ‹, ä¼ å…¥äº†ä¸€ä¸ªä¿¡å·é‡, æ˜¯å¦éœ€è¦ LIFO çš„é˜Ÿåˆ—, å’Œä¸€ä¸ªå€¼, å®ç°æ€è·¯å¤§æ¦‚æ˜¯å¦‚æœæ²¡è·å–åˆ°é”, å°±è¿›å…¥ç­‰å¾…é˜Ÿåˆ—, ç­‰å¾…è¢«å”¤é†’;\n// func runtime_SemacquireMutex(addr *uint32, lifo bool, skipframes int32) TEXT runtimeÂ·runtime_SemacquireMutex(SB), NOSPLIT, $0-12 MOVL addr+0(FP), BP // å°†äº’æ–¥é”çš„åœ°å€åŠ è½½åˆ° BP å¯„å­˜å™¨ MOVL lifo+4(FP), AX // å°† lifo å‚æ•°åŠ è½½åˆ° AX å¯„å­˜å™¨ MOVL skipframes+8(FP), CX // å°† skipframes å‚æ•°åŠ è½½åˆ° CX å¯„å­˜å™¨ // å°è¯•åŸå­åœ°è·å–äº’æ–¥é” acquire: MOVL $1, SI // å°† SI å¯„å­˜å™¨è®¾ç½®ä¸º 1 XCHGL SI, 0(BP) // ä½¿ç”¨ XCHGL æŒ‡ä»¤åŸå­åœ°äº¤æ¢ SI å’Œäº’æ–¥é”çš„å€¼ TESTL SI, SI // æ£€æŸ¥ SI å¯„å­˜å™¨çš„å€¼ï¼ˆå³åŸäº’æ–¥é”çš„å€¼ï¼‰ JZ acquired // å¦‚æœ SI å¯„å­˜å™¨çš„å€¼ä¸º 0ï¼Œè¡¨ç¤ºäº’æ–¥é”å·²è¢«è·å–ï¼Œè·³è½¬åˆ° acquired æ ‡ç­¾ // äº’æ–¥é”å·²è¢«å ç”¨ï¼Œé˜»å¡å½“å‰åç¨‹ï¼ˆgoroutineï¼‰ MOVL BP, 0(SP) // å°†äº’æ–¥é”çš„åœ°å€å­˜å‚¨åˆ°æ ˆä¸Š MOVL AX, 4(SP) // å°† lifo å‚æ•°å­˜å‚¨åˆ°æ ˆä¸Š MOVL CX, 8(SP) // å°† skipframes å‚æ•°å­˜å‚¨åˆ°æ ˆä¸Š CALL runtimeÂ·semacquire1(SB) // è°ƒç”¨ semacquire1 å‡½æ•°é˜»å¡å½“å‰åç¨‹ JMP acquire // å½“åç¨‹è¢«å”¤é†’æ—¶ï¼Œè·³å›åˆ° acquire æ ‡ç­¾å°è¯•å†æ¬¡è·å–äº’æ–¥é” acquired: // äº’æ–¥é”å·²è¢«æˆåŠŸè·å–ï¼Œæ‰§è¡Œåç»­ä»£ç  // ... RET CAS Mutex åŠ é”ä¸ºä»€ä¹ˆä¼šå½±å“æ€§èƒ½å‘¢? åŸºäºMutexçš„åŸç†: å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”æ—¶ï¼Œå®ƒå°†è¢«é˜»å¡ã€‚é˜»å¡çš„çº¿ç¨‹ä¼šè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾…é”è¢«é‡Šæ”¾, å½“é”è¢«é‡Šæ”¾æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå”¤é†’ç­‰å¾…é”çš„çº¿ç¨‹, ä½¿å…¶é‡æ–°å°è¯•è·å–é”. ä¸€èˆ¬æ¥è¯´, ç­‰å¾…çš„çº¿ç¨‹ä¼šæ”¾åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…, ä»¥ä¿éšœåç»­å”¤é†’çš„é¡ºåºã€‚\nè¿™é‡Œè€—æ—¶çš„ä¸»è¦åŸå› æ˜¯çº¿ç¨‹è¢«é˜»å¡è¿›å…¥ç¡çœ çŠ¶æ€, è€Œååˆè¢«å”¤é†’, è¿™äº›æ“ä½œéƒ½éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸æ€ ,å¦‚æœè¯´çº¿ç¨‹åœ¨æ²¡è·å–åˆ°é”æ—¶ä¸è¿›å…¥ç¡çœ çŠ¶æ€, è€Œæ˜¯åŸåœ°é‡è¯•, é‚£æ˜¯ä¸æ˜¯å°±èƒ½æé«˜æ•ˆç‡å‘¢? è¿™å°±æ˜¯ CAS çš„æ€è·¯, å…ˆæ¥çœ‹çœ‹ golang ä¸­å¯¹ CAS çš„ç›¸å…³å®ç°:\n// CompareAndSwapInt32 executes the compare-and-swap operation for an int32 value. // Consider using the more ergonomic and less error-prone [Int32.CompareAndSwap] instead. func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool) è¿™ç§åªæœ‰å‡½æ•°å£°æ˜ï¼Œæ²¡æœ‰å‡½æ•°å®ç°çš„ï¼Œé€šå¸¸æ„å‘³ç€å‡½æ•°çš„å®ç°åœ¨golangæ±‡ç¼–ä¸­, ä¹Ÿå°±æ˜¯è¿˜æ˜¯éœ€è¦å€ŸåŠ©ç³»ç»Ÿçš„èƒ½åŠ›å®ç° CAS, ä»æ±‡ç¼–æŒ‡ä»¤ä¸Šçœ‹, å¯¹äº addr æ¥è¯´, å¦‚æœ addr == old , å°±æŠŠ addr è®¾ç½®ä¸º new;\nåœ¨ X86 æ¶æ„ä¸‹:\n// func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool) TEXT runtimeÂ·CompareAndSwapInt32(SB), NOSPLIT, $0-13 MOVL addr+0(FP), BP // å°†ç›®æ ‡åœ°å€åŠ è½½åˆ° BP å¯„å­˜å™¨ MOVL old+4(FP), AX // å°† old å‚æ•°åŠ è½½åˆ° AX å¯„å­˜å™¨ MOVL new+8(FP), CX // å°† new å‚æ•°åŠ è½½åˆ° CX å¯„å­˜å™¨ // ä½¿ç”¨ CMPXCHGL æŒ‡ä»¤åŸå­åœ°æ¯”è¾ƒå’Œäº¤æ¢å€¼ MOVL AX, 0(BP) // å°† AX å¯„å­˜å™¨çš„å€¼å­˜å‚¨åˆ°ç›®æ ‡åœ°å€ LOCK CMPXCHGL CX, 0(BP) // åŸå­åœ°æ¯”è¾ƒå’Œäº¤æ¢ç›®æ ‡åœ°å€å’Œ CX å¯„å­˜å™¨çš„å€¼ // è®¾ç½®è¿”å›å€¼ SETE AL // å¦‚æœæ¯”è¾ƒå’Œäº¤æ¢æˆåŠŸï¼Œå°† AL å¯„å­˜å™¨è®¾ç½®ä¸º 1ï¼ˆtrueï¼‰ï¼Œå¦åˆ™è®¾ç½®ä¸º 0ï¼ˆfalseï¼‰ MOVB AL, swapped+12(FP) // å°† AL å¯„å­˜å™¨çš„å€¼å­˜å‚¨åˆ°è¿”å›å€¼ä¸­ RET è¿™æ®µæ±‡ç¼–ä¸­, æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯ LOCK CMPXCHGL , LOCK å‰ç¼€ç”¨äºç¡®ä¿æŒ‡ä»¤åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å¤„ç†å™¨æˆ–çº¿ç¨‹ä¸­æ–­ã€‚å½“ LOCK å‰ç¼€ä¸ CMPXCHGL æŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶ï¼Œç¡®ä¿äº†åœ¨æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œæ•°çš„è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä½ç½®çš„å€¼ä¸ä¼šè¢«å…¶ä»–å¤„ç†å™¨æˆ–çº¿ç¨‹ä¿®æ”¹ï¼Œä»è€Œå®ç°äº†åŸå­æ€§ã€‚\nä» CompareAndSwapInt32 å‡½æ•°çš„è¿”å›ç»“æœæ¥çœ‹, æ‰§è¡Œå‡½æ•°å¯èƒ½ä¼šå¤±è´¥, ä¹Ÿå°±æ˜¯æ²¡è·å–åˆ°é”, å¾€å¾€è¿™ç§æƒ…å†µä¼šè¿›è¡Œé‡è¯•, ç›´åˆ°æ‰§è¡Œå®Œæˆ, ä¹Ÿå°±æ˜¯è‡ªæ—‹çš„ç‰¹æ€§; å½“ç„¶è¿™ç§è‡ªæ—‹æ˜¯åœ¨ç”¨æˆ·æ€, æ— éœ€åˆ‡æ¢åˆ°å†…æ ¸æ€, å› æ­¤æ€§èƒ½ä¸Šç›¸å¯¹æ›´å¥½;\næ¯”å¦‚åœ¨ java è¯­è¨€ä¸­å¯¹äº CAS çš„ä½¿ç”¨:\npublic final int getAndAddInt(Object var1, long var2, int var4) { int var5; do { var5 = this.getIntVolatile(var1, var2); } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5; } ABA é—®é¢˜ func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool) åœ¨ CAS ä¸­, å¯¹äº addr æ¥è¯´, å¦‚æœ addr == old , å°±æŠŠ addr è®¾ç½®ä¸º new, åœ¨æ­¤è¿‡ç¨‹ä¸­, ä¾ç„¶å­˜åœ¨é—®é¢˜;\nå½“çº¿ç¨‹ T1 è¿›å…¥ CAS ä¹‹å‰, è¯»å–äº†ä¸€ä¸ª old å€¼, å‡è®¾ä¸º A; çº¿ç¨‹ T1 æ—¶é—´ç‰‡è€—å°½, çº¿ç¨‹ T2 å¼€å§‹æ‰§è¡Œ; T2 æ‰§è¡Œ CAS, æŠŠ addr è®¾ç½®ä¸º B, ç„¶ååˆæ‰§è¡Œ CAS , æŠŠ addr ä¿®æ”¹å› A; å½“ T1 ç»§ç»­æ‰§è¡Œæ—¶, å‘ç° addr ä¾ç„¶ä¸º old A, T1 ä¼šè®¤ä¸º addr æ²¡æœ‰è¢«ä¿®æ”¹è¿‡; å¦‚æœè¦è§£å†³ ABA é—®é¢˜, ä¸€ä¸ªå¯è¡Œçš„æ€è·¯å°±æ˜¯ç»™æ•°æ®åŠ ä¸Šä¸€ä¸ªç‰ˆæœ¬å·, ä¸ä»…æ˜¯å¯¹æ¯”æ•°æ®çš„å€¼, è¿˜éœ€è¦å¯¹æ¯”æ•°æ®çš„ç‰ˆæœ¬å·, è¿™ä¸ªæ€è·¯å…¶å®å°±æ˜¯ä»æœ€åº•å±‚çš„èµ„æºåšäº†éš”ç¦», åœ¨å¹¶å‘çš„åœºæ™¯ä¸­, å¦‚æœå¯¹æ•°æ®æ­£ç¡®æ€§è¦æ±‚å¾ˆé«˜, ä¸´ç•Œèµ„æºå…œåº•ç­–ç•¥å¾ˆé‡è¦;\nå¤§æ‰¹é‡çº¿ç¨‹è‡ªæ—‹é—®é¢˜ åŸºäº CAS çš„ç‰¹æ€§, æ²¡æœ‰ä¿®æ”¹æˆåŠŸå¯ä»¥è¿›è¡Œé‡è¯•, ä¹Ÿå°±æ˜¯è‡ªæ—‹, å¦‚æœåœ¨çº¿ç¨‹æ•°é‡å¾ˆå¤šçš„åœºæ™¯ä¸‹, åè€Œä¼šå½±å“æ€§èƒ½, å› ä¸ºä¼šæœ‰å¤§é‡çš„çº¿ç¨‹ä¸æ–­è‡ªæ—‹, è€Œä¸”éšç€çº¿ç¨‹æ•°é‡, è‡ªæ—‹çš„å½±å“ä¼šæŒç»­æ”¾å¤§, å› æ­¤åœ¨ Java ä¸­, synchronized ä¼šéšç€å¹¶å‘é‡çš„å¢åŠ , ä¼šæœ‰é”å‡çº§çš„æœºåˆ¶, åœ¨golang çš„ Mutex å®ç°ä¸­, ä¹Ÿæ˜¯ä» CAS é€æ¸å‡çº§åˆ°æœ€åé˜»å¡çº¿ç¨‹.\næ€»ç»“ ä»ç¼–ç¨‹è¯­è¨€çš„é”çš„å®ç°ä¸Šæ¥çœ‹, ä»ç”¨æˆ·æ€å¾ˆéš¾å®ç°é”çš„æœºåˆ¶, å› ä¸ºçº¿ç¨‹è°ƒåº¦æ˜¯ç”±å†…æ ¸å®Œæˆçš„, ä¸ç¡®å®šå½“å‰çº¿ç¨‹ä½•æ—¶è€—å°½æ—¶é—´ç‰‡, å¦‚æœè¯»åˆ°ä¸´ç•Œèµ„æºè¿˜æ²¡æ¥å¾—åŠå†™å…¥, æ­¤æ—¶ä¸­æ–­, å…¶ä»–çº¿ç¨‹è·å–åˆ° CPU æ—¶é—´ç‰‡å, ä¼šè¯»å–åˆ°ç›¸åŒçš„ä¸´ç•Œèµ„æº, å½“ä¸´ç•Œèµ„æºè¢«ä¿®æ”¹å, ä¹‹å‰çº¿ç¨‹æ‹¿åˆ°çš„ä¸´ç•Œèµ„æºè¿˜æ˜¯å†å²å€¼, æ­¤æ—¶å†ä¿®æ”¹å°±æ˜¯åŸºäºé”™è¯¯çš„å€¼è¿›è¡Œä¿®æ”¹;\nå½“å€ŸåŠ©ç³»ç»Ÿè°ƒç”¨æ—¶, ä¼šè¿›å…¥å†…æ ¸æ€, æ— è®ºæ˜¯ XCHGL è¿˜æ˜¯ CMPXCHGL , è¿™äº›æŒ‡ä»¤éƒ½æ˜¯åŸå­æ“ä½œ; ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦è€Œè¨€, é”çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æ ‡è¯†, é”çš„ç«äº‰å°±æ˜¯é€šè¿‡åŸå­æŒ‡ä»¤å»ä¿®æ”¹è¿™ä¸ªæ ‡è¯†ä½, ä¿®æ”¹æˆåŠŸåˆ™è¡¨ç°ä¸ºè·å–åˆ°äº†é”, ä¿®æ”¹å¤±è´¥åˆ™å¯ä»¥è‡ªè¡Œå†³å®š, è‡ªæ—‹æˆ–è€…é˜»å¡, è¡¨ç°ä¸ºä¸åŒçš„é”çš„å½¢å¼, è‡ªæ—‹é”, æ’ä»–é”;\nå‚è€ƒ https://zh.wikipedia.org/wiki/%E4%BA%92%E6%96%A5%E9%94%81\nhttps://www.infoq.com/presentations/go-locks/\nhttps://time.geekbang.org/column/article/377913\nhttps://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives/#mutex\n",
      "summary": "func add (a *int) *int { *a++ // çº¿ç¨‹ä¸å®‰å…¨ return a } è¿™æ˜¯ä¸€æ®µå¾ˆå…¸å‹çš„çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹, åœ¨å¹¶å‘åœºæ™¯ä¸‹, a çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„, å¤§æ¦‚ç‡ä¼šå°äº 1000, åŸå› æ˜¯ a++ å¹¶éåŸå­æ“ä½œ, ä¼šå­˜åœ¨åŒæ—¶æœ‰ä¸¤ä¸ªåç¨‹è¯»å–åˆ° a çš„å€¼æ˜¯ç›¸åŒçš„æƒ…å†µ, æ‰§è¡Œ a++ä¹‹åå†é‡æ–°å›å†™æ—¶, açš„å€¼ä¹Ÿæ˜¯ç›¸åŒçš„, æƒ³è¦å˜ä¸ºçº¿ç¨‹å®‰å…¨, å°±éœ€è¦åœ¨æ“ä½œä¸´ç•Œèµ„æºä¹‹å‰åŠ é”;\nMutex åœ¨æ“ä½œå…±äº«èµ„æºä¹‹å‰åŠ é”, ç„¶åæ“ä½œå®Œä¸´ç•Œèµ„æºä¹‹åé‡Šæ”¾é”, ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªåç¨‹æ“ä½œä¸´ç•Œèµ„æº;\nvar mu sync.Mutex func addSafe(a *int) *int { mu.Lock() // åŠ é” defer mu.Unlock() // é‡Šæ”¾é” *a++ return a } é”åœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ç¯å¢ƒä¸­å®ç°èµ„æºçš„äº’æ–¥è®¿é—®ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æƒ³è¦è®¿é—®æŸä¸ªå…±äº«èµ„æºï¼ˆå¦‚æ•°æ®ç»“æ„ã€æ–‡ä»¶ç­‰ï¼‰æ—¶ï¼Œå®ƒå¿…é¡»é¦–å…ˆå°è¯•è·å–è¯¥èµ„æºå¯¹åº”çš„é”ã€‚å¦‚æœé”æœªè¢«å…¶ä»–çº¿ç¨‹æˆ–è¿›ç¨‹å ç”¨ï¼Œé‚£ä¹ˆè¯·æ±‚çš„çº¿ç¨‹æˆ–è¿›ç¨‹å°†è·å¾—é”å¹¶ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™ï¼Œå®ƒå°†ç­‰å¾…ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚\n// If the lock is already in use, the calling goroutine // blocks until the mutex is available."
    },{
      "title": "Go ppfofå·¥å…·ä½¿ç”¨",
      "url": "https://qiref.github.io/post/2024/02/23/go-ppfof%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/",
      "content": "pprof pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·;\nruntime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ net/http/pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ å¯ç”¨æ–¹å¼ åœ¨mainå‡½æ•°ä¹‹å‰ä½¿ç”¨å¯åŠ¨, DoProfile(6060)\nimport ( \u0026quot;net/http\u0026quot; _ \u0026quot;net/http/pprof\u0026quot; \u0026quot;strconv\u0026quot; ) type ProfileServer struct { } func (this *ProfileServer) DoProfile(port int) { go func() { err := http.ListenAndServe(\u0026quot;:\u0026quot;+strconv.FormatInt(int64(port), 10), nil) if err != nil { log.Errorf(\u0026quot;Failed to do profile on port: %d\u0026quot;, port) } else { log.Infof(\u0026quot;pprof start successfully on port %d\u0026quot;, port) } }() } åˆ†æ curl 'http://127.0.0.1:6060/debug/pprof/profile' -o profile.20240223 curl 'http://127.0.0.1:6060/debug/pprof/heap' -o heap.20240223 curl 'http://127.0.0.1:6060/debug/pprof/block' -o block.20240223 curl 'http://127.0.0.1:6060/debug/pprof/mutex' -o mutex.20240223 curl 'http://127.0.0.1:6060/debug/pprof/trace' -o trace.20240223 è¾“å‡ºå¯¹åº”çš„pprofæ–‡ä»¶ä¹‹å, å¯¹æ–‡ä»¶è¿›è¡Œåˆ†æ;\nFlatï¼šå‡½æ•°è‡ªèº«è¿è¡Œè€—æ—¶ Flat%ï¼šå‡½æ•°è‡ªèº«è€—æ—¶æ¯”ä¾‹ Sum%ï¼šæŒ‡çš„å°±æ˜¯æ¯ä¸€è¡Œçš„flat%ä¸ä¸Šé¢æ‰€æœ‰è¡Œçš„flat%æ€»å’Œ Cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒæ‰€æœ‰è°ƒç”¨æ ˆçš„è¿è¡Œæ€»è€—æ—¶ Cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒæ‰€æœ‰è°ƒç”¨æ ˆçš„è¿è¡Œæ€»è€—æ—¶æ¯”ä¾‹ ä½¿ç”¨å‘½ä»¤è¡Œåˆ†æ è¾“å…¥ help æŸ¥çœ‹å¸®åŠ©å‘½ä»¤, å¸¸æœ‰ top å’Œ list\ntop æ‰¾åˆ°å ç”¨èµ„æºæœ€é«˜çš„å‡½æ•°, list methodName æ‰¾åˆ°æºç æ‰€åœ¨;\ngo tool pprof profile.230904 File: xx_cc Type: cpu Time: Feb 23, 2024 at 10:53am (CST) Duration: 30s, Total samples = 230ms ( 0.77%) Entering interactive mode (type \u0026quot;help\u0026quot; for commands, \u0026quot;o\u0026quot; for options) (pprof) top 20 Showing nodes accounting for 300ms, 88.24% of 340ms total Showing top 20 nodes out of 212 flat flat% sum% cum cum% 70ms 20.59% 20.59% 70ms 20.59% runtime.step 40ms 11.76% 32.35% 40ms 11.76% runtime/internal/syscall.Syscall6 20ms 5.88% 38.24% 20ms 5.88% runtime.unlock2 10ms 2.94% 41.18% 10ms 2.94% encoding/json.simpleLetterEqualFold 10ms 2.94% 44.12% 10ms 2.94% fmt.(*pp).doPrintf 10ms 2.94% 47.06% 10ms 2.94% net/http.readRequest 10ms 2.94% 50.00% 10ms 2.94% runtime.(*moduledata).textAddr 10ms 2.94% 52.94% 10ms 2.94% runtime.casgstatus 10ms 2.94% 55.88% 10ms 2.94% runtime.elideWrapperCalling 10ms 2.94% 58.82% 10ms 2.94% runtime.epollwait 10ms 2.94% 61.76% 10ms 2.94% runtime.findfunc 10ms 2.94% 64.71% 10ms 2.94% runtime.getStackMap 10ms 2.94% 67.65% 30ms 8.82% runtime.gwrite 10ms 2.94% 70.59% 10ms 2.94% runtime.heapBitsSetType 10ms 2.94% 73.53% 10ms 2.94% runtime.lock2 10ms 2.94% 76.47% 20ms 5.88% runtime.mallocgc 10ms 2.94% 79.41% 10ms 2.94% runtime.memmove 10ms 2.94% 82.35% 90ms 26.47% runtime.pcvalue 10ms 2.94% 85.29% 20ms 5.88% runtime.printlock 10ms 2.94% 88.24% 10ms 2.94% runtime.scanblock (pprof) list doPrintf Total: 340ms ROUTINE ======================== fmt.(*pp).doPrintf in /usr/lib/golang/src/fmt/print.go 10ms 10ms (flat, cum) 2.94% of Total . . 1009: p.reordered = false . . 1010:formatLoop: . . 1011: for i := 0; i \u0026lt; end; { . . 1012: p.goodArgNum = true . . 1013: lasti := i 10ms 10ms 1014: for i \u0026lt; end \u0026amp;\u0026amp; format[i] != '%' { . . 1015: i++ . . 1016: } . . 1017: if i \u0026gt; lasti { . . 1018: p.buf.writeString(format[lasti:i]) . . 1019: } (pprof) web ç•Œé¢æŸ¥çœ‹åˆ†æç»“æœ éœ€è¦å…ˆå®‰è£… graphviz\nbrew install graphviz # for macos apt install graphviz # for ubuntu yum install graphviz # for centos ç•Œé¢åˆ†ææ›´ä¸ºæ–¹ä¾¿, è¿˜èƒ½çœ‹ CPU ç«ç„°å›¾, æ›´å®¹æ˜“æ‰¾åˆ°é—®é¢˜æ‰€åœ¨; å¯åŠ¨webæœåŠ¡æŸ¥çœ‹profileåˆ†æç»“æœ:\ngo tool pprof -http=127.0.0.1:8001 profile.230904 Serving web UI on http://127.0.0.1:8001 ",
      "summary": "pprof pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·;\nruntime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ net/http/pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ å¯ç”¨æ–¹å¼ åœ¨mainå‡½æ•°ä¹‹å‰ä½¿ç”¨å¯åŠ¨, DoProfile(6060)\nimport ( \u0026quot;net/http\u0026quot; _ \u0026quot;net/http/pprof\u0026quot; \u0026quot;strconv\u0026quot; ) type ProfileServer struct { } func (this *ProfileServer) DoProfile(port int) { go func() { err := http.ListenAndServe(\u0026quot;:\u0026quot;+strconv.FormatInt(int64(port), 10), nil) if err != nil { log.Errorf(\u0026quot;Failed to do profile on port: %d\u0026quot;, port) } else { log.Infof(\u0026quot;pprof start successfully on port %d\u0026quot;, port) } }() } åˆ†æ curl 'http://127.0.0.1:6060/debug/pprof/profile' -o profile.20240223 curl 'http://127."
    },{
      "title": "B+æ ‘",
      "url": "https://qiref.github.io/post/2023/12/05/b-%E6%A0%91/",
      "content": "Bæ ‘å¼•å…¥ Bæ ‘ï¼ˆè‹±è¯­ï¼šB-treeï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨è®¡ç®—æœºç§‘å­¦è‡ªå¹³è¡¡çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®æœ‰åºã€‚è¿™ç§æ•°æ®ç»“æ„èƒ½å¤Ÿè®©æŸ¥æ‰¾æ•°æ®ã€é¡ºåºè®¿é—®ã€æ’å…¥æ•°æ®åŠåˆ é™¤çš„åŠ¨ä½œï¼Œéƒ½åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆã€‚Bæ ‘ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯ä¸€ä¸ªä¸€èˆ¬åŒ–çš„äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰2ä¸ªä»¥ä¸Šçš„å­èŠ‚ç‚¹ã€‚ä¸è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹å¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ç£ç›˜ã€‚Bæ ‘å‡å°‘å®šä½è®°å½•æ—¶æ‰€ç»å†çš„ä¸­é—´è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚Bæ ‘è¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç”¨æ¥æè¿°å¤–éƒ¨å­˜å‚¨ã€‚è¿™ç§æ•°æ®ç»“æ„å¸¸è¢«åº”ç”¨åœ¨æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä¸Šã€‚\nwiki ä¸Šæ˜¯è¿™ä¹ˆæè¿° B æ ‘çš„, é‡ç‚¹åœ¨äº B æ ‘è¢«ç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°ä¸Š, åŸºäºäºŒå‰æœç´¢æ ‘å¤©ç„¶çš„æœ‰åºæ€§, å®ç° logn çº§åˆ«çš„æŸ¥è¯¢; æ—¢ç„¶æ˜¯ç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°, é‚£ä¹ˆå¯ä»¥æ¥æ¨å¯¼ä¸€ä¸‹, ä¸ºä»€ä¹ˆB æ ‘ä¼šç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°?\næƒ³è¦å®ç° logn çº§åˆ«çš„æŸ¥è¯¢, binary search tree skiip list éƒ½å¯ä»¥å®ç°, Why B æ ‘?\näºŒå‰æœç´¢æ ‘ 1\näºŒå‰æœç´¢æ ‘å¤©ç„¶æœ‰åº, ä¹Ÿèƒ½è¾¾åˆ° logn çº§åˆ«çš„æŸ¥è¯¢æ€§èƒ½, ä½†æ˜¯äºŒå‰æœç´¢æ ‘, æœ‰ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜, å¦‚æœæ’å…¥çš„æ•°æ®æœ¬èº«æ˜¯æœ‰åºçš„, é‚£äºŒå‰æœç´¢æ ‘å°±ä¼šé€€åŒ–ä¸ºé“¾è¡¨, è¦è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥ç”¨ AVL Tree (Balanced binary search tree) å’Œ Red-Black Tree.\nAVL æ ‘ AVL Tree (Balanced binary search tree) åœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Š, å¢åŠ äº†è‡ªå¹³è¡¡çš„æœºåˆ¶, è§£å†³äºŒå‰æœç´¢æ ‘é€€åŒ–ä¸ºé“¾è¡¨çš„é—®é¢˜, ä½†æ˜¯è‡ªå¹³è¡¡ä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜(å¹³è¡¡æ¡ä»¶å¿…é¡»æ»¡è¶³æ‰€æœ‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1), æ’å…¥æ—¶å¯èƒ½ä¼šè§¦å‘å¤šæ¬¡çš„è‡ªå¹³è¡¡, ä»è€Œä¼šå½±å“æ•°æ®æ’å…¥çš„æ•ˆç‡, é‚£æœ‰æ²¡æœ‰åŠæ³•è§£å†³é¢‘ç¹çš„è‡ªå¹³è¡¡çš„é—®é¢˜å‘¢?\nçº¢é»‘æ ‘ Red-Black Tree å°±èƒ½åšåˆ°, çº¢é»‘æ ‘é€šè¿‡åˆ¶å®šä¸€ç³»åˆ—çš„è§„åˆ™:\nèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ã€‚ æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚ æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„ã€‚ æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ï¼ˆå³ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ï¼‰ã€‚ ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚ è¿™äº›çº¦æŸå¼ºåˆ¶äº†çº¢é»‘æ ‘çš„å…³é”®æ€§è´¨: ä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿ã€‚ç»“æœæ˜¯è¿™ä¸ªæ ‘å¤§è‡´ä¸Šæ˜¯å¹³è¡¡çš„, å¹³è¡¡æ¡ä»¶ç›¸å¯¹äº AVL æ ‘å®½æ¾, ä»è€Œå‡å°‘å¹³è¡¡æ¬¡æ•°, è·å¾—æ›´å¥½çš„æ’å…¥æ•ˆç‡; åˆ°è¿™é‡Œ, çœ‹ä¸Šå»é—®é¢˜å¥½åƒéƒ½è§£å†³äº†, ç”¨çº¢é»‘æ ‘å°±èƒ½æ»¡è¶³å­˜å‚¨ç³»ç»Ÿçš„è¦æ±‚, äº‹å®ä¸Šç¡®å®ä¹Ÿæ˜¯è¿™æ ·, å¾ˆå¤šè¯­è¨€çš„ hashmap å°±æ˜¯ç”¨çº¢é»‘æ ‘ä½œä¸ºåº•å±‚å­˜å‚¨å®ç°çš„, å‰ææ˜¯è¿™äº›ç´¢å¼•ç»“æ„éƒ½æ˜¯åœ¨å†…å­˜ä¸­, å¦‚æœè¿™ä¸ªå­˜å‚¨ç³»ç»Ÿæ˜¯åŸºäºç£ç›˜, çº¢é»‘æ ‘æ˜¯å¦é€‚ç”¨?\nBæ ‘ æ–‡ä»¶æ”¾åˆ°ç£ç›˜ä¸Š, é‚£ä¹ˆæ€ä¹ˆå¿«é€Ÿæ‰¾åˆ°æ–‡ä»¶ä¸­çš„æ•°æ®å‘¢?\né¦–å…ˆéœ€è¦å‡å°‘è·Ÿç£ç›˜çš„äº¤äº’æ¬¡æ•°; å…¶æ¬¡æ˜¯å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„, æ‰èƒ½å®ç° logn çº§åˆ«çš„æŸ¥è¯¢; æ ‘å½¢ç»“æ„çš„å­˜å‚¨, æœ€ç›´æ¥çš„æ€è·¯å°±æ˜¯ä¸€ä¸ªnodeå­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶, åŸºäºè¿™ä¸ªèƒŒæ™¯, æŸ¥è¯¢çš„æ€§èƒ½å°±ç›´æ¥å–å†³äºæ ‘çš„é«˜åº¦, æ¯ä¸€æ¬¡ä» parent åˆ° child, éƒ½æ˜¯ä¸€æ¬¡ç£ç›˜ IO, æŸ¥æ‰¾çš„æ–‡ä»¶è¶Šå¤š, æ€§èƒ½è¶Šå·®;\nå¦‚æœèƒ½é™ä½æ ‘çš„é«˜åº¦, å¯¹åº”æŸ¥è¯¢æ€§èƒ½å°±ä¼šæé«˜, åŸºäºæ ‘çš„ç»“æ„, å¦‚ä½•é™ä½æ ‘çš„é«˜åº¦å‘¢? æé«˜ child çš„ä¸ªæ•°, æ”¹ä¸º m å‰æ ‘, è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„:\nå¯ä»¥æŠŠå¤šä¸ªèŠ‚ç‚¹å‹ç¼©åˆ°ä¸€èµ·, ä»è€Œå‡å°‘æ ‘çš„é«˜åº¦; ç£ç›˜å’Œå†…å­˜éƒ½æ˜¯åŸºäº page çš„å­˜å‚¨, é»˜è®¤ä¸º 4K, å¤šä¸ªèŠ‚ç‚¹æ•°é‡å¯ä»¥å‡‘å¤Ÿ4K, æé«˜ç©ºé—´åˆ©ç”¨ç‡; è¿™æ ·, B æ ‘å°±è¯ç”Ÿäº†,B æ ‘æœ¬è´¨æ˜¯å¤šè·¯æŸ¥æ‰¾æ ‘, æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜å¤šä¸ª key , åŒæ—¶æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å« M ä¸ªå­èŠ‚ç‚¹, åŒæ—¶ä¹Ÿéœ€è¦æ»¡è¶³æŸ¥æ‰¾æ ‘çš„é¡ºåºæ€§;\n2\nB+ æ ‘ é€šå¸¸æ¥è¯´, B æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¼šåŒ…å« key data ä»¥åŠå­èŠ‚ç‚¹çš„æŒ‡é’ˆ, å°±è¿™ç§ç»“æ„è€Œè¨€, æ˜¯å¦è¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´å‘¢?\nåŸºäºB æ ‘, æƒ³è¿›ä¸€æ­¥ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡, è¿˜æ˜¯ä¸€ä¸ªé‡è¦çš„åŸåˆ™: å‡å°‘æ ‘çš„é«˜åº¦, å¦‚æœä»å­˜å‚¨ä¸Šæ¥è¯´, æ¯ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶çš„è¯, èŠ‚ç‚¹æ•°é‡è¶Šå°‘, å­˜å‚¨çš„æ–‡ä»¶å°±è¶Šå°‘, æŸ¥è¯¢æ—¶, è·Ÿç£ç›˜çš„äº¤äº’æ¬¡æ•°å°±è¶Šå°‘, å¦‚æœåªåœ¨å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨æ•°æ®, å…¶ä½™èŠ‚ç‚¹åªå­˜å‚¨ key ä¿¡æ¯, é‚£èŠ‚ç‚¹æ•°é‡å°±èƒ½å¤§å¹…å‡å°‘, ä»è€Œèƒ½å­˜å‚¨æ›´å¤šçš„æ•°æ®, æ ‘çš„é«˜åº¦ä¹Ÿä¼šé™ä½, è¿™å°±æ˜¯ B+ æ ‘çš„æ€è·¯;\nåŒæ—¶, B+ æ ‘æ•°æ®éƒ½åœ¨å¶å­èŠ‚ç‚¹, å¶å­èŠ‚ç‚¹è¿˜ç”¨é“¾è¡¨è¿æ¥èµ·æ¥, æ›´æ–¹ä¾¿èŒƒå›´æŸ¥è¯¢; è¿™ä¸ªæ€è·¯è·Ÿè·³è¡¨å¾ˆç›¸ä¼¼, éå¶å­èŠ‚ç‚¹å¯ä»¥è®¤ä¸ºæ˜¯å¶å­èŠ‚ç‚¹çš„ç´¢å¼•;\n/** * è¿™æ˜¯B+æ ‘éå¶å­èŠ‚ç‚¹çš„å®šä¹‰ã€‚ * * å‡è®¾keywords=[3, 5, 8, 10] * 4ä¸ªé”®å€¼å°†æ•°æ®åˆ†ä¸º5ä¸ªåŒºé—´ï¼š(-INF,3), [3,5), [5,8), [8,10), [10,INF) * 5ä¸ªåŒºé—´åˆ†åˆ«å¯¹åº”ï¼šchildren[0]...children[4] * * må€¼æ˜¯äº‹å…ˆè®¡ç®—å¾—åˆ°çš„ï¼Œè®¡ç®—çš„ä¾æ®æ˜¯è®©æ‰€æœ‰ä¿¡æ¯çš„å¤§å°æ­£å¥½ç­‰äºé¡µçš„å¤§å°ï¼š * PAGE_SIZE = (m-1)*4[keywordsså¤§å°]+m*8[childrenå¤§å°] */ public class BPlusTreeNode { public static int m = 5; // 5å‰æ ‘ public int[] keywords = new int[m-1]; // é”®å€¼ï¼Œç”¨æ¥åˆ’åˆ†æ•°æ®åŒºé—´ public BPlusTreeNode[] children = new BPlusTreeNode[m];//ä¿å­˜å­èŠ‚ç‚¹æŒ‡é’ˆ } /** * è¿™æ˜¯B+æ ‘ä¸­å¶å­èŠ‚ç‚¹çš„å®šä¹‰ã€‚ * * B+æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹è·Ÿå†…éƒ¨èŠ‚ç‚¹æ˜¯ä¸ä¸€æ ·çš„, * å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å€¼ï¼Œè€ŒéåŒºé—´ã€‚ * è¿™ä¸ªå®šä¹‰é‡Œï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹å­˜å‚¨3ä¸ªæ•°æ®è¡Œçš„é”®å€¼åŠåœ°å€ä¿¡æ¯ã€‚ * * kå€¼æ˜¯äº‹å…ˆè®¡ç®—å¾—åˆ°çš„ï¼Œè®¡ç®—çš„ä¾æ®æ˜¯è®©æ‰€æœ‰ä¿¡æ¯çš„å¤§å°æ­£å¥½ç­‰äºé¡µçš„å¤§å°ï¼š * PAGE_SIZE = k*4[keyw..å¤§å°]+k*8[dataAd..å¤§å°]+8[prevå¤§å°]+8[nextå¤§å°] */ public class BPlusTreeLeafNode { public static int k = 3; public int[] keywords = new int[k]; // æ•°æ®çš„é”®å€¼ public long[] dataAddress = new long[k]; // æ•°æ®åœ°å€ public BPlusTreeLeafNode prev; // è¿™ä¸ªç»“ç‚¹åœ¨é“¾è¡¨ä¸­çš„å‰é©±ç»“ç‚¹ public BPlusTreeLeafNode next; // è¿™ä¸ªç»“ç‚¹åœ¨é“¾è¡¨ä¸­çš„åç»§ç»“ç‚¹ } å‚è€ƒ https://oi-wiki.org/ds/bplus-tree/\nhttps://www.cs.usfca.edu/~galles/visualization/BPlusTree.html\nhttps://zh.m.wikipedia.org/wiki/B%E6%A0%91\nå·¦å­èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹,å³å­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹,ä¸­åºéå†èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºç»“æ„\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nè¿™æ˜¯ä¸€ä¸ªä¸‰é˜¶Bæ ‘,æ¯ä¸ªnodeæœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹, åŒæ—¶æ»¡è¶³å·¦å­èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹, å³å­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n",
      "summary": "Bæ ‘å¼•å…¥ Bæ ‘ï¼ˆè‹±è¯­ï¼šB-treeï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨è®¡ç®—æœºç§‘å­¦è‡ªå¹³è¡¡çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®æœ‰åºã€‚è¿™ç§æ•°æ®ç»“æ„èƒ½å¤Ÿè®©æŸ¥æ‰¾æ•°æ®ã€é¡ºåºè®¿é—®ã€æ’å…¥æ•°æ®åŠåˆ é™¤çš„åŠ¨ä½œï¼Œéƒ½åœ¨å¯¹æ•°æ—¶é—´å†…å®Œæˆã€‚Bæ ‘ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯ä¸€ä¸ªä¸€èˆ¬åŒ–çš„äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰2ä¸ªä»¥ä¸Šçš„å­èŠ‚ç‚¹ã€‚ä¸è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹å¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ç£ç›˜ã€‚Bæ ‘å‡å°‘å®šä½è®°å½•æ—¶æ‰€ç»å†çš„ä¸­é—´è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚Bæ ‘è¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç”¨æ¥æè¿°å¤–éƒ¨å­˜å‚¨ã€‚è¿™ç§æ•°æ®ç»“æ„å¸¸è¢«åº”ç”¨åœ¨æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä¸Šã€‚\nwiki ä¸Šæ˜¯è¿™ä¹ˆæè¿° B æ ‘çš„, é‡ç‚¹åœ¨äº B æ ‘è¢«ç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°ä¸Š, åŸºäºäºŒå‰æœç´¢æ ‘å¤©ç„¶çš„æœ‰åºæ€§, å®ç° logn çº§åˆ«çš„æŸ¥è¯¢; æ—¢ç„¶æ˜¯ç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°, é‚£ä¹ˆå¯ä»¥æ¥æ¨å¯¼ä¸€ä¸‹, ä¸ºä»€ä¹ˆB æ ‘ä¼šç”¨ä½œå­˜å‚¨ç³»ç»Ÿçš„å®ç°?\næƒ³è¦å®ç° logn çº§åˆ«çš„æŸ¥è¯¢, binary search tree skiip list éƒ½å¯ä»¥å®ç°, Why B æ ‘?\näºŒå‰æœç´¢æ ‘ 1\näºŒå‰æœç´¢æ ‘å¤©ç„¶æœ‰åº, ä¹Ÿèƒ½è¾¾åˆ° logn çº§åˆ«çš„æŸ¥è¯¢æ€§èƒ½, ä½†æ˜¯äºŒå‰æœç´¢æ ‘, æœ‰ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜, å¦‚æœæ’å…¥çš„æ•°æ®æœ¬èº«æ˜¯æœ‰åºçš„, é‚£äºŒå‰æœç´¢æ ‘å°±ä¼šé€€åŒ–ä¸ºé“¾è¡¨, è¦è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥ç”¨ AVL Tree (Balanced binary search tree) å’Œ Red-Black Tree.\nAVL æ ‘ AVL Tree (Balanced binary search tree) åœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Š, å¢åŠ äº†è‡ªå¹³è¡¡çš„æœºåˆ¶, è§£å†³äºŒå‰æœç´¢æ ‘é€€åŒ–ä¸ºé“¾è¡¨çš„é—®é¢˜, ä½†æ˜¯è‡ªå¹³è¡¡ä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜(å¹³è¡¡æ¡ä»¶å¿…é¡»æ»¡è¶³æ‰€æœ‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1), æ’å…¥æ—¶å¯èƒ½ä¼šè§¦å‘å¤šæ¬¡çš„è‡ªå¹³è¡¡, ä»è€Œä¼šå½±å“æ•°æ®æ’å…¥çš„æ•ˆç‡, é‚£æœ‰æ²¡æœ‰åŠæ³•è§£å†³é¢‘ç¹çš„è‡ªå¹³è¡¡çš„é—®é¢˜å‘¢?\nçº¢é»‘æ ‘ Red-Black Tree å°±èƒ½åšåˆ°, çº¢é»‘æ ‘é€šè¿‡åˆ¶å®šä¸€ç³»åˆ—çš„è§„åˆ™:"
    },{
      "title": "Log Structured Merge Tree",
      "url": "https://qiref.github.io/post/2023/10/13/log-structured-merge-tree/",
      "content": "åŸºæœ¬æ¦‚å¿µ Log Structured Merge Tree, å…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å­˜å‚¨æ•°æ®çš„æ–¹å¼,é€šå¸¸ç”¨äºå„ç§å­˜å‚¨ç³»ç»Ÿçš„åº•å±‚æ•°æ®ç»“æ„,é€šè¿‡å°½å¯èƒ½å‡å°‘ç£ç›˜éšæœºIOæ¥æå‡å†™å…¥æ€§èƒ½, é€‚ç”¨äºå†™å¤šè¯»å°‘çš„åœºæ™¯.\néšæœºå†™å’Œé¡ºåºå†™ å¯¹äºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿè€Œè¨€, ä¸å¯é¿å…åœ°éœ€è¦å†™å…¥æ–‡ä»¶åˆ°ç£ç›˜, å¯¹äºå¸¸è§„çš„å†™æ¥è¯´, æ¯æ¥ä¸€æ¡æ•°æ®å†™ä¸€æ¬¡æ–‡ä»¶, æ•°æ®å¯èƒ½æ˜¯ add update delete, éœ€è¦é¢‘ç¹æ“ä½œæ–‡ä»¶, æ¯ä¸€æ¬¡å†™éƒ½æ˜¯ä¸€æ¬¡éšæœº IO; ä¸ºäº†æé«˜å†™å…¥é€Ÿåº¦, LSM Tree å¹¶ä¸æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œéƒ½æŠŠæ–‡ä»¶å†™åˆ°ç£ç›˜, è€Œæ˜¯å°†æ•°æ®åœ¨å†…å­˜ä¸­æ›´æ–°ï¼Œå½“å†…å­˜ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼Œæ‰å°†è¿™éƒ¨åˆ†æ•°æ®çœŸæ­£åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ä¸­. ä»¥è¿™ç§æ–¹å¼å°½å¯èƒ½è®©æ¯æ¬¡ç£ç›˜ IO éƒ½æ˜¯é¡ºåºå†™;\næ€è·¯ åŸºäºå‡å°‘ç£ç›˜çš„éšæœº IO æ¥æå‡æ•´ä½“å­˜å‚¨ç³»ç»Ÿçš„å†™å…¥æ€§èƒ½è¿™ä¸€èƒŒæ™¯, å¾ˆè‡ªç„¶å¯ä»¥æ¨å¯¼å‡ºç”¨æ‰¹é‡å†™å…¥çš„æ–¹å¼, è¦æƒ³æ‰¹é‡å†™å…¥, å°±éœ€è¦åœ¨å†…å­˜ç»´æŠ¤æœ€è¿‘å†™å…¥çš„æ•°æ®, è¾¾åˆ°é˜ˆå€¼ä¹‹åç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜, ä½†æ˜¯è¿™æ ·åˆä¼šå­˜åœ¨æ–°çš„é—®é¢˜:\nå¦‚æœæŸä¸€æ¡æ•°æ®å·²ç»å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶, åç»­åˆæœ‰æ›´æ–°, æ€ä¹ˆå¤„ç†å‘¢? å†…å­˜ä¸­ç»´æŠ¤çš„ä¸´æ—¶æ•°æ®, å¦‚æœè¿˜æœªæ¥å¾—åŠå†™å…¥ç£ç›˜, æœåŠ¡æŒ‚äº†, é‡æ–°å¯åŠ¨æ—¶, å†å²å†™å…¥çš„æ•°æ®å¦‚ä½•æ¢å¤? æ¯æ¬¡å†…å­˜ä¸­æ•°æ®è¾¾åˆ°é˜ˆå€¼,å†™ä¸€ä¸ªæ•´ä¸ªæ–‡ä»¶åˆ°ç£ç›˜,é‚£ä¹ˆæœ€ç»ˆä¼šç”Ÿæˆå¤§é‡çš„æ–‡ä»¶, å¦‚ä½•è§£å†³? è§£å†³é—®é¢˜1, ä¸ºäº†ä¼˜åŒ–è¿™ç§æ›´æ–°çš„å†™å…¥, å¯ä»¥é‡‡ç”¨æ•°æ®ç‰ˆæœ¬çš„åšæ³•, æˆ–è€…ç»™æ•°æ®å¢åŠ æ ‡å¿—, ç„¶åå®šæœŸåˆå¹¶, å½“ç„¶, è¿™ä¹Ÿæ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´, ç›¸åŒçš„æ•°æ®å­˜å‚¨äº†å¤šæ¬¡, ä»¥æå‡å†™å…¥æ€§èƒ½; ä¸æ­¤åŒæ—¶, åœ¨æ•°æ®è¯»å–æ—¶,ç”±äºå†™å…¥çš„é€»è¾‘æ”¹å˜, ä¸€æ¡æ•°æ®å¯èƒ½ä¼šå­˜åœ¨äºå¤šä¸ªæ–‡ä»¶ä¸­, å› æ­¤åœ¨è¯»å–æ—¶, éœ€è¦è¿”å›æœ€æ–°çš„æ•°æ®, åœ¨è¯»å–åˆ°å¤šæ¡æ•°æ®æ—¶,éœ€è¦å¯¹å¤šæ¡æ•°æ®è¿›è¡Œåˆå–æœ€æ–°;\nè§£å†³é—®é¢˜2, åœ¨ä¸šç•Œæ¯”è¾ƒæ ‡å‡†çš„åšæ³•æ˜¯ WAL, WAL çš„åŸºæœ¬åŸç†æ˜¯åœ¨æ‰§è¡Œæ•°æ®ä¿®æ”¹æ“ä½œä¹‹å‰ï¼Œå…ˆå°†è¿™äº›æ“ä½œè®°å½•åœ¨æ—¥å¿—ï¼ˆlogï¼‰æ–‡ä»¶ä¸­, ä»¥ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæˆ–å´©æºƒæ—¶ï¼Œå¯ä»¥å€ŸåŠ©æ—¥å¿—è¿›è¡Œæ¢å¤å¹¶ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§;\nè§£å†³é—®é¢˜3, ä¸ºäº†é¿å…å¤§é‡æ–‡ä»¶, å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå®šæœŸåˆå¹¶, å½“æ•°æ®è¿˜åœ¨å†…å­˜ä¸­æ—¶, å¯ä»¥å€ŸåŠ©è·³è¡¨æˆ–è€… B+Tree ç­‰æ•°æ®ç»“æ„ä¿è¯å†…å­˜ä¸­æ•°æ®çš„é¡ºåºæ€§, åœ¨å†™æ–‡ä»¶æ—¶, ç”±äºæ•°æ®æ˜¯æœ‰åºçš„, åœ¨æ–‡ä»¶åˆå¹¶æ—¶,å¾ˆè‡ªç„¶å¯ä»¥å€ŸåŠ©å½’å¹¶æ’åºä¿è¯åˆå¹¶ä¹‹åçš„æ•°æ®çš„æœ‰åºæ€§, è€Œæœ‰åºæ€§åˆèƒ½å¤©ç„¶æé«˜æŸ¥è¯¢æ•ˆç‡.\næ¶æ„ lsm åŸºæœ¬ä¸Šå°±æ˜¯åŸºäºä»¥ä¸Šçš„æ¨å¯¼æ€è·¯å®ç°çš„, æ•´ä½“çš„æ¶æ„å¦‚ä¸‹:\nWAL WAL(Write Ahead Logging)å³æ—¥å¿—å…ˆå†™åŸç†ã€‚ æ—¥å¿—è®°å½•æ‰€æœ‰çš„æ•°æ®ä¿®æ”¹æ“ä½œ, æŠŠæ•°æ®ä¿®æ”¹é¢„å…ˆå†™å…¥æ—¥å¿—æ–‡ä»¶, ç„¶ååœ¨å†™å†…å­˜æˆ–è€…ç£ç›˜æ•°æ®åŒº, å½“æ—¥å¿—è®°å½•äº†å†™å…¥æ“ä½œ, åç»­çš„å†™åŠ¨ä½œè¿‡ç¨‹ä¸­, ä»»æ„æ­¥éª¤å‡ºç°é—®é¢˜å¯¼è‡´è¿›ç¨‹å´©æºƒ, éƒ½å¯ä»¥å€ŸåŠ© log è¿›è¡Œæ•°æ®æ¢å¤;\nWALçš„é€šå¸¸çš„å·¥ä½œæµç¨‹:\nå®¢æˆ·ç«¯å‘èµ·æ•°æ®ä¿®æ”¹è¯·æ±‚ã€‚ æœåŠ¡å™¨å°†ä¿®æ”¹æ“ä½œè®°å½•åˆ°WALæ—¥å¿—æ–‡ä»¶ã€‚ è¿”å›æˆåŠŸå“åº”ç»™å®¢æˆ·ç«¯ã€‚ å¼‚æ­¥çº¿ç¨‹å°†WALæ—¥å¿—å†…å®¹åŒæ­¥åˆ°ç£ç›˜æ•°æ®æ–‡ä»¶ã€‚ å½“WALæ—¥å¿—åŒæ­¥å®Œæ¯•,æ•°æ®ä¿®æ”¹æ‰çœŸæ­£å®Œæˆã€‚ åœ¨ lsm tree ä¸­, æ•´ä¸ª WAL çš„æµç¨‹å¯ä»¥å®Œå…¨èå…¥åˆ°å†™å…¥çš„è¿‡ç¨‹ä¸­, åŒ…æ‹¬ log æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸ, ä¹Ÿå¯ä»¥éšç€ sstable çš„è½ç›˜è€Œç»“æŸ.\nSStable SStable sorted string table, è¿™æ˜¯ä¸€ç§å­˜å‚¨æ•°æ®çš„æ ¼å¼, å¹¶ä¸”åœ¨æ–‡ä»¶ä¸­, æ•°æ®éƒ½æ˜¯æœ‰åºçš„, å¹¶ä¸”åœ¨æ–‡ä»¶ä¸­, ä¿å­˜äº†å…ƒæ•°æ®ä¿¡æ¯, æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡; å…·ä½“æ ¼å¼å¦‚ä¸‹:\nä»æ–‡ä»¶çš„ç»“æ„åŸºæœ¬èƒ½çœ‹å‡ºæ¥æ•°æ®æ˜¯å¦‚ä½•å†™å…¥çš„, æ•´ä¸ªæ–‡ä»¶åˆ†ä¸ºå…ƒæ•°æ®ä¿¡æ¯å’Œæ•°æ®æœ¬èº«, åŠ ä¸Šå…ƒæ•°æ®ä¿¡æ¯æ˜¯ä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡, æ¯”å¦‚å…ƒæ•°æ®ä¿¡æ¯åŒ…å«äº†å½“å‰æ–‡ä»¶ä¸­ key çš„èŒƒå›´, å¹¶ä¸”è¿˜å¯ä»¥ä¿å­˜ bloomfilter; å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„è®¾è®¡æ˜¯: footer æ•°æ®ä¸ºä»€ä¹ˆæ˜¯åœ¨æ–‡ä»¶æœ«å°¾? ä»è¯»å–æ–‡ä»¶çš„è§’åº¦è€Œè¨€, è¯»å–æ–‡ä»¶çš„èµ·å§‹ä½ç½®ä¸æ˜¯æ›´ç¬¦åˆä¹ æƒ¯, ä»åå¾€å‰è¯», è¯»å–æ–‡ä»¶çš„å 48 å­—èŠ‚ä¸æ˜¯éœ€è¦äº‹å…ˆçŸ¥é“æ–‡ä»¶çš„å¤§å°?\nä¸ªäººè®¤ä¸ºè¿™ä¸ªè®¾è®¡ä¸»è¦æ˜¯åŸºäºä»¥ä¸‹è€ƒè™‘:\næ•°æ®å†™å®Œæ‰çŸ¥é“å…ƒæ•°æ®é‡Œçš„ stat å’Œ key range, ç›´æ¥æŠŠå…ƒæ•°æ® append åˆ°æ–‡ä»¶å°¾éƒ¨, å†™å…¥æ•ˆç‡ä¼šæ›´é«˜; å¦‚æœå…ƒæ•°æ®åœ¨æ–‡ä»¶çš„èµ·å§‹ä½ç½®, å†™å®Œæ•°æ®æœ¬èº«ä¹‹å, è¿˜éœ€è¦å»æ›´æ–°æ–‡ä»¶èµ·å§‹ä½ç½®çš„å…ƒæ•°æ®ä¿¡æ¯, è¿™ä¸€è¿‡ç¨‹æœ‰å¯èƒ½ä¼šå¯¼è‡´éšæœº IO;\ncompaction ä» lsm tree çš„å†™å…¥è¿‡ç¨‹å¯ä»¥å¾—å‡º, L0 å±‚çš„æ–‡ä»¶éƒ½æ˜¯æ¥æºäº Memtable(immutable) , ä¸ºäº†ä¿è¯é¡ºåºå†™å…¥, æ¯æ¬¡å†™å…¥åˆ°ç£ç›˜éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶, åŸºäºè¿™ç§èƒŒæ™¯, æ•°æ®åœ¨æŸ¥è¯¢çš„æ—¶å€™åˆéœ€è¦å»æŸ¥è¯¢ L0 å±‚çš„æ–‡ä»¶, å¦‚æœæ–‡ä»¶å¾ˆå¤š, æŸ¥è¯¢æ•ˆç‡å¿…ç„¶å—å½±å“, è€Œ compaction çš„è®¾è®¡å°±æ˜¯ä¸ºäº†æå‡æ•°æ®æŸ¥è¯¢æ•ˆç‡;\næ–‡ä»¶åœ¨å­˜å‚¨æ—¶è®¾ç½®å±‚çº§, L0 æ–‡ä»¶å¤§å°ä¸Šé™ä¸º 10M L1 ä¸º 100M, ä»¥æ­¤ç±»æ¨, åŒæ—¶æ¯ä¸ªå±‚çº§çš„æ–‡ä»¶ä¸ªæ•°ä¹Ÿæœ‰é™åˆ¶; è§¦å‘ compaction çš„æ¡ä»¶ä¸º:\nLn å±‚çš„æ–‡ä»¶è¶…è¿‡é¢„å®šä¸ªæ•°; Ln å±‚çš„æ–‡ä»¶å¤§å°è¶…è¿‡å±‚çº§çš„å¤§å°é™åˆ¶; æŸä¸ªæ–‡ä»¶çš„æ— æ•ˆè¯»å–è¿‡å¤š; compaction çš„è¿‡ç¨‹å°±æ˜¯æŠŠ Li å±‚çš„è‹¥å¹²ä¸ªæ–‡ä»¶, åˆå¹¶åˆ° Li+1å±‚, åœ¨åˆå¹¶è¿‡ç¨‹ä¸­,é‡æ–°è®¡ç®—æ–°æ–‡ä»¶çš„ key èŒƒå›´, å¦‚æœæœ‰ç›¸åŒ key , åªä¿ç•™æœ€æ–°çš„ key, åˆå¹¶å®Œæˆä¹‹å, é‡æ–°è®¡ç®—å…ƒæ•°æ®, ç„¶åæ¸…ç†å†å²çš„æ–‡ä»¶;\nä» sstable æ–‡ä»¶å­˜å‚¨çš„å½¢å¼æ¥åˆ†æ, compaction çš„è¿‡ç¨‹å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªå¤šè·¯å½’å¹¶çš„ç®—æ³•, å¯ä»¥å‚è€ƒ : leetcode , ç¨å¾®æœ‰äº›åŒºåˆ«å°±æ˜¯åˆå¹¶çš„å†…å®¹æ˜¯é“¾è¡¨æˆ–è€…å…¶ä»–æ•°æ®ç»“æ„.\nè€Œè§£å†³å¤šè·¯å½’å¹¶çš„ç®—æ³•, æ€è·¯ä¹Ÿæœ‰å¾ˆå¤š, æœ€ç®€å•çš„å°±æ˜¯ç›´æ¥åˆå¹¶å¤šä¸ªæ•°ç»„,ç„¶ååŸºäºæœ€åçš„æ•°ç»„æ’åº, ä¹Ÿå¯ä»¥å€ŸåŠ©å¤§æ ¹å †è¿›è¡Œæ’åº, å…·ä½“å®ç°å¯ä»¥å‚è€ƒ: å †æ’åº.\nå¹¶å‘é—®é¢˜ å½“åœ¨ compaction è¿‡ç¨‹ä¸­, ä¼šæœ‰æ–‡ä»¶çš„æ¸…ç†, æ­¤æ—¶å¦‚æœç”¨æˆ·æ­£åœ¨è¯»éœ€è¦åˆå¹¶çš„æ–‡ä»¶, å¦‚ä½•è§£å†³è¿™ä¸ªè¯»å†™å†²çª?\né‡åˆ°è¯»å†™å†²çª, é¦–å…ˆå°±èƒ½æƒ³åˆ°åŠ é”, è¯»æ—¶ç»™æ–‡ä»¶åŠ é”, å†™æ“ä½œè¢«é˜»å¡, è™½ç„¶è¿™æ ·èƒ½è§£å†³é—®é¢˜, ä½†æ˜¯å´è¿èƒŒäº† lsm tree çš„è®¾è®¡åˆè¡·: é«˜æ€§èƒ½çš„å†™å…¥;\næ›´å¥½çš„è§£å†³åŠæ³•æ˜¯: MVCC(Multi-Version Concurrency Control)æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶;\nsstable æ–‡ä»¶è®¾ç½®ä¸ºåªè¯»ï¼Œæ¯æ¬¡ compaction éƒ½åªæ˜¯å¯¹è‹¥å¹²ä¸ª sstable æ–‡ä»¶è¿›è¡Œå¤šè·¯åˆå¹¶ååˆ›å»ºæ–°çš„æ–‡ä»¶ï¼Œæ•…ä¸ä¼šå½±å“åœ¨æŸä¸ª sstable æ–‡ä»¶è¯»æ“ä½œçš„æ­£ç¡®æ€§ï¼› sstable éƒ½æ˜¯å…·æœ‰ç‰ˆæœ¬ä¿¡æ¯çš„ï¼Œå³æ¯æ¬¡ compaction å®Œæˆåï¼Œéƒ½ä¼šç”Ÿæˆæ–°ç‰ˆæœ¬çš„ sstableï¼Œå› æ­¤å¯ä»¥ä¿éšœè¯»å†™æ“ä½œéƒ½å¯ä»¥é’ˆå¯¹äºç›¸åº”çš„ç‰ˆæœ¬æ–‡ä»¶è¿›è¡Œï¼Œè§£å†³äº†è¯»å†™å†²çªï¼› compaction ç”Ÿæˆçš„æ–‡ä»¶åªæœ‰ç­‰åˆå¹¶å®Œæˆåæ‰ä¼šå†™å…ƒæ•°æ®ï¼Œåœ¨æ­¤æœŸé—´å¯¹è¯»æ“ä½œæ¥è¯´æ˜¯é€æ˜çš„ï¼Œä¸ä¼šæ±¡æŸ“æ­£å¸¸çš„è¯»æ“ä½œï¼› é‡‡ç”¨å¼•ç”¨è®¡æ•°æ¥æ§åˆ¶åˆ é™¤è¡Œä¸ºã€‚å½“ compaction å®Œæˆåè¯•å›¾å»åˆ é™¤æŸä¸ª sstable æ–‡ä»¶ï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ä½œé€‚å½“çš„åˆ é™¤å»¶è¿Ÿï¼Œå³å¼•ç”¨è®¡æ•°ä¸ä¸º0æ—¶ï¼Œéœ€è¦ç­‰å¾…è‡³è¯¥æ–‡ä»¶çš„è®¡æ•°ä¸º0æ‰çœŸæ­£è¿›è¡Œåˆ é™¤ï¼› å‚è€ƒ https://leveldb-handbook.readthedocs.io/zh/latest/basic.html\nhttps://github.com/facebook/rocksdb/wiki/RocksDB-Overview\nhttps://zhuanlan.zhihu.com/p/351241814\n",
      "summary": "åŸºæœ¬æ¦‚å¿µ Log Structured Merge Tree, å…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å­˜å‚¨æ•°æ®çš„æ–¹å¼,é€šå¸¸ç”¨äºå„ç§å­˜å‚¨ç³»ç»Ÿçš„åº•å±‚æ•°æ®ç»“æ„,é€šè¿‡å°½å¯èƒ½å‡å°‘ç£ç›˜éšæœºIOæ¥æå‡å†™å…¥æ€§èƒ½, é€‚ç”¨äºå†™å¤šè¯»å°‘çš„åœºæ™¯.\néšæœºå†™å’Œé¡ºåºå†™ å¯¹äºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿè€Œè¨€, ä¸å¯é¿å…åœ°éœ€è¦å†™å…¥æ–‡ä»¶åˆ°ç£ç›˜, å¯¹äºå¸¸è§„çš„å†™æ¥è¯´, æ¯æ¥ä¸€æ¡æ•°æ®å†™ä¸€æ¬¡æ–‡ä»¶, æ•°æ®å¯èƒ½æ˜¯ add update delete, éœ€è¦é¢‘ç¹æ“ä½œæ–‡ä»¶, æ¯ä¸€æ¬¡å†™éƒ½æ˜¯ä¸€æ¬¡éšæœº IO; ä¸ºäº†æé«˜å†™å…¥é€Ÿåº¦, LSM Tree å¹¶ä¸æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œéƒ½æŠŠæ–‡ä»¶å†™åˆ°ç£ç›˜, è€Œæ˜¯å°†æ•°æ®åœ¨å†…å­˜ä¸­æ›´æ–°ï¼Œå½“å†…å­˜ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼Œæ‰å°†è¿™éƒ¨åˆ†æ•°æ®çœŸæ­£åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ä¸­. ä»¥è¿™ç§æ–¹å¼å°½å¯èƒ½è®©æ¯æ¬¡ç£ç›˜ IO éƒ½æ˜¯é¡ºåºå†™;\næ€è·¯ åŸºäºå‡å°‘ç£ç›˜çš„éšæœº IO æ¥æå‡æ•´ä½“å­˜å‚¨ç³»ç»Ÿçš„å†™å…¥æ€§èƒ½è¿™ä¸€èƒŒæ™¯, å¾ˆè‡ªç„¶å¯ä»¥æ¨å¯¼å‡ºç”¨æ‰¹é‡å†™å…¥çš„æ–¹å¼, è¦æƒ³æ‰¹é‡å†™å…¥, å°±éœ€è¦åœ¨å†…å­˜ç»´æŠ¤æœ€è¿‘å†™å…¥çš„æ•°æ®, è¾¾åˆ°é˜ˆå€¼ä¹‹åç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜, ä½†æ˜¯è¿™æ ·åˆä¼šå­˜åœ¨æ–°çš„é—®é¢˜:\nå¦‚æœæŸä¸€æ¡æ•°æ®å·²ç»å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶, åç»­åˆæœ‰æ›´æ–°, æ€ä¹ˆå¤„ç†å‘¢? å†…å­˜ä¸­ç»´æŠ¤çš„ä¸´æ—¶æ•°æ®, å¦‚æœè¿˜æœªæ¥å¾—åŠå†™å…¥ç£ç›˜, æœåŠ¡æŒ‚äº†, é‡æ–°å¯åŠ¨æ—¶, å†å²å†™å…¥çš„æ•°æ®å¦‚ä½•æ¢å¤? æ¯æ¬¡å†…å­˜ä¸­æ•°æ®è¾¾åˆ°é˜ˆå€¼,å†™ä¸€ä¸ªæ•´ä¸ªæ–‡ä»¶åˆ°ç£ç›˜,é‚£ä¹ˆæœ€ç»ˆä¼šç”Ÿæˆå¤§é‡çš„æ–‡ä»¶, å¦‚ä½•è§£å†³? è§£å†³é—®é¢˜1, ä¸ºäº†ä¼˜åŒ–è¿™ç§æ›´æ–°çš„å†™å…¥, å¯ä»¥é‡‡ç”¨æ•°æ®ç‰ˆæœ¬çš„åšæ³•, æˆ–è€…ç»™æ•°æ®å¢åŠ æ ‡å¿—, ç„¶åå®šæœŸåˆå¹¶, å½“ç„¶, è¿™ä¹Ÿæ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´, ç›¸åŒçš„æ•°æ®å­˜å‚¨äº†å¤šæ¬¡, ä»¥æå‡å†™å…¥æ€§èƒ½; ä¸æ­¤åŒæ—¶, åœ¨æ•°æ®è¯»å–æ—¶,ç”±äºå†™å…¥çš„é€»è¾‘æ”¹å˜, ä¸€æ¡æ•°æ®å¯èƒ½ä¼šå­˜åœ¨äºå¤šä¸ªæ–‡ä»¶ä¸­, å› æ­¤åœ¨è¯»å–æ—¶, éœ€è¦è¿”å›æœ€æ–°çš„æ•°æ®, åœ¨è¯»å–åˆ°å¤šæ¡æ•°æ®æ—¶,éœ€è¦å¯¹å¤šæ¡æ•°æ®è¿›è¡Œåˆå–æœ€æ–°;\nè§£å†³é—®é¢˜2, åœ¨ä¸šç•Œæ¯”è¾ƒæ ‡å‡†çš„åšæ³•æ˜¯ WAL, WAL çš„åŸºæœ¬åŸç†æ˜¯åœ¨æ‰§è¡Œæ•°æ®ä¿®æ”¹æ“ä½œä¹‹å‰ï¼Œå…ˆå°†è¿™äº›æ“ä½œè®°å½•åœ¨æ—¥å¿—ï¼ˆlogï¼‰æ–‡ä»¶ä¸­, ä»¥ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæˆ–å´©æºƒæ—¶ï¼Œå¯ä»¥å€ŸåŠ©æ—¥å¿—è¿›è¡Œæ¢å¤å¹¶ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§;\nè§£å†³é—®é¢˜3, ä¸ºäº†é¿å…å¤§é‡æ–‡ä»¶, å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå®šæœŸåˆå¹¶, å½“æ•°æ®è¿˜åœ¨å†…å­˜ä¸­æ—¶, å¯ä»¥å€ŸåŠ©è·³è¡¨æˆ–è€… B+Tree ç­‰æ•°æ®ç»“æ„ä¿è¯å†…å­˜ä¸­æ•°æ®çš„é¡ºåºæ€§, åœ¨å†™æ–‡ä»¶æ—¶, ç”±äºæ•°æ®æ˜¯æœ‰åºçš„, åœ¨æ–‡ä»¶åˆå¹¶æ—¶,å¾ˆè‡ªç„¶å¯ä»¥å€ŸåŠ©å½’å¹¶æ’åºä¿è¯åˆå¹¶ä¹‹åçš„æ•°æ®çš„æœ‰åºæ€§, è€Œæœ‰åºæ€§åˆèƒ½å¤©ç„¶æé«˜æŸ¥è¯¢æ•ˆç‡."
    },{
      "title": "Skip Lists é˜…è¯»ç¬”è®°",
      "url": "https://qiref.github.io/post/2023/10/01/skip-lists-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/",
      "content": "ç®—æ³•ä»‹ç» ã€ŠSkip Lists: A Probabilistic Alternative to Balanced Treesã€‹ è®ºæ–‡æ ‡é¢˜ç¿»è¯‘å°±æ˜¯ è·³è¡¨: å¹³è¡¡æ ‘çš„æ¦‚ç‡æ€§æ›¿ä»£æ–¹æ¡ˆ; è·³è¡¨æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥ä»£æ›¿å¹³è¡¡æ ‘çš„æ•°æ®ç»“æ„ã€‚è·³è¡¨ä½¿ç”¨æ¦‚ç‡å¹³è¡¡è€Œä¸æ˜¯ä¸¥æ ¼å¼ºåˆ¶çš„å¹³è¡¡ï¼Œå› æ­¤è·³è·ƒåˆ—è¡¨ä¸­çš„æ’å…¥å’Œåˆ é™¤ç®—æ³•æ¯”å¹³è¡¡æ ‘çš„ç­‰æ•ˆç®—æ³•è¦ç®€å•å¾—å¤šå¹¶ä¸”é€Ÿåº¦æ˜æ˜¾æ›´å¿«ã€‚\nä»è®ºæ–‡çš„æ ‡é¢˜å’Œä»‹ç», åŸºæœ¬ä¸Šå°±èƒ½çŸ¥é“è·³è¡¨æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„æ•°æ®ç»“æ„, ä¸ºäº†è§£å†³å¹³è¡¡æ ‘å®ç°çš„å¤æ‚æ€§, æä¾›ä¸€ç§æ¦‚ç‡æ€§å¹³è¡¡çš„æ•°æ®ç»“æ„,ä½œä¸ºå¹³è¡¡æ ‘çš„å¹³æ›¿æ•°æ®ç»“æ„, æŸ¥è¯¢å’Œæ’å…¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n).\nç®—æ³•æµç¨‹ åŸºæœ¬åŸç† èŠ‚ç‚¹ç»“æ„ï¼šè·³è¡¨ç”±å¤šä¸ªå±‚çº§ç»„æˆï¼Œæ¯ä¸ªå±‚çº§éƒ½æ˜¯ä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªå€¼å’Œå¤šä¸ªæŒ‡å‘ä¸‹ä¸€å±‚çº§èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\nå±‚çº§ç´¢å¼•ï¼šè·³è¡¨çš„æœ€åº•å±‚æ˜¯ä¸€ä¸ªæ™®é€šçš„æœ‰åºé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è€Œåœ¨æ›´é«˜çš„å±‚çº§ï¼ŒèŠ‚ç‚¹ä»¥ä¸€å®šçš„æ¦‚ç‡è¿æ¥åˆ°æ›´è¿œçš„èŠ‚ç‚¹ï¼Œå½¢æˆäº†ä¸€ç§â€œè·³è·ƒâ€çš„æ•ˆæœã€‚è¿™äº›è¿æ¥è¢«ç§°ä¸ºâ€œè·³è·ƒæŒ‡é’ˆâ€ï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ—¶å¯ä»¥å¿«é€Ÿåœ°è·³è¿‡ä¸€äº›èŠ‚ç‚¹ã€‚\næŸ¥æ‰¾æ“ä½œï¼šä»è·³è¡¨çš„é¡¶å±‚å¼€å§‹ï¼Œæˆ‘ä»¬æ²¿ç€æ¯ä¸ªå±‚çº§å‘å³ç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å€¼æˆ–æ‰¾åˆ°ä¸€ä¸ªå¤§äºç›®æ ‡å€¼çš„èŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€å±‚çº§ç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æœ€åº•å±‚ã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨å¹³å‡æƒ…å†µä¸‹å®ç°å¿«é€Ÿçš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log n)ã€‚\næ’å…¥å’Œåˆ é™¤æ“ä½œï¼šåœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰§è¡ŒæŸ¥æ‰¾æ“ä½œï¼Œæ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®ã€‚ç„¶åæˆ‘ä»¬åœ¨æ¯ä¸ªå±‚çº§ä¸Šæ’å…¥æ–°èŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®ä¸€å®šçš„æ¦‚ç‡å†³å®šæ˜¯å¦è¦ä¸ºè¯¥èŠ‚ç‚¹æ·»åŠ è·³è·ƒæŒ‡é’ˆã€‚åˆ é™¤æ“ä½œç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åå°†å…¶ä»æ¯ä¸ªå±‚çº§ä¸­ç§»é™¤ã€‚\næŸ¥è¯¢ level è¡¨ç¤ºè·³è¡¨çš„å±‚çº§, è€Œ forward[i] æ˜¯æ¯ä¸€ä¸ªå±‚çº§çš„é“¾è¡¨.\nSearch(list, searchKey) x := listâ†’header // ä»è·³è¡¨çš„é¡¶å±‚å¼€å§‹,éå†åˆ°ç¬¬ä¸€å±‚ for i := listâ†’level downto 1 do while xâ†’forward[i]â†’key \u0026lt; searchKey do x := xâ†’forward[i] // xâ†’key \u0026lt; searchKey â‰¤ xâ†’forward[1]â†’key // æœ€ç»ˆçš„ç»“æœä»è·³è¡¨æœ€åº•å±‚è·å– x := xâ†’forward[1] if xâ†’key = searchKey then return xâ†’value else return failure å†™å…¥ ç”±è·³è¡¨çš„å®šä¹‰å¾—å‡º, è·³è¡¨çš„ä¸Šä¸€å±‚çº§ç›¸å½“äºä¸‹ä¸€å±‚çº§çš„ç´¢å¼•, å¦‚æœéœ€è¦æ„å»ºå¤šçº§çš„ç´¢å¼•, é¦–å…ˆéœ€è¦è§£å†³: å½“å‰nodeæ˜¯å¦åº”è¯¥ç´¢å¼•åˆ°ä¸Šä¸€å±‚çº§?\nåŸºäºé“¾è¡¨çš„æœ‰åºæ€§,é¦–å…ˆå°±èƒ½è”æƒ³åˆ°æ¯éš” 2 ä¸ªå…ƒç´ å¾€ä¸Šå»ºç«‹ç´¢å¼•, ä½†æ˜¯è¿™æ ·ä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜: æ¯æ¬¡æ›´æ–°å…ƒç´ , æœ‰å¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•çš„å…¨å±€æ›´æ–°, æ•ˆç‡åè€Œé™ä½äº†;\nè®ºæ–‡è¿™é‡Œé‡‡ç”¨äº†æ¦‚ç‡çš„åšæ³•, åªéœ€è¦åœ¨å®è§‚ä¸Š, ä¸Šå±‚çš„ node æ˜¯ä¸‹å±‚ node æ•°é‡çš„ 1/2, å°±å¯ä»¥è®¤ä¸ºä¸Šå±‚çš„ç´¢å¼•å»ºç«‹æˆåŠŸ, è€Œä¸éœ€è¦ä¿è¯æ¯éš” n ä¸ª node å‘ä¸Šç´¢å¼•; è¿™æ ·åšæœ‰ä¸ªå¾ˆæ˜æ˜¾çš„ä¼˜ç‚¹, æ’å…¥ node æ—¶, ä¸éœ€è¦å»é‡æ–°æ›´æ–°æ¯ä¸€ä¸ªå±‚çº§çš„ç´¢å¼•, æ•ˆç‡å¤§å¤§æé«˜; å½“ç„¶ç´¢å¼•çš„ç¨€ç–æ€§å¾—ä¸åˆ°ä¿è¯, ä½†æ˜¯åœ¨å¤§æ‰¹é‡æ•°æ®èƒŒæ™¯ä¸‹, è¯¯å·®å¯ä»¥å¿½ç•¥ä¸è®¡.\næ¦‚ç‡æ€§ è¿™é‡Œ randomLevel() å®ç°äº† node æ‰€åœ¨å±‚çº§å‘ˆæ¦‚ç‡åˆ†å¸ƒ, ç¬¬äºŒå±‚æ¦‚ç‡: 1/2; ç¬¬ä¸‰å±‚æ¦‚ç‡: 1/2 * 1/2 = 1/4;\nrandomLevel() lvl := 1 // random() that returns a random value in [0...1) // p é»˜è®¤æ˜¯0.5 while random() \u0026lt; p and lvl \u0026lt; MaxLevel do lvl := lvl + 1 return lvl å†™å…¥çš„å‰åŠéƒ¨åˆ†æ˜¯åœ¨æŸ¥æ‰¾å…ƒç´ , å¦‚æœæ‰¾åˆ°ç›¸åŒ key, ç›´æ¥æ›´æ–°, å¦‚æœæ²¡æ‰¾åˆ°, åˆ™éœ€è¦æ’å…¥ node;\nåœ¨æ’å…¥ node ä¹‹å‰, éœ€è¦å…ˆæ˜ç¡®ä¸€ä¸‹è·³è¡¨åœ¨å®ç°ä¸Šæ˜¯ä¸ªæ€ä¹ˆæ ·çš„ç»“æ„, ä»åŸºç¡€çš„å•é“¾è¡¨å‡ºå‘, æ¯ä¸€ä¸ª node çš„æœ‰ val å’Œ next, val æ˜¯å­˜å‚¨çš„å…·ä½“çš„å€¼ next æŒ‡å‘ä¸‹ä¸€ä¸ª node; ä»ä¸Šå›¾çš„è·³è¡¨æè¿°æ¥çœ‹, æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªå•é“¾è¡¨, é‚£æ€ä¹ˆèƒ½ç›´æ¥ä»ä¸Šä¸€å±‚å¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€å±‚å‘¢?\nå¯ä»¥æŠŠ next å®šä¹‰æˆä¸€ä¸ªæ•°ç»„, è¿™æ ·é€šè¿‡æ•°ç»„ä¸‹æ ‡çš„å˜åŒ–, å°±èƒ½å®ç°é“¾è¡¨ä»ä¸Šä¸€å±‚çº§è·³è½¬åˆ°ä¸‹ä¸€å±‚çº§. è®ºæ–‡é‡Œçš„ forward å°±æ˜¯ next çš„å«ä¹‰.\nInsert(list, searchKey, newValue) local update[1..MaxLevel] // æ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œ, å¹¶ä¸”æ‰¾åˆ°è¢«æ›´æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ update[n] x := listâ†’header for i := listâ†’level downto 1 do while xâ†’forward[i]â†’key \u0026lt; searchKey do x := xâ†’forward[i] -- xâ†’key \u0026lt; searchKey â‰¤ xâ†’forward[i]â†’key update[i] := x x := xâ†’forward[1] if xâ†’key = searchKey then // å¦‚æœæ‰¾åˆ°ç›´æ¥æ›´æ–° value xâ†’value := newValue else // æ²¡æ‰¾åˆ°çš„æƒ…å†µ, éœ€è¦æ–°å¢èŠ‚ç‚¹ lvl := randomLevel() if lvl \u0026gt; listâ†’level then // å¦‚æœæ–°ç”Ÿæˆçš„å±‚çº§æ¯”å½“å‰è·³è¡¨å±‚çº§è¿˜é«˜çš„è¯, éœ€è¦æ›´æ–°è·³è¡¨çš„å±‚çº§ level, å¹¶ä¸”æ–°çš„å±‚çº§update[i]éœ€è¦æŒ‡å‘header for i := listâ†’level + 1 to lvl do update[i] := listâ†’header listâ†’level := lvl // åˆ›å»ºæ–°èŠ‚ç‚¹ x := makeNode(lvl, searchKey, value) for i := 1 to level do // update[i] æŒ‡å‘çš„æ˜¯æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ xâ†’forward[i] := update[i]â†’forward[i] update[i]â†’forward[i] := x åˆ é™¤ Delete(list, searchKey) local update[1..MaxLevel] // æ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œ, å¹¶ä¸”æ‰¾åˆ°è¢«æ›´æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ update[n] x := listâ†’header for i := listâ†’level downto 1 do while xâ†’forward[i]â†’key \u0026lt; searchKey do x := xâ†’forward[i] update[i] := x // æ‰¾åˆ°éœ€è¦åˆ é™¤çš„ç›®æ ‡èŠ‚ç‚¹çš„æœ€ä¸‹å±‚çº§å…ƒç´  x := xâ†’forward[1] if xâ†’key = searchKey then for i := 1 to listâ†’level do // åˆ¤æ–­update[n]çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ x ; å¦‚æœæ˜¯x,åˆ™åˆ é™¤x if update[i]â†’forward[i] â‰  x then break update[i]â†’forward[i] := xâ†’forward[i] free(x) // åˆ¤æ–­æœ€é¡¶å±‚æ˜¯ä¸æ˜¯ä¸ºç©º, ä¸ºç©ºåˆ™è·³è¡¨é™çº§ while listâ†’level \u0026gt; 1 and listâ†’headerâ†’forward[listâ†’level] = NIL do listâ†’level := listâ†’level â€“ 1 æ—¶é—´ç©ºé—´å¤æ‚åº¦åˆ†æ ä»è®ºæ–‡çš„æ€æƒ³æ¥çœ‹, å¾ˆæ˜æ˜¾, è·³è¡¨è¿™ç§æ•°æ®ç»“æ„, å°±æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯è§£å†³å¤§æ•°æ®é‡æŸ¥æ‰¾çš„é—®é¢˜, é€šè¿‡å¤šå±‚çº§ç´¢å¼•, åŠ é€ŸæŸ¥è¯¢;\nå¯¹äºç©ºé—´å¤æ‚åº¦, é¢å¤–åˆ©ç”¨çš„ç©ºé—´å°±æ˜¯æ‰€æœ‰ä¸Šå±‚çš„ç´¢å¼•é“¾è¡¨, å‡è®¾æœ‰ n ä¸ªå…ƒç´ , å…ƒç´ ç´¢å¼•åˆ°ä¸Šå±‚æ¦‚ç‡ä¸º 1/2; é¢å¤–çš„ç©ºé—´ä¸º: n/2 + n/4 + n/8 +...; æ ¹æ®ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼, é¢å¤–ç©ºé—´ä¸º: n(1-1/2^k) å…¶ä¸­kæ˜¯é¡¹æ•°, ä¹Ÿå°±æ˜¯è·³è¡¨å±‚çº§; å› æ­¤ç©ºé—´å¤æ‚åº¦ä¸º O(n).\nå¯¹äºæ—¶é—´å¤æ‚åº¦, å‡è®¾æœ‰ n ä¸ªå…ƒç´ , å…ƒç´ ç´¢å¼•åˆ°ä¸Šå±‚çš„æ¦‚ç‡ä¸º 1/2; å¯¹äºæŸä¸ªå±‚çº§è€Œè¨€, æ¯çº§ç´¢å¼•éƒ½æ˜¯ä¸¤ä¸ªç»“ç‚¹æŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹æ—¶ï¼Œæ‰€ä»¥æ¯ä¸€å±‚æœ€å¤šéå†3ä¸ªç»“ç‚¹, æ‰€ä»¥æœ€åéœ€è¦æŸ¥è¯¢çš„æ—¶é—´å°±å–å†³äºè·³è¡¨çš„å±‚çº§; l=log n, æ‰€ä»¥æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(log n).\nå…·ä½“å®ç° const maxLevel = 32 const pFactor = 0.25 type SkiplistNode struct { val int forward []*SkiplistNode } type Skiplist struct { head *SkiplistNode level int } func Constructor() Skiplist { return Skiplist{\u0026amp;SkiplistNode{-1, make([]*SkiplistNode, maxLevel)}, 0} } func (Skiplist) randomLevel() int { lv := 1 for lv \u0026lt; maxLevel \u0026amp;\u0026amp; rand.Float64() \u0026lt; pFactor { lv++ } return lv } func (s *Skiplist) Search(target int) bool { curr := s.head for i := s.level - 1; i \u0026gt;= 0; i-- { // æ‰¾åˆ°ç¬¬ i å±‚å°äºä¸”æœ€æ¥è¿‘ target çš„å…ƒç´  for curr.forward[i] != nil \u0026amp;\u0026amp; curr.forward[i].val \u0026lt; target { curr = curr.forward[i] } } curr = curr.forward[0] // æ£€æµ‹å½“å‰å…ƒç´ çš„å€¼æ˜¯å¦ç­‰äº target return curr != nil \u0026amp;\u0026amp; curr.val == target } func (s *Skiplist) Add(num int) { update := make([]*SkiplistNode, maxLevel) for i := range update { update[i] = s.head } curr := s.head for i := s.level - 1; i \u0026gt;= 0; i-- { // æ‰¾åˆ°ç¬¬ i å±‚å°äºä¸”æœ€æ¥è¿‘ num çš„å…ƒç´  for curr.forward[i] != nil \u0026amp;\u0026amp; curr.forward[i].val \u0026lt; num { curr = curr.forward[i] } update[i] = curr } lv := s.randomLevel() s.level = max(s.level, lv) newNode := \u0026amp;SkiplistNode{num, make([]*SkiplistNode, lv)} for i, node := range update[:lv] { // å¯¹ç¬¬ i å±‚çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œå°†å½“å‰å…ƒç´ çš„ forward æŒ‡å‘æ–°çš„èŠ‚ç‚¹ newNode.forward[i] = node.forward[i] node.forward[i] = newNode } } func (s *Skiplist) Erase(num int) bool { update := make([]*SkiplistNode, maxLevel) curr := s.head for i := s.level - 1; i \u0026gt;= 0; i-- { // æ‰¾åˆ°ç¬¬ i å±‚å°äºä¸”æœ€æ¥è¿‘ num çš„å…ƒç´  for curr.forward[i] != nil \u0026amp;\u0026amp; curr.forward[i].val \u0026lt; num { curr = curr.forward[i] } update[i] = curr } curr = curr.forward[0] // å¦‚æœå€¼ä¸å­˜åœ¨åˆ™è¿”å› false if curr == nil || curr.val != num { return false } for i := 0; i \u0026lt; s.level \u0026amp;\u0026amp; update[i].forward[i] == curr; i++ { // å¯¹ç¬¬ i å±‚çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œå°† forward æŒ‡å‘è¢«åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€è·³ update[i].forward[i] = curr.forward[i] } // æ›´æ–°å½“å‰çš„ level for s.level \u0026gt; 1 \u0026amp;\u0026amp; s.head.forward[s.level-1] == nil { s.level-- } return true } func max(a, b int) int { if b \u0026gt; a { return b } return a } å‚è€ƒ https://15721.courses.cs.cmu.edu/spring2018/papers/08-oltpindexes1/pugh-skiplists-cacm1990.pdf\nhttps://leetcode.cn/problems/design-skiplist/solutions/1696545/she-ji-tiao-biao-by-leetcode-solution-e8yh/\n",
      "summary": "ç®—æ³•ä»‹ç» ã€ŠSkip Lists: A Probabilistic Alternative to Balanced Treesã€‹ è®ºæ–‡æ ‡é¢˜ç¿»è¯‘å°±æ˜¯ è·³è¡¨: å¹³è¡¡æ ‘çš„æ¦‚ç‡æ€§æ›¿ä»£æ–¹æ¡ˆ; è·³è¡¨æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥ä»£æ›¿å¹³è¡¡æ ‘çš„æ•°æ®ç»“æ„ã€‚è·³è¡¨ä½¿ç”¨æ¦‚ç‡å¹³è¡¡è€Œä¸æ˜¯ä¸¥æ ¼å¼ºåˆ¶çš„å¹³è¡¡ï¼Œå› æ­¤è·³è·ƒåˆ—è¡¨ä¸­çš„æ’å…¥å’Œåˆ é™¤ç®—æ³•æ¯”å¹³è¡¡æ ‘çš„ç­‰æ•ˆç®—æ³•è¦ç®€å•å¾—å¤šå¹¶ä¸”é€Ÿåº¦æ˜æ˜¾æ›´å¿«ã€‚\nä»è®ºæ–‡çš„æ ‡é¢˜å’Œä»‹ç», åŸºæœ¬ä¸Šå°±èƒ½çŸ¥é“è·³è¡¨æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„æ•°æ®ç»“æ„, ä¸ºäº†è§£å†³å¹³è¡¡æ ‘å®ç°çš„å¤æ‚æ€§, æä¾›ä¸€ç§æ¦‚ç‡æ€§å¹³è¡¡çš„æ•°æ®ç»“æ„,ä½œä¸ºå¹³è¡¡æ ‘çš„å¹³æ›¿æ•°æ®ç»“æ„, æŸ¥è¯¢å’Œæ’å…¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n).\nç®—æ³•æµç¨‹ åŸºæœ¬åŸç† èŠ‚ç‚¹ç»“æ„ï¼šè·³è¡¨ç”±å¤šä¸ªå±‚çº§ç»„æˆï¼Œæ¯ä¸ªå±‚çº§éƒ½æ˜¯ä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªå€¼å’Œå¤šä¸ªæŒ‡å‘ä¸‹ä¸€å±‚çº§èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\nå±‚çº§ç´¢å¼•ï¼šè·³è¡¨çš„æœ€åº•å±‚æ˜¯ä¸€ä¸ªæ™®é€šçš„æœ‰åºé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è€Œåœ¨æ›´é«˜çš„å±‚çº§ï¼ŒèŠ‚ç‚¹ä»¥ä¸€å®šçš„æ¦‚ç‡è¿æ¥åˆ°æ›´è¿œçš„èŠ‚ç‚¹ï¼Œå½¢æˆäº†ä¸€ç§â€œè·³è·ƒâ€çš„æ•ˆæœã€‚è¿™äº›è¿æ¥è¢«ç§°ä¸ºâ€œè·³è·ƒæŒ‡é’ˆâ€ï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ—¶å¯ä»¥å¿«é€Ÿåœ°è·³è¿‡ä¸€äº›èŠ‚ç‚¹ã€‚\næŸ¥æ‰¾æ“ä½œï¼šä»è·³è¡¨çš„é¡¶å±‚å¼€å§‹ï¼Œæˆ‘ä»¬æ²¿ç€æ¯ä¸ªå±‚çº§å‘å³ç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å€¼æˆ–æ‰¾åˆ°ä¸€ä¸ªå¤§äºç›®æ ‡å€¼çš„èŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€å±‚çº§ç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æœ€åº•å±‚ã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨å¹³å‡æƒ…å†µä¸‹å®ç°å¿«é€Ÿçš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log n)ã€‚\næ’å…¥å’Œåˆ é™¤æ“ä½œï¼šåœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰§è¡ŒæŸ¥æ‰¾æ“ä½œï¼Œæ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®ã€‚ç„¶åæˆ‘ä»¬åœ¨æ¯ä¸ªå±‚çº§ä¸Šæ’å…¥æ–°èŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®ä¸€å®šçš„æ¦‚ç‡å†³å®šæ˜¯å¦è¦ä¸ºè¯¥èŠ‚ç‚¹æ·»åŠ è·³è·ƒæŒ‡é’ˆã€‚åˆ é™¤æ“ä½œç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åå°†å…¶ä»æ¯ä¸ªå±‚çº§ä¸­ç§»é™¤ã€‚\næŸ¥è¯¢ level è¡¨ç¤ºè·³è¡¨çš„å±‚çº§, è€Œ forward[i] æ˜¯æ¯ä¸€ä¸ªå±‚çº§çš„é“¾è¡¨.\nSearch(list, searchKey) x := listâ†’header // ä»è·³è¡¨çš„é¡¶å±‚å¼€å§‹,éå†åˆ°ç¬¬ä¸€å±‚ for i := listâ†’level downto 1 do while xâ†’forward[i]â†’key \u0026lt; searchKey do x := xâ†’forward[i] // xâ†’key \u0026lt; searchKey â‰¤ xâ†’forward[1]â†’key // æœ€ç»ˆçš„ç»“æœä»è·³è¡¨æœ€åº•å±‚è·å– x := xâ†’forward[1] if xâ†’key = searchKey then return xâ†’value else return failure å†™å…¥ ç”±è·³è¡¨çš„å®šä¹‰å¾—å‡º, è·³è¡¨çš„ä¸Šä¸€å±‚çº§ç›¸å½“äºä¸‹ä¸€å±‚çº§çš„ç´¢å¼•, å¦‚æœéœ€è¦æ„å»ºå¤šçº§çš„ç´¢å¼•, é¦–å…ˆéœ€è¦è§£å†³: å½“å‰nodeæ˜¯å¦åº”è¯¥ç´¢å¼•åˆ°ä¸Šä¸€å±‚çº§?"
    },{
      "title": "DBLog é˜…è¯»ç¬”è®°",
      "url": "https://qiref.github.io/post/2023/08/09/dblog-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/",
      "content": "ä»‹ç» è®ºæ–‡åŸå: DBLog: A Watermark Based Change-Data-Capture Framework , åŸºäº Watermark çš„ Change-Data-Capture(æ•°æ®åº“å®æ—¶æ•è·å·²æäº¤çš„å˜æ›´è®°å½•) æ¡†æ¶, æœ¬è´¨ä¸Šæ˜¯è§£å†³æ•°æ®åº“åŒæ­¥(å…¨é‡+å¢é‡)çš„æ¡†æ¶, Watermark æ˜¯æ¡†æ¶ä½¿ç”¨çš„ä¸€ç§æ‰‹æ®µ, åœ¨æºè¡¨ä¸­åˆ›å»ºè¡¨,ç”Ÿæˆå”¯ä¸€ uuid å¹¶æ›´æ–°è¡¨æ•°æ®, åœ¨æºè¡¨ä¸­å°±ä¼šç”Ÿæˆä¸€æ¡å˜æ›´è®°å½•,è®°ä½œ Watermark çš„å˜æ›´è®°å½•, é€šè¿‡ High Watermark å’Œ Low Watermark å°†å˜æ›´è®°å½•åˆ†å‰², ä¿è¯ select chunk æ•°æ®åŒ…å«äº†å¢é‡çš„å˜æ›´è®°å½•.\næ¡†æ¶æ•´ä½“æ¶æ„å¦‚ä¸‹:\næ¡†æ¶ç‰¹ç‚¹:\næŒ‰é¡ºåºå¤„ç†æ•è·åˆ°çš„ changelog; è½¬å‚¨å¯ä»¥éšæ—¶è¿›è¡Œï¼Œè·¨æ‰€æœ‰è¡¨ï¼Œé’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„è¡¨æˆ–è€…é’ˆå¯¹ä¸€ä¸ªè¡¨çš„å…·ä½“ä¸»é”®; ä»¥å—(chunk)çš„å½¢å¼è·å–è½¬å‚¨ï¼Œæ—¥å¿—ä¸è½¬å‚¨äº‹ä»¶äº¤é”™ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œchangelog å¯ä»¥ä¸è½¬å‚¨å¤„ç†ä¸€èµ·è¿›è¡Œã€‚å¦‚æœè¿›ç¨‹ç»ˆæ­¢ï¼Œå®ƒå¯ä»¥åœ¨æœ€åä¸€ä¸ªå®Œæˆçš„å—ä¹‹åæ¢å¤ï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹ã€‚è¿™è¿˜å…è®¸åœ¨éœ€è¦æ—¶å¯¹è½¬å‚¨è¿›è¡Œè°ƒæ•´å’Œæš‚åœ; ä¸ä¼šè·å–è¡¨çº§é”ï¼Œè¿™å¯ä»¥é˜²æ­¢å½±å“æºæ•°æ®åº“ä¸Šçš„å†™æµé‡; æ”¯æŒä»»ä½•ç±»å‹çš„è¾“å‡ºï¼Œå› æ­¤ï¼Œè¾“å‡ºå¯ä»¥æ˜¯æµã€æ•°æ®å­˜å‚¨ç”šæˆ–æ˜¯ API; è®¾è®¡å……åˆ†è€ƒè™‘äº†é«˜å¯ç”¨æ€§ã€‚å› æ­¤ï¼Œä¸‹æ¸¸çš„æ¶ˆè´¹è€…å¯ä»¥æ”¾å¿ƒï¼Œåªè¦æºç«¯å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä»¬å°±å¯ä»¥æ”¶åˆ°å˜åŒ–äº‹ä»¶ã€‚ æ³¨æ„, æœ¬æ–‡å¹¶éè¯¦ç»†ä»‹ç» DBLog æ¡†æ¶æœ¬èº«, è€Œæ˜¯åˆ†æå…¶æ¡†æ¶èƒŒåçš„è®¾è®¡æ€è·¯.\nç®—æ³•æµç¨‹ chunk åˆ’åˆ† å¯¹äºæºè¡¨æ•°æ®, å…¨é‡æ•°æ®ä½¿ç”¨åˆ†å—è¯»å–, åŸºäº primary key é¡ºåºæ’åº, å°†å…¨é‡æ•°æ®åˆ’åˆ†ä¸º N ä¸ª chunk;\nwatermark åŸºäº chunk åˆ’åˆ†, ç„¶å chunk æ•°æ®å…¨é‡å†™å…¥ä¸‹æ¸¸ä¹‹å, å†å°†æºè¡¨çš„å˜æ›´è®°å½• changelog å¢é‡åŒæ­¥åˆ°ä¸‹æ¸¸, æ•´ä½“æ€è·¯å°±æ˜¯è¿™æ ·, ä½†æ˜¯åˆ’åˆ† chunk æœ‰ä¸ªé—®é¢˜éœ€è¦è§£å†³, å°±æ˜¯å…ˆåŒæ­¥åˆ°ä¸‹æ¸¸çš„æ•°æ®ä¸ä¸€å®šçš„æœ€ç»ˆçš„æ•°æ®, ä¾‹å¦‚ä¸Šå›¾ chunk1 ä¸­çš„æ•°æ®åœ¨åŒæ­¥åˆ°ä¸‹æ¸¸ä¹‹åå¯èƒ½ä¼šåˆ é™¤, é‚£chunk1 çš„æ•°æ®å†™åˆ°ä¸‹æ¸¸ä¹‹å, ä¸‹æ¸¸å°±ä¼šå‡ºç°è„æ•°æ®; å¦‚ä½•è§£å†³ chunk å’Œ changelog ä¹‹é—´ä¸ä¼šç›¸äº’è¦†ç›–çš„é—®é¢˜?\nä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜, DBLog çš„è§£å†³åŠæ³•æ˜¯å¼•å…¥ watermark çš„æœºåˆ¶, åœ¨æŸ¥è¯¢ chunk æœŸé—´, å¯¹ changelog è¿›è¡Œæ ‡è®° , ç„¶åå»ç§»é™¤ select chunk æœŸé—´, chunk æ•°æ®ä¸­å¯¹åº”çš„ changelog æ•°æ®, è¿™æ ·å°±è§£å†³äº† select chunk æ•°æ®å’ŒæœŸé—´å¯¹åº”çš„ changelog æ•°æ®çš„é¡ºåºé—®é¢˜ , è¿™ä¹Ÿå°±æ˜¯è®ºæ–‡çš„ç²¾å¦™ä¹‹å¤„!\nwatermark æ˜¯é€šè¿‡æºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨å®ç°çš„, è¡¨å­˜å‚¨åœ¨ä¸“ç”¨çš„å‘½åç©ºé—´ä¸­ï¼Œå› æ­¤ä¸ä¼šä¸åº”ç”¨ç¨‹åºè¡¨å‘ç”Ÿå†²çªã€‚æ”¹è¡¨åªåŒ…å«ä¸€è¡Œ,å­˜å‚¨ UUID å­—æ®µ; é€šè¿‡å°†è¿™ä¸€è¡Œæ›´æ–°ä¸ºç‰¹å®šçš„ UUID æ¥ç”Ÿæˆwatermark, è¡Œæ›´æ–°ç”Ÿæˆä¸€ä¸ªæ›´æ”¹äº‹ä»¶ã€‚\nç®—æ³•ä¼ªç  ç®—æ³•ä¼ªä»£ç å¦‚ä¸‹:\n// step1 æš‚åœå¤„ç† changelog pause log event processing lw := uuid() hw := uuid() // step2 é€šè¿‡æ›´æ–°watermarkè¡¨ç”Ÿæˆ low watermark update watermark table set value = lw // step3 ä¸ºä¸‹ä¸€ä¸ªå—è¿è¡Œ SELECT è¯­å¥ï¼Œå¹¶å°†ç»“æœé›†å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæŒ‰ä¸»é”®ç´¢å¼• chunk := select next chunk from table // step4 é€šè¿‡æ›´æ–°watermarkè¡¨ç”Ÿæˆ high watermark update watermark table set value = hw // step5 æ¢å¤å¤„ç† changelog, ç›‘å¬ high watermark resume log event processing inwindow := false // other steps of event prosessing loop while true do e := next event from changelog if not inwindow then{ if e is not watermark then append e to outputbuffer else if e is watermark with value lw then inwindow := true }else{ if e is not watermark then{ // step 6 æ¥æ”¶åˆ°lwäº‹ä»¶åï¼Œå¼€å§‹ä»ç»“æœé›†ä¸­åˆ é™¤æ‰€æœ‰åœ¨lwä¹‹åæ¥æ”¶åˆ°çš„changelogä¸»é”®çš„æ¡ç›® if chunk contains e.key then{ remove e.key from chunk } append e to outputbuffer }else if e is watermark with value hw then { // step7 æ¥æ”¶åˆ°hwäº‹ä»¶åï¼Œå°†æ‰€æœ‰å‰©ä½™çš„ç»“æœé›†æ¡ç›®å‘é€åˆ°è¾“å‡º for each row in chunk do{ append row to outputbuffer } } } ç®—æ³•æ­¥éª¤åˆ†æ ç¤ºä¾‹è¡¨ï¼Œk1 åˆ° k6 ä¸ºä¸»é”®ã€‚æ¯ä¸ªæ›´æ”¹æ—¥å¿—æ¡ç›®è¡¨ç¤ºä¸»é”®çš„åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤äº‹ä»¶ã€‚åœ¨ä¸‹å›¾å±•ç¤ºäº†watermarkçš„ç”Ÿæˆå’Œchunkçš„é€‰æ‹©ï¼ˆstep 1 åˆ° step 4ï¼‰ã€‚é‡ç‚¹çœ‹ä»ä½äºwatermarkä¹‹é—´çš„ä¸»é”®ç»“æœ: åˆ é™¤é€‰å®šchunkçš„è¡Œï¼ˆstep 5 åˆ° step 7ï¼‰ã€‚\nå¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨ lw å’Œ hw ä¹‹é—´æäº¤äº†å¤§é‡çš„è¡Œæ›´æ”¹ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„ changelogã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®ºæ–‡åœ¨ step 2-4 æœŸé—´ä¼šçŸ­æš‚åœ°æš‚åœæ—¥å¿—å¤„ç†ï¼Œä»è€Œä¿è¯ä¸ä¼šé—æ¼watermark, è¿™æ ·changelogå¤„ç†å°±å¯ä»¥åœ¨ä»¥åé€ä¸ªäº‹ä»¶åœ°æ¢å¤ã€‚æ—¥å¿—å¤„ç†æš‚åœçš„æ—¶é—´å¾ˆçŸ­ï¼Œå› ä¸º step 2-4 é¢„è®¡ä¼šæ¯”è¾ƒå¿«ï¼šæ°´å°æ›´æ–°æ˜¯å•ä¸ªçš„å†™æ“ä½œï¼Œè€Œ SELECT æ“ä½œæœ‰ä¸€å®šçš„èŒƒå›´, å¯èƒ½è€—æ—¶è¾ƒé•¿ã€‚\nåœ¨ç¬¬ 7 æ­¥æ¥æ”¶åˆ°hwåï¼Œéå†²çªçš„chunkå—å°†è¢«æäº¤å†™å…¥ï¼Œä»¥ä¾¿æŒ‰é¡ºåºå‘é€åˆ°ä¸‹æ¸¸ã€‚è¿™æ˜¯ä¸€ä¸ªéé˜»å¡æ“ä½œï¼Œå› ä¸ºå†™å…¥åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œå…è®¸åœ¨step 7 ä¹‹åå¿«é€Ÿæ¢å¤æ—¥å¿—å¤„ç†ã€‚ç„¶åï¼Œchangelogå¤„ç†å°†ç»§ç»­å¤„ç†hwä¹‹åå‘ç”Ÿçš„äº‹ä»¶ã€‚\nåœ¨ä¸‹å›¾ä¸­ï¼Œä½¿ç”¨ä¸Šå›¾ç›¸åŒçš„ç¤ºä¾‹æ¥æè¿°æ•´ä¸ªåŒæ­¥æ•°æ®çš„å†™é¡ºåº, å‡ºç°åœ¨hwä¹‹å‰çš„changelogé¦–å…ˆè¢«å†™å…¥, ç„¶åæ˜¯chunkç»“æœ(è¢«ä¿®æ­£å), æœ€åæ˜¯åœ¨hwä¹‹åå‘ç”Ÿçš„changelogã€‚\né—®é¢˜ å½“chunkåˆ’åˆ†å®Œä¹‹å, è¿›å…¥å¢é‡çš„ binlog offset åº”è¯¥å¦‚ä½•é€‰å–? chunk åˆ’åˆ†è¿‡ç¨‹ä¸­,å®é™…ä¸Šå·²ç»æŠŠ lw åˆ° hw èŒƒå›´ä¸­çš„å¢é‡æ•°æ®, åˆå¹¶åˆ° chunk çš„å…¨é‡æ•°æ®ä¸­(åªåˆå¹¶chunkèŒƒå›´å†…çš„æ•°æ®), å› æ­¤, å¢é‡é˜¶æ®µçš„ binlog offset åº”è¯¥è¦ä»chuckä¸­æœ€å°çš„ hw å¼€å§‹, ä¸€ç›´åˆ°æœ€å¤§çš„ hw ä¸ºæ­¢, è¿™ä¸ªèŒƒå›´å†…çš„æ•°æ®, å¦‚æœ binlog å·²ç»åŒ…å«åœ¨ chunk ä¸­, å°±æ— éœ€å¤„ç†, å¦åˆ™å¾€ä¸‹æ¸¸å‘é€;\nå¢é‡é˜¶æ®µå¼€å§‹çš„ offset ä¸ºä»€ä¹ˆä¸æ˜¯æœ€å°çš„ lw ? å¦‚æœä»chuckä¸­æœ€å°çš„ hw å¼€å§‹, é‚£ä» lw - hw è¿™ä¸€æ®µçš„ binlogä¸­, æ²¡è¢«åˆå¹¶åˆ° chunk ä¸­çš„ binlogä¸å°±æ¼æ‰äº†?\nå¦‚ä¸‹å›¾, [lw1, hw1] è¿™ä¸ªèŒƒå›´ä¸­, å¦‚æœåœ¨ chunk ä¸­, ä¼šåˆå¹¶, å¦‚æœä¸åœ¨ chunk ä¸­, è¿™ä¸ªèŒƒå›´çš„æ•°æ®åœ¨ä¸‹ä¸€ä¸ª chunk çš„å…¨é‡é˜¶æ®µèƒ½æŸ¥è¯¢åˆ°, æ‰€ä»¥ä» min(hw) çš„ offset å¼€å¯å¢é‡é˜¶æ®µå³å¯.\nå¤šä¸ª chunk è¯»å–æ˜¯å¹¶è¡Œçš„, å¦‚æœä¸¤ä¸ª chunk çš„ lw åˆ° hw binlog æ•°æ®æœ‰äº¤å‰, æˆ–è€… chunk ä¹±åº, æ˜¯å¦ä¼šå½±å“ç»“æœ? åœ¨å¢é‡é˜¶æ®µå¼€å§‹æ—¶, ä¼šä» min(hw) çš„ offset å¼€å§‹æ¶ˆè´¹ binlog, ç›´åˆ° max(hw), æ­¤èŒƒå›´ä¸­çš„æ•°æ®, å¦‚æœæ˜¯ä¸åœ¨å¯¹åº”çš„ chunk ä¸­(å…¨é‡é˜¶æ®µå·²ç»åˆå¹¶), åˆ™ä¼šå‘ä¸‹æ¸¸å‘é€;\nå½“ watermark æœ‰äº¤å‰æ—¶, äº¤å‰éƒ¨åˆ†çš„ binlog ä¼šä¾æ¬¡åœ¨ä¸åŒçš„ chunk ä¸­è¿›è¡Œåˆ¤æ–­, å› æ­¤ä¸ä¼šé‡å¤; å½“ watermark ä¹±åºæ—¶, å…¨é‡é˜¶æ®µ,æ¯ä¸ª chunk åˆ’åˆ†çš„èŒƒå›´ä¸åŒ, ä¹±åºæ²¡æœ‰å½±å“, è‡³äº binlog æ¶ˆè´¹, ä¹Ÿæ˜¯é¡ºåºçš„, ä¸ä¼šå½±å“å¢é‡é˜¶æ®µçš„é¡ºåº;\nå‚è€ƒ https://arxiv.org/pdf/2010.12597.pdf\nhttps://netflixtechblog.com/dblog-a-generic-change-data-capture-framework-69351fb9099b\n",
      "summary": "ä»‹ç» è®ºæ–‡åŸå: DBLog: A Watermark Based Change-Data-Capture Framework , åŸºäº Watermark çš„ Change-Data-Capture(æ•°æ®åº“å®æ—¶æ•è·å·²æäº¤çš„å˜æ›´è®°å½•) æ¡†æ¶, æœ¬è´¨ä¸Šæ˜¯è§£å†³æ•°æ®åº“åŒæ­¥(å…¨é‡+å¢é‡)çš„æ¡†æ¶, Watermark æ˜¯æ¡†æ¶ä½¿ç”¨çš„ä¸€ç§æ‰‹æ®µ, åœ¨æºè¡¨ä¸­åˆ›å»ºè¡¨,ç”Ÿæˆå”¯ä¸€ uuid å¹¶æ›´æ–°è¡¨æ•°æ®, åœ¨æºè¡¨ä¸­å°±ä¼šç”Ÿæˆä¸€æ¡å˜æ›´è®°å½•,è®°ä½œ Watermark çš„å˜æ›´è®°å½•, é€šè¿‡ High Watermark å’Œ Low Watermark å°†å˜æ›´è®°å½•åˆ†å‰², ä¿è¯ select chunk æ•°æ®åŒ…å«äº†å¢é‡çš„å˜æ›´è®°å½•.\næ¡†æ¶æ•´ä½“æ¶æ„å¦‚ä¸‹:\næ¡†æ¶ç‰¹ç‚¹:\næŒ‰é¡ºåºå¤„ç†æ•è·åˆ°çš„ changelog; è½¬å‚¨å¯ä»¥éšæ—¶è¿›è¡Œï¼Œè·¨æ‰€æœ‰è¡¨ï¼Œé’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„è¡¨æˆ–è€…é’ˆå¯¹ä¸€ä¸ªè¡¨çš„å…·ä½“ä¸»é”®; ä»¥å—(chunk)çš„å½¢å¼è·å–è½¬å‚¨ï¼Œæ—¥å¿—ä¸è½¬å‚¨äº‹ä»¶äº¤é”™ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œchangelog å¯ä»¥ä¸è½¬å‚¨å¤„ç†ä¸€èµ·è¿›è¡Œã€‚å¦‚æœè¿›ç¨‹ç»ˆæ­¢ï¼Œå®ƒå¯ä»¥åœ¨æœ€åä¸€ä¸ªå®Œæˆçš„å—ä¹‹åæ¢å¤ï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹ã€‚è¿™è¿˜å…è®¸åœ¨éœ€è¦æ—¶å¯¹è½¬å‚¨è¿›è¡Œè°ƒæ•´å’Œæš‚åœ; ä¸ä¼šè·å–è¡¨çº§é”ï¼Œè¿™å¯ä»¥é˜²æ­¢å½±å“æºæ•°æ®åº“ä¸Šçš„å†™æµé‡; æ”¯æŒä»»ä½•ç±»å‹çš„è¾“å‡ºï¼Œå› æ­¤ï¼Œè¾“å‡ºå¯ä»¥æ˜¯æµã€æ•°æ®å­˜å‚¨ç”šæˆ–æ˜¯ API; è®¾è®¡å……åˆ†è€ƒè™‘äº†é«˜å¯ç”¨æ€§ã€‚å› æ­¤ï¼Œä¸‹æ¸¸çš„æ¶ˆè´¹è€…å¯ä»¥æ”¾å¿ƒï¼Œåªè¦æºç«¯å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä»¬å°±å¯ä»¥æ”¶åˆ°å˜åŒ–äº‹ä»¶ã€‚ æ³¨æ„, æœ¬æ–‡å¹¶éè¯¦ç»†ä»‹ç» DBLog æ¡†æ¶æœ¬èº«, è€Œæ˜¯åˆ†æå…¶æ¡†æ¶èƒŒåçš„è®¾è®¡æ€è·¯.\nç®—æ³•æµç¨‹ chunk åˆ’åˆ† å¯¹äºæºè¡¨æ•°æ®, å…¨é‡æ•°æ®ä½¿ç”¨åˆ†å—è¯»å–, åŸºäº primary key é¡ºåºæ’åº, å°†å…¨é‡æ•°æ®åˆ’åˆ†ä¸º N ä¸ª chunk;\nwatermark åŸºäº chunk åˆ’åˆ†, ç„¶å chunk æ•°æ®å…¨é‡å†™å…¥ä¸‹æ¸¸ä¹‹å, å†å°†æºè¡¨çš„å˜æ›´è®°å½• changelog å¢é‡åŒæ­¥åˆ°ä¸‹æ¸¸, æ•´ä½“æ€è·¯å°±æ˜¯è¿™æ ·, ä½†æ˜¯åˆ’åˆ† chunk æœ‰ä¸ªé—®é¢˜éœ€è¦è§£å†³, å°±æ˜¯å…ˆåŒæ­¥åˆ°ä¸‹æ¸¸çš„æ•°æ®ä¸ä¸€å®šçš„æœ€ç»ˆçš„æ•°æ®, ä¾‹å¦‚ä¸Šå›¾ chunk1 ä¸­çš„æ•°æ®åœ¨åŒæ­¥åˆ°ä¸‹æ¸¸ä¹‹åå¯èƒ½ä¼šåˆ é™¤, é‚£chunk1 çš„æ•°æ®å†™åˆ°ä¸‹æ¸¸ä¹‹å, ä¸‹æ¸¸å°±ä¼šå‡ºç°è„æ•°æ®; å¦‚ä½•è§£å†³ chunk å’Œ changelog ä¹‹é—´ä¸ä¼šç›¸äº’è¦†ç›–çš„é—®é¢˜?"
    },{
      "title": "Javaè¿›ç¨‹åˆ†æå·¥å…·",
      "url": "https://qiref.github.io/post/2023/06/26/java%E8%BF%9B%E7%A8%8B%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/",
      "content": "JVM å†…å­˜åŒºåŸŸ å¦‚æœè¦ä¸ºæ–°ç”Ÿä»£åˆ†é… 256m çš„å†…å­˜ï¼ˆNewSize ä¸ MaxNewSize è®¾ä¸ºä¸€è‡´ï¼‰ï¼Œå‚æ•°åº”è¯¥è¿™æ ·æ¥å†™ï¼š-Xmn256m;\nè¿˜å¯ä»¥é€šè¿‡ -XX:NewRatio=\u0026lt;int\u0026gt; æ¥è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”å€¼ã€‚æ¯”å¦‚ä»¥ä¸‹å‚æ•°å°±æ˜¯è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”å€¼ä¸º 1ã€‚ä¹Ÿå°±æ˜¯è¯´è€å¹´ä»£å’Œæ–°ç”Ÿä»£æ‰€å æ¯”å€¼ä¸º 1ï¼š1ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †æ ˆçš„ 1/2ã€‚\n-XX:NewRatio=1 JDK 1.8 ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ Metaspaceï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚\nMetaspace çš„åˆå§‹å®¹é‡å¹¶ä¸æ˜¯ -XX:MetaspaceSize è®¾ç½®ï¼Œæ— è®º -XX:MetaspaceSize é…ç½®ä»€ä¹ˆå€¼ï¼Œå¯¹äº 64 ä½ JVM æ¥è¯´ï¼ŒMetaspace çš„åˆå§‹å®¹é‡éƒ½æ˜¯ 21807104ï¼ˆçº¦ 20.8mï¼‰ã€‚å¯ä»¥å‚è€ƒ Oracle å®˜æ–¹æ–‡æ¡£ :\nSpecify a higher value for the option MetaspaceSize to avoid early garbage collections induced for class metadata. The amount of class metadata allocated for an application is application-dependent and general guidelines do not exist for the selection of MetaspaceSize. The default size of MetaspaceSize is platform-dependent and ranges from 12 MB to about 20 MB.\nMetaspace ç”±äºä½¿ç”¨ä¸æ–­æ‰©å®¹åˆ°-XX:MetaspaceSizeå‚æ•°æŒ‡å®šçš„é‡ï¼Œå°±ä¼šå‘ç”Ÿ Full GCï¼Œä¸”ä¹‹åæ¯æ¬¡ Metaspace æ‰©å®¹éƒ½ä¼šå‘ç”Ÿ Full GCã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMetaspaceSize è¡¨ç¤º Metaspace ä½¿ç”¨è¿‡ç¨‹ä¸­è§¦å‘ Full GC çš„é˜ˆå€¼ï¼Œåªå¯¹è§¦å‘èµ·ä½œç”¨ï¼›å¦‚æœ MaxMetaspaceSize è®¾ç½®å¤ªå°ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹ Full GC ï¼Œç”šè‡³OOMã€‚\njmap æ‰“å°heapä¿¡æ¯ å‘½ä»¤ï¼šjmap -heap pid\næè¿°ï¼šæ˜¾ç¤ºJavaå †è¯¦ç»†ä¿¡æ¯\nâœ ~ jmap -heap 10439 Attaching to process ID 10439, please wait... Error attaching to process: sun.jvm.hotspot.runtime.VMVersionMismatchException: Supported versions are 25.312-b07. Target VM is 25.272-b1 sun.jvm.hotspot.debugger.DebuggerException: sun.jvm.hotspot.runtime.VMVersionMismatchException: Supported versions are 25.312-b07. Target VM is 25.272-b1 at sun.jvm.hotspot.HotSpotAgent.setupVM(HotSpotAgent.java:435) at sun.jvm.hotspot.HotSpotAgent.go(HotSpotAgent.java:305) at sun.jvm.hotspot.HotSpotAgent.attach(HotSpotAgent.java:140) at sun.jvm.hotspot.tools.Tool.start(Tool.java:185) at sun.jvm.hotspot.tools.Tool.execute(Tool.java:118) at sun.jvm.hotspot.tools.HeapSummary.main(HeapSummary.java:50) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at sun.tools.jmap.JMap.runTool(JMap.java:201) at sun.tools.jmap.JMap.main(JMap.java:130) Caused by: sun.jvm.hotspot.runtime.VMVersionMismatchException: Supported versions are 25.312-b07. Target VM is 25.272-b1 at sun.jvm.hotspot.runtime.VM.checkVMVersion(VM.java:227) at sun.jvm.hotspot.runtime.VM.\u0026lt;init\u0026gt;(VM.java:294) at sun.jvm.hotspot.runtime.VM.initialize(VM.java:370) at sun.jvm.hotspot.HotSpotAgent.setupVM(HotSpotAgent.java:431) æŠ¥é”™åŸå› æ˜¯ç³»ç»Ÿæœ‰å¤šä¸ªjdkï¼Œå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„ã€‚\nâœ ~ echo $JAVA_HOME /usr/local/TencentKona-8.0.4-272 âœ ~ /usr/local/TencentKona-8.0.4-272/bin/jmap -heap 10439 Attaching to process ID 10439, please wait... Debugger attached successfully. Server compiler detected. JVM version is 25.272-b1 using thread-local object allocation. Garbage-First (G1) GC with 8 thread(s) Heap Configuration: MinHeapFreeRatio = 40 MaxHeapFreeRatio = 70 MaxHeapSize = 536870912 (512.0MB) NewSize = 1363144 (1.2999954223632812MB) MaxNewSize = 321912832 (307.0MB) OldSize = 5452592 (5.1999969482421875MB) NewRatio = 2 SurvivorRatio = 8 MetaspaceSize = 21807104 (20.796875MB) CompressedClassSpaceSize = 260046848 (248.0MB) MaxMetaspaceSize = 268435456 (256.0MB) G1HeapRegionSize = 1048576 (1.0MB) Heap Usage: G1 Heap: regions = 512 capacity = 536870912 (512.0MB) used = 226987352 (216.47200775146484MB) free = 309883560 (295.52799224853516MB) 42.27968901395798% used G1 Young Generation: Eden Space: regions = 207 capacity = 338690048 (323.0MB) used = 217055232 (207.0MB) free = 121634816 (116.0MB) 64.08668730650155% used Survivor Space: regions = 0 capacity = 0 (0.0MB) used = 0 (0.0MB) free = 0 (0.0MB) 0.0% used G1 Old Generation: regions = 10 capacity = 198180864 (189.0MB) used = 9932120 (9.472007751464844MB) free = 188248744 (179.52799224853516MB) 5.0116443129443615% used 8841 interned Strings occupying 891192 bytes. ç»Ÿè®¡heapå¯¹è±¡ å‘½ä»¤ï¼šjmap -histo:live pid æè¿°ï¼šæ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯\nå…¶ä¸­åŒ…æ‹¬æ¯ä¸ªJavaç±»ã€å¯¹è±¡æ•°é‡ã€å†…å­˜å¤§å°(å•ä½ï¼šå­—èŠ‚)ã€å®Œå…¨é™å®šçš„ç±»åã€‚æ‰“å°çš„è™šæ‹Ÿæœºå†…éƒ¨çš„ç±»åç§°å°†ä¼šå¸¦æœ‰ä¸€ä¸ª * å‰ç¼€ã€‚å¦‚æœæŒ‡å®šäº†liveå­é€‰é¡¹ï¼Œåˆ™åªè®¡ç®—æ´»åŠ¨çš„å¯¹è±¡ã€‚\nâœ ~ /usr/local/TencentKona-8.0.4-272/bin/jmap -histo:live 10439 |head -n 30 num #instances #bytes class name ---------------------------------------------- 1: 23634 2041848 [C 2: 43 1409712 [Ljava.util.concurrent.ForkJoinTask; 3: 1053 1191208 [B 4: 7197 790496 java.lang.Class 5: 23631 567144 java.lang.String 6: 6322 542264 [Ljava.lang.Object; 7: 8725 279200 java.util.concurrent.ConcurrentHashMap$Node 8: 4123 263872 java.nio.DirectByteBuffer 9: 4096 229376 org.apache.flink.core.memory.MemorySegment 10: 2900 201184 [I 11: 4117 164680 sun.misc.Cleaner 12: 4115 131680 java.nio.DirectByteBuffer$Deallocator 13: 3923 125536 java.util.HashMap$Node 14: 5009 80144 java.lang.Object 15: 900 79200 java.lang.reflect.Method 16: 811 77264 [Ljava.util.HashMap$Node; 17: 1304 73024 java.lang.invoke.MemberName 18: 101 66976 [Ljava.util.concurrent.ConcurrentHashMap$Node; 19: 4160 66560 java.util.concurrent.atomic.AtomicBoolean 20: 80 53760 org.apache.flink.shaded.netty4.io.netty.util.internal.shaded. org.jctools.queues.MpscArrayQueue 21: 1266 50640 java.util.LinkedHashMap$Entry 22: 1160 46400 java.lang.invoke.MethodType 23: 1144 45760 java.lang.ref.SoftReference 24: 1663 41632 [Ljava.lang.Class; 25: 986 39440 com.typesafe.config.impl.SimpleConfigOrigin 26: 1177 37664 java.lang.invoke.MethodType$ConcurrentWeakInternSet$WeakEntry 27: 777 37296 java.util.HashMap æ‰“å°ç­‰å¾…ç»ˆç»“çš„å¯¹è±¡ å‘½ä»¤ï¼šjmap -finalizerinfo pid\næè¿°ï¼šæ‰“å°ç­‰å¾…ç»ˆç»“çš„å¯¹è±¡ä¿¡æ¯\nâœ ~ /usr/local/TencentKona-8.0.4-272/bin/jmap -finalizerinfo 10439 Attaching to process ID 10439, please wait... Debugger attached successfully. Server compiler detected. JVM version is 25.272-b1 Number of objects pending for finalization: 0 ç”Ÿæˆdumpæ–‡ä»¶ å‘½ä»¤ï¼šjmap -dump:format=b,file=heapdump.hprof pid\næè¿°ï¼šç”Ÿæˆå †è½¬å‚¨å¿«ç…§dumpæ–‡ä»¶ã€‚\nâœ ~ /usr/local/TencentKona-8.0.4-272/bin/jmap -dump:format=b,file=heapdump.hprof 10439 Dumping heap to /root/heapdump.hprof ... Heap dump file created ä»¥hprofäºŒè¿›åˆ¶æ ¼å¼è½¬å‚¨Javaå †åˆ°æŒ‡å®šfilenameçš„æ–‡ä»¶ä¸­ã€‚liveå­é€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæŒ‡å®šäº†liveå­é€‰é¡¹ï¼Œå †ä¸­åªæœ‰æ´»åŠ¨çš„å¯¹è±¡ä¼šè¢«è½¬å‚¨ã€‚æƒ³è¦æµè§ˆheap dumpï¼Œä½ å¯ä»¥ä½¿ç”¨jhat(Javaå †åˆ†æå·¥å…·)è¯»å–ç”Ÿæˆçš„æ–‡ä»¶ã€‚\njhat åˆ†ædumpæ–‡ä»¶ å‘½ä»¤ï¼šjhat -J-mx1024m heapdump.hprofï¼Œå½“dumpæ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œéœ€è¦é€‚å½“è°ƒé«˜-mxï¼› å½“ç«¯å£æœ‰å ç”¨æ—¶ jhat -port 7080 heapdump.hprof å¯ä»¥æŒ‡å®šç«¯å£ï¼›\nâœ ~ jhat -J-mx1024m heapdump.hprof Reading from heapdump.phrof... Dump file created Tue May 24 21:38:43 CST 2022 Snapshot read, resolving... Resolving 4346760 objects... Chasing references, expect 869 dots Eliminating duplicate references. Snapshot resolved. Started HTTP server on port 7000 Server is ready. jhatä¼šå¯åŠ¨ä¸€ä¸ªwebæœåŠ¡ï¼Œåœ¨webç•Œé¢ä¸ŠæŸ¥çœ‹dumpæ–‡ä»¶è§£æçš„ç»“æœã€‚\nä½¿ç”¨EMAå·¥å…·ï¼Œä¼šæ¯”jhatæ›´å‹å¥½çš„ç•Œé¢ï¼›\njinfo jinfo è·å– JVM è¿è¡Œå‚æ•°ï¼ŒåŒ…æ‹¬å¯åŠ¨æ—¶æŒ‡å®šçš„ç¯å¢ƒå˜é‡ï¼›\n$ /usr/local/TencentKona-8.0.10-332/bin/jinfo 1 Attaching to process ID 1, please wait... Debugger attached successfully. Server compiler detected. JVM version is 25.332-b1 Java System Properties: zookeeper.sasl.client = true java.runtime.name = OpenJDK Runtime Environment java.vm.version = 25.332-b1 sun.boot.library.path = /usr/local/TencentKona-8.0.10-332/jre/lib/amd64 java.vm.vendor = Tencent path.separator = : file.encoding.pkg = sun.io java.vm.name = OpenJDK 64-Bit Server VM sun.os.patch.level = unknown sun.java.launcher = SUN_STANDARD user.dir = / java.vm.specification.name = Java Virtual Machine Specification java.runtime.version = 1.8.0_332-b1 java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment os.arch = amd64 java.endorsed.dirs = /usr/local/TencentKona-8.0.10-332/jre/lib/endorsed line.separator = ... VM Flags: Non-default VM flags: -XX:ActiveProcessorCount=8 -XX:CICompilerCount=4 -XX:CompressedClassSpaceSize=260046848 -XX:ErrorFile=null -XX:InitialHeapSize=3103784960 -XX:MaxDirectMemorySize=493921243 -XX:MaxHeapSize=3103784960 -XX:MaxMetaspaceSize=268435456 -XX:MaxNewSize=1034420224 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=1034420224 -XX:OldSize=2069364736 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC -XX:+UseUTF8UTF16Intrinsics Command line: -Duser.timezone=GMT+08 -Dlog.level=INFO -Xmx3103113861 -Xms3103113861 -XX:MaxDirectMemorySize=493921243 -XX:MaxMetaspaceSize=268435456 -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:ActiveProcessorCount=8 -Dlog4j2.formatMsgNoLookups=true jstat jstat -gc ç›‘æ§GCç›¸å…³ä¿¡æ¯ã€‚\n/usr/local/TencentKona-8.0.10-332/bin/jstat -gc 1 1000 S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT 43520.0 43008.0 0.0 27234.4 922112.0 282128.7 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 282128.7 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 282128.7 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 282128.7 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 282128.7 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 285552.9 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 285992.0 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 43520.0 43008.0 0.0 27234.4 922112.0 285992.0 2020864.0 35542.2 76928.0 73257.9 10368.0 9767.7 9 0.124 3 0.320 0.444 S0C: S0åŒº0çš„å®¹é‡ (kB); S1C: S1çš„å®¹é‡(kB); S0U: S0å·²ç”¨å†…å­˜ (kB); S1U: S1å·²ç”¨å†…å­˜ (kB); EC: ä¼Šç”¸å›­åŒºå®¹é‡ (kB); EU: ä¼Šç”¸å›­åŒºå·²ç”¨å†…å­˜ (kB); OC: è€å¹´ä»£å®¹é‡ (kB); OU: è€å¹´ä»£å·²ç”¨å†…å­˜ (kB); MC: å…ƒæ•°æ®åŒºå®¹é‡ (kB); MU: å…ƒæ•°æ®åŒºå·²ç”¨å†…å­˜ (kB); CCSC: ç±»å‹ç¼©åŒºå®¹é‡ (kB); CCSU: ç±»å‹ç¼©åŒºå·²ç”¨å†…å­˜ (kB); YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°; YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ—¶é—´; FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°; FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ—¶é—´; GCTï¼šæ€»åƒåœ¾å›æ”¶æ—¶é—´; jstat -gcutil ç›‘æ§JVM GC çš„ä¿¡æ¯ã€‚\n/usr/local/TencentKona-8.0.10-332/bin/jstat -gcutil 1 1000 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT 0.00 63.32 9.70 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 9.71 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 9.71 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 10.92 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 12.08 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 12.08 1.76 95.23 94.21 9 0.124 3 0.320 0.444 0.00 63.32 13.03 1.76 95.23 94.21 9 0.124 3 0.320 0.444 S0ï¼šS0åŒºåŸŸä½¿ç”¨ç‡ S1ï¼šS1åŒºåŸŸä½¿ç”¨ç‡ Eï¼šä¼Šç”¸å›­åŒºä½¿ç”¨ç‡ Oï¼šOld Generationä½¿ç”¨ç‡ï¼ŒOU/OC Mï¼šMatespaceåŒºä½¿ç”¨ç‡ï¼ŒMU/MC CCSï¼šå‹ç¼©ç±»ç©ºé—´ä½¿ç”¨ç‡ YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•° YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ—¶é—´ FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•° FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ—¶é—´ GCTï¼šæ€»åƒåœ¾å›æ”¶æ—¶é—´ jstack jstack -l è·å–çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œå¯ä»¥åˆ†æjavaè¿›ç¨‹ä¸­çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥ååŠ©åˆ†ææ­»é”é—®é¢˜ï¼›\n/usr/local/TencentKona-8.0.10-332/bin/jstack -l 1 ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ ˆä¼šå¾ˆé•¿ï¼Œå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ä¸­åˆ†æ.\n/usr/local/TencentKona-8.0.10-332/bin/jstack -l 1 \u0026gt; /tmp/1.threaddump Native Memory Tracking é»˜è®¤æƒ…å†µä¸‹ï¼ŒNMTæ˜¯å¤„äºå…³é—­çŠ¶æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® JVM å¯åŠ¨å‚æ•°æ¥å¼€å¯ï¼š-XX:NativeMemoryTracking=[off | summary | detail]ï¼›ï¼ˆå¯ç”¨NMTä¼šå¯¼è‡´5% -10%çš„æ€§èƒ½å¼€é”€ï¼‰\noff ä¸è·Ÿè¸ª JVM æœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å¦‚æœä¸æŒ‡å®š -XX:NativeMemoryTracking é€‰é¡¹åˆ™é»˜è®¤ä¸ºoffã€‚ summary ä»…è·Ÿè¸ª JVM å­ç³»ç»Ÿï¼ˆå¦‚ï¼šJava heapã€classã€codeã€threadç­‰ï¼‰çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ detail é™¤äº†é€šè¿‡ JVM å­ç³»ç»Ÿè·Ÿè¸ªå†…å­˜ä½¿ç”¨æƒ…å†µå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å•ç‹¬çš„ CallSiteã€å•ç‹¬çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸåŠå…¶æäº¤åŒºåŸŸæ¥è·Ÿè¸ªå†…å­˜ä½¿ç”¨æƒ…å†µã€‚ é™¤äº†åœ¨è™šæ‹Ÿæœºè¿è¡Œæ—¶è·å– NMT æ•°æ®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°ï¼š-XX:+UnlockDiagnosticVMOptionså’Œ-XX:+PrintNMTStatistics ï¼Œæ¥è·å–è™šæ‹Ÿæœºé€€å‡ºæ—¶å†…å­˜ä½¿ç”¨æƒ…å†µçš„æ•°æ®ï¼ˆè¾“å‡ºæ•°æ®çš„è¯¦ç»†ç¨‹åº¦å–å†³äºä½ è®¾å®šçš„è·Ÿè¸ªçº§åˆ«ï¼Œå¦‚ summary/detail ç­‰ï¼‰ã€‚\n-XX:+UnlockDiagnosticVMOptionsï¼šè§£é”ç”¨äºè¯Šæ–­ JVM çš„é€‰é¡¹ï¼Œé»˜è®¤å…³é—­ã€‚ -XX:+PrintNMTStatisticsï¼šå½“å¯ç”¨ NMT æ—¶ï¼Œåœ¨è™šæ‹Ÿæœºé€€å‡ºæ—¶æ‰“å°å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œé»˜è®¤å…³é—­ï¼Œéœ€è¦å¼€å¯å‰ç½®å‚æ•° -XX:+UnlockDiagnosticVMOptions æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ å¼€å¯ NMT jcmd \u0026lt;pid\u0026gt; VM.native_memory [summary | detail | baseline | summary.diff | detail.diff | shutdown] [scale= KB | MB | GB] jcmd 33561 VM.native_memory summary scale=MB 33561: Native Memory Tracking: Total: reserved=5593MB, committed=477MB - Java Heap (reserved=4096MB, committed=256MB) (mmap: reserved=4096MB, committed=256MB) - Class (reserved=1049MB, committed=25MB) (classes #2428) (malloc=11MB #2029) (mmap: reserved=1038MB, committed=14MB) - Thread (reserved=25MB, committed=25MB) (thread #26) (stack: reserved=25MB, committed=25MB) - Code (reserved=244MB, committed=5MB) (malloc=1MB #1623) (mmap: reserved=244MB, committed=4MB) - GC (reserved=162MB, committed=150MB) (malloc=12MB #148) (mmap: reserved=150MB, committed=137MB) - Internal (reserved=12MB, committed=12MB) (malloc=12MB #4010) - Symbol (reserved=4MB, committed=4MB) (malloc=3MB #13444) (arena=1MB #1) å„åŒºåŸŸè¯´æ˜ ä¸»è¦å…³æ³¨ committed éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†æ˜¯å·²ä½¿ç”¨çš„å†…å­˜ï¼›\nJava Heap Java å †æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼›å¯ä»¥ä½¿ç”¨ -Xms/-Xmx æˆ– -XX:InitialHeapSize/-XX:MaxHeapSize ç­‰å‚æ•°æ¥æ§åˆ¶åˆå§‹/æœ€å¤§çš„å¤§å°\nClass Class ä¸»è¦æ˜¯ç±»å…ƒæ•°æ®ï¼ˆmeta dataï¼‰æ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå³è™šæ‹Ÿæœºè§„èŒƒä¸­è§„å®šçš„æ–¹æ³•åŒºã€‚å…·ä½“åˆ° HotSpot çš„å®ç°ä¸­ï¼ŒJDK7 ä¹‹å‰æ˜¯å®ç°åœ¨ PermGen æ°¸ä¹…ä»£ä¸­ï¼ŒJDK8 ä¹‹ååˆ™æ˜¯ç§»é™¤äº† PermGen å˜æˆäº† MetaSpace å…ƒç©ºé—´ã€‚ åŸºäºæ­¤ï¼Œé‚£åœ¨å¯åŠ¨ JVM è¿›ç¨‹çš„æ—¶å€™è®¾ç½®çš„ -XX:MaxMetaspaceSize=256M å‚æ•°åº”è¯¥å¯ä»¥é™åˆ¶ Class æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼› ä½†å®é™…æƒ…å†µå¹¶éè¿™æ ·ï¼Œè¿™é‡Œ Class éœ€è¦è®¾ç½® -XX:CompressedClassSpaceSize=256M æ¥æ§åˆ¶ã€‚\n-XX:MaxMetaspaceSizeï¼šMetaspace æ€»ç©ºé—´çš„æœ€å¤§å…è®¸ä½¿ç”¨å†…å­˜ï¼Œé»˜è®¤æ˜¯ä¸é™åˆ¶ã€‚ -XX:CompressedClassSpaceSizeï¼šMetaspace ä¸­çš„ Compressed Class Space çš„æœ€å¤§å…è®¸å†…å­˜ï¼Œé»˜è®¤å€¼æ˜¯ 1Gï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯· 1G çš„è™šæ‹Ÿåœ°å€æ˜ å°„ï¼Œä½†ä¸æ˜¯çœŸçš„å°±ç”¨äº†æ“ä½œç³»ç»Ÿçš„ 1G å†…å­˜ã€‚ Thread çº¿ç¨‹æ‰€ä½¿ç”¨çš„å†…å­˜ï¼›å¯ä»¥ä½¿ç”¨å‚æ•° -Xss/-XX:ThreadStackSize è®¾ç½®\nCode JVM è‡ªèº«ä¼šç”Ÿæˆä¸€äº› native code å¹¶å°†å…¶å­˜å‚¨åœ¨ç§°ä¸º codecache çš„å†…å­˜åŒºåŸŸä¸­ã€‚JVM ç”Ÿæˆ native code çš„åŸå› æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬åŠ¨æ€ç”Ÿæˆçš„è§£é‡Šå™¨å¾ªç¯ã€ JNIã€å³æ—¶ç¼–è¯‘å™¨(JIT)ç¼–è¯‘ Java æ–¹æ³•ç”Ÿæˆçš„æœ¬æœºä»£ç  ã€‚å…¶ä¸­ JIT ç”Ÿæˆçš„ native code å æ®äº† codecache ç»å¤§éƒ¨åˆ†çš„ç©ºé—´ã€‚\ncodecache reserve çš„æœ€å¤§å†…å­˜æ˜¯ç”± -XX:ReservedCodeCacheSize å‚æ•°å†³å®šçš„ï¼› codecache commit çš„å†…å­˜æ˜¯ç”± -XX:InitialCodeCacheSize å‚æ•°å†³å®šçš„ã€‚\nGC GC æ‰€ä½¿ç”¨çš„å†…å­˜ï¼Œå°±æ˜¯åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„æ•°æ®æ‰€å æ®çš„å†…å­˜ï¼Œä¾‹å¦‚å¡è¡¨ card tablesã€è®°å¿†é›† remembered setsã€æ ‡è®°æ ˆ marking stackã€æ ‡è®°ä½å›¾ marking bitmaps ç­‰ç­‰ã€‚å…¶å®éƒ½æ˜¯ä¸€ç§å€ŸåŠ©é¢å¤–çš„ç©ºé—´ï¼Œæ¥è®°å½•ä¸åŒå†…å­˜åŒºåŸŸä¹‹é—´å¼•ç”¨å…³ç³»çš„ç»“æ„ï¼ˆéƒ½æ˜¯åŸºäºç©ºé—´æ¢æ—¶é—´çš„æ€æƒ³ï¼Œå¦åˆ™å¯»æ‰¾å¼•ç”¨å…³ç³»å°±éœ€è¦è¯¸å¦‚éå†è¿™ç§æµªè´¹æ—¶é—´çš„æ–¹å¼ï¼‰ã€‚GC è¿™å—å†…å­˜æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ— æ³•å‹ç¼©çš„ã€‚\nInternal Internal åŒ…å«å‘½ä»¤è¡Œè§£æå™¨ä½¿ç”¨çš„å†…å­˜ã€JVMTIã€PerfData ä»¥åŠ Unsafe åˆ†é…çš„å†…å­˜ç­‰ç­‰ã€‚ ç›´æ¥å†…å­˜å¯ä»¥ç”± -XX:MaxDirectMemorySize=128M å‚æ•°å†³å®šï¼Œæœ€åä¼šåœ¨ Internal ä¸­ä½“ç°ï¼š\nByteBuffer.allocateDirect(256 * _1M); // å¦‚æœè®¾ç½® -XX:MaxDirectMemorySize=128Mï¼Œè¿™é‡Œåˆ†é… DirectMemory ä¼šå¤±è´¥ Symbol Symbol ä¸º JVM ä¸­çš„ç¬¦å·è¡¨æ‰€ä½¿ç”¨çš„å†…å­˜ï¼ŒHotSpotä¸­ç¬¦å·è¡¨ä¸»è¦æœ‰ä¸¤ç§ï¼šSymbolTable ä¸ StringTableã€‚\nJava çš„ç±»åœ¨ç¼–è¯‘ä¹‹åä¼šç”Ÿæˆ Constant pool å¸¸é‡æ± ï¼Œå¸¸é‡æ± ä¸­ä¼šæœ‰å¾ˆå¤šçš„å­—ç¬¦ä¸²å¸¸é‡ï¼ŒHotSpot å‡ºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ï¼Œå¾€å¾€ä¼šå°†è¿™äº›å­—ç¬¦ä¸²å¸¸é‡ä½œä¸ºä¸€ä¸ª Symbol å¯¹è±¡å­˜å…¥ä¸€ä¸ª HashTable çš„è¡¨ç»“æ„ä¸­å³ SymbolTableï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²å¯ä»¥åœ¨ SymbolTable ä¸­ lookupï¼ˆSymbolTable::lookupï¼‰åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šé‡ç”¨è¯¥å­—ç¬¦ä¸²ï¼Œå¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šåˆ›å»ºæ–°çš„ Symbolï¼ˆSymbolTable::new_symbolï¼‰ã€‚\né™¤äº† SymbolTableï¼Œè¿˜æœ‰ StringTableï¼ˆStringTable ç»“æ„ä¸ SymbolTable åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ HashTable çš„ç»“æ„ï¼‰ï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚HotSpot ä¹Ÿæ˜¯åŸºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ä¸ºæˆ‘ä»¬æä¾›äº† StringTableï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ String.intern çš„æ–¹å¼å°†å­—ç¬¦ä¸²æ”¾å…¥ StringTable ä¸­æ¥é‡ç”¨å­—ç¬¦ä¸²ã€‚\n-XX:StringTableSize å‚æ•°è®¾ç½® HashTable çš„é•¿åº¦ï¼› -XX:SymbolTableSize å‚æ•°è®¾ç½® SymbolTable çš„é•¿åº¦ã€‚\nå¦‚æœè¯¥å€¼è®¾ç½®çš„è¿‡å°çš„è¯ä¼šå¯¼è‡´hash å†²çªï¼Œå³ä½¿ HashTable è¿›è¡Œ rehashï¼Œhash å†²çªä¹Ÿä¼šååˆ†é¢‘ç¹ï¼›\nåŸºçº¿åˆ†æ jcmd 33561 VM.native_memory baseline 33561: Baseline succeeded jcmd 33561 VM.native_memory summary.diff scale=MB 33561: Native Memory Tracking: Total: reserved=5593MB, committed=479MB - Java Heap (reserved=4096MB, committed=256MB) (mmap: reserved=4096MB, committed=256MB) - Class (reserved=1049MB, committed=26MB) (classes #2428) (malloc=11MB #2270 +99) (mmap: reserved=1038MB, committed=14MB) - Thread (reserved=25MB, committed=25MB) (thread #26) (stack: reserved=25MB, committed=25MB) - Code (reserved=245MB, committed=6MB) (malloc=1MB #1996 +106) (mmap: reserved=244MB, committed=5MB) - GC (reserved=162MB, committed=150MB) (malloc=12MB #148) (mmap: reserved=150MB, committed=137MB) - Internal (reserved=12MB, committed=12MB) (malloc=12MB #4029 +3) - Symbol (reserved=4MB, committed=4MB) (malloc=3MB #13444) (arena=1MB #1) - Native Memory Tracking (reserved=1MB, committed=1MB) (tracking overhead=0MB) åŸºçº¿åˆ†æä¼šè¾“å‡ºä» baseline å¼€å§‹ï¼Œåˆ°ç°åœ¨å„åŒºåŸŸçš„å¤§å°å˜åŒ–ï¼Œä»¥åŠçº¿ç¨‹æ•°é‡å˜åŒ–ï¼›\n",
      "summary": "JVM å†…å­˜åŒºåŸŸ å¦‚æœè¦ä¸ºæ–°ç”Ÿä»£åˆ†é… 256m çš„å†…å­˜ï¼ˆNewSize ä¸ MaxNewSize è®¾ä¸ºä¸€è‡´ï¼‰ï¼Œå‚æ•°åº”è¯¥è¿™æ ·æ¥å†™ï¼š-Xmn256m;\nè¿˜å¯ä»¥é€šè¿‡ -XX:NewRatio=\u0026lt;int\u0026gt; æ¥è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”å€¼ã€‚æ¯”å¦‚ä»¥ä¸‹å‚æ•°å°±æ˜¯è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”å€¼ä¸º 1ã€‚ä¹Ÿå°±æ˜¯è¯´è€å¹´ä»£å’Œæ–°ç”Ÿä»£æ‰€å æ¯”å€¼ä¸º 1ï¼š1ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †æ ˆçš„ 1/2ã€‚\n-XX:NewRatio=1 JDK 1.8 ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ Metaspaceï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚\nMetaspace çš„åˆå§‹å®¹é‡å¹¶ä¸æ˜¯ -XX:MetaspaceSize è®¾ç½®ï¼Œæ— è®º -XX:MetaspaceSize é…ç½®ä»€ä¹ˆå€¼ï¼Œå¯¹äº 64 ä½ JVM æ¥è¯´ï¼ŒMetaspace çš„åˆå§‹å®¹é‡éƒ½æ˜¯ 21807104ï¼ˆçº¦ 20.8mï¼‰ã€‚å¯ä»¥å‚è€ƒ Oracle å®˜æ–¹æ–‡æ¡£ :\nSpecify a higher value for the option MetaspaceSize to avoid early garbage collections induced for class metadata. The amount of class metadata allocated for an application is application-dependent and general guidelines do not exist for the selection of MetaspaceSize."
    },{
      "title": "The Dataflow Model é˜…è¯»ç¬”è®°",
      "url": "https://qiref.github.io/post/2023/05/16/the-dataflow-model-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/",
      "content": "Dataflow è®¡ç®—æ¨¡å‹ Dataflow çš„æ ¸å¿ƒè®¡ç®—æ¨¡å‹éå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªå«åš ParDoï¼Œå°±æ˜¯å¹¶è¡Œå¤„ç†çš„æ„æ€ï¼›å¦ä¸€ä¸ªå«åš GroupByKeyï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§ Key è¿›è¡Œåˆ†ç»„ã€‚\nParDo ParDo ç”¨æ¥è¿›è¡Œé€šç”¨çš„å¹¶è¡ŒåŒ–å¤„ç†ã€‚æ¯ä¸ªè¾“å…¥å…ƒç´ ï¼ˆè¿™ä¸ªå…ƒç´ æœ¬èº«æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰é™çš„é›†åˆï¼‰éƒ½ä¼šä½¿ç”¨ä¸€ä¸ª UDF è¿›è¡Œå¤„ç†ï¼ˆåœ¨Dataflowä¸­å«åšDoFnï¼‰ï¼Œè¾“å‡ºæ˜¯0æˆ–å¤šä¸ªè¾“å‡ºå…ƒç´ ã€‚è¿™ä¸ªä¾‹å­æ˜¯æŠŠé”®çš„å‰ç¼€è¿›è¡Œå±•å¼€ï¼Œç„¶åæŠŠå€¼å¤åˆ¶åˆ°å±•å¼€åçš„é”®æ„æˆæ–°çš„é”®å€¼å¯¹å¹¶è¾“å‡ºã€‚\nGroupByKey GroupByKey ç”¨æ¥æŒ‰ Key æŠŠå…ƒç´ é‡æ–°åˆ†ç»„ã€‚\nParDo æ“ä½œå› ä¸ºæ˜¯å¯¹æ¯ä¸ªè¾“å…¥çš„å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå› æ­¤å¾ˆè‡ªç„¶åœ°å°±å¯ä»¥é€‚ç”¨äºæ— è¾¹ç•Œçš„æ•°æ®ã€‚è€Œ GroupByKey æ“ä½œï¼Œåœ¨æŠŠæ•°æ®å‘é€åˆ°ä¸‹æ¸¸è¿›è¡Œæ±‡æ€»å‰ï¼Œéœ€è¦æ”¶é›†åˆ°æŒ‡å®šçš„é”®å¯¹åº”çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœè¾“å…¥æºæ˜¯æ— è¾¹ç•Œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸çŸ¥é“ä½•æ—¶æ‰èƒ½æ”¶é›†åˆ°æ‰€æœ‰çš„æ•°æ®ã€‚æ‰€ä»¥é€šå¸¸çš„è§£å†³æ–¹æ¡ˆæ˜¯å¯¹æ•°æ®ä½¿ç”¨çª—å£æ“ä½œã€‚\nçª—å£ æ—¶é—´è¯­ä¹‰ çª—å£é€šå¸¸åŸºäºæ—¶é—´ï¼Œæ—¶é—´å¯¹äºçª—å£æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æµå¼è®¡ç®—ä¸­ï¼Œæœ‰ processing-time å’Œ event-time ä¸¤ç§æ—¶é—´è¯­ä¹‰ï¼Œå…·ä½“å‚è€ƒï¼š æ—¶é—´è¯­ä¹‰\nçª—å£åˆ†ç±» å›ºå®šçª—å£ï¼ˆFixed Windowï¼‰å›ºå®šåŒºé—´ï¼ˆäº’ä¸é‡å ï¼‰çš„çª—å£ï¼Œå¯ä»¥åŸºäºæ—¶é—´ï¼Œä¹Ÿå¯ä»¥åŸºäºæ•°é‡ï¼›å°†äº‹ä»¶åˆ†é…åˆ°ä¸åŒåŒºé—´çš„çª—å£ä¸­ï¼Œåœ¨é€šè¿‡çª—å£è¾¹ç•Œåï¼Œçª—å£å†…çš„æ‰€æœ‰äº‹ä»¶ä¼šå‘é€ç»™è®¡ç®—å‡½æ•°è¿›è¡Œè®¡ç®—ï¼›\næ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰å›ºå®šåŒºé—´ä½†å¯ä»¥é‡å çš„çª—å£ï¼Œéœ€è¦æŒ‡å®šçª—å£åŒºé—´ä»¥åŠæ»‘åŠ¨æ­¥é•¿ï¼ŒåŒºé—´é‡å æ„å‘³ç€åŒä¸€ä¸ªäº‹ä»¶ä¼šåˆ†é…åˆ°ä¸åŒçª—å£å‚ä¸è®¡ç®—ã€‚ çª—å£åŒºé—´å†³å®šä½•æ—¶è§¦å‘è®¡ç®—ï¼Œæ»‘åŠ¨æ­¥é•¿å†³å®šä½•æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ï¼›\nä¼šè¯çª—å£ï¼ˆSession Windowï¼‰ä¼šè¯çª—å£é€šå¸¸åŸºäºç”¨æˆ·çš„ä¼šè¯ï¼Œé€šè¿‡å®šä¹‰ä¼šè¯çš„è¶…æ—¶æ—¶é—´ï¼Œå°†äº‹ä»¶åˆ†å‰²åˆ°ä¸åŒçš„ä¼šè¯ä¸­ï¼› ä¾‹å¦‚ï¼Œæœ‰ä¸ªå®¢æœèŠå¤©ç³»ç»Ÿï¼Œå¦‚æœç”¨æˆ·è¶…è¿‡ 30 åˆ†é’Ÿæ²¡æœ‰äº’åŠ¨ï¼Œåˆ™è®¤ä¸ºä¸€æ¬¡ä¼šè¯ç»“æŸï¼Œå½“å®¢æˆ·ä¸‹æ¬¡è¿›å…¥ï¼Œå°±æ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯äº†ã€‚\nçª—å£åˆ†é…ä¸åˆå¹¶ Dataflow æ¨¡å‹é‡Œï¼Œéœ€è¦çš„ä¸åªæ˜¯ GroupByKeyï¼Œå®é™…åœ¨ç»Ÿè®¡æ•°æ®çš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦çš„æ˜¯ GroupByKeyAndWindowã€‚ç»Ÿè®¡ä¸€ä¸ªä¸è€ƒè™‘ä»»ä½•æ—¶é—´çª—å£çš„æ•°æ®ï¼Œå¾€å¾€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼› Dataflow æ¨¡å‹æå‡ºï¼š\nä»æ¨¡å‹ç®€åŒ–çš„è§’åº¦ä¸Šï¼ŒæŠŠæ‰€æœ‰çš„çª—å£ç­–ç•¥éƒ½å½“åšéå¯¹é½çª—å£ï¼Œè€Œåº•å±‚å®ç°æ¥è´Ÿè´£æŠŠå¯¹é½çª—å£ä½œä¸ºä¸€ä¸ªç‰¹ä¾‹è¿›è¡Œä¼˜åŒ–ã€‚ çª—å£æ“ä½œå¯ä»¥è¢«åˆ†éš”ä¸ºä¸¤ä¸ªäº’ç›¸ç›¸å…³çš„æ“ä½œï¼š set\u0026lt;Window\u0026gt; AssignWindows(T datum) å³çª—å£åˆ†é…æ“ä½œã€‚è¿™ä¸ªæ“ä½œæŠŠå…ƒç´ åˆ†é…åˆ° 0 æˆ–å¤šä¸ªçª—å£ä¸­å»ã€‚ set\u0026lt;window\u0026gt; MergeWindows(Set\u0026lt;Window\u0026gt; windows) å³çª—å£åˆå¹¶æ“ä½œï¼Œè¿™ä¸ªæ“ä½œåœ¨æ±‡æ€»æ—¶åˆå¹¶çª—å£ã€‚ è€Œåœ¨å®é™…çš„é€»è¾‘å®ç°å±‚é¢ï¼ŒDataflow æœ€é‡è¦çš„ä¸¤ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ AssignWindows å‡½æ•°å’Œ MergeWindows å‡½æ•°ã€‚ çª—å£åˆ†é… æ¯ä¸€ä¸ªåŸå§‹çš„äº‹ä»¶ï¼Œåœ¨ä¸šåŠ¡å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œå…¶å®éƒ½æ˜¯ï¼ˆkey, value, event_timeï¼‰è¿™æ ·ä¸€ä¸ªä¸‰å…ƒç»„ã€‚è€Œ AssignWindows è¦åšçš„ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªä¸‰å…ƒç»„ï¼Œæ ¹æ®æˆ‘ä»¬çš„å¤„ç†é€»è¾‘ï¼Œå˜æˆï¼ˆkey, value, event_time, windowï¼‰è¿™æ ·çš„å››å…ƒç»„ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨çª—å£åˆ†é…è¿‡ç¨‹ä¸­ï¼Œæ»‘åŠ¨çª—å£ä¸­å­˜åœ¨åŒºé—´é‡åˆçš„æƒ…å†µï¼Œé‚£ä¹ˆåœ¨ä¸ºäº‹ä»¶åˆ†é…çª—å£çš„è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§ä¸Šæ–‡å››å…ƒç»„çš„å®šä¹‰ï¼Œå¯èƒ½ä¸€ä¸ªäº‹ä»¶ä¼šå˜æˆå¤šä¸ªäº‹ä»¶ï¼›\nçª—å£åˆå¹¶ Dataflow é‡Œï¼Œé€šè¿‡ AssignWindows+MergeWindows çš„ç»„åˆï¼Œæ¥è¿›è¡Œç›¸åº”çš„æ•°æ®ç»Ÿè®¡ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥å‰é¢ä¼šè¯çª—å£ä¸­çš„æ¡ˆä¾‹ï¼šå®¢æˆ· 30 åˆ†é’Ÿæ²¡æœ‰äº’åŠ¨å°±ç®—ä½œè¶…æ—¶ã€‚\nå› ä¸ºè¦æ ¹æ®åŒä¸€ä¸ªç”¨æˆ·çš„è¡Œä¸ºè¿›è¡Œåˆ†æï¼Œæ‰€ä»¥ Key æ˜¯ç”¨æˆ· ID ã€‚é‚£ä¹ˆå¯¹åº”çš„ Value é‡Œï¼Œå¯ä»¥è®°å½•æ¶ˆæ¯å‘é€æ–¹ï¼Œä»¥åŠå¯¹åº”çš„æ¶ˆæ¯å†…å®¹ã€‚è€Œ event_timeï¼Œåˆ™æ˜¯å®é™…æ¶ˆæ¯å‘é€çš„æ—¶é—´ã€‚å¯¹äºæ¯ä¸€ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬è¿›è¡Œ AssignWindows çš„æ—¶å€™ï¼Œéƒ½æ˜¯æŠŠå¯¹åº”çš„æ—¶é—´çª—å£ï¼Œè®¾ç½®æˆ [eventtâ€‹ime,eventtâ€‹ime+30)ã€‚ä¹Ÿå°±æ˜¯äº‹ä»¶å‘ç”Ÿä¹‹åçš„ 30 åˆ†é’Ÿè¶…æ—¶æ—¶é—´ä¹‹å†…ï¼Œéƒ½æ˜¯è¿™ä¸ªäº‹ä»¶å¯¹åº”ä¼šè¯çš„æ—¶é—´çª—å£ã€‚è€Œåœ¨åŒä¸€ä¸ª Key çš„å¤šä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›çª—å£åˆå¹¶ã€‚å¯¹äºä¼šè¯çª—å£ï¼Œå¦‚æœä¸¤ä¸ªäº‹ä»¶çš„çª—å£ä¹‹é—´æœ‰é‡åˆéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„æ—¶é—´çª—å£ã€‚è€Œå¦‚æœä¸åŒäº‹ä»¶ä¹‹é—´çš„çª—å£æ²¡æœ‰é‡åˆï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäº‹ä»¶å°±è¿˜æ˜¯ä¸¤ä¸ªå„è‡ªç‹¬ç«‹çš„æ—¶é—´çª—å£ã€‚\nä¾‹å¦‚åŒä¸€ä¸ªç”¨æˆ·ä¸‹ï¼Œæœ‰ä¸‰ä¸ªäº‹ä»¶ï¼Œå‘ç”Ÿçš„æ—¶é—´åˆ†åˆ«æ˜¯ 13:02ã€13:14ã€13:57ã€‚é‚£ä¹ˆåˆ†é…çª—å£çš„æ—¶å€™ï¼Œä¸‰ä¸ªçª—å£ä¼šæ˜¯ [13:02,13:32)ï¼Œ[13:14,13:44) ä»¥åŠ [13:57,14:27)ã€‚å‰ä¸¤ä¸ªæ—¶é—´çª—å£æ˜¯æœ‰é‡å éƒ¨åˆ†çš„ï¼Œä½†æ˜¯ç¬¬ä¸‰ä¸ªæ—¶é—´çª—å£å¹¶æ²¡æœ‰é‡å ï¼Œå¯¹åº”çš„çª—å£ä¼šåˆå¹¶æˆ [13:02,13:44) ä»¥åŠ [13:57,14:27) è¿™æ ·ä¸¤ä¸ªæ—¶é—´çª—å£ã€‚\nçª—å£çš„åˆ†é…å’Œåˆå¹¶åŠŸèƒ½ï¼Œå°±ä½¿å¾— Dataflow å¯ä»¥å¤„ç†ä¹±åºæ•°æ®ã€‚ç›¸åŒçš„æ•°æ®ä»¥ä¸åŒçš„é¡ºåºåˆ°è¾¾æˆ‘ä»¬çš„è®¡ç®—èŠ‚ç‚¹ï¼Œè®¡ç®—çš„ç»“æœä»ç„¶æ˜¯ç›¸åŒçš„ã€‚å¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šä¸€æ¬¡è®¡ç®—å®Œçš„ç»“æœä½œä¸ºçŠ¶æ€æŒä¹…åŒ–ä¸‹æ¥ï¼Œç„¶åæ¯ä¸€ä¸ªæ–°è¿›å…¥çš„äº‹ä»¶ï¼Œéƒ½æŒ‰ç…§ AssignWindows å’Œ MergeWindows çš„æ–¹å¼ä¸æ–­å¯¹æ•°æ®è¿›è¡ŒåŒ–ç®€ã€‚\nè§¦å‘å™¨å’Œå¢é‡å¤„ç† åŸºäº watermark å¤„ç†è¿Ÿåˆ°æ•°æ®å¿…ç„¶ä¼šé¢ä¸´ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\nåœ¨ watermark ä¹‹åçš„äº‹ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ ä¸ºäº†æ•°æ®å‡†ç¡®æ€§è€Œè®¾ç½®è¿‡é•¿çš„ watermark ï¼Œä¼šå¯¼è‡´æ²¡æœ‰è¿Ÿåˆ°æ•°æ®ä¹Ÿä¼šç­‰å¾…è¿‡é•¿æ—¶é—´ï¼Œä»è€Œå¤±å»æ—¶æ•ˆæ€§ã€‚ åœ¨ Dataflow ä¸­ç»™å‡ºå¦‚ä¸‹æ€è·¯ï¼š\nåŸºäº lambda æ¶æ„çš„æ€æƒ³ï¼Œå°½å¿«ç»™å‡ºä¸€ä¸ªè®¡ç®—ç»“æœï¼Œç„¶ååœ¨åç»­çš„äº‹ä»¶å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå»ä¸æ–­ä¿®æ­£è®¡ç®—ç»“æœï¼Œåœ¨ Dataflow ä¸­ä½“ç°ä¸º è§¦å‘å™¨ï¼ˆTriggerï¼‰ æœºåˆ¶ï¼›\nè§¦å‘å™¨é™¤äº†å®šä¹‰æ•°æ®ä½•æ—¶è®¡ç®—ï¼Œè¿˜å¯ä»¥å®šä¹‰è§¦å‘ä¹‹åçš„è¾“å‡ºç­–ç•¥ï¼š\næŠ›å¼ƒï¼ˆDiscardingï¼‰ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è§¦å‘ä¹‹åï¼Œå¯¹åº”çª—å£å†…çš„æ•°æ®å°±è¢«æŠ›å¼ƒæ‰äº†ã€‚è¿™æ„å‘³ç€åç»­å¦‚æœæœ‰çª—å£å†…çš„æ•°æ®åˆ°è¾¾ï¼Œä¹Ÿæ²¡æ³•å’Œä¸Šä¸€æ¬¡è§¦å‘æ—¶å€™çš„ç»“æœè¿›è¡Œåˆå¹¶è®¡ç®—ã€‚ä½†è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ¯ä¸ªè®¡ç®—èŠ‚ç‚¹çš„å­˜å‚¨ç©ºé—´å ç”¨ä¸ä¼šå¤ªå¤§ã€‚ä¸€æ—¦è§¦å‘å‘ä¸‹æ¸¸è¾“å‡ºè®¡ç®—ç»“æœäº†ï¼Œç°æœ‰çš„æ•°æ®æˆ‘ä»¬ä¹Ÿå°±ä¸éœ€è¦äº†ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œæ ¹æ®æœ¬åœ°æ—¶é—´å»ç»Ÿè®¡é”™è¯¯æ—¥å¿—çš„æ•°é‡å¹¶å‘Šè­¦ï¼Œä½¿ç”¨è¿™ç§ç­–ç•¥å°±ä¼šæ¯”è¾ƒåˆé€‚ã€‚ ç´¯ç§¯ï¼ˆAccumulatingï¼‰ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è§¦å‘ä¹‹åï¼Œå¯¹åº”çª—å£å†…çš„æ•°æ®ï¼Œä»ç„¶ä¼šæŒä¹…åŒ–ä½œä¸ºçŠ¶æ€ä¿å­˜ä¸‹æ¥ã€‚å½“æœ‰æ–°çš„æ—¥å¿—è¿‡æ¥ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šè®¡ç®—æ–°çš„è®¡ç®—ç»“æœï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å†æ¬¡è§¦å‘ï¼Œå‘ä¸‹æ¸¸å‘é€æ–°çš„è®¡ç®—ç»“æœï¼Œè€Œä¸‹æ¸¸ä¹Ÿä¼šç”¨æ–°çš„è®¡ç®—ç»“æœæ¥è¦†ç›–æ‰è€çš„è®¡ç®—ç»“æœã€‚ ç´¯ç§¯å¹¶æ’¤å›ï¼ˆAccumulating \u0026amp; Retractingï¼‰ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é™¤äº†â€œä¿®æ­£â€è®¡ç®—ç»“æœä¹‹å¤–ï¼Œå¯èƒ½è¿˜è¦â€œæ’¤å›â€è®¡ç®—ç»“æœã€‚åœ¨è¿›è¡Œç´¯ç§¯è¯­ä¹‰çš„åŸºç¡€ä¸Šï¼Œè®¡ç®—ç»“æœçš„ä¸€ä»½å¤åˆ¶ä¹Ÿè¢«ä¿ç•™åˆ°æŒä¹…åŒ–çŠ¶æ€ä¸­ã€‚å½“çª—å£å°†æ¥å†æ¬¡è§¦å‘æ—¶ï¼Œä¸Šä¸€æ¬¡çš„ç»“æœå€¼å…ˆä¸‹å‘åšæ’¤å›å¤„ç†ï¼Œç„¶åæ–°çš„ç»“æœä½œä¸ºæ­£å¸¸æ•°æ®ä¸‹å‘ï¼› ä»¥å‰é¢çš„å®¢æœä¼šè¯ä¸ºä¾‹ï¼šåŸæœ¬å…ˆæ”¶åˆ°äº†ä¸‰ä¸ªäº‹ä»¶ï¼Œ13:02ã€13:14ã€13:57ï¼Œæ ¹æ® 30 åˆ†é’Ÿçš„ä¼šè¯çª—å£ï¼Œç»è¿‡åˆå¹¶åï¼Œçª—å£å°±å˜æˆäº† [13:02,13:44) ä»¥åŠ [13:57,14:27) è¿™æ ·ä¸¤ä¸ªæ—¶é—´çª—å£ã€‚å¹¶ä¸”ï¼Œè¿™ä¸¤ä¸ªä¼šè¯åˆ†åˆ«ä½œä¸ºä¸¤æ¡è®°å½•ï¼Œå‘ä¸‹æ¸¸çš„ä¸åŒè®¡ç®—èŠ‚ç‚¹ä¸‹å‘äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åˆæ¥æ”¶åˆ°äº†ä¸€æ¡å§—å§—æ¥è¿Ÿçš„æ–°æ—¥å¿—ï¼Œæ—¥å¿—çš„æ—¶é—´æ˜¯ 13:40ï¼Œè¿™ä¸ªç”¨æˆ·å…¶å®åªæœ‰ä¸€ä¸ªä¼šè¯ [13:02,14:27)ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ä»…è¦å‘ä¸‹æ¸¸å‘é€ä¸€ä¸ªæ–°ä¼šè¯å‡ºå»ï¼Œè¿˜éœ€è¦èƒ½å¤Ÿâ€œæ’¤å›â€ä¹‹å‰å·²ç»å‘é€çš„ä¸¤ä¸ªé”™è¯¯çš„ä¼šè¯ã€‚\nå‚è€ƒ 43864.pdf è®ºæ–‡-Dataflow æ¨¡å‹ https://developer.aliyun.com/article/64911 ",
      "summary": "Dataflow è®¡ç®—æ¨¡å‹ Dataflow çš„æ ¸å¿ƒè®¡ç®—æ¨¡å‹éå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªå«åš ParDoï¼Œå°±æ˜¯å¹¶è¡Œå¤„ç†çš„æ„æ€ï¼›å¦ä¸€ä¸ªå«åš GroupByKeyï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§ Key è¿›è¡Œåˆ†ç»„ã€‚\nParDo ParDo ç”¨æ¥è¿›è¡Œé€šç”¨çš„å¹¶è¡ŒåŒ–å¤„ç†ã€‚æ¯ä¸ªè¾“å…¥å…ƒç´ ï¼ˆè¿™ä¸ªå…ƒç´ æœ¬èº«æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰é™çš„é›†åˆï¼‰éƒ½ä¼šä½¿ç”¨ä¸€ä¸ª UDF è¿›è¡Œå¤„ç†ï¼ˆåœ¨Dataflowä¸­å«åšDoFnï¼‰ï¼Œè¾“å‡ºæ˜¯0æˆ–å¤šä¸ªè¾“å‡ºå…ƒç´ ã€‚è¿™ä¸ªä¾‹å­æ˜¯æŠŠé”®çš„å‰ç¼€è¿›è¡Œå±•å¼€ï¼Œç„¶åæŠŠå€¼å¤åˆ¶åˆ°å±•å¼€åçš„é”®æ„æˆæ–°çš„é”®å€¼å¯¹å¹¶è¾“å‡ºã€‚\nGroupByKey GroupByKey ç”¨æ¥æŒ‰ Key æŠŠå…ƒç´ é‡æ–°åˆ†ç»„ã€‚\nParDo æ“ä½œå› ä¸ºæ˜¯å¯¹æ¯ä¸ªè¾“å…¥çš„å…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå› æ­¤å¾ˆè‡ªç„¶åœ°å°±å¯ä»¥é€‚ç”¨äºæ— è¾¹ç•Œçš„æ•°æ®ã€‚è€Œ GroupByKey æ“ä½œï¼Œåœ¨æŠŠæ•°æ®å‘é€åˆ°ä¸‹æ¸¸è¿›è¡Œæ±‡æ€»å‰ï¼Œéœ€è¦æ”¶é›†åˆ°æŒ‡å®šçš„é”®å¯¹åº”çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœè¾“å…¥æºæ˜¯æ— è¾¹ç•Œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸çŸ¥é“ä½•æ—¶æ‰èƒ½æ”¶é›†åˆ°æ‰€æœ‰çš„æ•°æ®ã€‚æ‰€ä»¥é€šå¸¸çš„è§£å†³æ–¹æ¡ˆæ˜¯å¯¹æ•°æ®ä½¿ç”¨çª—å£æ“ä½œã€‚\nçª—å£ æ—¶é—´è¯­ä¹‰ çª—å£é€šå¸¸åŸºäºæ—¶é—´ï¼Œæ—¶é—´å¯¹äºçª—å£æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨æµå¼è®¡ç®—ä¸­ï¼Œæœ‰ processing-time å’Œ event-time ä¸¤ç§æ—¶é—´è¯­ä¹‰ï¼Œå…·ä½“å‚è€ƒï¼š æ—¶é—´è¯­ä¹‰\nçª—å£åˆ†ç±» å›ºå®šçª—å£ï¼ˆFixed Windowï¼‰å›ºå®šåŒºé—´ï¼ˆäº’ä¸é‡å ï¼‰çš„çª—å£ï¼Œå¯ä»¥åŸºäºæ—¶é—´ï¼Œä¹Ÿå¯ä»¥åŸºäºæ•°é‡ï¼›å°†äº‹ä»¶åˆ†é…åˆ°ä¸åŒåŒºé—´çš„çª—å£ä¸­ï¼Œåœ¨é€šè¿‡çª—å£è¾¹ç•Œåï¼Œçª—å£å†…çš„æ‰€æœ‰äº‹ä»¶ä¼šå‘é€ç»™è®¡ç®—å‡½æ•°è¿›è¡Œè®¡ç®—ï¼›\næ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰å›ºå®šåŒºé—´ä½†å¯ä»¥é‡å çš„çª—å£ï¼Œéœ€è¦æŒ‡å®šçª—å£åŒºé—´ä»¥åŠæ»‘åŠ¨æ­¥é•¿ï¼ŒåŒºé—´é‡å æ„å‘³ç€åŒä¸€ä¸ªäº‹ä»¶ä¼šåˆ†é…åˆ°ä¸åŒçª—å£å‚ä¸è®¡ç®—ã€‚ çª—å£åŒºé—´å†³å®šä½•æ—¶è§¦å‘è®¡ç®—ï¼Œæ»‘åŠ¨æ­¥é•¿å†³å®šä½•æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ï¼›\nä¼šè¯çª—å£ï¼ˆSession Windowï¼‰ä¼šè¯çª—å£é€šå¸¸åŸºäºç”¨æˆ·çš„ä¼šè¯ï¼Œé€šè¿‡å®šä¹‰ä¼šè¯çš„è¶…æ—¶æ—¶é—´ï¼Œå°†äº‹ä»¶åˆ†å‰²åˆ°ä¸åŒçš„ä¼šè¯ä¸­ï¼› ä¾‹å¦‚ï¼Œæœ‰ä¸ªå®¢æœèŠå¤©ç³»ç»Ÿï¼Œå¦‚æœç”¨æˆ·è¶…è¿‡ 30 åˆ†é’Ÿæ²¡æœ‰äº’åŠ¨ï¼Œåˆ™è®¤ä¸ºä¸€æ¬¡ä¼šè¯ç»“æŸï¼Œå½“å®¢æˆ·ä¸‹æ¬¡è¿›å…¥ï¼Œå°±æ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯äº†ã€‚\nçª—å£åˆ†é…ä¸åˆå¹¶ Dataflow æ¨¡å‹é‡Œï¼Œéœ€è¦çš„ä¸åªæ˜¯ GroupByKeyï¼Œå®é™…åœ¨ç»Ÿè®¡æ•°æ®çš„æ—¶å€™ï¼Œå¾€å¾€éœ€è¦çš„æ˜¯ GroupByKeyAndWindowã€‚ç»Ÿè®¡ä¸€ä¸ªä¸è€ƒè™‘ä»»ä½•æ—¶é—´çª—å£çš„æ•°æ®ï¼Œå¾€å¾€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼› Dataflow æ¨¡å‹æå‡ºï¼š\nä»æ¨¡å‹ç®€åŒ–çš„è§’åº¦ä¸Šï¼ŒæŠŠæ‰€æœ‰çš„çª—å£ç­–ç•¥éƒ½å½“åšéå¯¹é½çª—å£ï¼Œè€Œåº•å±‚å®ç°æ¥è´Ÿè´£æŠŠå¯¹é½çª—å£ä½œä¸ºä¸€ä¸ªç‰¹ä¾‹è¿›è¡Œä¼˜åŒ–ã€‚ çª—å£æ“ä½œå¯ä»¥è¢«åˆ†éš”ä¸ºä¸¤ä¸ªäº’ç›¸ç›¸å…³çš„æ“ä½œï¼š set\u0026lt;Window\u0026gt; AssignWindows(T datum) å³çª—å£åˆ†é…æ“ä½œã€‚è¿™ä¸ªæ“ä½œæŠŠå…ƒç´ åˆ†é…åˆ° 0 æˆ–å¤šä¸ªçª—å£ä¸­å»ã€‚ set\u0026lt;window\u0026gt; MergeWindows(Set\u0026lt;Window\u0026gt; windows) å³çª—å£åˆå¹¶æ“ä½œï¼Œè¿™ä¸ªæ“ä½œåœ¨æ±‡æ€»æ—¶åˆå¹¶çª—å£ã€‚ è€Œåœ¨å®é™…çš„é€»è¾‘å®ç°å±‚é¢ï¼ŒDataflow æœ€é‡è¦çš„ä¸¤ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ AssignWindows å‡½æ•°å’Œ MergeWindows å‡½æ•°ã€‚ çª—å£åˆ†é… æ¯ä¸€ä¸ªåŸå§‹çš„äº‹ä»¶ï¼Œåœ¨ä¸šåŠ¡å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œå…¶å®éƒ½æ˜¯ï¼ˆkey, value, event_timeï¼‰è¿™æ ·ä¸€ä¸ªä¸‰å…ƒç»„ã€‚è€Œ AssignWindows è¦åšçš„ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªä¸‰å…ƒç»„ï¼Œæ ¹æ®æˆ‘ä»¬çš„å¤„ç†é€»è¾‘ï¼Œå˜æˆï¼ˆkey, value, event_time, windowï¼‰è¿™æ ·çš„å››å…ƒç»„ã€‚"
    },{
      "title": "å †å’Œå †æ’åº",
      "url": "https://qiref.github.io/post/2023/05/12/%E5%A0%86%E5%92%8C%E5%A0%86%E6%8E%92%E5%BA%8F/",
      "content": "å † å †çš„æœ¬è´¨æ˜¯æ ‘ï¼Œç”¨æ•°ç»„è¡¨ç¤ºçš„å®Œå…¨äºŒå‰æ ‘ï¼›\nå®šä¹‰ ä¸€æ£µæ·±åº¦ä¸ºkä¸”æœ‰ 2^k - 1 ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ç§°ä¸ºæ»¡äºŒå‰æ ‘ã€‚\næ ¹æ®äºŒå‰æ ‘çš„æ€§è´¨2, æ»¡äºŒå‰æ ‘æ¯ä¸€å±‚çš„ç»“ç‚¹ä¸ªæ•°éƒ½è¾¾åˆ°äº†æœ€å¤§å€¼, å³æ»¡äºŒå‰æ ‘çš„ç¬¬iå±‚ä¸Šæœ‰ 2^(i-1) ä¸ªç»“ç‚¹ (iâ‰¥1) ã€‚\nå¦‚æœå¯¹æ»¡äºŒå‰æ ‘çš„ç»“ç‚¹è¿›è¡Œç¼–å·, çº¦å®šç¼–å·ä»æ ¹ç»“ç‚¹èµ·, è‡ªä¸Šè€Œä¸‹, è‡ªå·¦è€Œå³ã€‚åˆ™æ·±åº¦ä¸ºkçš„, æœ‰nä¸ªç»“ç‚¹çš„äºŒå‰æ ‘, å½“ä¸”ä»…å½“å…¶æ¯ä¸€ä¸ªç»“ç‚¹éƒ½ä¸æ·±åº¦ä¸ºkçš„æ»¡äºŒå‰æ ‘ä¸­ç¼–å·ä»1è‡³nçš„ç»“ç‚¹ä¸€ä¸€å¯¹åº”æ—¶, ç§°ä¹‹ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚\nä»æ»¡äºŒå‰æ ‘å’Œå®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¯ä»¥çœ‹å‡º, æ»¡äºŒå‰æ ‘æ˜¯å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ®Šå½¢æ€, å³å¦‚æœä¸€æ£µäºŒå‰æ ‘æ˜¯æ»¡äºŒå‰æ ‘, åˆ™å®ƒå¿…å®šæ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚\nå‚è€ƒï¼š https://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91/7773232\næ€§è´¨ arrï¼š[2 3 4 52 2 2 1] idxï¼š 0 1 2 3 4 5 6 i ä¸‹æ ‡å’Œå…ƒç´ ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š\nå·¦å­èŠ‚ç‚¹ï¼š2*i+1 å³å­èŠ‚ç‚¹ï¼š2*i+2 çˆ¶èŠ‚ç‚¹ï¼š(i-1)/2 å¤§æ ¹å † å®Œå…¨äºŒå‰æ ‘é‡Œï¼Œæ¯ä¸€ä¸ªå­æ ‘çš„æœ€å¤§å€¼æ˜¯æ ¹èŠ‚ç‚¹ï¼›\nå°æ ¹å † å®Œå…¨äºŒå‰æ ‘é‡Œï¼Œæ¯ä¸€ä¸ªå­æ ‘çš„æœ€å°å€¼æ˜¯æ ¹èŠ‚ç‚¹ï¼›\nå †æ’åº å®šä¹‰å † // maxHeap å®šä¹‰ä¸€ä¸ªå¤§æ ¹å † type maxHeap struct { Data []int Count int } func NewMaxHeap(size int) *maxHeap { return \u0026amp;maxHeap{ Data: make([]int, size), Count: 0, } } æ’å…¥æ•°æ® æ’å…¥æ•°æ®æ—¶ï¼Œæ˜¯å¾€æ•°ç»„æœ€åå¢åŠ å…ƒç´ ï¼Œç”±äºéœ€è¦ä¿è¯å¤§æ ¹å †çš„æ€§è´¨ï¼Œå¦‚æœæ–°åŠ å…¥çš„å…ƒç´ æ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œåˆ™è·Ÿçˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œè¿™ä¸ªäº¤æ¢æµç¨‹å®Œæˆåï¼Œæ–°å…ƒç´ æ’å…¥å°±å®Œæˆäº†ã€‚\nçˆ¶èŠ‚ç‚¹ä¸‹æ ‡è·Ÿå½“å‰ä¸‹æ ‡indexçš„å…³ç³»ï¼šçˆ¶èŠ‚ç‚¹ = (i-1)/2\n// insert å‘å †ä¸­æ’å…¥å…ƒç´  func (heap *maxHeap) Insert(val int) { heap.Data[heap.Count] = val heap.Count++ // heap.shiftUp(heap.Count) heap.shiftUp1(heap.Count - 1) // æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ } // shiftUp å‘å †ä¸­æ’å…¥å…ƒç´ æ—¶ï¼Œå¶å­èŠ‚ç‚¹å¯èƒ½éœ€è¦å‘ä¸Šç§»åŠ¨ func (heap *maxHeap) shiftUp1(index int) { // çˆ¶èŠ‚ç‚¹ = (i-1)/2 for index \u0026gt; 0 \u0026amp;\u0026amp; heap.Data[index] \u0026gt; heap.Data[(index-1)/2] { heap.Data[index], heap.Data[(index-1)/2] = heap.Data[(index-1)/2], heap.Data[index] index = (index - 1) / 2 } fmt.Printf(\u0026quot;shiftUp heap %v \\n\u0026quot;, heap) } // shiftUp å‘å †ä¸­æ’å…¥å…ƒç´ æ—¶ï¼Œå¶å­èŠ‚ç‚¹å¯èƒ½éœ€è¦å‘ä¸Šç§»åŠ¨ func (heap *maxHeap) shiftUp(count int) { for count \u0026gt; 1 \u0026amp;\u0026amp; heap.Data[count-1] \u0026gt; heap.Data[(count/2)-1] { heap.Data[count-1], heap.Data[(count/2)-1] = heap.Data[(count/2)-1], heap.Data[count-1] count = (count / 2) } fmt.Printf(\u0026quot;shiftUp heap %v \\n\u0026quot;, heap) } ç§»é™¤æ•°æ® ç§»é™¤æ•°æ®ï¼Œå°±æ˜¯ç§»é™¤æ ¹èŠ‚ç‚¹ï¼ŒåŒæ—¶æŠŠæœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œç„¶åè·Ÿå­èŠ‚ç‚¹æ¯”è¾ƒï¼Œæ­¤æ—¶ï¼Œå¤§æ ¹å †éœ€è¦æ‰¾åˆ°å·¦å³å­èŠ‚ç‚¹ä¸­ï¼Œè¾ƒå¤§çš„ä¸€ä¸ªå…ƒç´ ï¼Œè·Ÿçˆ¶èŠ‚ç‚¹è¿›è¡Œäº’æ¢ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ¯”è¾ƒå®Œæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶ count-1ï¼›\n// ExtraMax æå–å¤§æ ¹å †çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå¤§æ ¹å †æ•´ä½“æ€§è´¨ä¸å˜ func (heap *maxHeap) ExtraMax() int { heap.Count-- result := heap.Data[0] heap.Data[0], heap.Data[heap.Count] = heap.Data[heap.Count], heap.Data[0] heap.shiftDown(0) return result } // shiftDown ç§»é™¤å †ä¸­å…ƒç´ ï¼ŒèŠ‚ç‚¹å‘ä¸‹ç§»åŠ¨ func (heap *maxHeap) shiftDown(index int) { for index \u0026lt;= heap.Count-1 { i := heap.getMaxChildNode(index) if i == -1 { break } if heap.Data[index] \u0026lt; heap.Data[i] { heap.Data[index], heap.Data[i] = heap.Data[i], heap.Data[index] } index = i } } // getMaxChildNode è·å–æœ€å¤§å­èŠ‚ç‚¹ä¸‹æ ‡ï¼Œå¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œreturn -1 func (heap *maxHeap) getMaxChildNode(index int) int { if index \u0026lt;= heap.Count-1 { if index*2+2 \u0026gt; heap.Count-1 { // å½“å³èŠ‚ç‚¹ä¸‹æ ‡è¶Šç•Œæ—¶ if index*2+1 \u0026lt;= heap.Count-1 { // å¦‚æœå·¦ä¸‹æ ‡æ²¡æœ‰è¶Šç•Œï¼Œåˆ™è¿”å›å·¦èŠ‚ç‚¹ä¸‹æ ‡ return index*2 + 1 } } else { // å½“å³èŠ‚ç‚¹ä¸‹æ ‡æ²¡æœ‰è¶Šç•Œæ—¶ï¼Œæ­¤æ—¶å·¦ä¸‹æ ‡ä¸€å®šæ²¡æœ‰è¶Šç•Œ if heap.Data[index*2+1] \u0026gt;= heap.Data[index*2+2] { return index*2 + 1 } else { return index*2 + 2 } } } // æ²¡æœ‰å­èŠ‚ç‚¹æ—¶ï¼Œè¿”å›-1 return -1 } å †åˆå§‹åŒ– å †çš„å†…éƒ¨å®é™…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å¯ä»¥é€šè¿‡ä¸‹æ ‡è¡¨ç¤ºä¸ºæ ‘å½¢ç»“æ„ï¼Œå †åˆå§‹åŒ–å¯ä»¥æŠŠæ•°ç»„è½¬åŒ–ä¸ºå¤§æ ¹å †æˆ–è€…å°æ ¹å †ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨ï¼š\næœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹æ˜¯ï¼š(n-1)/2 (n æ˜¯æ•°ç»„å¤§å°)\n// MaxHeapipy æœ€å¤§å †åˆå§‹åŒ– func MaxHeapipy(arr []int) *maxHeap { mh := NewMaxHeap(len(arr)) mh.Data = arr mh.Count = len(arr) // å †æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹æ˜¯ï¼š(n-1)/2ï¼Œn æ˜¯æ•°ç»„å¤§å° // åŸºäºè¿™ä¸ªæ€§è´¨ï¼Œå¯ä»¥ä¾æ¬¡å¯¹æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹è¿›è¡Œ shiftDownï¼Œç›¸å½“äºæ¯ä¸€ä¸ªå­æ ‘éƒ½å®Œæˆ shiftDownï¼Œ // æœ€åå®Œæˆæ ¹èŠ‚ç‚¹çš„ shiftDown // shiftDown ä¹‹åï¼Œä¾ç„¶ä¿æŒå¤§æ ¹å †çš„æ€§è´¨ for i := (mh.Count - 1) / 2; i \u0026gt;= 0; i-- { mh.shiftDown(i) } return mh } å †æ’åºæ‰©å±• å·²çŸ¥ä¸€ä¸ªå‡ ä¹æœ‰åºçš„æ•°ç»„ï¼Œå‡ ä¹æœ‰åºæ˜¯æŒ‡ï¼Œå¦‚æœæŠŠæ•°ç»„æ’å¥½åºçš„è¯ï¼Œæ¯ä¸ªå…ƒç´ ç§»åŠ¨çš„è·ç¦»ä¸å¯ä»¥è¶…è¿‡kï¼Œå¹¶ä¸”kç›¸å¯¹äºæ•°ç»„æ¥è¯´æ¯”è¾ƒå°ã€‚è¯·é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ç®—æ³•é’ˆå¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œæ’åºã€‚\nå‡è®¾k=6ï¼Œå‡†å¤‡ä¸€ä¸ªå°æ ¹å †ï¼Œéå†æ•°ç»„ï¼ŒæŠŠå‰7ä¸ªå…ƒç´ æ„å»ºä¸€ä¸ªå°æ ¹å †ï¼Œåˆ™0ä½ç½®æ˜¯æ•°ç»„çš„æœ€å°å€¼ï¼ˆå› ä¸ºæ’å¥½åºä¹‹åï¼Œæ¯ä¸ªå…ƒç´ ç§»åŠ¨è·ç¦»ä¸ä¼šè¶…è¿‡kï¼‰ï¼ŒæŠŠå°æ ¹å †çš„æ ¹èŠ‚ç‚¹å¼¹å‡ºï¼Œæ”¾åˆ°æ•°ç»„çš„0ä½ç½®ï¼Œç„¶åä¾æ¬¡æŠŠ7ä¸ªå…ƒç´ ä¹‹åçš„æ•°æ®æ’å…¥åˆ°å°æ ¹å †ï¼Œå¼¹å‡ºæ ¹èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¼¹å‡ºçš„æ•°æ®ä¸€æ¬¡æœ‰åºã€‚\n",
      "summary": "å † å †çš„æœ¬è´¨æ˜¯æ ‘ï¼Œç”¨æ•°ç»„è¡¨ç¤ºçš„å®Œå…¨äºŒå‰æ ‘ï¼›\nå®šä¹‰ ä¸€æ£µæ·±åº¦ä¸ºkä¸”æœ‰ 2^k - 1 ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ç§°ä¸ºæ»¡äºŒå‰æ ‘ã€‚\næ ¹æ®äºŒå‰æ ‘çš„æ€§è´¨2, æ»¡äºŒå‰æ ‘æ¯ä¸€å±‚çš„ç»“ç‚¹ä¸ªæ•°éƒ½è¾¾åˆ°äº†æœ€å¤§å€¼, å³æ»¡äºŒå‰æ ‘çš„ç¬¬iå±‚ä¸Šæœ‰ 2^(i-1) ä¸ªç»“ç‚¹ (iâ‰¥1) ã€‚\nå¦‚æœå¯¹æ»¡äºŒå‰æ ‘çš„ç»“ç‚¹è¿›è¡Œç¼–å·, çº¦å®šç¼–å·ä»æ ¹ç»“ç‚¹èµ·, è‡ªä¸Šè€Œä¸‹, è‡ªå·¦è€Œå³ã€‚åˆ™æ·±åº¦ä¸ºkçš„, æœ‰nä¸ªç»“ç‚¹çš„äºŒå‰æ ‘, å½“ä¸”ä»…å½“å…¶æ¯ä¸€ä¸ªç»“ç‚¹éƒ½ä¸æ·±åº¦ä¸ºkçš„æ»¡äºŒå‰æ ‘ä¸­ç¼–å·ä»1è‡³nçš„ç»“ç‚¹ä¸€ä¸€å¯¹åº”æ—¶, ç§°ä¹‹ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚\nä»æ»¡äºŒå‰æ ‘å’Œå®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¯ä»¥çœ‹å‡º, æ»¡äºŒå‰æ ‘æ˜¯å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ®Šå½¢æ€, å³å¦‚æœä¸€æ£µäºŒå‰æ ‘æ˜¯æ»¡äºŒå‰æ ‘, åˆ™å®ƒå¿…å®šæ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚\nå‚è€ƒï¼š https://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91/7773232\næ€§è´¨ arrï¼š[2 3 4 52 2 2 1] idxï¼š 0 1 2 3 4 5 6 i ä¸‹æ ‡å’Œå…ƒç´ ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š\nå·¦å­èŠ‚ç‚¹ï¼š2*i+1 å³å­èŠ‚ç‚¹ï¼š2*i+2 çˆ¶èŠ‚ç‚¹ï¼š(i-1)/2 å¤§æ ¹å † å®Œå…¨äºŒå‰æ ‘é‡Œï¼Œæ¯ä¸€ä¸ªå­æ ‘çš„æœ€å¤§å€¼æ˜¯æ ¹èŠ‚ç‚¹ï¼›\nå°æ ¹å † å®Œå…¨äºŒå‰æ ‘é‡Œï¼Œæ¯ä¸€ä¸ªå­æ ‘çš„æœ€å°å€¼æ˜¯æ ¹èŠ‚ç‚¹ï¼›\nå †æ’åº å®šä¹‰å † // maxHeap å®šä¹‰ä¸€ä¸ªå¤§æ ¹å † type maxHeap struct { Data []int Count int } func NewMaxHeap(size int) *maxHeap { return \u0026amp;maxHeap{ Data: make([]int, size), Count: 0, } } æ’å…¥æ•°æ® æ’å…¥æ•°æ®æ—¶ï¼Œæ˜¯å¾€æ•°ç»„æœ€åå¢åŠ å…ƒç´ ï¼Œç”±äºéœ€è¦ä¿è¯å¤§æ ¹å †çš„æ€§è´¨ï¼Œå¦‚æœæ–°åŠ å…¥çš„å…ƒç´ æ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œåˆ™è·Ÿçˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œè¿™ä¸ªäº¤æ¢æµç¨‹å®Œæˆåï¼Œæ–°å…ƒç´ æ’å…¥å°±å®Œæˆäº†ã€‚"
    },{
      "title": "Chandy-Lamport ç®—æ³•ç¬”è®°",
      "url": "https://qiref.github.io/post/2023/05/08/chandy-lamport-%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/",
      "content": "å‰è¨€ Global Snapshotï¼ˆGlobal Stateï¼‰ï¼šå…¨å±€å¿«ç…§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ Failure Recovery çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œä¹Ÿæ˜¯å¹¿æ³›åº”ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ›´å¤šæ˜¯åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿä¸­çš„ä¸€ç§å®¹é”™å¤„ç†ç†è®ºåŸºç¡€ã€‚\nåœ¨ Chandy-Lamport ç®—æ³•ä¸­ï¼Œä¸ºäº†å®šä¹‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„ Global Snapshotï¼Œå…ˆå°†åˆ†å¸ƒå¼ç³»ç»Ÿç®€åŒ–æˆæœ‰é™ä¸ªè¿›ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„ channel ç»„æˆï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ ï¼ˆGAGï¼‰ï¼šèŠ‚ç‚¹æ˜¯è¿›ç¨‹ï¼Œè¾¹æ˜¯ channelã€‚å› ä¸ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸åŒçš„ç‰©ç†æœºå™¨ä¸Šçš„ã€‚é‚£ä¹ˆä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„ Global Snapshot å°±æ˜¯æœ‰è¿›ç¨‹çš„çŠ¶æ€å’Œ channel ä¸­çš„ message ç»„æˆï¼Œè¿™ä¸ªä¹Ÿæ˜¯åˆ†å¸ƒå¼å¿«ç…§ç®—æ³•éœ€è¦è®°å½•çš„ã€‚å› æ­¤ï¼ŒChandy-Lamport ç®—æ³•è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ Failure Recovery æ—¶ï¼Œå¯ä»¥ä» Global Snapshot ä¸­æ¢å¤çš„é—®é¢˜ï¼›\nç®—æ³•è¿‡ç¨‹ å‰ææ¡ä»¶åŠå®šä¹‰ processï¼ˆPnï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼Œç”¨ P1ï¼ŒP2ï¼ŒP3 è¡¨ç¤ºï¼› channelï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPn ä¸ Pm é€šä¿¡çš„ç®¡é“ï¼ŒC12 è¡¨ç¤ºä» P1 åˆ° P2 çš„ channelï¼Œåä¹‹ï¼ŒC32 è¡¨ç¤ºä» P3 åˆ° P2çš„ channelï¼› messageï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPn ä¸ Pm ä¹‹é—´å‘é€çš„ä¸šåŠ¡æ¶ˆæ¯ï¼›M23 è¡¨ç¤ºä» P2 åˆ° P3 çš„ messageï¼› markerï¼šåœ¨ Chandy-Lamport ç®—æ³•ä¸­ï¼ŒPn ä¸ Pm ä¹‹é—´å‘é€çš„æ ‡è®°æ¶ˆæ¯ï¼Œä¸åŒäºä¸šåŠ¡çš„ messageï¼Œmarker æ˜¯ç”± Chandy-Lamport ç®—æ³•å®šä¹‰ï¼Œç”¨äºå¸®åŠ©å®ç°å¿«ç…§ç®—æ³•ï¼› snapshot/stateï¼šéƒ½è¡¨ç¤ºå¿«ç…§ï¼ŒåŒæ—¶åŒ…æ‹¬è¿›ç¨‹æœ¬èº«çš„çŠ¶æ€å’Œ messageï¼›ä¸‹æ–‡ä¸­ç»Ÿä¸€å…¨å±€å¿«ç…§å« snapshotï¼Œprocess æœ¬åœ°å¿«ç…§å« stateï¼› Chandy-Lamport ç®—æ³•æœ‰ä¸€äº›å‰ææ¡ä»¶ï¼š\nè¿›ç¨‹ä¹‹é—´çš„ message æ˜¯æœ‰åºçš„ï¼Œä¹Ÿå³FIFO channelï¼› è¿›ç¨‹ä¹‹é—´çš„ message æ˜¯å¯é ä¼ é€’çš„ï¼› ç®—æ³•æ­¥éª¤ Pn ä¸­ä»»æ„è¿›ç¨‹å‘èµ· snapshotï¼Œä¾‹å¦‚ P1 æ­¤æ—¶å‘èµ· snapshotï¼› P1 é¦–å…ˆä¿å­˜æœ¬åœ°çš„ stateï¼› P1 å‘ output channel å‘é€ marker æ¶ˆæ¯åˆ°å…¶ä»–è¿›ç¨‹ï¼ˆP2ï¼ŒP3ï¼‰ï¼› P1 å¼€å§‹è®°å½•æ‰€æœ‰ input channel çš„ messageï¼›ï¼Ÿï¼Ÿï¼Ÿ P2 æ”¶åˆ° marker æ¶ˆæ¯åï¼› å¦‚æœ P2 è¿˜æœªè®°å½•æœ¬åœ°çš„ stateï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ° markeræ¶ˆæ¯ï¼ˆä¾‹å¦‚æ”¶åˆ° P1 marker æ¶ˆæ¯ï¼‰ï¼› P2 å¼€å§‹è®°å½•æœ¬åœ° stateï¼› P2 å°† input channel C12 ç½®ä¸ºç©ºï¼›ï¼Ÿï¼Ÿï¼Ÿ P2 å‘ output channel å‘é€ marker æ¶ˆæ¯ï¼ˆP1ï¼ŒP3ï¼‰ï¼› P2 è®°å½•é™¤ C12 ä¹‹å¤–çš„æ‰€æœ‰ input channel çš„ messageï¼› å¦‚æœ P2 å·²ç»å®Œæˆæœ¬åœ° state è®°å½•ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ° markeræ¶ˆæ¯ï¼ˆä¾‹å¦‚æ”¶åˆ° P3 marker æ¶ˆæ¯ï¼‰ï¼› è®°å½• input channel C32 åœ¨æ”¶åˆ° marker æ¶ˆæ¯ä¹‹å‰çš„ messageï¼› P1 P2 P3 æ”¶åˆ° marker æ¶ˆæ¯å¹¶è®°å½•è‡ªå·±çš„ state å’Œ messageï¼›æ‰€æœ‰ state éƒ½è®°å½•å®Œæˆåï¼Œå¯ä»¥ç”±æŸä¸ªæœåŠ¡å™¨æ”¶é›†è¿™äº›åˆ†æ•£çš„å¿«ç…§ï¼Œå½¢æˆå…¨å±€å¿«ç…§ ï¼ˆGlobal Snapshotï¼‰ï¼Œå…¨å±€å¿«ç…§ç”±æ¯ä¸ªè¿›ç¨‹çš„ state å’Œæ¯ä¸ªé€šé“çš„ message ç»„æˆï¼› é—®é¢˜ ä¸ºä»€ä¹ˆ P1 å‘èµ· snapshot ä¹‹åï¼Œè¦å¼€å§‹è®°å½•æ‰€æœ‰ input channel çš„ messageï¼Ÿ\nè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦æ˜ç¡®ï¼Œæ¯ä¸€æ¬¡çš„ snapshot æ˜¯ä»ä»€ä¹ˆæ—¶å€™ç»“æŸçš„ï¼Œå½“æœ€åä¸€ä¸ª P æœ¬åœ°çš„ state å…¨éƒ¨å®Œæˆä¹‹åï¼Œæ‰ç®—æ˜¯ä¸€æ¬¡ snapshotï¼›æ‰€ä»¥ï¼Œåœ¨ä¸€æ¬¡ snapshot å‘èµ·ä¹‹åï¼Œåˆ°æœ€åä¸€ä¸ª P å®Œæˆæœ¬åœ° stateï¼Œè¿›ç¨‹ä¹‹é—´çš„å¢é‡ message ä¹Ÿä¼šè®°å½•å¹¶ä¿å­˜åˆ° state ä¸­ï¼›\nä¸ºä»€ä¹ˆ P2 å¼€å§‹è®°å½•æœ¬åœ° state ä¹‹åéœ€è¦å°† C12 ç½®ä¸ºç©ºï¼Ÿ\nå›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç†è§£ç®—æ³•ä¸­ï¼Œmarker è¿™ä¸ªæ¶ˆæ¯æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå…¶å® marker æ˜¯ä¸ºäº†åˆ†å‰²æ¯ä¸€æ¬¡çš„ snapshotï¼ ç›¸å½“äºæ˜¯ message ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œå½“ P2 è®°å½•æœ¬åœ° state ä¹‹åï¼Œè¯´æ˜ P2 æ­¤æ—¶å·²ç»ä» C12 ä¸­å¾—åˆ°ä¸€ä¸ª marker æ¶ˆæ¯ï¼Œä» P1 â†’ P2 çš„æ¶ˆæ¯é»˜è®¤éƒ½å·²ç»è¢« P2 æ¥æ”¶åˆ°ï¼Œå¹¶ä¸”å¤„ç†å®Œæˆï¼ˆå·²ç»ä¿å­˜åˆ° P2 çš„æœ¬åœ° state ä¸­ï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œä» C12 ä¸­ marker ä¹‹åçš„æ¶ˆæ¯ï¼Œæ˜¯ä¸‹ä¸€æ¬¡ snapshot çš„ messageï¼›\nç¤ºä¾‹ èƒŒæ™¯è¯´æ˜ï¼Œ3 ä¸ªè¿›ç¨‹ P1 P2 P3ï¼›æ¯ä¸ªè¿›ç¨‹åœ¨è¿è¡Œä¸­ä¼šäº§ç”Ÿè‡ªèº«çš„ state ä¾‹å¦‚ P1ï¼ˆa,bï¼‰,æ¯ä¸ªè¿›ç¨‹ä¹‹é—´è¿˜ä¼šäº§ç”Ÿmessageï¼Œä¾‹å¦‚ message (b-\u0026gt;f);\nåœ¨ Chandy-Lamport ç®—æ³•ä¸­ï¼Œå¯ä»¥ç”±ä»»æ„è¿›ç¨‹å‘èµ· snapshotï¼›å‡è®¾è¿™é‡Œ P1 å…ˆå‘èµ· Global Snapshotï¼›\nP1 å…ˆè®°å½•è‡ªèº«çš„ state(a,b)ï¼Œç„¶åå‘ P2 P3 å‘é€ markerï¼Œæœ€åè®°å½• input channel C21 C31\nå‡è®¾ P3 å…ˆæ¥æ”¶åˆ° marker æ¶ˆæ¯ï¼Œæ­¤æ—¶æ˜¯ P3 ç¬¬ä¸€æ¬¡æ”¶åˆ° marker æ¶ˆæ¯ï¼ŒP3 å…ˆå¼€å§‹è®°å½•è‡ªèº«çš„ state(i)ï¼Œç„¶åå°† C13 ç½®ä¸ºç©ºï¼Œç„¶åå‘ P1 å’Œ P2 å‘é€ marker æ¶ˆæ¯ï¼Œæœ€åï¼ŒP3 è®°å½• C23 çš„æ¶ˆæ¯ï¼›\nå½“ P2 æ¥æ”¶åˆ° marker æ¶ˆæ¯ä¹‹åï¼Œæ­¤æ—¶ P2 ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ° marker æ¶ˆæ¯ï¼ŒP2 å¼€å§‹è®°å½•è‡ªèº«çš„ state(f,g,h)ï¼Œç„¶åå°† C32 ç½®ä¸ºç©ºï¼ˆmarker æ¶ˆæ¯æ¥è‡ªäº P3ï¼‰ï¼Œç„¶åå‘ P1 P3 å‘é€ marker æ¶ˆæ¯ï¼Œæœ€åï¼ŒP2 è®°å½• C12 çš„æ¶ˆæ¯ï¼›\nè‡³æ­¤ï¼Œæ‰€æœ‰çš„ marker æ¶ˆæ¯å·²ç»å‘å‡ºï¼Œå‰©ä½™çš„è¿‡ç¨‹å°±æ˜¯å¤„ç†éé¦–æ¬¡æ¥å—åˆ° marker æ¶ˆæ¯çš„æµç¨‹ï¼›\nå½“ P1 æ”¶åˆ° P2 P3 çš„ marker æ¶ˆæ¯æ—¶ï¼Œç”±äº P1 æ˜¯ snapshot çš„å‘èµ·è€…ï¼Œè®¤ä¸º P1 å·²ç»æ¥å—åˆ° marker æ¶ˆæ¯ï¼Œæ­¤æ—¶ï¼š\nåœ¨ time1 æ—¶åˆ»ï¼Œæ¥æ”¶åˆ° P3 çš„ marker æ¶ˆæ¯ï¼Œåªéœ€è¦è®°å½• C31 çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶ C31 ä¸ºç©ºï¼› åœ¨ time2 æ—¶åˆ»ï¼Œæ¥æ”¶åˆ° P2 çš„ marker æ¶ˆæ¯ï¼Œåªéœ€è¦è®°å½• C21 çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶ channel ä¸­æœ‰ä¸ªæ¶ˆæ¯ messageï¼ˆh-\u0026gt;dï¼‰,å› æ­¤ï¼Œéœ€è¦æŠŠ messageï¼ˆh-\u0026gt;dï¼‰è®°å½•åˆ° snapshot ä¸­ï¼ŒP1 çš„å·¥ä½œå®Œæˆäº†; ä¸ P1 åŒç†ï¼Œå½“ P2 P3 å†æ¬¡æ¥æ”¶åˆ° marker æ¶ˆæ¯æ—¶ï¼Œåªéœ€è¦è®°å½• channel çš„æ¶ˆæ¯å°±è¡Œï¼Œç”±äº P2 P3 åç»­è¿‡ç¨‹æ²¡æœ‰æ¶ˆæ¯ä¼ è¾“ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼› å½“æ‰€æœ‰è¿›ç¨‹å¤„ç†å®Œæ‰€æœ‰ marker æ¶ˆæ¯ä¹‹åï¼Œä¸€æ¬¡ snapshot æµç¨‹å°±ç»“æŸäº†ï¼›\nä»ç»“æœä¸Šçœ‹ï¼Œä¸€æ¬¡ snapshot åŒ…æ‹¬äº† state(a,b,f,g,h,i) + messageï¼ˆh-\u0026gt;dï¼‰ , ç”±äº g åœ¨ state ä¸­ï¼Œå¹¶ä¸” h-\u0026gt;d æ˜¯åœ¨ä¸€æ¬¡ snapshot ä¸­å‘ç”Ÿçš„ï¼Œæ‰€ä»¥ï¼Œh-\u0026gt;d ä¹Ÿåº”è¯¥åŒ…å«åœ¨è¿™æ¬¡ snapshot ä¸­ï¼Œè¿™ä¹Ÿå°±æ˜¯ Chandy-Lamport ç®—æ³•çš„ç²¾å¦™ä¹‹å¤„ï¼\nå‚è€ƒ åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…¨å±€å¿«ç…§ - Yang Blog\npaper_reading/Chandy-Lamport.md at main Â· legendtkl/paper_reading Â· GitHub\nChandyâ€“Lamport algorithm - Wikipedia\n",
      "summary": "å‰è¨€ Global Snapshotï¼ˆGlobal Stateï¼‰ï¼šå…¨å±€å¿«ç…§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ Failure Recovery çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œä¹Ÿæ˜¯å¹¿æ³›åº”ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ›´å¤šæ˜¯åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿä¸­çš„ä¸€ç§å®¹é”™å¤„ç†ç†è®ºåŸºç¡€ã€‚\nåœ¨ Chandy-Lamport ç®—æ³•ä¸­ï¼Œä¸ºäº†å®šä¹‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„ Global Snapshotï¼Œå…ˆå°†åˆ†å¸ƒå¼ç³»ç»Ÿç®€åŒ–æˆæœ‰é™ä¸ªè¿›ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„ channel ç»„æˆï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ ï¼ˆGAGï¼‰ï¼šèŠ‚ç‚¹æ˜¯è¿›ç¨‹ï¼Œè¾¹æ˜¯ channelã€‚å› ä¸ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸åŒçš„ç‰©ç†æœºå™¨ä¸Šçš„ã€‚é‚£ä¹ˆä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„ Global Snapshot å°±æ˜¯æœ‰è¿›ç¨‹çš„çŠ¶æ€å’Œ channel ä¸­çš„ message ç»„æˆï¼Œè¿™ä¸ªä¹Ÿæ˜¯åˆ†å¸ƒå¼å¿«ç…§ç®—æ³•éœ€è¦è®°å½•çš„ã€‚å› æ­¤ï¼ŒChandy-Lamport ç®—æ³•è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ Failure Recovery æ—¶ï¼Œå¯ä»¥ä» Global Snapshot ä¸­æ¢å¤çš„é—®é¢˜ï¼›\nç®—æ³•è¿‡ç¨‹ å‰ææ¡ä»¶åŠå®šä¹‰ processï¼ˆPnï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼Œç”¨ P1ï¼ŒP2ï¼ŒP3 è¡¨ç¤ºï¼› channelï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPn ä¸ Pm é€šä¿¡çš„ç®¡é“ï¼ŒC12 è¡¨ç¤ºä» P1 åˆ° P2 çš„ channelï¼Œåä¹‹ï¼ŒC32 è¡¨ç¤ºä» P3 åˆ° P2çš„ channelï¼› messageï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒPn ä¸ Pm ä¹‹é—´å‘é€çš„ä¸šåŠ¡æ¶ˆæ¯ï¼›M23 è¡¨ç¤ºä» P2 åˆ° P3 çš„ messageï¼› markerï¼šåœ¨ Chandy-Lamport ç®—æ³•ä¸­ï¼ŒPn ä¸ Pm ä¹‹é—´å‘é€çš„æ ‡è®°æ¶ˆæ¯ï¼Œä¸åŒäºä¸šåŠ¡çš„ messageï¼Œmarker æ˜¯ç”± Chandy-Lamport ç®—æ³•å®šä¹‰ï¼Œç”¨äºå¸®åŠ©å®ç°å¿«ç…§ç®—æ³•ï¼› snapshot/stateï¼šéƒ½è¡¨ç¤ºå¿«ç…§ï¼ŒåŒæ—¶åŒ…æ‹¬è¿›ç¨‹æœ¬èº«çš„çŠ¶æ€å’Œ messageï¼›ä¸‹æ–‡ä¸­ç»Ÿä¸€å…¨å±€å¿«ç…§å« snapshotï¼Œprocess æœ¬åœ°å¿«ç…§å« stateï¼› Chandy-Lamport ç®—æ³•æœ‰ä¸€äº›å‰ææ¡ä»¶ï¼š"
    },{
      "title": "Goè¯­è¨€ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹",
      "url": "https://qiref.github.io/post/2023/04/28/go%E8%AF%AD%E8%A8%80%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/",
      "content": " type Request struct { Name string } type XxHandler struct { RequestQueue chan *Request } func (o *XxHandler) String() string { if b, err := json.Marshal(o); err != nil { return \u0026quot;\u0026quot; } else { return string(b) } } // Start å¯åŠ¨é˜Ÿåˆ—ç›‘å¬ func (o *XxHandler) Start() { go func() { for request := range o.RequestQueue { go o.Process(request) } }() } // AppendTask å‘é˜Ÿåˆ—ä¸­å¢åŠ task func (o *XxHandler) AppendTask(request *Request) { if request == nil { return } o.RequestQueue \u0026lt;- request } // Stop å…³é—­é˜Ÿåˆ— func (o *XxHandler) Stop() { close(o.RequestQueue) } func newIns() *XxHandler { return \u0026amp;XxHandler{ RequestQueue: make(chan *Request, 10), } } var ins *XxHandler // GetXxHandler è·å– å®ä¾‹ func GetXxHandler() *XxHandler { if ins == nil { ins = newIns() } return ins } // Process å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ func (o *XxHandler) Process(request *Request) { // do something } func TestXxHandler(t *testing.T) { GetXxHandler().Start() GetXxHandler().AppendTask(\u0026amp;Request{Name: \u0026quot;xx\u0026quot;}) } ",
      "summary": "type Request struct { Name string } type XxHandler struct { RequestQueue chan *Request } func (o *XxHandler) String() string { if b, err := json.Marshal(o); err != nil { return \u0026quot;\u0026quot; } else { return string(b) } } // Start å¯åŠ¨é˜Ÿåˆ—ç›‘å¬ func (o *XxHandler) Start() { go func() { for request := range o.RequestQueue { go o.Process(request) } }() } // AppendTask å‘é˜Ÿåˆ—ä¸­å¢åŠ task func (o *XxHandler) AppendTask(request *Request) { if request == nil { return } o."
    },{
      "title": "Goè¯­è¨€å®ç° bitmap",
      "url": "https://qiref.github.io/post/2023/04/28/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-bitmap/",
      "content": "ç®—æ³•è¯´æ˜ Bitmapç®—æ³•æ˜¯ä¸€ç§åŸºäºä½è¿ç®—çš„æ•°æ®ç»“æ„ï¼Œç”¨äºè§£å†³å¤§è§„æ¨¡æ•°æ®çš„å¿«é€ŸæŸ¥æ‰¾å’Œç»Ÿè®¡é—®é¢˜ã€‚å…¶åŸºæœ¬åŸç†æ˜¯å°†ä¸€ä¸ªå¤§æ•°æ®é›†åˆæ˜ å°„åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶å‘é‡ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”äºæ•°æ®é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå‘é‡ä¸­çš„æ¯ä¸€ä½è¡¨ç¤ºè¯¥å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ã€‚\nå…·ä½“æ¥è¯´ï¼ŒBitmapç®—æ³•é€šè¿‡ä½¿ç”¨ä¸€ä¸ªä½å›¾ï¼ˆbitmapï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªæ•°æ®é›†åˆï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªä½ã€‚å¦‚æœæŸä¸ªå…ƒç´ åœ¨æ•°æ®é›†åˆä¸­å‡ºç°ï¼Œåˆ™å°†å…¶å¯¹åº”çš„ä½è®¾ç½®ä¸º1ï¼Œå¦åˆ™å°†å…¶å¯¹åº”çš„ä½è®¾ç½®ä¸º0ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œé›†åˆæ“ä½œï¼Œå¦‚å¹¶é›†ã€äº¤é›†å’Œå·®é›†ç­‰ã€‚\nBitmapç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹åœ¨äºå…¶ç©ºé—´æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨è¾ƒå°çš„ç©ºé—´å­˜å‚¨å¤§è§„æ¨¡æ•°æ®é›†åˆã€‚å¦å¤–ï¼ŒBitmapç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿéå¸¸ä½ï¼Œå¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œé›†åˆæ“ä½œã€‚\nå¦‚ä½•ç”¨æ•°ç»„è¡¨ç¤ºä¸€ä¸ª bitmap ä»¥ 1byte ä¸ºä¾‹ï¼š8ä½èƒ½è¡¨ç¤º8ä¸ªå…ƒç´ ï¼Œ 0-7 å·å¯¹åº”äº† b[0] ä¸‹æ ‡ï¼Œ 8-15 å·å¯¹åº”äº† b[1] ä¸‹æ ‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå› æ­¤ï¼Œæ•°ç»„ä¸‹æ ‡ n è·Ÿbitmapå…ƒç´ åºå· bitmapIdx çš„å…³ç³»ä¸ºï¼šn = bitmapIdx \u0026gt;\u0026gt; 3\nå€¼å¦‚ä½•æ˜ å°„åˆ° bitmap æ•°ç»„ å½“æ‰¾åˆ°äº† å…ƒç´ åºå· n åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¹‹åï¼Œå¦‚ä½•ç»™ b[n] èµ‹å€¼å‘¢ï¼Ÿ\n1 \u0026lt;\u0026lt; (bitmapIdx \u0026amp; 7) ç­‰åŒäº 1 \u0026lt;\u0026lt; (bitmapIdx % 8)\n(bitmapIdx % 8) æ‰¾åˆ°åœ¨äº†åœ¨æ•°ç»„ b[n] ä¸­çš„ç¬¬ m ä½ï¼Œç„¶å 1 \u0026lt;\u0026lt; m ä¹‹åï¼Œå°±ç›¸å½“äºç»™æ•°ç»„èµ‹å€¼ï¼ŒæŠŠç¬¬ m ä½ ç½®ä¸º1ã€‚\néªŒè¯ åŒæ ·ä»¥ 1byte ä¸ºä¾‹ï¼šå€Ÿç”¨ä¸Šè¿°ç»“è®ºï¼Œç¬¬ 24 å·å…ƒç´ ï¼Œå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ n ä¸ºï¼šn = 24 \u0026gt;\u0026gt; 3 ç»“æœä¸º3, b[3]ï¼›\n1 \u0026lt;\u0026lt; (24 % 8) = 1 ï¼Œ è¯´æ˜ 24 å·å…ƒç´ ï¼Œåœ¨ b[3] çš„ç¬¬1ä½ï¼Œb[3] = 1ï¼›\nå½“ 25 å·å…ƒç´ åŠ å…¥æ—¶ï¼Œæ­¤æ—¶ n = 25 \u0026gt;\u0026gt; 3 ç»“æœä¸º3ï¼Œb[3]; 1 \u0026lt;\u0026lt; (25 % 8) = 2 , è¯´æ˜ 25 å·å…ƒç´ ï¼Œåœ¨ b[3] çš„ç¬¬2ä½ï¼Œæ­¤æ—¶å¦‚ä½•èµ‹å€¼å‘¢ï¼Œb[3] å·²ç»èµ‹å€¼ä¸º 1 äº†; é€šè¿‡ | è¿ç®—å°±èƒ½åˆå¹¶ç»“æœï¼šb[3] = 1|2 = 3, æ­¤æ—¶å°±æŠŠ 24ï¼Œ25 ä¸¤ä¸ªå…ƒç´ æ”¾åˆ° b[3] ä¸­äº†ï¼›\nä»£ç å®ç° package bitmap import ( \u0026quot;encoding/json\u0026quot; \u0026quot;fmt\u0026quot; \u0026quot;strconv\u0026quot; ) type BitMap struct { data []int64 } func NewBitMap(size int) *BitMap { return \u0026amp;BitMap{ data: make([]int64, size), } } func ParseFromJsonStr(str string) *BitMap { bitMap := NewBitMap(0) err := json.Unmarshal([]byte(str), \u0026amp;bitMap.data) if err != nil { _ = fmt.Errorf(\u0026quot;parse from json str return error %+v\u0026quot;, err) } return bitMap } func (b *BitMap) set(index uint) { dataIdx := index \u0026gt;\u0026gt; 5 // index/32 if dataIdx \u0026gt;= uint(len(b.data)) { b.data = append(b.data, 1\u0026lt;\u0026lt;(index\u0026amp;31)) // index\u0026amp;31 = index%32 } else { b.data[dataIdx] |= 1 \u0026lt;\u0026lt; (index \u0026amp; 31) } } func (b *BitMap) get(index uint) bool { dataIdx := index \u0026gt;\u0026gt; 5 if len(b.data) \u0026lt;= 0 || uint(len(b.data)) \u0026lt; dataIdx { return false } return b.data[dataIdx]\u0026amp;(1\u0026lt;\u0026lt;(index\u0026amp;31)) \u0026gt; 0 } func (b *BitMap) String() string { result := \u0026quot;\u0026quot; for _, v := range b.data { result += strconv.FormatInt(v, 10) + \u0026quot;(\u0026quot; + DecToBin(v) + \u0026quot;),\u0026quot; } return result } func DecToBin(n int64) string { result := \u0026quot;\u0026quot; if n == 0 { return \u0026quot;0\u0026quot; } for ; n \u0026gt; 0; n /= 2 { lsb := n % 2 result = strconv.FormatInt(lsb, 10) + result } return result } æµ‹è¯•ç»“æœ func TestNewBitmap(t *testing.T) { bitMap := NewBitMap(1) bitMap.set(1) bitMap.set(2) bitMap.set(3) bitMap.set(4) bitMap.set(0) fmt.Println(bitMap.String()) bitMap.set(32) bitMap.set(33) fmt.Println(bitMap.String()) bitMap.set(89) fmt.Println(bitMap.String()) } === RUN TestNewBitmap 31(11111), 31(11111),3(11), 31(11111),3(11),33554432(10000000000000000000000000), --- PASS: TestNewBitmap (0.00s) PASS ",
      "summary": "ç®—æ³•è¯´æ˜ Bitmapç®—æ³•æ˜¯ä¸€ç§åŸºäºä½è¿ç®—çš„æ•°æ®ç»“æ„ï¼Œç”¨äºè§£å†³å¤§è§„æ¨¡æ•°æ®çš„å¿«é€ŸæŸ¥æ‰¾å’Œç»Ÿè®¡é—®é¢˜ã€‚å…¶åŸºæœ¬åŸç†æ˜¯å°†ä¸€ä¸ªå¤§æ•°æ®é›†åˆæ˜ å°„åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶å‘é‡ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”äºæ•°æ®é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå‘é‡ä¸­çš„æ¯ä¸€ä½è¡¨ç¤ºè¯¥å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ã€‚\nå…·ä½“æ¥è¯´ï¼ŒBitmapç®—æ³•é€šè¿‡ä½¿ç”¨ä¸€ä¸ªä½å›¾ï¼ˆbitmapï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªæ•°æ®é›†åˆï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªä½ã€‚å¦‚æœæŸä¸ªå…ƒç´ åœ¨æ•°æ®é›†åˆä¸­å‡ºç°ï¼Œåˆ™å°†å…¶å¯¹åº”çš„ä½è®¾ç½®ä¸º1ï¼Œå¦åˆ™å°†å…¶å¯¹åº”çš„ä½è®¾ç½®ä¸º0ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œé›†åˆæ“ä½œï¼Œå¦‚å¹¶é›†ã€äº¤é›†å’Œå·®é›†ç­‰ã€‚\nBitmapç®—æ³•çš„ä¸»è¦ä¼˜ç‚¹åœ¨äºå…¶ç©ºé—´æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨è¾ƒå°çš„ç©ºé—´å­˜å‚¨å¤§è§„æ¨¡æ•°æ®é›†åˆã€‚å¦å¤–ï¼ŒBitmapç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿéå¸¸ä½ï¼Œå¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œé›†åˆæ“ä½œã€‚\nå¦‚ä½•ç”¨æ•°ç»„è¡¨ç¤ºä¸€ä¸ª bitmap ä»¥ 1byte ä¸ºä¾‹ï¼š8ä½èƒ½è¡¨ç¤º8ä¸ªå…ƒç´ ï¼Œ 0-7 å·å¯¹åº”äº† b[0] ä¸‹æ ‡ï¼Œ 8-15 å·å¯¹åº”äº† b[1] ä¸‹æ ‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå› æ­¤ï¼Œæ•°ç»„ä¸‹æ ‡ n è·Ÿbitmapå…ƒç´ åºå· bitmapIdx çš„å…³ç³»ä¸ºï¼šn = bitmapIdx \u0026gt;\u0026gt; 3\nå€¼å¦‚ä½•æ˜ å°„åˆ° bitmap æ•°ç»„ å½“æ‰¾åˆ°äº† å…ƒç´ åºå· n åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¹‹åï¼Œå¦‚ä½•ç»™ b[n] èµ‹å€¼å‘¢ï¼Ÿ\n1 \u0026lt;\u0026lt; (bitmapIdx \u0026amp; 7) ç­‰åŒäº 1 \u0026lt;\u0026lt; (bitmapIdx % 8)\n(bitmapIdx % 8) æ‰¾åˆ°åœ¨äº†åœ¨æ•°ç»„ b[n] ä¸­çš„ç¬¬ m ä½ï¼Œç„¶å 1 \u0026lt;\u0026lt; m ä¹‹åï¼Œå°±ç›¸å½“äºç»™æ•°ç»„èµ‹å€¼ï¼ŒæŠŠç¬¬ m ä½ ç½®ä¸º1ã€‚\néªŒè¯ åŒæ ·ä»¥ 1byte ä¸ºä¾‹ï¼šå€Ÿç”¨ä¸Šè¿°ç»“è®ºï¼Œç¬¬ 24 å·å…ƒç´ ï¼Œå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ n ä¸ºï¼šn = 24 \u0026gt;\u0026gt; 3 ç»“æœä¸º3, b[3]ï¼›"
    },{
      "title": "Goè¯­è¨€å®ç° LRU",
      "url": "https://qiref.github.io/post/2023/04/27/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-lru/",
      "content": "LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•;å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå®ƒåœ¨æœªæ¥è¢«è®¿é—®çš„æ¦‚ç‡ä¹Ÿä¼šå¾ˆé«˜ï¼›åä¹‹ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®å¾ˆä¹…éƒ½æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå®ƒåœ¨æœªæ¥è¢«è®¿é—®çš„æ¦‚ç‡å°±ç›¸å¯¹è¾ƒä½ã€‚å› æ­¤ï¼ŒLRUç®—æ³•é€‰æ‹©æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼Œå³é€‰æ‹©æœ€é•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®è¿‡çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚\nå…·ä½“æ¥è¯´ï¼ŒLRUç®—æ³•é€šå¸¸ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨å’Œä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å®ç°ã€‚åŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‰ç…§æœ€è¿‘è®¿é—®æ—¶é—´çš„é¡ºåºæ’åˆ—ï¼Œæœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ’åœ¨é“¾è¡¨å¤´éƒ¨ï¼Œæœ€ä¹…æœªè®¿é—®çš„èŠ‚ç‚¹æ’åœ¨é“¾è¡¨å°¾éƒ¨ã€‚å“ˆå¸Œè¡¨ä¸­å­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾å’Œåˆ é™¤ã€‚\nå½“éœ€è¦è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼ŒLRUç®—æ³•é¦–å…ˆåœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾è¯¥æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†å¯¹åº”çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†è¯¥æ•°æ®æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ä¸­åˆ›å»ºå¯¹åº”çš„èŠ‚ç‚¹ã€‚\nå½“éœ€è¦æ·˜æ±°æ•°æ®æ—¶ï¼ŒLRUç®—æ³•é€‰æ‹©é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹è¿›è¡Œæ·˜æ±°ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤å¯¹åº”çš„èŠ‚ç‚¹ã€‚\ngolang å®ç° LRU ç®—æ³•ï¼š\npackage lru import ( \u0026quot;container/list\u0026quot; \u0026quot;errors\u0026quot; \u0026quot;sync\u0026quot; ) // LRU implements a non-thread safe fixed size LRU cache type LRU struct { size int evictList *list.List items map[interface{}]*list.Element } // entry is used to hold a value in the evictList type entry struct { key interface{} value interface{} } // NewLRU constructs an LRU of the given size func NewLRU(size int) (*LRU, error) { if size \u0026lt;= 0 { return nil, errors.New(\u0026quot;must provide a positive size\u0026quot;) } c := \u0026amp;LRU{ size: size, evictList: list.New(), items: make(map[interface{}]*list.Element), } return c, nil } // Add adds a value to the cache. Returns true if an eviction occured. func (c *LRU) Add(key, value interface{}) bool { // Check for existing item if ent, ok := c.items[key]; ok { c.evictList.MoveToFront(ent) ent.Value.(*entry).value = value return false } // Add new item ent := \u0026amp;entry{key, value} entry := c.evictList.PushFront(ent) c.items[key] = entry evict := c.evictList.Len() \u0026gt; c.size // Verify size not exceeded if evict { c.removeOldest() } return evict } // Get looks up a key's value from the cache. func (c *LRU) Get(key interface{}) (value interface{}, ok bool) { if ent, ok := c.items[key]; ok { c.evictList.MoveToFront(ent) return ent.Value.(*entry).value, true } return } // Remove removes the provided key from the cache, returning if the // key was contained. func (c *LRU) Remove(key interface{}) bool { if ent, ok := c.items[key]; ok { c.removeElement(ent) return true } return false } // removeOldest removes the oldest item from the cache. func (c *LRU) removeOldest() { ent := c.evictList.Back() if ent != nil { c.removeElement(ent) } } // removeElement is used to remove a given list element from the cache func (c *LRU) removeElement(e *list.Element) { c.evictList.Remove(e) kv := e.Value.(*entry) delete(c.items, kv.key) if c.onEvict != nil { c.onEvict(kv.key, kv.value) } } éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ª LRU å®ç°å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœéœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦åœ¨å¤–å±‚æ–¹æ³•åŠ é”ï¼ŒåŒæ—¶ï¼Œç”±äº golang çš„ lock å¹¶ä¸æ˜¯å¯é‡å…¥çš„ï¼Œéœ€è¦æ³¨æ„é¿å…æ­»é”é—®é¢˜ã€‚ ä»¥ä¸‹å®ç°ä¸­åŸºäº LRU åšäº†ä¸€æ¬¡å°è£…ï¼Œå®ç°äº†çº¿ç¨‹å®‰å…¨çš„å†…å­˜çº§ LRU-Cacheï¼š\nå®Œæ•´ä»£ç ï¼š https://github.com/ArchieYao/leet-code-training/blob/main/src/lru/lru.go\n",
      "summary": "LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•;å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå®ƒåœ¨æœªæ¥è¢«è®¿é—®çš„æ¦‚ç‡ä¹Ÿä¼šå¾ˆé«˜ï¼›åä¹‹ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®å¾ˆä¹…éƒ½æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå®ƒåœ¨æœªæ¥è¢«è®¿é—®çš„æ¦‚ç‡å°±ç›¸å¯¹è¾ƒä½ã€‚å› æ­¤ï¼ŒLRUç®—æ³•é€‰æ‹©æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼Œå³é€‰æ‹©æœ€é•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®è¿‡çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚\nå…·ä½“æ¥è¯´ï¼ŒLRUç®—æ³•é€šå¸¸ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨å’Œä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å®ç°ã€‚åŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‰ç…§æœ€è¿‘è®¿é—®æ—¶é—´çš„é¡ºåºæ’åˆ—ï¼Œæœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ’åœ¨é“¾è¡¨å¤´éƒ¨ï¼Œæœ€ä¹…æœªè®¿é—®çš„èŠ‚ç‚¹æ’åœ¨é“¾è¡¨å°¾éƒ¨ã€‚å“ˆå¸Œè¡¨ä¸­å­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾å’Œåˆ é™¤ã€‚\nå½“éœ€è¦è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼ŒLRUç®—æ³•é¦–å…ˆåœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾è¯¥æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†å¯¹åº”çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†è¯¥æ•°æ®æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ä¸­åˆ›å»ºå¯¹åº”çš„èŠ‚ç‚¹ã€‚\nå½“éœ€è¦æ·˜æ±°æ•°æ®æ—¶ï¼ŒLRUç®—æ³•é€‰æ‹©é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹è¿›è¡Œæ·˜æ±°ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤å¯¹åº”çš„èŠ‚ç‚¹ã€‚\ngolang å®ç° LRU ç®—æ³•ï¼š\npackage lru import ( \u0026quot;container/list\u0026quot; \u0026quot;errors\u0026quot; \u0026quot;sync\u0026quot; ) // LRU implements a non-thread safe fixed size LRU cache type LRU struct { size int evictList *list.List items map[interface{}]*list.Element } // entry is used to hold a value in the evictList type entry struct { key interface{} value interface{} } // NewLRU constructs an LRU of the given size func NewLRU(size int) (*LRU, error) { if size \u0026lt;= 0 { return nil, errors."
    },{
      "title": "Flinkå†…å­˜æ¨¡å‹",
      "url": "https://qiref.github.io/post/2023/03/28/flink%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/",
      "content": "Java å †å¤–å†…å­˜ import sun.nio.ch.DirectBuffer; import java.nio.ByteBuffer; import java.util.concurrent.TimeUnit; public class OutHeapMem { public static void main(String[] args) throws Exception { // åˆ†é… 1G ç›´æ¥å†…å­˜ ByteBuffer byteBuffer = ByteBuffer.allocateDirect(1024 * 1024 * 1024); TimeUnit.SECONDS.sleep(30); System.out.println(\u0026quot;clean start\u0026quot;); // æ¸…é™¤ç›´æ¥å†…å­˜ ((DirectBuffer) byteBuffer).cleaner().clean(); System.out.println(\u0026quot;clean finished\u0026quot;); TimeUnit.SECONDS.sleep(30); } } # åˆ†é…å†…å­˜ Memory used total max usage heap 21M 165M 3641M 0.59% ps_eden_space 3M 64M 1344M 0.29% ps_survivor_space 0K 10752K 10752K 0.00% ps_old_gen 17M 91M 2731M 0.64% nonheap 28M 28M -1 96.89% code_cache 5M 5M 240M 2.11% metaspace 20M 21M -1 97.00% compressed_class_space 2M 2M 1024M 0.25% direct 1024M 1024M - 100.00% mapped 0K 0K - 0.00% # é‡Šæ”¾å†…å­˜ Memory used total max usage heap 21M 165M 3641M 0.60% ps_eden_space 4M 64M 1344M 0.32% ps_survivor_space 0K 10752K 10752K 0.00% ps_old_gen 17M 91M 2731M 0.64% nonheap 27M 28M -1 96.79% code_cache 5M 5M 240M 2.09% metaspace 20M 21M -1 97.03% compressed_class_space 2M 2M 1024M 0.25% direct 0K 0K - 0.00% mapped 0K 0K - 0.00% é€šè¿‡ arthas åˆ†æï¼Œåˆ†é…ç›´æ¥å†…å­˜ä¼šåœ¨ direct å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œè¡¨æ˜æ˜¯åœ¨å †å¤–åˆ†é…çš„å†…å­˜ç©ºé—´ï¼›è™½ç„¶ byteBuffer æŒ‡å‘äº† direct memoryï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡å¼•ç”¨è¿˜åœ¨ heap ä¸­ï¼Œå½“ byteBuffer å¯¹è±¡å¼•ç”¨ è¢« GC ç®—æ³•å›æ”¶æ‰ä¹‹åï¼ŒbyteBuffer æŒ‡å‘çš„å†…å­˜ç©ºé—´ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼›\nflink å†…å­˜æ¨¡å‹ flink å†…å­˜æ¨¡å‹å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºï¼ŒHeap å†…å­˜ å’Œ Off-Heap å†…å­˜ï¼›\nHeap å†…å­˜åŒ…æ‹¬ï¼ŒTask å’Œ Framework ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æ¡†æ¶éœ€è¦çš„å†…å­˜ä»¥åŠç”¨æˆ·ä»£ç éœ€è¦çš„å†…å­˜ï¼› Off-Heap å†…å­˜åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼ŒManaged Memory å’Œ Direct Memory ä»¥åŠ JVM ç›¸å…³çš„æ¶ˆè€—ï¼ŒJVM Metaspace å’Œ JVM Overhead å¾ˆå¥½ç†è§£ï¼Œç”¨äº JVM çš„å¼€é”€ï¼Œé‚£ä¸ºä»€ä¹ˆå †å¤–å†…å­˜åˆä¼šåˆ†æˆ Managed memory å’Œ Direct memory å‘¢ï¼Ÿæ˜¯å› ä¸º Managed Memory æ˜¯ç”± Flink ç®¡ç†çš„ï¼Œè€Œä¸”è¿™éƒ¨åˆ†å†…å­˜æ˜¯åœ¨å †å¤–ï¼›è€Œå¦å¤–çš„å †å¤–å†…å­˜å¹¶éç”± Flink ç®¡ç†ï¼Œæ‰€ä»¥å«åš Direct Memoryï¼š Managed Memory ç”± Flink ç®¡ç†ï¼ˆMemoryManagerï¼‰çš„å†…å­˜ï¼Œä»¥ Flink æŠ½è±¡çš„ MemorySegments çš„å½¢å¼åˆ†é…ç»™ä½¿ç”¨è€…ï¼› Direct Memory ä¸ºäº†åŒºåˆ«äº Flink ç®¡ç†çš„å †å¤–å†…å­˜ï¼Œ Direct Memory åˆ†ä¸º Framework Task Network ä¸‰ä¸ªéƒ¨åˆ†ï¼› Framework Off-Heap ç”¨äº Flink æ¡†æ¶çš„å †å¤–å†…å­˜ï¼› Task Off-Heap ç”¨äº Flink çš„ç®—å­åŠå…¶ç”¨æˆ·ä»£ç çš„å †å¤–å†…å­˜ï¼› task ä¹‹é—´ç½‘ç»œä¼ è¾“çš„å †å¤–å†…å­˜ï¼› JVM å¼€é”€ JVM Metaspace Taskmanager JVM çš„å…ƒç©ºé—´å†…å­˜ï¼› JVM Overhead ç”¨äº JVM åƒåœ¾å›æ”¶çš„å¼€é”€ï¼› JVM Heap ç»„æˆéƒ¨åˆ† é…ç½®å‚æ•° æè¿° æ¡†æ¶å †å†…å­˜ï¼ˆFramework Heap Memoryï¼‰ taskmanager.memory.framework.heap.size ç”¨äº Flink æ¡†æ¶çš„ JVM å †å†…å­˜ï¼ˆè¿›é˜¶é…ç½®ï¼‰ã€‚TaskExecutors çš„æ¡†æ¶å †å†…å­˜å¤§å°ã€‚è¿™æ˜¯ä¸º TaskExecutor æ¡†æ¶ä¿ç•™çš„ JVM å †å†…å­˜å¤§å°ï¼Œä¸ä¼šåˆ†é…ç»™ä»»åŠ¡æ§½ã€‚ ä»»åŠ¡å †å†…å­˜ï¼ˆTask Heap Memoryï¼‰ taskmanager.memory.task.heap.size ç”¨äº Flink åº”ç”¨çš„ç®—å­åŠç”¨æˆ·ä»£ç çš„ JVM å †å†…å­˜ã€‚\nä»»åŠ¡æ‰§è¡Œå™¨çš„ä»»åŠ¡å †å†…å­˜å¤§å°ã€‚è¿™æ˜¯ä¸ºä»»åŠ¡ä¿ç•™çš„ JVM å †å†…å­˜çš„å¤§å°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®ƒçš„å¤§å°ä¸ºï¼šæ€» Flink å†…å­˜å‡å»æ¡†æ¶å †å†…å­˜ã€æ¡†æ¶å †å¤–å†…å­˜ã€ä»»åŠ¡å †å¤–å†…å­˜ã€æ‰˜ç®¡å†…å­˜å’Œç½‘ç»œå†…å­˜ã€‚ Off-JVM Memory Managed memory ç»„æˆéƒ¨åˆ† é…ç½®å‚æ•° æè¿° æ‰˜ç®¡å†…å­˜ï¼ˆManaged memoryï¼‰ taskmanager.memory.managed.size taskmanager.memory.managed.fraction ç”± Flink ç®¡ç†çš„æµå¤„ç†å’Œæ‰¹å¤„ç†ä½œä¸šä¸­ç”¨äºæ’åºã€å“ˆå¸Œè¡¨åŠç¼“å­˜ä¸­é—´ç»“æœ ã€ æµå¤„ç†ä½œä¸šä¸­ç”¨äº RocksDB State Backendã€æµå¤„ç†å’Œæ‰¹å¤„ç†ä½œä¸šä¸­ç”¨äºåœ¨ Python è¿›ç¨‹ä¸­æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚å†…å­˜ä½¿ç”¨è€…å¯ä»¥ä» MemoryManager ä»¥ MemorySegments çš„å½¢å¼åˆ†é…å†…å­˜ï¼Œæ‰€ä»¥åç§°å« Managed Momoryã€‚ Direct Memory ç»„æˆéƒ¨åˆ† é…ç½®å‚æ•° æè¿° æ¡†æ¶å †å¤–å†…å­˜ï¼ˆFramework Off-heap Memoryï¼‰ taskmanager.memory.framework.off-heap.size è¿™æ˜¯ä¸º Flink æ¡†æ¶ä¿ç•™çš„å †å¤–å†…å­˜çš„å¤§å°ï¼Œä¸ä¼šåˆ†é…ç»™ä»»åŠ¡æ§½ã€‚ Flink åœ¨è®¡ç®— JVM max direct memory size å‚æ•°æ—¶ï¼Œä¼šæŠŠé…ç½®çš„å€¼å…¨éƒ¨ç»Ÿè®¡è¿›å»ã€‚ ä»»åŠ¡å †å¤–å†…å­˜ï¼ˆTask Off-heap Memoryï¼‰ taskmanager.memory.task.off-heap.size TaskExecutors çš„ä»»åŠ¡å †å¤–å†…å­˜å¤§å°ï¼Œç”¨äº Flink ç®—å­åŠç”¨æˆ·ä»£ç çš„å †å¤–å†…å­˜ã€‚ Flink åœ¨è®¡ç®— JVM max direct memory size å‚æ•°æ—¶ï¼Œä¼šæŠŠé…ç½®çš„å€¼å…¨éƒ¨ç»Ÿè®¡è¿›å»ã€‚ ç½‘ç»œå†…å­˜ï¼ˆNetwork Memoryï¼‰ taskmanager.memory.network.min taskmanager.memory.network.max taskmanager.memory.network.fraction ç”¨äºtask ä¹‹é—´æ•°æ®ä¼ è¾“çš„å †å¤–å†…å­˜ï¼ˆç½‘ç»œä¼ è¾“ç¼“å†²åŒºï¼‰ JVM Metaspace ã€JVM Overhead ç»„æˆéƒ¨åˆ† é…ç½®å‚æ•° æè¿° JVM Metaspace taskmanager.memory.jvm-metaspace.size Flink JVM è¿›ç¨‹çš„ Metaspaceã€‚ä» JDK 8 å¼€å§‹ï¼ŒJVM æŠŠæ°¸ä¹…ä»£æ‹¿æ‰äº†ã€‚ç±»çš„ä¸€äº›å…ƒæ•°æ®æ”¾åœ¨å«åš Metaspace çš„ Native Memory ä¸­ã€‚åœ¨ Flink ä¸­çš„ JVM Metaspace Memory ä¹Ÿä¸€æ ·ï¼Œé…ç½®çš„æ˜¯ Taskmanager JVM çš„å…ƒç©ºé—´å†…å­˜å¤§å°ã€‚ JVM Overhead taskmanager.memory.jvm-overhead.min taskmanager.memory.jvm-overhead.max taskmanager.memory.jvm-overhead.fraction ç”¨äº JVM å¼€é”€çš„æœ¬åœ°å†…å­˜ï¼Œä¾‹å¦‚æ ˆç©ºé—´ã€åƒåœ¾å›æ”¶ç©ºé—´ç­‰ã€‚Flink è®¡ç®— JVM max direct memory size å‚æ•°æ—¶ä¸ä¼šè®¡ç®—åœ¨å†…ã€‚ å‚è€ƒï¼š https://nightlies.apache.org/flink/flink-docs-release-1.13/zh/docs/deployment/memory/mem_setup_tm/\n",
      "summary": "Java å †å¤–å†…å­˜ import sun.nio.ch.DirectBuffer; import java.nio.ByteBuffer; import java.util.concurrent.TimeUnit; public class OutHeapMem { public static void main(String[] args) throws Exception { // åˆ†é… 1G ç›´æ¥å†…å­˜ ByteBuffer byteBuffer = ByteBuffer.allocateDirect(1024 * 1024 * 1024); TimeUnit.SECONDS.sleep(30); System.out.println(\u0026quot;clean start\u0026quot;); // æ¸…é™¤ç›´æ¥å†…å­˜ ((DirectBuffer) byteBuffer).cleaner().clean(); System.out.println(\u0026quot;clean finished\u0026quot;); TimeUnit.SECONDS.sleep(30); } } # åˆ†é…å†…å­˜ Memory used total max usage heap 21M 165M 3641M 0.59% ps_eden_space 3M 64M 1344M 0.29% ps_survivor_space 0K 10752K 10752K 0.00% ps_old_gen 17M 91M 2731M 0."
    },{
      "title": "Flinkç±»åŠ è½½æœºåˆ¶",
      "url": "https://qiref.github.io/post/2023/03/24/flink%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/",
      "content": "flink ç±»åŠ è½½é…ç½®è¯´æ˜ Flink ä½œä¸ºåŸºäº JVM çš„æ¡†æ¶ï¼Œåœ¨ flink-conf.yaml ä¸­æä¾›äº†æ§åˆ¶ç±»åŠ è½½ç­–ç•¥çš„å‚æ•° classloader.resolve-orderï¼Œå¯é€‰é¡¹æœ‰ child-firstï¼ˆé»˜è®¤ï¼‰å’Œ parent-firstã€‚\nKey Default Type Description classloader.resolve-order \u0026ldquo;child-first\u0026rdquo; String Defines the class resolution strategy when loading classes from user code, meaning whether to first check the user code jar (\u0026ldquo;child-first\u0026rdquo;) or the application classpath (\u0026ldquo;parent-first\u0026rdquo;). The default settings indicate to load classes first from the user code jar, which means that user code jars can include and load different dependencies than Flink uses (transitively). classloader.parent-first-patterns.default \u0026ldquo;java.\u0026rdquo;;\n\u0026ldquo;scala.\u0026rdquo;;\n\u0026ldquo;org.apache.flink.\u0026rdquo;;\n\u0026ldquo;com.esotericsoftware.kryo\u0026rdquo;;\n\u0026ldquo;org.apache.hadoop.\u0026rdquo;;\n\u0026ldquo;javax.annotation.\u0026rdquo;;\n\u0026ldquo;org.xml\u0026rdquo;;\n\u0026ldquo;javax.xml\u0026rdquo;;\n\u0026ldquo;org.apache.xerces\u0026rdquo;;\n\u0026ldquo;org.w3c\u0026rdquo;;\n\u0026ldquo;org.rocksdb.\u0026rdquo;;\n\u0026ldquo;org.slf4j\u0026rdquo;;\n\u0026ldquo;org.apache.log4j\u0026rdquo;;\n\u0026ldquo;org.apache.logging\u0026rdquo;;\n\u0026ldquo;org.apache.commons.logging\u0026rdquo;;\n\u0026ldquo;ch.qos.logback\u0026rdquo; List A (semicolon-separated) list of patterns that specifies which classes should always be resolved through the parent ClassLoader first. A pattern is a simple prefix that is checked against the fully qualified class name. This setting should generally not be modified. To add another pattern we recommend to use \u0026ldquo;classloader.parent-first-patterns.additional\u0026rdquo; instead. classloader.parent-first-patterns.additional List A (semicolon-separated) list of patterns that specifies which classes should always be resolved through the parent ClassLoader first. A pattern is a simple prefix that is checked against the fully qualified class name. These patterns are appended to \u0026ldquo;classloader.parent-first-patterns.default\u0026rdquo;. classloader.fail-on-metaspace-oom-error true Boolean Fail Flink JVM processes if \u0026lsquo;OutOfMemoryError: Metaspace\u0026rsquo; is thrown while trying to load a user code class. classloader.check-leaked-classloader true Boolean Fails attempts at loading classes if the user classloader of a job is used after it has terminated. This is usually caused by the classloader being leaked by lingering threads or misbehaving libraries, which may also result in the classloader being used by other jobs. This check should only be disabled if such a leak prevents further jobs from running. parent-first ç±»åŠ è½½ç­–ç•¥ ParentFirstClassLoader å’Œ ChildFirstClassLoader ç±»çš„çˆ¶ç±»å‡ä¸º FlinkUserCodeClassLoader æŠ½è±¡ç±»ï¼š\n/** * This class loader accepts a custom handler if an exception occurs in {@link #loadClass(String, * boolean)}. */ public abstract class FlinkUserCodeClassLoader extends URLClassLoader { public static final Consumer\u0026lt;Throwable\u0026gt; NOOP_EXCEPTION_HANDLER = classLoadingException -\u0026gt; {}; private final Consumer\u0026lt;Throwable\u0026gt; classLoadingExceptionHandler; protected FlinkUserCodeClassLoader(URL[] urls, ClassLoader parent) { this(urls, parent, NOOP_EXCEPTION_HANDLER); } protected FlinkUserCodeClassLoader( URL[] urls, ClassLoader parent, Consumer\u0026lt;Throwable\u0026gt; classLoadingExceptionHandler) { super(urls, parent); this.classLoadingExceptionHandler = classLoadingExceptionHandler; } @Override public final Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { try { synchronized (getClassLoadingLock(name)) { return loadClassWithoutExceptionHandling(name, resolve); } } catch (Throwable classLoadingException) { classLoadingExceptionHandler.accept(classLoadingException); throw classLoadingException; } } /** * Same as {@link #loadClass(String, boolean)} but without exception handling. * * \u0026lt;p\u0026gt;Extending concrete class loaders should implement this instead of {@link * #loadClass(String, boolean)}. */ protected Class\u0026lt;?\u0026gt; loadClassWithoutExceptionHandling(String name, boolean resolve) throws ClassNotFoundException { return super.loadClass(name, resolve); } } FlinkUserCodeClassLoader ç»§æ‰¿è‡ª URLClassLoaderã€‚å› ä¸º Flink App çš„ç”¨æˆ·ä»£ç åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šï¼Œæ‰€ä»¥é€šè¿‡ URL åœ¨ JAR åŒ…å†…å¯»æ‰¾å…¨é™å®šåå¯¹åº”çš„ç±»æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚è€Œ ParentFirstClassLoader ä»…ä»…æ˜¯ä¸€ä¸ªç»§æ‰¿ FlinkUserCodeClassLoader çš„ç©ºç±»è€Œå·²ã€‚\n/** * Regular URLClassLoader that first loads from the parent and only after that from the URLs. */ public static class ParentFirstClassLoader extends FlinkUserCodeClassLoader { ParentFirstClassLoader( URL[] urls, ClassLoader parent, Consumer\u0026lt;Throwable\u0026gt; classLoadingExceptionHandler) { super(urls, parent, classLoadingExceptionHandler); } static { ClassLoader.registerAsParallelCapable(); } } è¿™æ ·å°±ç›¸å½“äº ParentFirstClassLoader ç›´æ¥è°ƒç”¨äº†çˆ¶åŠ è½½å™¨çš„ loadClass() æ–¹æ³•ã€‚ä¹‹å‰å·²ç»è®²è¿‡ï¼ŒJVM ä¸­ç±»åŠ è½½å™¨çš„å±‚æ¬¡å…³ç³»å’Œé»˜è®¤ loadClass() æ–¹æ³•çš„é€»è¾‘ç”±åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆparents delegation modelï¼‰æ¥ä½“ç°ï¼š\nå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½ä¸€ä¸ªç±»ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠåŠ è½½çš„è¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å®Œæˆï¼Œæ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€’ç»™æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚åªæœ‰å½“çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½åˆ°è¿™ä¸ªç±»æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±åŠ è½½ã€‚ åŒäº²å§”æ´¾æ¨¡å‹\nå¯è§ï¼ŒFlink çš„ parent-first ç±»åŠ è½½ç­–ç•¥å°±æ˜¯ç…§æ¬åŒäº²å§”æ´¾æ¨¡å‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ä»£ç çš„ç±»åŠ è½½å™¨æ˜¯ Custom ClassLoaderï¼ŒFlink æ¡†æ¶æœ¬èº«çš„ç±»åŠ è½½å™¨æ˜¯ Application ClassLoaderã€‚ç”¨æˆ·ä»£ç ä¸­çš„ç±»å…ˆç”± Flink æ¡†æ¶çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå†ç”±ç”¨æˆ·ä»£ç çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚ä½†æ˜¯ï¼ŒFlink é»˜è®¤å¹¶ä¸é‡‡ç”¨ parent-first ç­–ç•¥ï¼Œè€Œæ˜¯é‡‡ç”¨ child-first ç­–ç•¥ã€‚\nchild-first ç±»åŠ è½½ç­–ç•¥ åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„å°±æ˜¯ç±»åŠ è½½å™¨çš„å±‚æ¬¡å…³ç³»ä¿è¯äº†è¢«åŠ è½½ç±»çš„å±‚æ¬¡å…³ç³»ï¼Œä»è€Œä¿è¯äº† Java è¿è¡Œç¯å¢ƒçš„å®‰å…¨æ€§ã€‚ä½†æ˜¯åœ¨ Flink App è¿™ç§ä¾èµ–çº·ç¹å¤æ‚çš„ç¯å¢ƒä¸­ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œç¨‹åºä¸­å¼•å…¥çš„ Flink-Cassandra Connector æ€»æ˜¯ä¾èµ–äºå›ºå®šçš„ Cassandra ç‰ˆæœ¬ï¼Œç”¨æˆ·ä»£ç ä¸­ä¸ºäº†å…¼å®¹å®é™…ä½¿ç”¨çš„ Cassandra ç‰ˆæœ¬ï¼Œä¼šå¼•å…¥ä¸€ä¸ªæ›´ä½æˆ–æ›´é«˜çš„ä¾èµ–ã€‚è€ŒåŒä¸€ä¸ªç»„ä»¶ä¸åŒç‰ˆæœ¬çš„ç±»å®šä¹‰æœ‰å¯èƒ½ä¼šä¸åŒï¼ˆå³ä½¿ç±»çš„å…¨é™å®šåæ˜¯ç›¸åŒçš„ï¼‰ï¼Œå¦‚æœä»ç„¶ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±ä¼šå› ä¸º Flink æ¡†æ¶æŒ‡å®šç‰ˆæœ¬çš„ç±»å…ˆåŠ è½½ï¼Œè€Œå‡ºç°è«åå…¶å¦™çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚NoSuchMethodErrorã€IllegalAccessError ç­‰ã€‚\né‰´äºæ­¤ï¼ŒFlink å®ç°äº† ChildFirstClassLoader ç±»åŠ è½½å™¨å¹¶ä½œä¸ºé»˜è®¤ç­–ç•¥ã€‚å®ƒæ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä½¿å¾—ç”¨æˆ·ä»£ç çš„ç±»å…ˆåŠ è½½ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­å°†è¿™ä¸ªæ“ä½œç§°ä¸º\u0026quot;Inverted Class Loading\u0026quot;ã€‚\npublic final class ChildFirstClassLoader extends FlinkUserCodeClassLoader { /** * The classes that should always go through the parent ClassLoader. This is relevant for Flink * classes, for example, to avoid loading Flink classes that cross the user-code/system-code * barrier in the user-code ClassLoader. */ private final String[] alwaysParentFirstPatterns; public ChildFirstClassLoader( URL[] urls, ClassLoader parent, String[] alwaysParentFirstPatterns, Consumer\u0026lt;Throwable\u0026gt; classLoadingExceptionHandler) { super(urls, parent, classLoadingExceptionHandler); this.alwaysParentFirstPatterns = alwaysParentFirstPatterns; } @Override protected Class\u0026lt;?\u0026gt; loadClassWithoutExceptionHandling(String name, boolean resolve) throws ClassNotFoundException { // First, check if the class has already been loaded Class\u0026lt;?\u0026gt; c = findLoadedClass(name); if (c == null) { // check whether the class should go parent-first for (String alwaysParentFirstPattern : alwaysParentFirstPatterns) { if (name.startsWith(alwaysParentFirstPattern)) { return super.loadClassWithoutExceptionHandling(name, resolve); } } try { // check the URLs c = findClass(name); } catch (ClassNotFoundException e) { // let URLClassLoader do it, which will eventually call the parent c = super.loadClassWithoutExceptionHandling(name, resolve); } } else if (resolve) { resolveClass(c); } return c; } æ ¸å¿ƒé€»è¾‘åœ¨ loadClassWithoutExceptionHandling() æ–¹æ³•ä¸­ï¼š\nè°ƒç”¨ findLoadedClass() æ–¹æ³•æ£€æŸ¥å…¨é™å®šå name å¯¹åº”çš„ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œè‹¥æ²¡æœ‰åŠ è½½è¿‡ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ æ£€æŸ¥è¦åŠ è½½çš„ç±»æ˜¯å¦ä»¥ alwaysParentFirstPatterns é›†åˆä¸­çš„å‰ç¼€å¼€å¤´ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨çˆ¶ç±»çš„å¯¹åº”æ–¹æ³•ï¼Œä»¥ parent-first çš„æ–¹å¼æ¥åŠ è½½å®ƒã€‚alwaysParentFirstPatterns é›†åˆä¸­çš„è¿™äº›ç±»éƒ½æ˜¯ Javaã€Flink ç­‰ç»„ä»¶çš„åŸºç¡€ï¼Œä¸èƒ½è¢«ç”¨æˆ·ä»£ç è¦†ç›–ã€‚å®ƒç”±ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°æ¥æŒ‡å®šï¼š classloader.parent-first-patterns.defaultï¼Œä¸å»ºè®®ä¿®æ”¹ï¼Œå›ºå®šä¸ºä»¥ä¸‹è¿™äº›å€¼ï¼š\njava.; scala.; org.apache.flink.; com.esotericsoftware.kryo; org.apache.hadoop.; javax.annotation.; org.slf4j; org.apache.log4j; org.apache.logging; org.apache.commons.logging; ch.qos.logback; org.xml; javax.xml; org.apache.xerces; org.w3c classloader.parent-first-patterns.additionalï¼šé™¤äº†ä¸Šä¸€ä¸ªå‚æ•°æŒ‡å®šçš„ç±»ä¹‹å¤–ï¼Œç”¨æˆ·å¦‚æœæœ‰å…¶ä»–ç±»ä»¥ child-first æ¨¡å¼ä¼šå‘ç”Ÿå†²çªï¼Œè€Œå¸Œæœ›ä»¥åŒäº²å§”æ´¾æ¨¡å‹æ¥åŠ è½½çš„è¯ï¼Œå¯ä»¥é¢å¤–æŒ‡å®šï¼ˆåˆ†å·åˆ†éš”ï¼‰ã€‚\nå¦‚æœç±»ä¸ç¬¦åˆ alwaysParentFirstPatterns é›†åˆçš„æ¡ä»¶ï¼Œå°±è°ƒç”¨ findClass() æ–¹æ³•åœ¨ç”¨æˆ·ä»£ç ä¸­æŸ¥æ‰¾å¹¶è·å–è¯¥ç±»çš„å®šä¹‰ï¼ˆè¯¥æ–¹æ³•åœ¨ URLClassLoader ä¸­æœ‰é»˜è®¤å®ç°ï¼‰ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œå† fallback åˆ°çˆ¶åŠ è½½å™¨æ¥åŠ è½½ã€‚ æœ€åï¼Œè‹¥ resolve å‚æ•°ä¸º trueï¼Œå°±è°ƒç”¨ resolveClass() æ–¹æ³•é“¾æ¥è¯¥ç±»ï¼Œæœ€åè¿”å›å¯¹åº”çš„ Class å¯¹è±¡ã€‚ å‚è€ƒï¼š\nåŒäº²å§”æ´¾æ¨¡å‹ä¸ Flink çš„ç±»åŠ è½½ç­–ç•¥-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)\nè°ƒè¯•ç±»åŠ è½½ | Apache Flink\n",
      "summary": "flink ç±»åŠ è½½é…ç½®è¯´æ˜ Flink ä½œä¸ºåŸºäº JVM çš„æ¡†æ¶ï¼Œåœ¨ flink-conf.yaml ä¸­æä¾›äº†æ§åˆ¶ç±»åŠ è½½ç­–ç•¥çš„å‚æ•° classloader.resolve-orderï¼Œå¯é€‰é¡¹æœ‰ child-firstï¼ˆé»˜è®¤ï¼‰å’Œ parent-firstã€‚\nKey Default Type Description classloader.resolve-order \u0026ldquo;child-first\u0026rdquo; String Defines the class resolution strategy when loading classes from user code, meaning whether to first check the user code jar (\u0026ldquo;child-first\u0026rdquo;) or the application classpath (\u0026ldquo;parent-first\u0026rdquo;). The default settings indicate to load classes first from the user code jar, which means that user code jars can include and load different dependencies than Flink uses (transitively)."
    },{
      "title": "JavaåŒäº²å§”æ´¾",
      "url": "https://qiref.github.io/post/2023/03/24/java%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/",
      "content": "ç±»åŠ è½½å™¨ Javaè¯­è¨€ç³»ç»Ÿä¸­æ”¯æŒä»¥ä¸‹4ç§ç±»åŠ è½½å™¨ï¼š\nBootstrap ClassLoader å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½Javaæ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\\libä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰ï¼› Extension ClassLoader æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½ç›®å½•%JRE_HOME%\\lib\\extç›®å½•ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ï¼› Application ClassLoader åº”ç”¨ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨çš„classpathä¸‹çš„æ‰€æœ‰ç±»ï¼› User ClassLoader ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨,å¯åŠ è½½æŒ‡å®šè·¯å¾„çš„classæ–‡ä»¶ï¼› åŒäº²å§”æ´¾ ç±»åŠ è½½å™¨é‡‡ç”¨äº†åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå…¶å·¥ä½œåŸç†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚\nåŒäº²å§”æ´¾æ¨¡å¼çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ\nJava ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚æ¬¡å…³ç³»å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨å·²ç»åŠ è½½è¿‡ä¸€æ¬¡æ—¶ï¼Œæ²¡æœ‰å¿…è¦å­ç±»å†å»åŠ è½½ä¸€æ¬¡ã€‚ è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼ŒJava æ ¸å¿ƒ Api ç±»ä¸ä¼šè¢«éšæ„æ›¿æ¢ï¼Œæ ¸å¿ƒç±»æ°¸è¿œæ˜¯è¢«ä¸Šå±‚çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å®šä¹‰äº†ä¸€ä¸ª java.lang.String ç±»ï¼Œå®ƒä¼šä¼˜å…ˆå§”æ´¾ç»™ BootStrapClassLoader å»åŠ è½½ï¼ŒåŠ è½½å®Œäº†å°±ç›´æ¥è¿”å›äº†ã€‚ å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª java.lang.ExtStringï¼Œèƒ½è¢«åŠ è½½å—ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯ä¸èƒ½çš„ï¼Œå› ä¸º java.lang åŒ…æ˜¯æœ‰æƒé™æ§åˆ¶çš„ï¼Œè‡ªå®šä¹‰äº†è¿™ä¸ªåŒ…ï¼Œä¼šæŠ¥ä¸€ä¸ªé”™å¦‚ä¸‹ï¼š\njava.lang.SecurityException: Prohibited package name: java.lang æºç åˆ†æ protected Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // é¦–å…ˆï¼Œæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½äº†ï¼Œæœ€ç»ˆå®ç°æ˜¯ä¸€ä¸ª native æœ¬åœ°å®ç° Class\u0026lt;?\u0026gt; c = findLoadedClass(name); // å¦‚æœè¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œåˆ™å¼€å§‹åŠ è½½ if (c == null) { long t0 = System.nanoTime(); try { // é¦–å…ˆå¦‚æœçˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚Launcher ç±»é‡Œæåˆ°çš„ parent å°±åœ¨è¿™é‡Œä½¿ç”¨çš„ã€‚ if (parent != null) { c = parent.loadClass(name, false); } else { // å¦‚æœçˆ¶åŠ è½½å™¨ä¸ºç©ºï¼ˆæ¯”å¦‚ ExtClassLoaderï¼‰ï¼Œå°±ä½¿ç”¨ BootStrapClassloader æ¥åŠ è½½ c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { } // å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä½¿ç”¨ findClass ç±»æ¥åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå°±é‡å†™è¿™ä¸ªæ–¹æ³• if (c == null) { long t1 = System.nanoTime(); c = findClass(name); sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); } } if (resolve) { resolveClass(c); } return c; } } å¦‚ä½•ä¸»åŠ¨ç ´ååŒäº²å§”æ´¾æœºåˆ¶ åŒäº²å§”æ´¾è¿‡ç¨‹éƒ½æ˜¯åœ¨loadClassæ–¹æ³•ä¸­å®ç°çš„ï¼Œé‚£ä¹ˆæƒ³è¦ç ´åè¿™ç§æœºåˆ¶ï¼Œé‚£ä¹ˆå°±è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œé‡å†™å…¶ä¸­çš„loadClassæ–¹æ³•ï¼Œä½¿å…¶ä¸è¿›è¡ŒåŒäº²å§”æ´¾å³å¯ã€‚\nloadClassï¼ˆï¼‰ã€findClassï¼ˆï¼‰ã€defineClassï¼ˆï¼‰åŒºåˆ«\nClassLoaderä¸­å’Œç±»åŠ è½½æœ‰å…³çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå‰é¢æåˆ°äº†loadClassï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰findClasså’ŒdefineClassç­‰ï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\nloadClass() å°±æ˜¯ä¸»è¦è¿›è¡Œç±»åŠ è½½çš„æ–¹æ³•ï¼Œé»˜è®¤çš„åŒäº²å§”æ´¾æœºåˆ¶å°±å®ç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ findClass() æ ¹æ®åç§°æˆ–ä½ç½®åŠ è½½.classå­—èŠ‚ç  definclass() æŠŠå­—èŠ‚ç è½¬åŒ–ä¸ºClass è¿™é‡Œé¢éœ€è¦å±•å¼€è®²ä¸€ä¸‹loadClasså’ŒfindClassï¼Œæˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œå½“æˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨çš„æ—¶å€™ï¼Œå¹¶ä¸”åƒç ´ååŒäº²å§”æ´¾åŸåˆ™æ—¶ï¼Œæˆ‘ä»¬ä¼šé‡å†™loadClassæ–¹æ³•ã€‚\nè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¹¶éµå¾ªåŒäº²å§”æ´¾ å¦‚æœä½ æƒ³å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå¹¶ä¸”è¦éµå®ˆåŒäº²å§”æ´¾æ¨¡å‹ï¼Œé‚£ä¹ˆå¯ä»¥ç»§æ‰¿ClassLoaderï¼Œå¹¶ä¸”åœ¨findClassä¸­å®ç°ä½ è‡ªå·±çš„åŠ è½½é€»è¾‘å³å¯ã€‚\n",
      "summary": "ç±»åŠ è½½å™¨ Javaè¯­è¨€ç³»ç»Ÿä¸­æ”¯æŒä»¥ä¸‹4ç§ç±»åŠ è½½å™¨ï¼š\nBootstrap ClassLoader å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½Javaæ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\\libä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰ï¼› Extension ClassLoader æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½ç›®å½•%JRE_HOME%\\lib\\extç›®å½•ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ï¼› Application ClassLoader åº”ç”¨ç±»åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨çš„classpathä¸‹çš„æ‰€æœ‰ç±»ï¼› User ClassLoader ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨,å¯åŠ è½½æŒ‡å®šè·¯å¾„çš„classæ–‡ä»¶ï¼› åŒäº²å§”æ´¾ ç±»åŠ è½½å™¨é‡‡ç”¨äº†åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå…¶å·¥ä½œåŸç†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚\nåŒäº²å§”æ´¾æ¨¡å¼çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ\nJava ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚æ¬¡å…³ç³»å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨å·²ç»åŠ è½½è¿‡ä¸€æ¬¡æ—¶ï¼Œæ²¡æœ‰å¿…è¦å­ç±»å†å»åŠ è½½ä¸€æ¬¡ã€‚ è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼ŒJava æ ¸å¿ƒ Api ç±»ä¸ä¼šè¢«éšæ„æ›¿æ¢ï¼Œæ ¸å¿ƒç±»æ°¸è¿œæ˜¯è¢«ä¸Šå±‚çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å®šä¹‰äº†ä¸€ä¸ª java.lang.String ç±»ï¼Œå®ƒä¼šä¼˜å…ˆå§”æ´¾ç»™ BootStrapClassLoader å»åŠ è½½ï¼ŒåŠ è½½å®Œäº†å°±ç›´æ¥è¿”å›äº†ã€‚ å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª java.lang.ExtStringï¼Œèƒ½è¢«åŠ è½½å—ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯ä¸èƒ½çš„ï¼Œå› ä¸º java.lang åŒ…æ˜¯æœ‰æƒé™æ§åˆ¶çš„ï¼Œè‡ªå®šä¹‰äº†è¿™ä¸ªåŒ…ï¼Œä¼šæŠ¥ä¸€ä¸ªé”™å¦‚ä¸‹ï¼š\njava.lang.SecurityException: Prohibited package name: java.lang æºç åˆ†æ protected Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // é¦–å…ˆï¼Œæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½äº†ï¼Œæœ€ç»ˆå®ç°æ˜¯ä¸€ä¸ª native æœ¬åœ°å®ç° Class\u0026lt;?\u0026gt; c = findLoadedClass(name); // å¦‚æœè¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œåˆ™å¼€å§‹åŠ è½½ if (c == null) { long t0 = System.nanoTime(); try { // é¦–å…ˆå¦‚æœçˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚Launcher ç±»é‡Œæåˆ°çš„ parent å°±åœ¨è¿™é‡Œä½¿ç”¨çš„ã€‚ if (parent !"
    },{
      "title": "Goè¯­è¨€å•ä¾‹æ¨¡å¼",
      "url": "https://qiref.github.io/post/2023/03/24/go%E8%AF%AD%E8%A8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/",
      "content": "é”™è¯¯ç¤ºä¾‹ type singleton struct {} var instance *singleton func GetInstance() *singleton { if instance == nil { instance = \u0026amp;singleton{} // ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ } return instance } ä¸ä¼˜é›…ç¤ºä¾‹ func GetInstance() *singleton { mu.Lock() // å¦‚æœå®ä¾‹å­˜åœ¨æ²¡æœ‰å¿…è¦åŠ é” defer mu.Unlock() if instance == nil { instance = \u0026amp;singleton{} } return instance } åŠ é”å¯ä»¥ä¿è¯æ¯æ¬¡æ‹¿åˆ°ç›¸åŒå®ä¾‹ï¼Œä½†æ˜¯å¦‚æœå·²ç»å®ä¾‹åŒ–ï¼Œå†è°ƒç”¨å‡½æ•°ï¼Œä¾ç„¶æœ‰é”å­˜åœ¨ï¼Œæµªè´¹æ€§èƒ½ï¼Œä¸å¤Ÿä¼˜é›…ï¼›\nä¼˜é›…ç¤ºä¾‹ import ( \u0026quot;sync\u0026quot; ) type singleton struct {} var instance *singleton var once sync.Once func GetInstance() *singleton { once.Do(func() { instance = \u0026amp;singleton{} }) return instance } è¯¥å®ç°åˆ©ç”¨sync.Onceç±»å‹å»åŒæ­¥å¯¹GetInstance()çš„è®¿é—®ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬çš„ç±»å‹ä»…è¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚\n",
      "summary": "é”™è¯¯ç¤ºä¾‹ type singleton struct {} var instance *singleton func GetInstance() *singleton { if instance == nil { instance = \u0026amp;singleton{} // ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ } return instance } ä¸ä¼˜é›…ç¤ºä¾‹ func GetInstance() *singleton { mu.Lock() // å¦‚æœå®ä¾‹å­˜åœ¨æ²¡æœ‰å¿…è¦åŠ é” defer mu.Unlock() if instance == nil { instance = \u0026amp;singleton{} } return instance } åŠ é”å¯ä»¥ä¿è¯æ¯æ¬¡æ‹¿åˆ°ç›¸åŒå®ä¾‹ï¼Œä½†æ˜¯å¦‚æœå·²ç»å®ä¾‹åŒ–ï¼Œå†è°ƒç”¨å‡½æ•°ï¼Œä¾ç„¶æœ‰é”å­˜åœ¨ï¼Œæµªè´¹æ€§èƒ½ï¼Œä¸å¤Ÿä¼˜é›…ï¼›\nä¼˜é›…ç¤ºä¾‹ import ( \u0026quot;sync\u0026quot; ) type singleton struct {} var instance *singleton var once sync.Once func GetInstance() *singleton { once.Do(func() { instance = \u0026amp;singleton{} }) return instance } è¯¥å®ç°åˆ©ç”¨sync."
    },{
      "title": "Flinkåå‹",
      "url": "https://qiref.github.io/post/2023/03/23/flink%E5%8F%8D%E5%8E%8B/",
      "content": "ä»€ä¹ˆæ˜¯åå‹ å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ª Task å‘ç”ŸÂ åå‹è­¦å‘Šï¼ˆä¾‹å¦‚ï¼šÂ Highï¼‰ï¼Œæ„å‘³ç€å®ƒç”Ÿäº§æ•°æ®çš„é€Ÿç‡æ¯”ä¸‹æ¸¸ Task æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡è¦å¿«ã€‚ åœ¨å·¥ä½œæµä¸­æ•°æ®è®°å½•æ˜¯ä»ä¸Šæ¸¸å‘ä¸‹æ¸¸æµåŠ¨çš„ï¼ˆä¾‹å¦‚ï¼šä» Source åˆ° Sinkï¼‰ã€‚åå‹æ²¿ç€ç›¸åçš„æ–¹å‘ä¼ æ’­ï¼Œæ²¿ç€æ•°æ®æµå‘ä¸Šæ¸¸ä¼ æ’­ã€‚\nä»¥ä¸€ä¸ªç®€å•çš„Â Source -\u0026gt; SinkÂ Job ä¸ºä¾‹ã€‚å¦‚æœçœ‹åˆ°Â SourceÂ å‘ç”Ÿäº†è­¦å‘Šï¼Œæ„å‘³ç€Â SinkÂ æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡æ¯”Â SourceÂ ç”Ÿäº§æ•°æ®çš„é€Ÿç‡è¦æ…¢ã€‚Â SinkÂ æ­£åœ¨å‘ä¸Šæ¸¸çš„Â SourceÂ ç®—å­äº§ç”Ÿåå‹ã€‚\nTaskï¼ˆSubTaskï¼‰çš„æ¯ä¸ªå¹¶è¡Œå®ä¾‹éƒ½å¯ä»¥ç”¨ä¸‰ä¸ªä¸€ç»„çš„æŒ‡æ ‡è¯„ä»·ï¼š\nbackPressureTimeMsPerSecondï¼Œsubtask è¢«åå‹çš„æ—¶é—´ idleTimeMsPerSecondï¼Œsubtask ç­‰å¾…æŸç±»å¤„ç†çš„æ—¶é—´ busyTimeMsPerSecondï¼Œsubtask å®é™…å·¥ä½œæ—¶é—´ åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡ç›¸åŠ éƒ½çº¦ç­‰äº1000msã€‚ æŒ‡æ ‡å€¼è¯´æ˜ï¼š\nOK: 0 \u0026lt;= æ¯”ä¾‹ \u0026lt;= 0.10 LOW: 0.10 \u0026lt; æ¯”ä¾‹ \u0026lt;= 0.5 HIGH: 0.5 \u0026lt; æ¯”ä¾‹ \u0026lt;= 1 åå‹é—®é¢˜å®šä½ å¯ä»¥çœ‹å„ä¸ªoperatorçš„metricsçš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼šbuffers.outPoolUsageã€buffers.inPoolUsageã€buffers.inputFloatingBuffersUsageã€buffers.inputExclusiveBuffersUsageï¼›\næ¥æ”¶ç«¯å…±ç”¨ä¸€ä¸ªLocalBufferPoolï¼Œæ¥æ”¶ç«¯æ¯ä¸ªChannelåœ¨åˆå§‹åŒ–é˜¶æ®µéƒ½ä¼šåˆ†é…å›ºå®šæ•°é‡çš„Buffer(Exclusive Buffer)ã€‚å¦‚æœæŸä¸€æ—¶åˆ»æ¥æ”¶ç«¯æ¥å—åˆ°çš„æ•°é‡å¤ªå¤šï¼ŒExclusive Bufferå°±ä¼šè€—å°½ï¼Œæ­¤æ—¶å°±ä¼šå‘BufferPoolç”³è¯·å‰©ä½™çš„Floating Bufferï¼ˆé™¤äº†Exclusive Bufferï¼Œå…¶ä»–çš„éƒ½æ˜¯Floating Buffer,å¤‡ç”¨Bufferï¼‰ï¼›inPoolUsage = floatingBuffersUsage + exclusiveBuffersUsage\nè‹¥ inPoolUsage ä½ï¼Œè€Œ outPoolUsage ä½ï¼Œåˆ™è¯´æ˜å®Œå…¨æ²¡æœ‰èƒŒå‹ç°è±¡ã€‚ è‹¥ inPoolUsage ä½ï¼Œè€Œ outPoolUsage é«˜ï¼Œåˆ™è¯´æ˜å¤„äºä¸´æ—¶çŠ¶æ€ï¼Œå¯èƒ½æ˜¯èƒŒå‹åˆšå¼€å§‹ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆšç»“æŸï¼Œéœ€è¦å†è§‚å¯Ÿã€‚ è‹¥ inPoolUsage é«˜ï¼Œè€Œ outPoolUsage ä½ï¼Œé‚£ä¹ˆé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªç®—å­å°±æ˜¯èƒŒå‹çš„æ ¹æºäº†ã€‚ è‹¥ inPoolUsage é«˜ï¼Œè€Œ outPoolUsage é«˜ï¼Œåˆ™è¯´æ˜è¿™ä¸ªç®—å­æ˜¯è¢«å…¶ä»–ä¸‹æ¸¸ç®—å­åå‹è€Œæ¥çš„ï¼Œå¹¶ä¸æ˜¯å…ƒå‡¶ã€‚ åœ¨åå‹å®šä½è¿‡ç¨‹ä¸­ï¼Œå»ºè®®å…³é—­ Operator Chaining ä¼˜åŒ–ï¼Œè¿™æ ·æ‰€æœ‰çš„ç®—å­å¯ä»¥å•ç‹¬æ‹†åˆ†å‡ºæ¥ï¼Œä¸ä¼šç›¸äº’å¹²æ‰°ï¼š\npipeline.operator-chaining: false å‚è€ƒ ç›‘æ§åå‹ | Apache Flink\n",
      "summary": "ä»€ä¹ˆæ˜¯åå‹ å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ª Task å‘ç”ŸÂ åå‹è­¦å‘Šï¼ˆä¾‹å¦‚ï¼šÂ Highï¼‰ï¼Œæ„å‘³ç€å®ƒç”Ÿäº§æ•°æ®çš„é€Ÿç‡æ¯”ä¸‹æ¸¸ Task æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡è¦å¿«ã€‚ åœ¨å·¥ä½œæµä¸­æ•°æ®è®°å½•æ˜¯ä»ä¸Šæ¸¸å‘ä¸‹æ¸¸æµåŠ¨çš„ï¼ˆä¾‹å¦‚ï¼šä» Source åˆ° Sinkï¼‰ã€‚åå‹æ²¿ç€ç›¸åçš„æ–¹å‘ä¼ æ’­ï¼Œæ²¿ç€æ•°æ®æµå‘ä¸Šæ¸¸ä¼ æ’­ã€‚\nä»¥ä¸€ä¸ªç®€å•çš„Â Source -\u0026gt; SinkÂ Job ä¸ºä¾‹ã€‚å¦‚æœçœ‹åˆ°Â SourceÂ å‘ç”Ÿäº†è­¦å‘Šï¼Œæ„å‘³ç€Â SinkÂ æ¶ˆè´¹æ•°æ®çš„é€Ÿç‡æ¯”Â SourceÂ ç”Ÿäº§æ•°æ®çš„é€Ÿç‡è¦æ…¢ã€‚Â SinkÂ æ­£åœ¨å‘ä¸Šæ¸¸çš„Â SourceÂ ç®—å­äº§ç”Ÿåå‹ã€‚\nTaskï¼ˆSubTaskï¼‰çš„æ¯ä¸ªå¹¶è¡Œå®ä¾‹éƒ½å¯ä»¥ç”¨ä¸‰ä¸ªä¸€ç»„çš„æŒ‡æ ‡è¯„ä»·ï¼š\nbackPressureTimeMsPerSecondï¼Œsubtask è¢«åå‹çš„æ—¶é—´ idleTimeMsPerSecondï¼Œsubtask ç­‰å¾…æŸç±»å¤„ç†çš„æ—¶é—´ busyTimeMsPerSecondï¼Œsubtask å®é™…å·¥ä½œæ—¶é—´ åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡ç›¸åŠ éƒ½çº¦ç­‰äº1000msã€‚ æŒ‡æ ‡å€¼è¯´æ˜ï¼š\nOK: 0 \u0026lt;= æ¯”ä¾‹ \u0026lt;= 0.10 LOW: 0.10 \u0026lt; æ¯”ä¾‹ \u0026lt;= 0.5 HIGH: 0.5 \u0026lt; æ¯”ä¾‹ \u0026lt;= 1 åå‹é—®é¢˜å®šä½ å¯ä»¥çœ‹å„ä¸ªoperatorçš„metricsçš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼šbuffers.outPoolUsageã€buffers.inPoolUsageã€buffers.inputFloatingBuffersUsageã€buffers.inputExclusiveBuffersUsageï¼›\næ¥æ”¶ç«¯å…±ç”¨ä¸€ä¸ªLocalBufferPoolï¼Œæ¥æ”¶ç«¯æ¯ä¸ªChannelåœ¨åˆå§‹åŒ–é˜¶æ®µéƒ½ä¼šåˆ†é…å›ºå®šæ•°é‡çš„Buffer(Exclusive Buffer)ã€‚å¦‚æœæŸä¸€æ—¶åˆ»æ¥æ”¶ç«¯æ¥å—åˆ°çš„æ•°é‡å¤ªå¤šï¼ŒExclusive Bufferå°±ä¼šè€—å°½ï¼Œæ­¤æ—¶å°±ä¼šå‘BufferPoolç”³è¯·å‰©ä½™çš„Floating Bufferï¼ˆé™¤äº†Exclusive Bufferï¼Œå…¶ä»–çš„éƒ½æ˜¯Floating Buffer,å¤‡ç”¨Bufferï¼‰ï¼›inPoolUsage = floatingBuffersUsage + exclusiveBuffersUsage\nè‹¥ inPoolUsage ä½ï¼Œè€Œ outPoolUsage ä½ï¼Œåˆ™è¯´æ˜å®Œå…¨æ²¡æœ‰èƒŒå‹ç°è±¡ã€‚ è‹¥ inPoolUsage ä½ï¼Œè€Œ outPoolUsage é«˜ï¼Œåˆ™è¯´æ˜å¤„äºä¸´æ—¶çŠ¶æ€ï¼Œå¯èƒ½æ˜¯èƒŒå‹åˆšå¼€å§‹ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆšç»“æŸï¼Œéœ€è¦å†è§‚å¯Ÿã€‚ è‹¥ inPoolUsage é«˜ï¼Œè€Œ outPoolUsage ä½ï¼Œé‚£ä¹ˆé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªç®—å­å°±æ˜¯èƒŒå‹çš„æ ¹æºäº†ã€‚ è‹¥ inPoolUsage é«˜ï¼Œè€Œ outPoolUsage é«˜ï¼Œåˆ™è¯´æ˜è¿™ä¸ªç®—å­æ˜¯è¢«å…¶ä»–ä¸‹æ¸¸ç®—å­åå‹è€Œæ¥çš„ï¼Œå¹¶ä¸æ˜¯å…ƒå‡¶ã€‚ åœ¨åå‹å®šä½è¿‡ç¨‹ä¸­ï¼Œå»ºè®®å…³é—­ Operator Chaining ä¼˜åŒ–ï¼Œè¿™æ ·æ‰€æœ‰çš„ç®—å­å¯ä»¥å•ç‹¬æ‹†åˆ†å‡ºæ¥ï¼Œä¸ä¼šç›¸äº’å¹²æ‰°ï¼š"
    },{
      "title": "Arthasç«ç„°å›¾ä½¿ç”¨",
      "url": "https://qiref.github.io/post/2023/03/22/arthas%E7%81%AB%E7%84%B0%E5%9B%BE%E4%BD%BF%E7%94%A8/",
      "content": "arthas ç«ç„°å›¾ç›¸å…³å‘½ä»¤ arthas ä¸­ profiler å‘½ä»¤æ”¯æŒç”Ÿæˆåº”ç”¨çƒ­ç‚¹çš„ç«ç„°å›¾ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸æ–­çš„é‡‡æ ·ï¼Œç„¶åæŠŠæ”¶é›†åˆ°çš„é‡‡æ ·ç»“æœç”Ÿæˆç«ç„°å›¾ã€‚\nå¯åŠ¨arthasï¼š\njava -jar arthas-boot.jar å¼€å§‹æ”¶é›†ç«ç„°å›¾ï¼š\n[arthas@1]$ profiler start Profiling started [arthas@1]$ profiler status Profiling is running for 6 seconds [arthas@1]$ profiler status Profiling is running for 27 seconds [arthas@1]$ profiler getSamples 2 [arthas@1]$ profiler getSamples 4 [arthas@1]$ profiler stop --file /tmp/cpu-result-1.html OK profiler output file: /tmp/cpu-result-1.html å‘½ä»¤è¯´æ˜ï¼š\nprofiler start å¼€å¯ç«ç„°å›¾æ”¶é›†ï¼› profiler status æŸ¥çœ‹ç«ç„°å›¾æ”¶é›†çš„çŠ¶æ€ï¼Œä¼šæ˜¾ç¤ºå½“å‰å·²ç»é‡‡é›†å¤šé•¿æ—¶é—´ï¼› profiler getSamples è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡ï¼Œç†è®ºä¸Šï¼Œsample è¶Šå¤šï¼Œç»“æœè¶Šå‡†ç¡®ï¼› profiler stop --file /tmp/cpu-result-1.html åœæ­¢å½“å‰ç«ç„°å›¾æ”¶é›†ï¼Œä¼šè¾“å‡ºåˆ°æ–‡ä»¶ä¸­å»ï¼Œç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯ç«ç„°å›¾ï¼› å…³é”®å‚æ•°è¯´æ˜ event -e, \u0026ndash;event é»˜è®¤é‡‡é›† CPU ä¿¡æ¯ï¼Œå¯è®¾ï¼šcpu, alloc, lock, cache-misses etc\nå¦‚æœæƒ³é‡‡é›†å†…å­˜ä¿¡æ¯ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\nprofiler start --event alloc file -f, --file \u0026lt;value\u0026gt; è¾“å‡ºçš„æ–‡ä»¶ï¼Œä¸»è¦æ”¯æŒ html, jfr ä¸¤ç§æ ¼å¼ï¼›\nprofiler stop --file /tmp/cpu-result-1.html duration -d, --duration \u0026lt;value\u0026gt; æŒ‡å®šç»“æŸæ—¶é—´ï¼›\nprofiler æ‰§è¡Œ 30 ç§’è‡ªåŠ¨ç»“æŸï¼š\nprofiler start --duration 30 ç«ç„°å›¾åˆ†ææ–¹æ³• arthas ç«ç„°å›¾é¢œè‰²è¯´æ˜ï¼š\nç»¿è‰²ï¼š java ä»£ç  é»„è‰²ï¼š jvm c++ ä»£ç  çº¢è‰²ï¼š ç”¨æˆ·æ€ c ä»£ç  æ©™è‰²ï¼š å†…æ ¸æ€ c ä»£ç  è¿™é‡Œåˆ†æjavaè¿›ç¨‹ï¼Œä¸»è¦çœ‹ç»¿è‰²éƒ¨åˆ†ï¼›\nçºµè½´è¡¨ç¤ºå‡½æ•°è°ƒç”¨æ ˆï¼Œæ¯ä¸€å±‚æ˜¯ä¸€ä¸ªå‡½æ•°ï¼›\næ¨ªè½´è¡¨ç¤ºæŠ½æ ·æ•°ï¼Œæ¯ä¸€æ ¼çš„å®½åº¦è¶Šå®½ï¼Œè¡¨ç¤ºå®ƒè¢«æŠ½æ ·åˆ°çš„æ¬¡æ•°è¶Šå¤šï¼Œä¾§é¢ååº”æ‰§è¡Œæ—¶é—´è¶Šé•¿ï¼›ç«ç„°å›¾çš„æ¯ä¸€æ ¼ï¼Œé¼ æ ‡æ‚¬æµ®æ—¶ä¼šæ˜¾ç¤ºå®Œæ•´çš„å‡½æ•°åã€å æ®æ€»æŠ½æ ·æ¬¡æ•°çš„ç™¾åˆ†æ¯”ï¼Œä»¥æ­¤æ¥å¯¹æ¯”ä¸åŒå‡½æ•°çš„è€—æ—¶å·®åˆ«ï¼›\nCPU ç«ç„°å›¾ï¼Œèƒ½æ‰¾å‡ºcpuå ç”¨é«˜çš„é—®é¢˜å‡½æ•°ï¼Œåˆ†æä»£ç çƒ­è·¯å¾„ï¼› å†…å­˜ç«ç„°å›¾ï¼Œèƒ½æ‰¾åˆ°å†…å­˜å ç”¨é«˜çš„å¯¹è±¡ï¼Œç”³è¯·å†…å­˜å¤šçš„å‡½æ•°ï¼› å‚è€ƒï¼š\nhttps://arthas.aliyun.com/doc/profiler.html\n",
      "summary": "arthas ç«ç„°å›¾ç›¸å…³å‘½ä»¤ arthas ä¸­ profiler å‘½ä»¤æ”¯æŒç”Ÿæˆåº”ç”¨çƒ­ç‚¹çš„ç«ç„°å›¾ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸æ–­çš„é‡‡æ ·ï¼Œç„¶åæŠŠæ”¶é›†åˆ°çš„é‡‡æ ·ç»“æœç”Ÿæˆç«ç„°å›¾ã€‚\nå¯åŠ¨arthasï¼š\njava -jar arthas-boot.jar å¼€å§‹æ”¶é›†ç«ç„°å›¾ï¼š\n[arthas@1]$ profiler start Profiling started [arthas@1]$ profiler status Profiling is running for 6 seconds [arthas@1]$ profiler status Profiling is running for 27 seconds [arthas@1]$ profiler getSamples 2 [arthas@1]$ profiler getSamples 4 [arthas@1]$ profiler stop --file /tmp/cpu-result-1.html OK profiler output file: /tmp/cpu-result-1.html å‘½ä»¤è¯´æ˜ï¼š\nprofiler start å¼€å¯ç«ç„°å›¾æ”¶é›†ï¼› profiler status æŸ¥çœ‹ç«ç„°å›¾æ”¶é›†çš„çŠ¶æ€ï¼Œä¼šæ˜¾ç¤ºå½“å‰å·²ç»é‡‡é›†å¤šé•¿æ—¶é—´ï¼› profiler getSamples è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡ï¼Œç†è®ºä¸Šï¼Œsample è¶Šå¤šï¼Œç»“æœè¶Šå‡†ç¡®ï¼› profiler stop --file /tmp/cpu-result-1.html åœæ­¢å½“å‰ç«ç„°å›¾æ”¶é›†ï¼Œä¼šè¾“å‡ºåˆ°æ–‡ä»¶ä¸­å»ï¼Œç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯ç«ç„°å›¾ï¼› å…³é”®å‚æ•°è¯´æ˜ event -e, \u0026ndash;event é»˜è®¤é‡‡é›† CPU ä¿¡æ¯ï¼Œå¯è®¾ï¼šcpu, alloc, lock, cache-misses etc"
    },{
      "title": "Flink Appendæµã€Retractæµã€Upsertæµ",
      "url": "https://qiref.github.io/post/2022/03/13/flink-append%E6%B5%81retract%E6%B5%81upsert%E6%B5%81/",
      "content": "æ‘˜è¦ï¼š ä»‹ç» Flink ä¸­ Appendæµã€Retractæµã€Upsertæµçš„å«ä¹‰ã€‚\nAppendæµ Retractæµ Upsertæµ Appendæµ åœ¨ Append æµä¸­ï¼Œä»…é€šè¿‡ INSERT æ“ä½œä¿®æ”¹çš„åŠ¨æ€è¡¨ï¼Œå¯ä»¥é€šè¿‡è¾“å‡ºæ’å…¥çš„è¡Œè½¬æ¢ä¸ºæµã€‚\nRetractæµ retract æµåŒ…å«ä¸¤ç§ç±»å‹çš„ messageï¼š add messages å’Œ retract messages ã€‚\né€šè¿‡å°†INSERT æ“ä½œç¼–ç ä¸º add messageã€å°† DELETE æ“ä½œç¼–ç ä¸º retract messageã€å°† UPDATE æ“ä½œç¼–ç ä¸ºæ›´æ–°(å…ˆå‰)è¡Œçš„ retract message å’Œæ›´æ–°(æ–°)è¡Œçš„ add messageï¼Œå°†åŠ¨æ€è¡¨è½¬æ¢ä¸º retract æµã€‚\nOPERATOR ENCODE insert add update retract -\u0026gt; add delete retract Upsertæµ upsert æµåŒ…å«ä¸¤ç§ç±»å‹çš„ messageï¼š upsert messages å’Œdelete messagesã€‚\nè½¬æ¢ä¸º upsert æµçš„åŠ¨æ€è¡¨éœ€è¦(å¯èƒ½æ˜¯ç»„åˆçš„)å”¯ä¸€é”®ã€‚é€šè¿‡å°† INSERT å’Œ UPDATE æ“ä½œç¼–ç ä¸º upsert messageï¼Œå°† DELETE æ“ä½œç¼–ç ä¸º delete message ï¼Œå°†å…·æœ‰å”¯ä¸€é”®çš„åŠ¨æ€è¡¨è½¬æ¢ä¸ºæµã€‚æ¶ˆè´¹æµçš„ç®—å­éœ€è¦çŸ¥é“å”¯ä¸€é”®çš„å±æ€§ï¼Œä»¥ä¾¿æ­£ç¡®åœ°åº”ç”¨ messageã€‚ä¸ retract æµçš„ä¸»è¦åŒºåˆ«åœ¨äº UPDATE æ“ä½œæ˜¯ç”¨å•ä¸ª message ç¼–ç çš„ï¼Œå› æ­¤æ•ˆç‡æ›´é«˜ã€‚\nOPERATOR ENCODE insert upsert update upsert delete delete å°†åŠ¨æ€è¡¨è½¬ä¸ºdatastreamæ—¶ï¼Œä»…æ”¯æŒappend æµä¸retractæµã€‚\nå°†åŠ¨æ€è¡¨è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œæ”¯æŒAppendã€Retractä»¥åŠUpsertæ¨¡å¼\nhttps://nightlies.apache.org/flink/flink-docs-release-1.12/zh/dev/table/streaming/dynamic_tables.html\n",
      "summary": "æ‘˜è¦ï¼š ä»‹ç» Flink ä¸­ Appendæµã€Retractæµã€Upsertæµçš„å«ä¹‰ã€‚\nAppendæµ Retractæµ Upsertæµ Appendæµ åœ¨ Append æµä¸­ï¼Œä»…é€šè¿‡ INSERT æ“ä½œä¿®æ”¹çš„åŠ¨æ€è¡¨ï¼Œå¯ä»¥é€šè¿‡è¾“å‡ºæ’å…¥çš„è¡Œè½¬æ¢ä¸ºæµã€‚\nRetractæµ retract æµåŒ…å«ä¸¤ç§ç±»å‹çš„ messageï¼š add messages å’Œ retract messages ã€‚\né€šè¿‡å°†INSERT æ“ä½œç¼–ç ä¸º add messageã€å°† DELETE æ“ä½œç¼–ç ä¸º retract messageã€å°† UPDATE æ“ä½œç¼–ç ä¸ºæ›´æ–°(å…ˆå‰)è¡Œçš„ retract message å’Œæ›´æ–°(æ–°)è¡Œçš„ add messageï¼Œå°†åŠ¨æ€è¡¨è½¬æ¢ä¸º retract æµã€‚\nOPERATOR ENCODE insert add update retract -\u0026gt; add delete retract Upsertæµ upsert æµåŒ…å«ä¸¤ç§ç±»å‹çš„ messageï¼š upsert messages å’Œdelete messagesã€‚\nè½¬æ¢ä¸º upsert æµçš„åŠ¨æ€è¡¨éœ€è¦(å¯èƒ½æ˜¯ç»„åˆçš„)å”¯ä¸€é”®ã€‚é€šè¿‡å°† INSERT å’Œ UPDATE æ“ä½œç¼–ç ä¸º upsert messageï¼Œå°† DELETE æ“ä½œç¼–ç ä¸º delete message ï¼Œå°†å…·æœ‰å”¯ä¸€é”®çš„åŠ¨æ€è¡¨è½¬æ¢ä¸ºæµã€‚æ¶ˆè´¹æµçš„ç®—å­éœ€è¦çŸ¥é“å”¯ä¸€é”®çš„å±æ€§ï¼Œä»¥ä¾¿æ­£ç¡®åœ°åº”ç”¨ messageã€‚ä¸ retract æµçš„ä¸»è¦åŒºåˆ«åœ¨äº UPDATE æ“ä½œæ˜¯ç”¨å•ä¸ª message ç¼–ç çš„ï¼Œå› æ­¤æ•ˆç‡æ›´é«˜ã€‚"
    },{
      "title": "Flink Checkpointæœºåˆ¶",
      "url": "https://qiref.github.io/post/2022/03/04/flink-checkpoint%E6%9C%BA%E5%88%B6/",
      "content": "æ‘˜è¦ï¼š å¦‚æœæŠŠè¿è¡Œä¸­çš„ Flink ç¨‹åºæ¯”åšä¸€æ¡æ²³æµï¼ŒCheckpoint å°±æ˜¯ä¸€ä¸ªç›¸æœºï¼Œå®šæœŸåœ°å¯¹æ²³æµè¿›è¡Œæ‹ç…§ï¼Œè®°å½•æ²³æ°´çš„çŠ¶æ€ã€‚æœ¬æ–‡ä»¥è‡ªé¡¶å‘ä¸‹çš„è§†è§’ï¼Œä»ç†è®ºåˆ°å®ç°ï¼Œåˆ†æ Flink ä¸­çš„ Checkpoint æœºåˆ¶ï¼›\nç†è®ºåŸºç¡€ asynchronous barrier snapshotting ç®—æ³•æ­¥éª¤ ç®—æ³•åœ¨ Flink ä¸­çš„å®ç° Flink Checkpoint æ•´ä½“æµç¨‹ Flink Checkpoint Barrier Alignment Flink Checkpoint ä½¿ç”¨ Flink Job é‡å¯ç­–ç•¥ Flink Job å¼€å¯ Checkpoint ç†è®ºåŸºç¡€ asynchronous barrier snapshotting Flink Checkpoint æœºåˆ¶æ˜¯å¼‚æ­¥å±éšœå¿«ç…§ï¼ˆasynchronous barrier snapshotting, ABSï¼‰ç®—æ³•çš„ä¸€ç§å®ç°ï¼Œè€Œ ABS ç®—æ³•åŸºäº Chandy-Lamport çš„å˜ç§ï¼Œä½†æ•°æ®æ¨¡å‹æ˜¯è¿˜æ˜¯åŸºäº Chandy-Lamportï¼›\nåœ¨ flink ä¸­ï¼Œä½œä¸šç®—å­è¢«æŠ½è±¡ä¸º DAGï¼ŒèŠ‚ç‚¹ä¸º operatorï¼Œè¾¹æ˜¯æ¯ä¸€ä¸ª operator çš„ streamï¼ˆchannelï¼‰ï¼Œä¸ Chandy-Lamport çš„æ•°æ®æ¨¡å‹æ­£å¥½å»åˆï¼›\nABS ç®—æ³•æŠŠ Chandy-Lamport ä¸­çš„ marker æ¶ˆæ¯æ¢æˆäº† barrierï¼Œä½œç”¨æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯åˆ‡åˆ† snapshotï¼›\nABS ç®—æ³• ä¸­ asynchronous æ˜¯å¼‚æ­¥çš„æ„æ€ï¼Œå½“ç®—å­æ”¶é½ barrier å¹¶è§¦å‘å¿«ç…§ä¹‹åï¼Œä¸ä¼šç­‰å¾…å¿«ç…§æ•°æ®å…¨éƒ¨å†™å…¥çŠ¶æ€åç«¯ï¼Œè€Œæ˜¯ä¸€è¾¹åå°å†™å…¥ï¼Œä¸€è¾¹ç«‹åˆ»ç»§ç»­å¤„ç†æ•°æ®æµï¼Œå¹¶å°† barrier å‘é€åˆ°ä¸‹æ¸¸ï¼Œå®ç°äº†æœ€å°åŒ–å»¶è¿Ÿã€‚å½“ç„¶ï¼Œå¼•å…¥å¼‚æ­¥æ€§ä¹‹åï¼Œæ‰€æœ‰æœ‰çŠ¶æ€çš„ç®—å­éƒ½éœ€è¦ä¸ŠæŠ¥ ackï¼Œå¦åˆ™ JobManager å°±æ— æ³•ç¡®è®¤ä¸€æ¬¡ snapshot æ˜¯å¦å®Œæˆã€‚\nç®—æ³•æ­¥éª¤ Sourceç®—å­æ¥æ”¶åˆ°JobManageräº§ç”Ÿçš„å±éšœï¼Œç”Ÿæˆè‡ªå·±çŠ¶æ€çš„å¿«ç…§ï¼ˆå…¶ä¸­åŒ…å«æ•°æ®æºå¯¹åº”çš„offset/positionä¿¡æ¯ï¼‰ï¼Œå¹¶å°†å±éšœå¹¿æ’­ç»™ä¸‹æ¸¸æ‰€æœ‰æ•°æ®æµï¼› ä¸‹æ¸¸é Source çš„ç®—å­ä»å®ƒçš„æŸä¸ªè¾“å…¥æ•°æ®æµæ¥æ”¶åˆ°å±éšœåï¼Œä¼šé˜»å¡è¿™ä¸ªè¾“å…¥æµï¼Œç»§ç»­æ¥æ”¶å…¶ä»–è¾“å…¥æµï¼Œç›´åˆ°æ‰€æœ‰è¾“å…¥æµçš„å±éšœéƒ½åˆ°è¾¾ã€‚ä¸€æ—¦ç®—å­æ”¶é½äº†æ‰€æœ‰å±éšœï¼Œå®ƒå°±ä¼šç”Ÿæˆè‡ªå·±çŠ¶æ€çš„å¿«ç…§ï¼Œå¹¶ç»§ç»­å°†å±éšœå¹¿æ’­ç»™ä¸‹æ¸¸æ‰€æœ‰æ•°æ®æµï¼› Sinkç®—å­æ¥æ”¶åˆ°å±éšœä¹‹åä¼šå‘ JobManager ç¡®è®¤ï¼Œæ‰€æœ‰Sinkéƒ½ç¡®è®¤æ”¶åˆ°å±éšœæ ‡è®°ç€è¿™ä¸€å‘¨æœŸcheckpointè¿‡ç¨‹ç»“æŸï¼Œå¿«ç…§æˆåŠŸã€‚ å¦‚æœç®—å­åªæœ‰ä¸€ä¸ªè¾“å…¥æµçš„è¯ï¼Œé—®é¢˜å°±æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨æ”¶åˆ°å±éšœä¹‹åç«‹å³åšå¿«ç…§ã€‚ä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªè¾“å…¥æµï¼Œå°±å¿…é¡»è¦ç­‰å¾…æ”¶åˆ°æ‰€æœ‰å±éšœæ‰èƒ½åšå¿«ç…§ï¼Œä»¥é¿å…å°†æ£€æŸ¥ç‚¹ n ä¸æ£€æŸ¥ç‚¹ n + 1 çš„æ•°æ®æ··æ·†ã€‚è¿™ä¸ªç­‰å¾…çš„è¿‡ç¨‹å°±å«åšå¯¹é½ï¼ˆalignmentï¼‰ï¼Œè§ä¸‹å›¾ï¼›\nç®—æ³•åœ¨ Flink ä¸­çš„å®ç° åœ¨ Flink çš„ stream ä¸­ï¼Œæ¯ä¸€æ¬¡çš„ Checkpoint è¢« barrier åˆ†å‰²ï¼š\nå½“ç®—å­æ¥æ”¶åˆ°ä¸æ­¢ä¸€ä¸ª steam æ—¶ï¼Œbarrier åˆ°è¾¾ç®—å­çš„é¡ºåºä¼šä¸ä¸€è‡´ï¼Œæ­¤æ—¶ï¼Œç®—å­ä¼šåœæ­¢å¤„ç†æ–°çš„æ•°æ®ï¼Œç­‰åˆ°å‰©ä½™çš„ barrier åˆ°è¾¾ç®—å­åï¼Œæ‰å¼€å§‹è¿›è¡Œ Checkpointï¼Œè¿™å°±æ˜¯ Barrier Alignment ã€‚\nFlink Checkpoint æ•´ä½“æµç¨‹ Chekcpoint æ˜¯ç”± jobmanager ä¸­çš„ CheckpointCoordinator å‘èµ·çš„ï¼ŒCheckpointCoordinator æ˜¯ä¸€ä¸ªç±»ï¼ŒFlink ä¸­å…·ä½“æè¿°å¦‚ä¸‹ï¼š\n// The checkpoint coordinator coordinates the distributed snapshots of operators and state. // It triggers the checkpoint by sending the messages to the relevant tasks and // collects the checkpoint acknowledgements. CheckpointCoordinator ä¼šè°ƒåº¦task è¿›è¡Œ checkpointï¼Œå¹¶æ¥æ”¶æ¥è‡ª tasks çš„ ackï¼›\nç”¨äºä¿å­˜ Checkpoint state å’Œ meta çš„å®¹å™¨ç§°ä¸º state backendï¼ŒFlink ä¸­è‡ªå¸¦å‡ ç§ state backendï¼š\nMemoryStateBackend å†…å­˜å‹ï¼ˆé»˜è®¤ï¼‰ FsStateBackend æ–‡ä»¶ç³»ç»Ÿï¼Œæœ¬åœ°ã€hdfsã€cos RocksDBStateBackend æ•°æ®åº“RocksDBï¼Œå­˜å‚¨åœ¨TaskManagerçš„dataç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥åŒæ­¥åˆ°è¿œç¨‹ Flink Checkpoint Barrier Alignment åŸºäº Barrier Alignmentï¼ŒCheckpoint äº§ç”Ÿä¸¤ç§æ¨¡å¼ï¼šEXACTLY_ONCE AT_LEAST_ONCE ï¼›\nå½“ Barrier Alignment æ—¶ï¼Œå…ˆåˆ°æ¥çš„æ•°æ®è¿›è¡Œ bufferï¼Œå°±æ˜¯ EXACTLY_ONCEï¼Œå½“å…ˆåˆ°æ¥çš„æ•°æ®å…ˆè¿›è¡Œå¤„ç†æ—¶ï¼Œå°±æ˜¯ AT_LEAST_ONCE ã€‚\nä»Flink 1.11å¼€å§‹ï¼ŒCheckpoint å¯ä»¥æ˜¯éå¯¹é½çš„ã€‚ Unaligned checkpoints åŒ…å« In-flight æ•°æ®(ä¾‹å¦‚ï¼Œå­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„æ•°æ®)ä½œä¸º Checkpoint Stateçš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸ Checkpoint Barrier è·¨è¶Šè¿™äº›ç¼“å†²åŒºã€‚å› æ­¤ï¼ŒCheckpoint æ—¶é•¿å˜å¾—ä¸å½“å‰ååé‡æ— å…³ï¼Œå› ä¸º Checkpoint Barrier å®é™…ä¸Šå·²ç»ä¸å†åµŒå…¥åˆ°æ•°æ®æµå½“ä¸­ã€‚ ä½¿ç”¨ Unaligned checkpoints ä¹Ÿä¼šå¸¦æ¥æ–°çš„ä»£ä»·ï¼ŒState ä¸­ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·ä¼šå¢åŠ  State çš„è´Ÿæ‹…ï¼›\nå¦‚æœåˆ°ç®—å­èƒŒå‹æ˜¯ç”±äº Checkpoint å‘¨æœŸè¿‡é•¿ï¼ˆBarrier Alignmentï¼‰æ—¶ï¼Œæ­¤æ—¶å»ºè®®ä½¿ç”¨ Unaligned checkpointï¼›\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); // å¯ç”¨éå¯¹é½ Checkpoint env.getCheckpointConfig().enableUnalignedCheckpoints(); Flink Checkpoint ä½¿ç”¨ Flink Job é‡å¯ç­–ç•¥ åœ¨ä½œä¸šè¿è¡Œæ—¶ï¼Œç»å¸¸ä¼šç”±äºå„ç§ä¸ç¡®å®šå› ç´ å¯¼è‡´ä½œä¸šåœæ­¢ï¼Œç½‘ç»œï¼Œç£ç›˜ï¼Œå¤–éƒ¨ä¾èµ–ç­‰ç­‰ï¼ŒFlink å†…éƒ¨æä¾›å¤šç§ä½œä¸šé‡å¯çš„ç­–ç•¥æ¥å‡å°‘è¿ç»´æˆæœ¬ï¼ŒFlink ç¨‹åºè®¾ç½®é‡å¯ç­–ç•¥åï¼Œå½“ä½œä¸šåœæ­¢æ—¶ï¼ŒFlink å¯ä»¥é‡æ–°æ‹‰èµ·ä½œä¸šï¼Œå¸¸ç”¨çš„é‡å¯ç­–ç•¥å¦‚ä¸‹ï¼š\nStreamExecutionEnvironment executionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment(); // é»˜è®¤é‡å¯ç­–ç•¥ï¼Œæ²¡æœ‰é‡å¯ç­–ç•¥ executionEnvironment.setRestartStrategy(RestartStrategies.noRestart()); // é‡‡ç”¨é›†ç¾¤çš„é‡å¯ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰å…¶ä»–é‡å¯ç­–ç•¥ï¼Œé»˜è®¤é€‰æ‹©å›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ã€‚ executionEnvironment.setRestartStrategy(RestartStrategies.fallBackRestart()); // é‡‡ç”¨é›†ç¾¤çš„é‡å¯ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰å…¶ä»–é‡å¯ç­–ç•¥ï¼Œé»˜è®¤é€‰æ‹©å›ºå®šå»¶æ—¶é‡å¯ç­–ç•¥ã€‚ executionEnvironment.setRestartStrategy(RestartStrategies.fallBackRestart()); // å¦‚æœ20 S å†…ï¼Œæœ‰1æ¬¡é”™è¯¯ï¼Œåˆ™ç»ˆæ­¢ä½œä¸šï¼Œä¸æ»¡è¶³åˆ™ä¼šé‡å¯ä½œä¸šï¼Œé‡å¯æ—¶é—´é—´éš”ä¸º 5 S executionEnvironment.setRestartStrategy( RestartStrategies.failureRateRestart(1, Time.seconds(20), Time.seconds(5))); source å®šä¹‰äº†ä¸€ä¸ª Tuple3 çš„æ•°æ®æºï¼Œindex ä¸€ç›´è‡ªå¢ï¼Œåœ¨ map è¿‡ç¨‹ä¸­ï¼Œé‡åˆ° 100 æ—¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼› ä½œä¸šè¿è¡Œçš„ç»“æœæ˜¯ï¼Œå½“ index=100 æ—¶ï¼Œä½œä¸šå¤±è´¥ï¼Œç„¶åé‡å¯ï¼Œé‡æ–°å¼€å§‹è¿è¡Œï¼š\npublic class MapFunc { public static MapFunction\u0026lt;Tuple3\u0026lt;String, Integer, Long\u0026gt;, Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; getMapFunc( Logger logger) { return new MapFunction\u0026lt;Tuple3\u0026lt;String, Integer, Long\u0026gt;, Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt;() { @Override public Tuple2\u0026lt;String, Integer\u0026gt; map(Tuple3\u0026lt;String, Integer, Long\u0026gt; event) throws Exception { if (event.f1 % 100 == 0) { logger.error(\u0026quot;event.f1 more than 100. value : \u0026quot; + event.f1); throw new RuntimeException(\u0026quot;event.f1 more than 100.\u0026quot;); } return new Tuple2\u0026lt;\u0026gt;(event.f0, event.f1); } }; } } // è¿è¡Œä½œä¸š public class FixedDelayRestartJob { public static void main(String[] args) throws Exception { Logger logger = LoggerFactory.getLogger(FixedDelayRestartJob.class); StreamExecutionEnvironment executionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment(); executionEnvironment.setParallelism(1); // é‡å¯å°è¯•æ¬¡æ•° 2ï¼Œæ¯æ¬¡é‡å¯é—´éš” 5 S executionEnvironment.setRestartStrategy( RestartStrategies.fixedDelayRestart(2, Time.seconds(5))); // source DataStreamSource\u0026lt;Tuple3\u0026lt;String, Integer, Long\u0026gt;\u0026gt; source = executionEnvironment.addSource(SourceFunc.getSourceFunc(logger)); // map operator SingleOutputStreamOperator\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; operator = source.map(MapFunc.getMapFunc(logger)); // sink operator.print(); executionEnvironment.execute(\u0026quot;not-restart\u0026quot;); } } Flink Job å¼€å¯ Checkpoint åœ¨ç»™ Flink ä½œä¸šè®¾ç½®é‡å¯ç­–ç•¥åï¼Œä½œä¸šå¤±è´¥æ—¶ä¼šé‡æ–°è¿è¡Œï¼Œæ­¤æ—¶ï¼Œä½œä¸šæ˜¯ä»æœ€å¼€å§‹çš„ä½ç½®å¼€å§‹è¿è¡Œï¼Œæ¯æ¬¡é‡æ–°å¯åŠ¨åï¼Œä¸Šè¿°ç¤ºä¾‹ä¸­çš„ sum éƒ½ä¼šä» 0 å¼€å§‹ï¼›\nåœ¨çœŸå®åœºæ™¯ä¸‹ï¼Œé€šå¸¸ä¸éœ€è¦ä½œä¸šåˆé‡æ–°æŠŠå†å²æ•°æ®éƒ½è®¡ç®—ä¸€æ¬¡ï¼Œå› ä¸ºå¯èƒ½ä¼šé€ æˆæ•°æ®é‡å¤ï¼ŒFlink ä¸­å› æ­¤å¼•å…¥äº† Checkpoint æœºåˆ¶ï¼Œä½œä¸šå¯ä»¥åˆ©ç”¨ Checkpoint ä¿å­˜ sum çš„å€¼ï¼Œåœ¨å¤±è´¥çš„åœ°æ–¹é‡æ–°å¯åŠ¨ï¼Œæ­¤æ—¶ sum çš„å€¼ä¼šä» Checkpoint ä¸­è¯»å–ï¼Œå¹¶æŒç»­ç´¯åŠ ã€‚\n// é‡å¯å°è¯•æ¬¡æ•° 2ï¼Œæ¯æ¬¡é‡å¯é—´éš” 5 S executionEnvironment.setRestartStrategy(RestartStrategies.fixedDelayRestart(2, Time.seconds(5))); // æ¯10msè¿›è¡Œä¸€æ¬¡ Checkpoint executionEnvironment.enableCheckpointing(10); å®Œæ•´ä»£ç åœ°å€ï¼š https://github.com/ArchieYao/flink-learning/tree/main/hello-world\nå‚è€ƒï¼š\nhttps://nightlies.apache.org/flink/flink-docs-release-1.16/zh/docs/ops/state/checkpointing_under_backpressure/\n",
      "summary": "æ‘˜è¦ï¼š å¦‚æœæŠŠè¿è¡Œä¸­çš„ Flink ç¨‹åºæ¯”åšä¸€æ¡æ²³æµï¼ŒCheckpoint å°±æ˜¯ä¸€ä¸ªç›¸æœºï¼Œå®šæœŸåœ°å¯¹æ²³æµè¿›è¡Œæ‹ç…§ï¼Œè®°å½•æ²³æ°´çš„çŠ¶æ€ã€‚æœ¬æ–‡ä»¥è‡ªé¡¶å‘ä¸‹çš„è§†è§’ï¼Œä»ç†è®ºåˆ°å®ç°ï¼Œåˆ†æ Flink ä¸­çš„ Checkpoint æœºåˆ¶ï¼›\nç†è®ºåŸºç¡€ asynchronous barrier snapshotting ç®—æ³•æ­¥éª¤ ç®—æ³•åœ¨ Flink ä¸­çš„å®ç° Flink Checkpoint æ•´ä½“æµç¨‹ Flink Checkpoint Barrier Alignment Flink Checkpoint ä½¿ç”¨ Flink Job é‡å¯ç­–ç•¥ Flink Job å¼€å¯ Checkpoint ç†è®ºåŸºç¡€ asynchronous barrier snapshotting Flink Checkpoint æœºåˆ¶æ˜¯å¼‚æ­¥å±éšœå¿«ç…§ï¼ˆasynchronous barrier snapshotting, ABSï¼‰ç®—æ³•çš„ä¸€ç§å®ç°ï¼Œè€Œ ABS ç®—æ³•åŸºäº Chandy-Lamport çš„å˜ç§ï¼Œä½†æ•°æ®æ¨¡å‹æ˜¯è¿˜æ˜¯åŸºäº Chandy-Lamportï¼›\nåœ¨ flink ä¸­ï¼Œä½œä¸šç®—å­è¢«æŠ½è±¡ä¸º DAGï¼ŒèŠ‚ç‚¹ä¸º operatorï¼Œè¾¹æ˜¯æ¯ä¸€ä¸ª operator çš„ streamï¼ˆchannelï¼‰ï¼Œä¸ Chandy-Lamport çš„æ•°æ®æ¨¡å‹æ­£å¥½å»åˆï¼›\nABS ç®—æ³•æŠŠ Chandy-Lamport ä¸­çš„ marker æ¶ˆæ¯æ¢æˆäº† barrierï¼Œä½œç”¨æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯åˆ‡åˆ† snapshotï¼›\nABS ç®—æ³• ä¸­ asynchronous æ˜¯å¼‚æ­¥çš„æ„æ€ï¼Œå½“ç®—å­æ”¶é½ barrier å¹¶è§¦å‘å¿«ç…§ä¹‹åï¼Œä¸ä¼šç­‰å¾…å¿«ç…§æ•°æ®å…¨éƒ¨å†™å…¥çŠ¶æ€åç«¯ï¼Œè€Œæ˜¯ä¸€è¾¹åå°å†™å…¥ï¼Œä¸€è¾¹ç«‹åˆ»ç»§ç»­å¤„ç†æ•°æ®æµï¼Œå¹¶å°† barrier å‘é€åˆ°ä¸‹æ¸¸ï¼Œå®ç°äº†æœ€å°åŒ–å»¶è¿Ÿã€‚å½“ç„¶ï¼Œå¼•å…¥å¼‚æ­¥æ€§ä¹‹åï¼Œæ‰€æœ‰æœ‰çŠ¶æ€çš„ç®—å­éƒ½éœ€è¦ä¸ŠæŠ¥ ackï¼Œå¦åˆ™ JobManager å°±æ— æ³•ç¡®è®¤ä¸€æ¬¡ snapshot æ˜¯å¦å®Œæˆã€‚"
    },{
      "title": "Flinkæ—¶é—´è¯­ä¹‰",
      "url": "https://qiref.github.io/post/2022/02/25/flink%E6%97%B6%E9%97%B4%E8%AF%AD%E4%B9%89/",
      "content": "æ‘˜è¦ï¼š ç†è§£æµå¤„ç†ä¸­çš„æ—¶é—´è¯­ä¹‰ï¼Œå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ã€‚\nå¦‚å›¾ï¼Œåœ¨æ— ç•Œæ•°æ®ä¸­ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œæ•°æ®ä¸€ç›´äº§ç”Ÿï¼Œä½†çœŸå®æƒ…å†µä¸­ï¼Œå¾€å¾€åœ¨ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®éƒ½æ˜¯ä¸å‡åŒ€çš„ï¼Œå¾€å¾€ä¼šå‡ºç°æ„å¤–çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨åœ°é“æ— ä¿¡å·çš„æƒ…å†µä¸‹ï¼Œæ•°æ®è™½ç„¶äº§ç”Ÿï¼Œä½†æ˜¯ä¼šæœ‰ä¸€æ®µæ—¶é—´å»¶è¿Ÿæ‰ä¼šåˆ°è¾¾æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¾‹å¦‚è™šçº¿æ¡†ä¸­çš„æ•°æ®ã€‚\nå¤„ç†æ—¶é—´ å¤„ç†æ—¶é—´å°±æ˜¯æµè®¡ç®—å¤„ç†ç¨‹åºçš„æœºå™¨æœ¬åœ°æ—¶é—´ï¼ŒæŒ‰ç…§è¿™ç§æ—¶é—´è¯­ä¹‰ï¼Œåœ¨æµè®¡ç®—çš„æ—¶é—´çª—å£ä¸­ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„æ•°æ®ä¼šæŒ‰è¿™æ ·åˆ†å¸ƒï¼š\nåŸºäºæœ¬åœ°æ—¶é—´ï¼Œåœ¨ç¬¬ä¸€åˆ†é’Ÿï¼Œæµå¤„ç†ç¨‹åºåªæ”¶åˆ°äº† 15ã€18 ä¸¤ä¸ªæ•°æ®ï¼Œåç»­æ•°æ®ç”±äºç½‘ç»œåŸå› ï¼Œåœ¨ 8:01:00 ä¹‹åæ‰åˆ°è¾¾æµè®¡ç®—ç¨‹åºï¼Œæ‰€ä»¥åç»­æ•°æ®åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£å†…ã€‚\näº‹ä»¶æ—¶é—´ äº‹ä»¶æ—¶é—´å°±æ˜¯äº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´é€šå¸¸ä¼šåœ¨æ•°æ®ä¸­ï¼ŒæŒ‰ç…§è¿™ç§æ—¶é—´è¯­ä¹‰ï¼Œåœ¨æµè®¡ç®—çš„æ—¶é—´çª—å£ä¸­ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„æ•°æ®ä¼šæŒ‰è¿™æ ·åˆ†å¸ƒï¼š\nåŸºäºäº‹ä»¶æ—¶é—´ï¼Œåœ¨ç¬¬ä¸€åˆ†é’Ÿï¼Œæ•°æ®åº”è¯¥æ˜¯ï¼š15 18 9 10 ï¼Œåœ¨ç¬¬äºŒåˆ†é’Ÿï¼Œæ•°æ®åº”è¯¥æ˜¯ï¼š11 ã€‚\nwatermark ç”±äºäº‹ä»¶æ—¶é—´çš„çª—å£å’Œäº‹ä»¶ç›¸å…³ï¼Œé‚£ä¹ˆå¦‚æœä¸‹ä¸€ä¸ªäº‹ä»¶è¿˜æœªåˆ°è¾¾ï¼Œæµè®¡ç®—ç¨‹åºæ˜¯å¦å°±æ— é™ç­‰å¾…å‘¢ï¼Ÿ\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œflink å¼•å…¥ watermark çš„æ¦‚å¿µï¼Œå‡å¦‚å®šä¹‰ watermark ä¸º Tï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€ä¸ªæ—¶é—´çª—å£ä¸­ï¼ŒT éƒ½ä¼šå•è°ƒé€’å¢ T \u0026lt; T1ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£ä¸­çš„äº‹ä»¶æ—¶é—´å¿…é¡»å¤§äº T1ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ—¶é—´çª—å£çš„æ•°æ®å°±æ˜¯ä»‹äº T-T1ã€‚\n",
      "summary": "æ‘˜è¦ï¼š ç†è§£æµå¤„ç†ä¸­çš„æ—¶é—´è¯­ä¹‰ï¼Œå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ã€‚\nå¦‚å›¾ï¼Œåœ¨æ— ç•Œæ•°æ®ä¸­ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œæ•°æ®ä¸€ç›´äº§ç”Ÿï¼Œä½†çœŸå®æƒ…å†µä¸­ï¼Œå¾€å¾€åœ¨ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®éƒ½æ˜¯ä¸å‡åŒ€çš„ï¼Œå¾€å¾€ä¼šå‡ºç°æ„å¤–çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨åœ°é“æ— ä¿¡å·çš„æƒ…å†µä¸‹ï¼Œæ•°æ®è™½ç„¶äº§ç”Ÿï¼Œä½†æ˜¯ä¼šæœ‰ä¸€æ®µæ—¶é—´å»¶è¿Ÿæ‰ä¼šåˆ°è¾¾æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¾‹å¦‚è™šçº¿æ¡†ä¸­çš„æ•°æ®ã€‚\nå¤„ç†æ—¶é—´ å¤„ç†æ—¶é—´å°±æ˜¯æµè®¡ç®—å¤„ç†ç¨‹åºçš„æœºå™¨æœ¬åœ°æ—¶é—´ï¼ŒæŒ‰ç…§è¿™ç§æ—¶é—´è¯­ä¹‰ï¼Œåœ¨æµè®¡ç®—çš„æ—¶é—´çª—å£ä¸­ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„æ•°æ®ä¼šæŒ‰è¿™æ ·åˆ†å¸ƒï¼š\nåŸºäºæœ¬åœ°æ—¶é—´ï¼Œåœ¨ç¬¬ä¸€åˆ†é’Ÿï¼Œæµå¤„ç†ç¨‹åºåªæ”¶åˆ°äº† 15ã€18 ä¸¤ä¸ªæ•°æ®ï¼Œåç»­æ•°æ®ç”±äºç½‘ç»œåŸå› ï¼Œåœ¨ 8:01:00 ä¹‹åæ‰åˆ°è¾¾æµè®¡ç®—ç¨‹åºï¼Œæ‰€ä»¥åç»­æ•°æ®åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£å†…ã€‚\näº‹ä»¶æ—¶é—´ äº‹ä»¶æ—¶é—´å°±æ˜¯äº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´é€šå¸¸ä¼šåœ¨æ•°æ®ä¸­ï¼ŒæŒ‰ç…§è¿™ç§æ—¶é—´è¯­ä¹‰ï¼Œåœ¨æµè®¡ç®—çš„æ—¶é—´çª—å£ä¸­ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„æ•°æ®ä¼šæŒ‰è¿™æ ·åˆ†å¸ƒï¼š\nåŸºäºäº‹ä»¶æ—¶é—´ï¼Œåœ¨ç¬¬ä¸€åˆ†é’Ÿï¼Œæ•°æ®åº”è¯¥æ˜¯ï¼š15 18 9 10 ï¼Œåœ¨ç¬¬äºŒåˆ†é’Ÿï¼Œæ•°æ®åº”è¯¥æ˜¯ï¼š11 ã€‚\nwatermark ç”±äºäº‹ä»¶æ—¶é—´çš„çª—å£å’Œäº‹ä»¶ç›¸å…³ï¼Œé‚£ä¹ˆå¦‚æœä¸‹ä¸€ä¸ªäº‹ä»¶è¿˜æœªåˆ°è¾¾ï¼Œæµè®¡ç®—ç¨‹åºæ˜¯å¦å°±æ— é™ç­‰å¾…å‘¢ï¼Ÿ\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œflink å¼•å…¥ watermark çš„æ¦‚å¿µï¼Œå‡å¦‚å®šä¹‰ watermark ä¸º Tï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€ä¸ªæ—¶é—´çª—å£ä¸­ï¼ŒT éƒ½ä¼šå•è°ƒé€’å¢ T \u0026lt; T1ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£ä¸­çš„äº‹ä»¶æ—¶é—´å¿…é¡»å¤§äº T1ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ—¶é—´çª—å£çš„æ•°æ®å°±æ˜¯ä»‹äº T-T1ã€‚"
    },{
      "title": "FlinkåŸºæœ¬æ¶æ„",
      "url": "https://qiref.github.io/post/2022/02/23/flink%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84/",
      "content": "æ‘˜è¦ï¼š é¸Ÿç° Flink æ¶æ„ï¼Œåˆ†æ Flink å†…éƒ¨ç»„ä»¶å·¥ä½œæœºåˆ¶ã€‚\nFlink æ¶æ„å›¾ æäº¤ä½œä¸šæµç¨‹ Flink é›†ç¾¤æ¨¡å¼ JobManager Taskmanager ç®—å­é“¾ Slot task æ•°æ®äº¤æ¢ç­–ç•¥ Flink æ¶æ„å›¾ ä¸€ä¸ªå®Œæ•´çš„ Flink é›†ç¾¤ç”±ä¸€ä¸ª Jobmanager å’Œè‹¥å¹²ä¸ª Taskmanager ç»„æˆï¼ŒJobmanager ä¸»è¦è´Ÿè´£è°ƒåº¦ task ä»¥åŠ åè°ƒ Checkpointã€‚Taskmanager åˆ™è´Ÿè´£å…·ä½“çš„ task æ‰§è¡Œï¼Œä»¥åŠæ•°æ®æµçš„äº¤æ¢ã€‚\nå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ JobManager å’Œ TaskManagerï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºstandalone é›†ç¾¤å¯åŠ¨ã€åœ¨å®¹å™¨ä¸­å¯åŠ¨ã€æˆ–è€…é€šè¿‡YARNç­‰èµ„æºæ¡†æ¶ç®¡ç†å¹¶å¯åŠ¨ã€‚TaskManager è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚\næäº¤ä½œä¸šæµç¨‹ ä»¥ä¸€ä¸ªä½œä¸šæäº¤çš„æµç¨‹æ¥è¯´æ˜ Flink å„ä¸ªç»„ä»¶æ˜¯å¦‚ä½•äº¤äº’å’Œå·¥ä½œçš„ï¼š\nFlink é›†ç¾¤æ¨¡å¼ Flink é›†ç¾¤ç±»å‹ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ï¼š\nFlink Session é›†ç¾¤\nè¿™ç§æ¨¡å¼ä¸‹ï¼Œé›†ç¾¤è‡ªåˆ›å»ºå¼€å§‹ï¼Œæœ€ååˆ°é›†ç¾¤ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œä¸å—ä½œä¸šå› ç´ å½±å“ï¼› é›†ç¾¤ä¸‹çš„å¤šä¸ªä½œä¸šå…±äº« å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ç­‰èµ„æºï¼Œå¦‚æœé›†ç¾¤å‡ºç°å¼‚å¸¸ï¼Œè¯¥é›†ç¾¤ä¸‹çš„æ‰€æœ‰ä½œä¸šéƒ½ä¼šæ”¶åˆ°å½±å“ã€‚\nä¼˜ç‚¹ï¼šæäº¤ä½œä¸šé€Ÿåº¦å¾ˆå¿«ï¼Œæ— éœ€æå‰ç”³è¯·èµ„æºï¼› å¹¶ä¸”èµ„æºåˆ©ç”¨ç‡è¾ƒé«˜ã€‚\nç¼ºç‚¹ï¼šä½œä¸šä¹‹é—´éš”ç¦»æ€§è¾ƒå·®ï¼Œæ¨ªå‘æ‰©å±•ä¸å¤ªæ–¹ä¾¿ã€‚\nFlink job é›†ç¾¤\nè¿™ç§æ¨¡å¼ä¹Ÿç§° pre-job æ¨¡å¼ï¼Œé›†ç¾¤äº¤ç”± èµ„æºç®¡ç†å™¨æ‰˜ç®¡ï¼Œä¾‹å¦‚ Yarn ï¼Œéœ€è¦è¿è¡Œä½œä¸šï¼Œç¬¬ä¸€æ­¥ç”³è¯·èµ„æºï¼Œå¯åŠ¨ä¸€ä¸ª Flink é›†ç¾¤ï¼Œç¬¬äºŒæ­¥æäº¤ä½œä¸šï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªä½œä¸šä¼šç‹¬äº«ä¸€ä¸ª Flink é›†ç¾¤ã€‚\nä¼˜ç‚¹ï¼šä½œä¸šä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œç¨³å®šæ€§é«˜ï¼Œå¹¶ä¸”ä¸åŒä½œä¸šå¯ä»¥æ ¹æ®èµ„æºæƒ…å†µçµæ´»è°ƒæ•´ã€‚\nç¼ºç‚¹ï¼šèµ„æºæµªè´¹ï¼Œå¹¶ä¸”ä½œä¸šå¯åŠ¨è¾ƒæ…¢ã€‚\nFlink Application é›†ç¾¤\nè¿™ç§æ¨¡å¼ä¹Ÿç§° Application æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„é›†ç¾¤å’Œä½œä¸šç›¸å…³ï¼Œæ¯ä¸€ä¸ªä½œä¸šç‹¬äº«ä¸€ä¸ªé›†ç¾¤ï¼Œæ— éœ€äº‹å…ˆå¯åŠ¨ä¸€ä¸ªé›†ç¾¤ï¼Œè€Œä¸”ç›´æ¥ä»ä½œä¸š jar ä¸­æå– JobGraph æ‰§è¡Œã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªä½œä¸šå°±æ˜¯ä¸€ä¸ª Application ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª Flink é›†ç¾¤ã€‚\nä¼˜ç‚¹ï¼šé›†ç¾¤ç›´æ¥ç›¸äº’éš”ç¦»ï¼Œå¯ä»¥å¾ˆå¥½åœ°åˆ©ç”¨èµ„æºï¼›\nç¼ºç‚¹ï¼šæš‚æ— ã€‚\nJobManager åœ¨ Flink é›†ç¾¤ä¸­ï¼ŒJobManager è´Ÿè´£åè°ƒã€è°ƒåº¦ Task ï¼Œä»¥åŠä½œä¸šå¿«ç…§ã€ä»å¿«ç…§ä¸­æ¢å¤ç­‰åŠŸèƒ½ã€‚\nJobmanager æ ¸å¿ƒç»„ä»¶ï¼š\nResourceManager\nResourceManager è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºåˆ†é…ã€å›æ”¶ï¼Œå¹¶ç®¡ç† task slotã€‚\nDispatcher\nDispatcher æä¾›äº†ä¸€ä¸ª REST æ¥å£ï¼Œç”¨æ¥æäº¤ Flink åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ JobMasterã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI ç”¨æ¥æä¾›ä½œä¸šæ‰§è¡Œä¿¡æ¯ã€‚\nJobMaster\nJobMaster è´Ÿè´£ç®¡ç†å•ä¸ªJobGraphçš„æ‰§è¡Œã€‚Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ JobMasterã€‚\nä¸€ä¸ª Flink é›†ç¾¤ä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ª Jobmanager ï¼Œå¯ä»¥è®¾å®šå¤šä¸ª Jobmanager ï¼Œleader åªæœ‰ä¸€ä¸ªï¼Œå…¶ä»– Jobmanager ä¸º standbyã€‚\nTaskmanager Taskmanager è´Ÿè´£å…·ä½“ task çš„æ‰§è¡Œï¼Œä»¥åŠæ•°æ®æµçš„äº¤æ¢ã€‚ åŒæ—¶ï¼Œ Taskmanager éœ€è¦å°†èµ„æºçŠ¶æ€å‘ Jobmanager æ±‡æŠ¥ã€‚\nç®—å­é“¾ å‡è®¾ Flink ç®—å­å¹¶è¡Œåº¦ä¸º2ï¼Œè¯¥ç®—å­çš„ subTask æœ‰ä¸¤ä¸ªï¼ŒFlink ä¼šå°†ç®—å­çš„ subtasks é“¾æ¥æˆ tasksã€‚æ¯ä¸ª tasks ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†ç®—å­é“¾æ¥æˆ task æ˜¯ä¸ªæœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢ã€ç¼“å†²çš„å¼€é”€ï¼Œå¹¶ä¸”å‡å°‘å»¶è¿Ÿçš„åŒæ—¶å¢åŠ æ•´ä½“ååé‡ï¼Œæ­¤æ—¶ä¸€ä¸ªçº¿ç¨‹å°†ä¼šæ‰§è¡Œå¤šä¸ª subTaskã€‚\né“¾è¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ï¼Œå¦‚æœæƒ³å¯¹æ•´ä¸ªä½œä¸šç¦ç”¨ç®—å­é“¾ï¼Œå¯ä»¥è°ƒç”¨ StreamExecutionEnvironment.disableOperatorChaining()ã€‚\nSlot task slot ä»£è¡¨ Taskmanager ä¸­çš„å¯ç”¨èµ„æºï¼ˆä¸åŒ…æ‹¬CPUï¼‰çš„é›†åˆï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª Taskmanager æœ‰3ä¸ª slotï¼Œé‚£æ¯ä¸ª slot å°†ä¼šå¹³åˆ† Taskmanager çš„å†…å­˜èµ„æºï¼Œå½“ç¬¬å››ä¸ª task æäº¤è¿‡æ¥æ—¶ï¼Œtask å°†è¿›å…¥ SCHEDULE çŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…å…¶ä»– task æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ª taskã€‚\nslotå…±äº«ï¼š\né»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸ subtask å…±äº« slotï¼Œå³ä¾¿å®ƒä»¬æ˜¯ä¸åŒçš„ task çš„ subtaskï¼Œåªè¦æ˜¯æ¥è‡ªäºåŒä¸€ä½œä¸šå³å¯ã€‚ç®—å­æœ€å¤§å¹¶è¡Œåº¦å’Œ slot æ•°é‡ä¸€è‡´ï¼Œç®—å­ä¹‹é—´çš„æ•°æ®äº¤æ¢ä¼šæ ¹æ®ä¸åŒçš„ç­–ç•¥è¿›è¡Œã€‚\næ¯ä¸€ä¸ª subtasks ç®—å­é“¾ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ slot ä¸­çš„æ‰§è¡Œæƒ…å†µå¦‚ä¸‹ï¼š\ntask æ•°æ®äº¤æ¢ç­–ç•¥ æ•°æ®äº¤æ¢ç­–ç•¥å®šä¹‰äº†åœ¨ç‰©ç†æ‰§è¡Œæµå›¾ä¸­å¦‚ä½•å°†æ•°æ®åˆ†é…ç»™ä»»åŠ¡ï¼Œ\nForward\nå°†æ•°æ®ä»ä¸€ä¸ªä»»åŠ¡å‘é€åˆ°æ¥æ”¶ä»»åŠ¡ã€‚å¦‚æœä¸¤ä¸ªä»»åŠ¡éƒ½ä½äºåŒä¸€å°ç‰©ç†è®¡ç®—æœºä¸Šï¼ˆè¿™é€šå¸¸ç”±ä»»åŠ¡è°ƒåº¦å™¨ç¡®ä¿ï¼‰ï¼Œè¿™ç§äº¤æ¢ç­–ç•¥å¯ä»¥é¿å…ç½‘ç»œé€šä¿¡ã€‚\nBroadCast\nå°†æ‰€æœ‰æ•°æ®å‘é€åˆ°ç®—å­çš„æ‰€æœ‰çš„å¹¶è¡Œä»»åŠ¡ä¸Šé¢å»ã€‚å› ä¸ºè¿™ç§ç­–ç•¥ä¼šå¤åˆ¶æ•°æ®å’Œæ¶‰åŠç½‘ç»œé€šä¿¡ï¼Œæ‰€ä»¥ä»£ä»·ç›¸å½“æ˜‚è´µã€‚\nKey-based\nåŸºäºé”®æ§çš„ç­–ç•¥é€šè¿‡Keyå€¼(é”®)å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºä¿è¯å…·æœ‰ç›¸åŒKeyçš„æ•°æ®å°†ç”±åŒä¸€ä»»åŠ¡å¤„ç†ã€‚\nRandom\néšæœºç­–ç•¥ç»Ÿä¸€å°†æ•°æ®åˆ†é…åˆ°ç®—å­çš„ä»»åŠ¡ä¸­å»ï¼Œä»¥ä¾¿å‡åŒ€åœ°å°†è´Ÿè½½åˆ†é…åˆ°ä¸åŒçš„è®¡ç®—ä»»åŠ¡ã€‚\nå‚è€ƒï¼š\nhttps://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/concepts/flink-architecture/\nhttps://www.jianshu.com/p/3898dd13f079\nhttps://confucianzuoyuan.github.io/flink-tutorial/book/chapter02-01-03-%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E7%AD%96%E7%95%A5.html\n",
      "summary": "æ‘˜è¦ï¼š é¸Ÿç° Flink æ¶æ„ï¼Œåˆ†æ Flink å†…éƒ¨ç»„ä»¶å·¥ä½œæœºåˆ¶ã€‚\nFlink æ¶æ„å›¾ æäº¤ä½œä¸šæµç¨‹ Flink é›†ç¾¤æ¨¡å¼ JobManager Taskmanager ç®—å­é“¾ Slot task æ•°æ®äº¤æ¢ç­–ç•¥ Flink æ¶æ„å›¾ ä¸€ä¸ªå®Œæ•´çš„ Flink é›†ç¾¤ç”±ä¸€ä¸ª Jobmanager å’Œè‹¥å¹²ä¸ª Taskmanager ç»„æˆï¼ŒJobmanager ä¸»è¦è´Ÿè´£è°ƒåº¦ task ä»¥åŠ åè°ƒ Checkpointã€‚Taskmanager åˆ™è´Ÿè´£å…·ä½“çš„ task æ‰§è¡Œï¼Œä»¥åŠæ•°æ®æµçš„äº¤æ¢ã€‚\nå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ JobManager å’Œ TaskManagerï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºstandalone é›†ç¾¤å¯åŠ¨ã€åœ¨å®¹å™¨ä¸­å¯åŠ¨ã€æˆ–è€…é€šè¿‡YARNç­‰èµ„æºæ¡†æ¶ç®¡ç†å¹¶å¯åŠ¨ã€‚TaskManager è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚\næäº¤ä½œä¸šæµç¨‹ ä»¥ä¸€ä¸ªä½œä¸šæäº¤çš„æµç¨‹æ¥è¯´æ˜ Flink å„ä¸ªç»„ä»¶æ˜¯å¦‚ä½•äº¤äº’å’Œå·¥ä½œçš„ï¼š\nFlink é›†ç¾¤æ¨¡å¼ Flink é›†ç¾¤ç±»å‹ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ï¼š\nFlink Session é›†ç¾¤\nè¿™ç§æ¨¡å¼ä¸‹ï¼Œé›†ç¾¤è‡ªåˆ›å»ºå¼€å§‹ï¼Œæœ€ååˆ°é›†ç¾¤ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œä¸å—ä½œä¸šå› ç´ å½±å“ï¼› é›†ç¾¤ä¸‹çš„å¤šä¸ªä½œä¸šå…±äº« å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ç­‰èµ„æºï¼Œå¦‚æœé›†ç¾¤å‡ºç°å¼‚å¸¸ï¼Œè¯¥é›†ç¾¤ä¸‹çš„æ‰€æœ‰ä½œä¸šéƒ½ä¼šæ”¶åˆ°å½±å“ã€‚\nä¼˜ç‚¹ï¼šæäº¤ä½œä¸šé€Ÿåº¦å¾ˆå¿«ï¼Œæ— éœ€æå‰ç”³è¯·èµ„æºï¼› å¹¶ä¸”èµ„æºåˆ©ç”¨ç‡è¾ƒé«˜ã€‚\nç¼ºç‚¹ï¼šä½œä¸šä¹‹é—´éš”ç¦»æ€§è¾ƒå·®ï¼Œæ¨ªå‘æ‰©å±•ä¸å¤ªæ–¹ä¾¿ã€‚\nFlink job é›†ç¾¤\nè¿™ç§æ¨¡å¼ä¹Ÿç§° pre-job æ¨¡å¼ï¼Œé›†ç¾¤äº¤ç”± èµ„æºç®¡ç†å™¨æ‰˜ç®¡ï¼Œä¾‹å¦‚ Yarn ï¼Œéœ€è¦è¿è¡Œä½œä¸šï¼Œç¬¬ä¸€æ­¥ç”³è¯·èµ„æºï¼Œå¯åŠ¨ä¸€ä¸ª Flink é›†ç¾¤ï¼Œç¬¬äºŒæ­¥æäº¤ä½œä¸šï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªä½œä¸šä¼šç‹¬äº«ä¸€ä¸ª Flink é›†ç¾¤ã€‚"
    },{
      "title": "Flink WordCount",
      "url": "https://qiref.github.io/post/2022/02/22/flink-wordcount/",
      "content": "æ‘˜è¦ï¼šFlink ä»é›¶å¼€å§‹ï¼Œä¸‹è½½é›†ç¾¤å¹¶è¿è¡Œ WordCount Jobã€‚ å®Œæ•´ä»£ç åœ°å€ï¼š https://github.com/ArchieYao/flink-learning/tree/main/hello-world\nFlink æœ¬åœ°æ¨¡å¼é›†ç¾¤å®‰è£… è¿è¡ŒFlinkï¼Œéœ€æå‰å®‰è£…å¥½ Java 8 æˆ–è€… Java 11ã€‚\nwget https://dlcdn.apache.org/flink/flink-1.14.3/flink-1.14.3-bin-scala_2.12.tgz tar -zxvf flink-1.14.3-bin-scala_2.12.tgz cd flink-1.14.3 ./bin/start-cluster.sh è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥åœ¨ IP:8081 è®¿é—® Flink-UI\nFlink Word Count job source æ˜¯å¤šæ®µæ–‡æœ¬ï¼Œç±»å‹ï¼š DataSource ï¼Œç»è¿‡ flatMapï¼Œåˆ‡åˆ†ä¸ºæ¯ä¸ªå•è¯ï¼Œç„¶åè½¬æ¢ä¸ºï¼š(val,n) çš„æ•°æ®ï¼Œç„¶åæ ¹æ® val åˆ†ç»„ç»Ÿè®¡ï¼Œå¾—å‡º sum(n) çš„å€¼ã€‚\npublic static void main(String[] args) throws Exception { // åˆ›å»ºFlinkä»»åŠ¡è¿è¡Œç¯å¢ƒ final ExecutionEnvironment executionEnvironment = ExecutionEnvironment.getExecutionEnvironment(); // åˆ›å»ºDataSetï¼Œæ•°æ®æ˜¯ä¸€è¡Œä¸€è¡Œæ–‡æœ¬ DataSource\u0026lt;String\u0026gt; text = executionEnvironment.fromElements( \u0026quot;Licensed to the Apache Software Foundation (ASF) under one\u0026quot;, \u0026quot;or more contributor license agreements. See the NOTICE file\u0026quot;, \u0026quot;distributed with this work for additional information\u0026quot;, \u0026quot;regarding copyright ownership. The ASF licenses this file\u0026quot;, \u0026quot;to you under the Apache License, Version 2.0 (the\u0026quot;); // é€šè¿‡Flinkå†…ç½®è½¬æ¢å‡½æ•°è¿›è¡Œè®¡ç®— AggregateOperator\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; sum = text.flatMap( new FlatMapFunction\u0026lt;String, Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt;() { @Override public void flatMap( String value, Collector\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; collector) throws Exception { String[] split = value.split(\u0026quot;\\\\W+\u0026quot;); for (String s : split) { if (s.length() \u0026gt; 0) { collector.collect(new Tuple2\u0026lt;\u0026gt;(s, 1)); // TimeUnit.SECONDS.sleep(5); } } } }) .groupBy(0) .sum(1); // æ‰“å°ç»“æœ sum.print(); } Job å¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥æäº¤åˆ° Flink é›†ç¾¤ä¸­è¿è¡Œã€‚\nmvn clean package -DskipTests -Dcheckstyle.skip=true -Drat.skip=true # å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ pom ä¸­ï¼Œåº”è¯¥æŒ‡å®š Job çš„ main classã€‚ \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-jar-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;archive\u0026gt; \u0026lt;manifest\u0026gt; \u0026lt;mainClass\u0026gt;archieyao.github.io.WordCount\u0026lt;/mainClass\u0026gt; \u0026lt;/manifest\u0026gt; \u0026lt;/archive\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; ./bin/flink run -j hello-world-1.0-SNAPSHOT.jar ",
      "summary": "æ‘˜è¦ï¼šFlink ä»é›¶å¼€å§‹ï¼Œä¸‹è½½é›†ç¾¤å¹¶è¿è¡Œ WordCount Jobã€‚ å®Œæ•´ä»£ç åœ°å€ï¼š https://github.com/ArchieYao/flink-learning/tree/main/hello-world\nFlink æœ¬åœ°æ¨¡å¼é›†ç¾¤å®‰è£… è¿è¡ŒFlinkï¼Œéœ€æå‰å®‰è£…å¥½ Java 8 æˆ–è€… Java 11ã€‚\nwget https://dlcdn.apache.org/flink/flink-1.14.3/flink-1.14.3-bin-scala_2.12.tgz tar -zxvf flink-1.14.3-bin-scala_2.12.tgz cd flink-1.14.3 ./bin/start-cluster.sh è¿è¡ŒæˆåŠŸåï¼Œå¯ä»¥åœ¨ IP:8081 è®¿é—® Flink-UI\nFlink Word Count job source æ˜¯å¤šæ®µæ–‡æœ¬ï¼Œç±»å‹ï¼š DataSource ï¼Œç»è¿‡ flatMapï¼Œåˆ‡åˆ†ä¸ºæ¯ä¸ªå•è¯ï¼Œç„¶åè½¬æ¢ä¸ºï¼š(val,n) çš„æ•°æ®ï¼Œç„¶åæ ¹æ® val åˆ†ç»„ç»Ÿè®¡ï¼Œå¾—å‡º sum(n) çš„å€¼ã€‚\npublic static void main(String[] args) throws Exception { // åˆ›å»ºFlinkä»»åŠ¡è¿è¡Œç¯å¢ƒ final ExecutionEnvironment executionEnvironment = ExecutionEnvironment.getExecutionEnvironment(); // åˆ›å»ºDataSetï¼Œæ•°æ®æ˜¯ä¸€è¡Œä¸€è¡Œæ–‡æœ¬ DataSource\u0026lt;String\u0026gt; text = executionEnvironment.fromElements( \u0026quot;Licensed to the Apache Software Foundation (ASF) under one\u0026quot;, \u0026quot;or more contributor license agreements."
    },{
      "title": "Goè¯­è¨€cobra",
      "url": "https://qiref.github.io/post/2022/02/19/go%E8%AF%AD%E8%A8%80cobra/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€ cobra æ¡†æ¶ä½¿ç”¨è¯´æ˜ï¼Œæ–‡ä¸­ä»£ç åœ°å€ï¼š https://github.com/ArchieYao/clid\ncobra ç®€ä»‹ cobraæ˜¯ Go è¯­è¨€çš„ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºåº“ï¼Œå¯ä»¥ç”¨æ¥ç¼–å†™å‘½ä»¤è¡Œç¨‹åºã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œ ç”¨äºç”ŸæˆåŸºäº cobra çš„åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚éå¸¸å¤šçŸ¥åçš„å¼€æºé¡¹ç›®ä½¿ç”¨äº† cobra åº“æ„å»ºå‘½ä»¤è¡Œï¼Œå¦‚Kubernetesã€Hugoã€etcdç­‰ã€‚\nå®‰è£… cobra cobra æ˜¯ç”±å¤§åé¼é¼çš„ spf13ï¼ˆgolang å¼€å‘è€…ï¼‰ å¼€å‘çš„ï¼ŒGitHub åœ°å€ï¼šhttps://github.com/spf13/cobra\n// å®‰è£… go get -u github.com/spf13/cobra # æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ cobra -h Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. Usage: cobra [command] Available Commands: add Add a command to a Cobra Application completion Generate the autocompletion script for the specified shell help Help about any command init Initialize a Cobra Application Flags: -a, --author string author name for copyright attribution (default \u0026quot;YOUR NAME\u0026quot;) --config string config file (default is $HOME/.cobra.yaml) -h, --help help for cobra -l, --license string name of license for the project --viper use Viper for configuration Use \u0026quot;cobra [command] --help\u0026quot; for more information about a command. åˆ›å»º cobra å·¥ç¨‹ # åˆ›å»º Go å·¥ç¨‹ mkdir clid cd clid go mod init clid # åˆ›å»º cobra å·¥ç¨‹ cobra init # å¯ä»¥å¾—åˆ°å¦‚ä¸‹å·¥ç¨‹ç›®å½• D:\\WORKSPACE\\GOLANG\\TRAINNING\\CLID â”‚ go.mod â”‚ go.sum â”‚ LICENSE â”‚ main.go â”‚ â””â”€â”€â”€cmd root.go # æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå·¥ç¨‹å¯ä»¥æ­£å¸¸ç¼–è¯‘å¹¶ä¸”è¿è¡Œ go build -o ./bin/clid å¢åŠ è‡ªå®šä¹‰å‘½ä»¤ cobra add version tree /f D:. â”‚ go.mod â”‚ go.sum â”‚ LICENSE â”‚ main.go â”‚ â””â”€â”€â”€cmd root.go version.go # åœ¨ `cmd` ç›®å½•ä¸‹æ–°ç”Ÿæˆä¸€ä¸ª `version.go` çš„æ–‡ä»¶ ä»æ–°ç”Ÿæˆçš„æ–‡ä»¶å¯ä»¥çœ‹å‡ºï¼Œæ ¸å¿ƒæ–¹æ³•å°±2ä¸ªï¼š\nvar versionCmd = \u0026amp;cobra.Command{ Use: \u0026quot;version\u0026quot;, Short: \u0026quot;ç‰ˆæœ¬ä¿¡æ¯\u0026quot;, // å‘½ä»¤æç¤º Long: `ç‰ˆæœ¬ä¿¡æ¯æè¿°`, // å‘½ä»¤è¯´æ˜ Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026quot;0.0.1-Alpha\u0026quot;) }, } func init() { rootCmd.AddCommand(versionCmd) // version å‘½ä»¤æ˜¯ rootCmd çš„ä¸€ä¸ªå­å‘½ä»¤ } #./clid A longer description that spans multiple lines and likely contains examples and usage of using your application. For example: Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. Usage: 1 [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command version ç‰ˆæœ¬ä¿¡æ¯ # ./clid version 0.0.1-Alpha # ./clid version -h ç‰ˆæœ¬ä¿¡æ¯æè¿° Usage: clid version [flags] Flags: -h, --help help for version ç»™å­å‘½ä»¤å¢åŠ å‚æ•° é‡æ–°å¢åŠ å‘½ä»¤æµ‹è¯•\ncobra add foo var fooCmd = \u0026amp;cobra.Command{ Use: \u0026quot;foo\u0026quot;, Short: \u0026quot;A brief description of your command\u0026quot;, Long: `A longer description `, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026quot;foo called\u0026quot;) bar, err := cmd.Flags().GetString(\u0026quot;bar\u0026quot;) if err != nil { fmt.Println(\u0026quot;è¯·è¾“å…¥æ­£ç¡®çš„bar\u0026quot;) } fmt.Printf(\u0026quot;è¾“å…¥å€¼bar[%s]\u0026quot;, bar) }, } func init() { rootCmd.AddCommand(fooCmd) fooCmd.Flags().StringP(\u0026quot;bar\u0026quot;, \u0026quot;a\u0026quot;, \u0026quot;é»˜è®¤å€¼\u0026quot;, \u0026quot;å‘½ä»¤è¯´æ˜\u0026quot;) } æ‰§è¡Œç»“æœï¼š\n#./clid foo -h A longer description Usage: clid foo [flags] Flags: -a, --bar string å‘½ä»¤è¯´æ˜ (default \u0026quot;é»˜è®¤å€¼\u0026quot;) -h, --help help for foo # ./clid foo -a test # ./clid foo --bar test foo called è¾“å…¥å€¼bar[test] å‘½ä»¤å…¶ä»–å‚æ•° ä»¥ä¸Šæ˜¯æŒ‡å®šäº† foo å‘½ä»¤çš„å‚æ•°ï¼Œcobra è¿˜å¯ä»¥è¯†åˆ«å‘½ä»¤åçš„é™„åŠ å‚æ•°ã€‚\nä»¥ä¸‹ä»£ç å®šä¹‰äº†ä¸€ä¸ªå¤šæ•°æ±‚å’Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤åï¼Œåœ¨å‘½ä»¤åå¸¦ä¸Šéœ€è¦æ±‚å’Œçš„å‚æ•°ï¼Œå³å¯å®Œæˆæ±‚å’Œã€‚\nvar sumCmd = \u0026amp;cobra.Command{ Use: \u0026quot;sum\u0026quot;, Short: \u0026quot;A brief description of your command\u0026quot;, Long: `A longer description .`, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026quot;sum called\u0026quot;) result := 0 for _, v := range args { arg, err := strconv.Atoi(v) if err != nil { fmt.Printf(\u0026quot;args: %s , %s cannot convert to int \u0026quot;, args, v) return } result += arg } fmt.Printf(\u0026quot;result [%d]\u0026quot;, result) }, } æµ‹è¯•ç»“æœï¼š\n# ./clid sum 1 2 3 4 5 sum called result [15] ",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€ cobra æ¡†æ¶ä½¿ç”¨è¯´æ˜ï¼Œæ–‡ä¸­ä»£ç åœ°å€ï¼š https://github.com/ArchieYao/clid\ncobra ç®€ä»‹ cobraæ˜¯ Go è¯­è¨€çš„ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºåº“ï¼Œå¯ä»¥ç”¨æ¥ç¼–å†™å‘½ä»¤è¡Œç¨‹åºã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œ ç”¨äºç”ŸæˆåŸºäº cobra çš„åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚éå¸¸å¤šçŸ¥åçš„å¼€æºé¡¹ç›®ä½¿ç”¨äº† cobra åº“æ„å»ºå‘½ä»¤è¡Œï¼Œå¦‚Kubernetesã€Hugoã€etcdç­‰ã€‚\nå®‰è£… cobra cobra æ˜¯ç”±å¤§åé¼é¼çš„ spf13ï¼ˆgolang å¼€å‘è€…ï¼‰ å¼€å‘çš„ï¼ŒGitHub åœ°å€ï¼šhttps://github.com/spf13/cobra\n// å®‰è£… go get -u github.com/spf13/cobra # æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ cobra -h Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. Usage: cobra [command] Available Commands: add Add a command to a Cobra Application completion Generate the autocompletion script for the specified shell help Help about any command init Initialize a Cobra Application Flags: -a, --author string author name for copyright attribution (default \u0026quot;YOUR NAME\u0026quot;) --config string config file (default is $HOME/."
    },{
      "title": "ProtoBufæ•°æ®åè®®",
      "url": "https://qiref.github.io/post/2022/01/11/protobuf%E6%95%B0%E6%8D%AE%E5%8D%8F%E8%AE%AE/",
      "content": "æ‘˜è¦ï¼šProtoBuf(Protocol Buffers)æ˜¯ä¸€ç§è·¨å¹³å°ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹æ³•ï¼Œå¯ç”¨äºç½‘ç»œæ•°æ®äº¤æ¢åŠæ•°æ®å­˜å‚¨ã€‚\nProtocol Buffersä»‹ç» ä¸åŒäº XML ã€JSON è¿™ç§æ–‡æœ¬æ ¼å¼æ•°æ®ï¼ŒProtocol Buffers æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼æ•°æ®ã€‚åœ¨Protocol Buffers è¯ç”Ÿä¹‹åˆï¼Œå°±è¢«èµ‹äºˆä¸¤ä¸ªç‰¹ç‚¹ï¼š\nå‘å‰å…¼å®¹ï¼Œå¾ˆå®¹æ˜“å¼•å…¥æ–°å­—æ®µï¼Œåº”å¯¹å­—æ®µçš„é¢‘ç¹å˜æ›´ æ•°æ®æ ¼å¼å…·å¤‡æè¿°æ€§ï¼Œå¹¶ä¸”æ”¯æŒå¤šè¯­è¨€å¤„ç† ä¼ è¾“æ•ˆç‡é«˜ åŸºäºä»¥ä¸Šè¿™äº›ç‰¹æ€§ï¼ŒProtocol Buffers è¢«å¹¿æ³›åº”ç”¨äºå„ç§ RPC æ¡†æ¶ä¸­ï¼Œå¹¶ä¸”æ˜¯ Google çš„æ•°æ®é€šç”¨è¯­è¨€ã€‚\nProtocol Buffersåè®®æ–‡ä»¶ Protocol Buffers åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆå®šä¹‰å¥½åè®®æ–‡ä»¶ï¼Œä»¥ .proto ä¸ºåç¼€çš„æ–‡ä»¶å°±æ˜¯Protocol Buffers çš„åè®®æ–‡ä»¶ã€‚\nExample:\n// æŒ‡å®šprotobufçš„ç‰ˆæœ¬ï¼Œproto3æ˜¯æœ€æ–°çš„è¯­æ³•ç‰ˆæœ¬ syntax = \u0026quot;proto3\u0026quot;; // å®šä¹‰æ•°æ®ç»“æ„ï¼Œmessage ä½ å¯ä»¥æƒ³è±¡æˆjavaçš„classï¼Œcè¯­è¨€ä¸­çš„struct message Response { string data = 1; // å®šä¹‰ä¸€ä¸ªstringç±»å‹çš„å­—æ®µï¼Œå­—æ®µåå­—ä¸ºdata, åºå·ä¸º1 int32 status = 2; // å®šä¹‰ä¸€ä¸ªint32ç±»å‹çš„å­—æ®µï¼Œå­—æ®µåå­—ä¸ºstatus, åºå·ä¸º2 } å¦‚æœ A å’Œ B è¦åŸºäº Protocol Buffers åè®®è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆåœ¨é€šä¿¡å‰ï¼ŒA å’Œ B éƒ½éœ€è¦æœ‰åŒä¸€ä»½åè®®æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨ Protocol Buffers æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦æ•°æ®çš„ Schema ä¿¡æ¯ï¼›\nProtocol Buffersè½¯ä»¶ å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒProtocol Buffers å¯ä»¥å®‰è£…è½¯ä»¶ï¼Œå°†æŒ‡å®šçš„ proto åè®®æ–‡ä»¶è½¬æ¢ä¸ºå¤šç§ç¼–ç¨‹è¯­è¨€ä»£ç ï¼Œå¹¶ä¸”æä¾›äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç­‰ä¸€ç³»åˆ—æ–¹æ³•åº“ã€‚\nä¸‹è½½åœ°å€ï¼š https://github.com/protocolbuffers/protobuf/releases\nMAC ä¸‹å®‰è£…ï¼š\nbrew install protobuf # å®‰è£…å®ŒæˆåéªŒè¯ protoc --version è½¬æ¢ä¸ºä»£ç :\n# åœ¨å½“å‰ç›®å½•è¾“å‡º response.proto åè®®ç”Ÿæˆçš„Javaä»£ç  protoc --java_out=. response.proto \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.google.protobuf\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;protobuf-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ResponseOuterClass.Response.Builder builder = ResponseOuterClass.Response.newBuilder(); // è®¾ç½®å­—æ®µå€¼ builder.setData(\u0026quot;hello www.tizi365.com\u0026quot;); builder.setStatus(200); ResponseOuterClass.Response response = builder.build(); // å°†æ•°æ®æ ¹æ®protobufæ ¼å¼ï¼Œè½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ byte[] byteArray = response.toByteArray(); // ååºåˆ—åŒ–,äºŒè¿›åˆ¶æ•°æ® ResponseOuterClass.Response newResponse = ResponseOuterClass.Response.parseFrom(byteArray); System.out.println(newResponse.getData()); System.out.println(newResponse.getStatus()); Protocol Buffers ç¼–ç  Protocol Buffers ç¼–ç ä¸»è¦å€ŸåŠ© Varint å’Œ ZigZag ç®—æ³•å®ç°ï¼Œè¿™ä¹Ÿä½¿å¾— Protocol Buffers æœ‰æ›´ä¼˜ç§€çš„ä¼ è¾“æ•ˆç‡ã€‚\nåœ¨ç†è§£è¿™ä¸¤ä¸ªç®—æ³•å‰ï¼Œé¦–å…ˆéœ€è¦å›é¡¾ä¸€ä¸‹è®¡ç®—æœºäºŒè¿›åˆ¶è¡¨ç¤ºçš„å‡ ç§æ–¹å¼ï¼š\nåŸç ï¼Œç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ä½ï¼ˆ0ä¸ºéè´Ÿæ•°ï¼Œ1ä¸ºè´Ÿæ•°ï¼‰ï¼Œå‰©ä½™è¡¨ç¤ºå€¼ã€‚ +8 = 0000 1000ã€ŒåŸç ã€ -8 = 1000 1000ã€ŒåŸç ã€\nåç ï¼Œç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ä½ï¼ˆ0ä¸ºéè´Ÿæ•°ï¼Œ1ä¸ºè´Ÿæ•°ï¼‰ï¼Œå‰©ä½™ä½ï¼Œè´Ÿæ•°æŒ‰ä½å–åï¼Œéè´Ÿæ•°ä¸å˜ï¼Œæ­£æ•°çš„åç æ˜¯åŸç æœ¬èº«ã€‚ +8 = 0000 1000ã€Œåç ã€ -8 = 1111 0111ã€Œåç ã€\nè¡¥ç ï¼Œç”±äºåŸç å’Œåç æ— æ³•ç›´æ¥å‚ä¸ä½è¿ç®—ï¼ˆç¬¦å·ä½çš„å­˜åœ¨ï¼‰ï¼Œæ‰€ä»¥å¼•å…¥è¡¥ç ï¼Œè¡¥ç ç”¨ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ï¼ˆ0ä¸ºéè´Ÿæ•°ï¼Œ1ä¸ºè´Ÿæ•°ï¼‰ï¼Œå‰©ä¸‹çš„ä½éè´Ÿæ•°ä¿æŒä¸å˜ï¼Œè´Ÿæ•°æŒ‰ä½æ±‚åæœ«ä½åŠ 1.ï¼ˆè¡¥ç çš„è¡¥ç æ˜¯åŸç ï¼Œæ­£æ•°çš„è¡¥ç æ˜¯æœ¬èº«ï¼‰ +8 = 0000 1000ã€Œè¡¥ç ã€ -8 = 1000 1000ã€ŒåŸç ã€-\u0026gt; 1111 0111 +1 -\u0026gt; 1111 1000ã€Œè¡¥ç ã€\nè®¡ç®—æœºä¸­çš„æ•°å€¼æ˜¯ç”¨è¡¥ç æ¥è¡¨ç¤ºå’Œå­˜å‚¨çš„ã€‚\nVarint Varint ç¼–ç æ˜¯å°†æ•°å­—è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„çš„ç¼–ç æ–¹å¼ï¼Œä½¿ç”¨å‰ææ˜¯æ•°å­—è¾ƒå°ï¼Œè¿™æ ·æ‰èƒ½æ›´é«˜æ•ˆåœ°å‹ç¼©ã€‚\nç¼–ç è¿‡ç¨‹ï¼š\n300 çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œint ç±»å‹ï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ 1 0010 1100 ç”±äºå‰2ä¸ªå­—èŠ‚éƒ½æ˜¯ç©ºä½ï¼Œæµªè´¹äº†2ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚\nä½¿ç”¨ Varint ç¼–ç åˆ™ä¼šå˜ä¸º 1010 1100 0000 0010ã€‚ å˜ä¸ºäº†ä¸¤ä¸ªå­—èŠ‚ã€‚\n1 0010 1100 // æ¯7ä½ä¸ºä¸€ä¸ªå•å…ƒï¼Œä»åå¾€å‰ç¼–ç ï¼Œå†åŠ é¦–ä½ msb(most significant bit) ï¼Œè¡¨ç¤ºåç»­8ä½æ˜¯å¦è¿ç»­ 010 1100 â†’ 1010 1100 000 0010 â†’ 0000 0010 â†’ 1010 1100 0000 0010 è§£ç è¿‡ç¨‹ï¼š\n000 0010 010 1100 // è§£ç éœ€å»é™¤msb â†’ 000 0010 ++ 010 1100 â†’ 100101100 â†’ 256 + 32 + 8 + 4 = 300 ZigZag ZigZag ç¼–ç æ˜¯ä¸ºäº†è§£å†³ Varint å¯¹è´Ÿæ•°ç¼–ç æ•ˆç‡ä½çš„é—®é¢˜ï¼ˆæœ€é«˜ä½æ˜¯ç¬¦å·ä½ 1 ï¼‰ï¼Œå°†æœ‰ç¬¦å·æ•´æ•°æ˜ å°„ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œåœ¨å®ç°ä¸Šï¼Œæ˜ å°„é€šè¿‡ç§»ä½å³å¯å®ç°ã€‚\nåœ¨ Varint ä¸­ï¼Œè´Ÿæ•°æœ‰ä¸ªä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ ç¬¦å·ä½åœ¨ç¬¬ä¸€ä½ï¼å¯¼è‡´é«˜ä½ä¸€ç›´éœ€è¦ç¼–ç ã€‚\n// -1 10000000 00000000 00000000 00000001ã€ŒåŸã€ 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ å¦‚æœå¯¹ -1 è¿›è¡Œ Varint ç¼–ç ï¼Œå°±æ˜¾å¾—ä¸é‚£ä¹ˆé«˜æ•ˆäº†ï¼Œå› ä¸ºæ‰€æœ‰ä½éƒ½æ˜¯1ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•æŠŠè¿™ä¸ªç¬¦å·ä½æ¢ä¸€ä¸‹å‘¢ï¼ŸZigZag å°±å®Œæˆäº†è¿™ä»¶äº‹ï¼š\n// -1 ç»è¿‡zigzag ç¼–ç å˜æˆ 1 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ 00000000 00000000 00000000 00000001ã€Œzigzagã€ // 1 ç»è¿‡zigzag ç¼–ç å˜æˆ 2 00000000 00000000 00000000 00000001ã€Œè¡¥ç ã€ 00000000 00000000 00000000 00000010ã€Œzigzagã€ ç§»ä½è¿ç®—ï¼š\n\u0026lt;\u0026lt; : å·¦ç§»è¿ç®—ï¼Œå·¦ç§»å‡ ä½ä½ä½å°±è¡¥å‡ ä¸ª0 \u0026gt;\u0026gt; : å³ç§»è¿ç®—ï¼Œå¦‚æœæ•°å­—ä¸ºæ­£æ•°æ—¶ï¼Œç§»ä½ååœ¨é«˜ä½è¡¥0ï¼›å¦‚æœæ•°å­—ä¸ºè´Ÿæ•°æ—¶ï¼Œç§»ä½ååœ¨é«˜ä½è¡¥1 \u0026gt;\u0026gt;\u0026gt;: æ— ç¬¦å·å³ç§»ä½ï¼Œä¸ç®¡æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œé«˜ä½éƒ½ç”¨0è¡¥é½ï¼ˆå¿½ç•¥ç¬¦å·ä½ï¼‰ ç¼–ç è¿‡ç¨‹ï¼š\n(n \u0026lt;\u0026lt; 1) ^ (n \u0026gt;\u0026gt; 31) // å¼‚æˆ–ï¼ˆç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ï¼‰ // æ¨æ¼”è¿‡ç¨‹ -1 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ â†’ n \u0026lt;\u0026lt; 1 â†’ 1111111 11111111 11111111 111111110ã€Œè¡¥ã€ â†’ n \u0026gt;\u0026gt; 31 â†’ 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ â†’ å¼‚æˆ– â†’ 00000000 00000000 00000000 00000001ã€Œè¡¥ã€ // æ¨æ¼”è¿‡ç¨‹ 1 00000000 00000000 00000000 00000001ã€Œè¡¥ã€ â†’ n \u0026lt;\u0026lt; 1 â†’ 00000000 00000000 00000000 00000010ã€Œè¡¥ã€ â†’ n \u0026gt;\u0026gt; 31 â†’ 00000000 00000000 00000000 00000000ã€Œè¡¥ã€ â†’ å¼‚æˆ– â†’ 00000000 00000000 00000000 00000010ã€Œè¡¥ã€ è§£ç è¿‡ç¨‹ï¼š\n(n \u0026gt;\u0026gt;\u0026gt; 1) ^ -(n \u0026amp; 1) // æ¨æ¼”è¿‡ç¨‹ -1 00000000 00000000 00000000 00000001ã€Œè¡¥ã€ â†’ n \u0026gt;\u0026gt;\u0026gt; 1 â†’ 00000000 00000000 00000000 00000000ã€Œè¡¥ã€ â†’ -(n \u0026amp; 1) â†’ 00000000 00000000 00000000 00000001ã€Œè¡¥ã€ â†’ 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ â†’ å¼‚æˆ– â†’ 11111111 11111111 11111111 11111111ã€Œè¡¥ã€ å‚è€ƒï¼š\nhttps://colobu.com/2019/10/03/protobuf-ultimate-tutorial-in-go/\nhttps://github.com/halfrost/Halfrost-Field/blob/master/contents/Protocol/Protocol-buffers-encode.md#%E5%85%AD-protocol-buffer-%E7%BC%96%E7%A0%81%E5%8E%9F%E7%90%86\nhttps://developers.google.com/protocol-buffers\nhttps://www.tizi365.com/archives/367.html\n",
      "summary": "æ‘˜è¦ï¼šProtoBuf(Protocol Buffers)æ˜¯ä¸€ç§è·¨å¹³å°ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹æ³•ï¼Œå¯ç”¨äºç½‘ç»œæ•°æ®äº¤æ¢åŠæ•°æ®å­˜å‚¨ã€‚\nProtocol Buffersä»‹ç» ä¸åŒäº XML ã€JSON è¿™ç§æ–‡æœ¬æ ¼å¼æ•°æ®ï¼ŒProtocol Buffers æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼æ•°æ®ã€‚åœ¨Protocol Buffers è¯ç”Ÿä¹‹åˆï¼Œå°±è¢«èµ‹äºˆä¸¤ä¸ªç‰¹ç‚¹ï¼š\nå‘å‰å…¼å®¹ï¼Œå¾ˆå®¹æ˜“å¼•å…¥æ–°å­—æ®µï¼Œåº”å¯¹å­—æ®µçš„é¢‘ç¹å˜æ›´ æ•°æ®æ ¼å¼å…·å¤‡æè¿°æ€§ï¼Œå¹¶ä¸”æ”¯æŒå¤šè¯­è¨€å¤„ç† ä¼ è¾“æ•ˆç‡é«˜ åŸºäºä»¥ä¸Šè¿™äº›ç‰¹æ€§ï¼ŒProtocol Buffers è¢«å¹¿æ³›åº”ç”¨äºå„ç§ RPC æ¡†æ¶ä¸­ï¼Œå¹¶ä¸”æ˜¯ Google çš„æ•°æ®é€šç”¨è¯­è¨€ã€‚\nProtocol Buffersåè®®æ–‡ä»¶ Protocol Buffers åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆå®šä¹‰å¥½åè®®æ–‡ä»¶ï¼Œä»¥ .proto ä¸ºåç¼€çš„æ–‡ä»¶å°±æ˜¯Protocol Buffers çš„åè®®æ–‡ä»¶ã€‚\nExample:\n// æŒ‡å®šprotobufçš„ç‰ˆæœ¬ï¼Œproto3æ˜¯æœ€æ–°çš„è¯­æ³•ç‰ˆæœ¬ syntax = \u0026quot;proto3\u0026quot;; // å®šä¹‰æ•°æ®ç»“æ„ï¼Œmessage ä½ å¯ä»¥æƒ³è±¡æˆjavaçš„classï¼Œcè¯­è¨€ä¸­çš„struct message Response { string data = 1; // å®šä¹‰ä¸€ä¸ªstringç±»å‹çš„å­—æ®µï¼Œå­—æ®µåå­—ä¸ºdata, åºå·ä¸º1 int32 status = 2; // å®šä¹‰ä¸€ä¸ªint32ç±»å‹çš„å­—æ®µï¼Œå­—æ®µåå­—ä¸ºstatus, åºå·ä¸º2 } å¦‚æœ A å’Œ B è¦åŸºäº Protocol Buffers åè®®è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆåœ¨é€šä¿¡å‰ï¼ŒA å’Œ B éƒ½éœ€è¦æœ‰åŒä¸€ä»½åè®®æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨ Protocol Buffers æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦æ•°æ®çš„ Schema ä¿¡æ¯ï¼›"
    },{
      "title": "Log4j2æŒ‰ç…§æ—¶é—´å’Œæ—¥å¿—å¤§å°æ»šåŠ¨",
      "url": "https://qiref.github.io/post/2021/08/25/log4j2%E6%8C%89%E7%85%A7%E6%97%B6%E9%97%B4%E5%92%8C%E6%97%A5%E5%BF%97%E5%A4%A7%E5%B0%8F%E6%BB%9A%E5%8A%A8/",
      "content": "æ‘˜è¦ï¼šLog4j2 æŒ‰ç…§æ—¶é—´å’Œæ—¥å¿—å¤§å°æ»šåŠ¨ã€‚\nLog4j2æŒ‰ç…§æ—¶é—´å’Œæ—¥å¿—å¤§å°æ»š status = error name = PropertiesConfig #Make sure to change log file path as per your need property.filename = C:\\\\logs\\\\debug.log filters = threshold filter.threshold.type = ThresholdFilter filter.threshold.level = debug appenders = rolling appender.rolling.type = RollingFile appender.rolling.name = RollingFile appender.rolling.fileName = ${filename} appender.rolling.filePattern = debug-backup-%d{MM-dd-yy-HH-mm-ss}-%i.log.gz appender.rolling.layout.type = PatternLayout appender.rolling.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n appender.rolling.policies.type = Policies appender.rolling.policies.time.type = TimeBasedTriggeringPolicy appender.rolling.policies.time.interval = 1 appender.rolling.policies.time.modulate = true appender.rolling.policies.size.type = SizeBasedTriggeringPolicy appender.rolling.policies.size.size=10MB appender.rolling.strategy.type = DefaultRolloverStrategy appender.rolling.strategy.max = 20 loggers = rolling #Make sure to change the package structure as per your application logger.rolling.name = com.howtodoinjava logger.rolling.level = debug logger.rolling.additivity = false logger.rolling.appenderRef.rolling.ref = RollingFile æ—¥å¿—é…ç½®åŠ¨æ€æ›´æ–° monitorInterval æ˜¯ç”¨æ¥è®¾ç½®é…ç½®æ–‡ä»¶çš„åŠ¨æ€åŠ è½½æ—¶é—´çš„ï¼Œå•ä½æ˜¯ç§’ã€‚\nmonitorInterval = 10 ",
      "summary": "æ‘˜è¦ï¼šLog4j2 æŒ‰ç…§æ—¶é—´å’Œæ—¥å¿—å¤§å°æ»šåŠ¨ã€‚\nLog4j2æŒ‰ç…§æ—¶é—´å’Œæ—¥å¿—å¤§å°æ»š status = error name = PropertiesConfig #Make sure to change log file path as per your need property.filename = C:\\\\logs\\\\debug.log filters = threshold filter.threshold.type = ThresholdFilter filter.threshold.level = debug appenders = rolling appender.rolling.type = RollingFile appender.rolling.name = RollingFile appender.rolling.fileName = ${filename} appender.rolling.filePattern = debug-backup-%d{MM-dd-yy-HH-mm-ss}-%i.log.gz appender.rolling.layout.type = PatternLayout appender.rolling.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n appender.rolling.policies.type = Policies appender.rolling.policies.time.type = TimeBasedTriggeringPolicy appender.rolling.policies.time.interval = 1 appender.rolling.policies.time.modulate = true appender."
    },{
      "title": "Git-rebaseç”¨æ³•.md",
      "url": "https://qiref.github.io/post/2021/08/09/git-rebase%E7%94%A8%E6%B3%95.md/",
      "content": "æ‘˜è¦ï¼šGit rebase çš„ä½¿ç”¨æ–¹æ³•ã€‚\ncommit åˆå¹¶ å½“å¤šä¸ªcommitå­˜åœ¨æ—¶ï¼Œæäº¤MRä¼šå‡ºç°å¾ˆå¤šçš„commitï¼Œreviewä¼šå¾ˆå›°éš¾ï¼Œè¿™æ—¶å¯ä»¥å°†å¤šä¸ªcommitåˆå¹¶ä¸ºä¸€ä¸ªcommitã€‚\nå‘½ä»¤è¯´æ˜ï¼š\ngit rebase -i [startpoint] [endpoint] å…¶ä¸­-içš„æ„æ€æ˜¯\u0026ndash;interactiveï¼Œå³å¼¹å‡ºäº¤äº’å¼çš„ç•Œé¢è®©ç”¨æˆ·ç¼–è¾‘å®Œæˆåˆå¹¶æ“ä½œï¼Œ[startpoint] [endpoint] åˆ™æŒ‡å®šäº†ä¸€ä¸ªç¼–è¾‘åŒºé—´ï¼Œå¦‚æœä¸æŒ‡å®š[endpoint]ï¼Œåˆ™è¯¥åŒºé—´çš„ç»ˆç‚¹é»˜è®¤æ˜¯å½“å‰åˆ†æ”¯HEADæ‰€æŒ‡å‘çš„commit(æ³¨ï¼šè¯¥åŒºé—´æŒ‡å®šçš„æ˜¯ä¸€ä¸ªå‰å¼€åé—­çš„åŒºé—´)ã€‚ åœ¨æŸ¥çœ‹åˆ°äº†logæ—¥å¿—åï¼Œæˆ‘ä»¬è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit rebase -i 36224db or git rebase -i HEAD~3 # åˆå¹¶æœ€è¿‘ä¸‰æ¬¡commit æ¯ä¸€ä¸ªcommit id å‰é¢çš„pickè¡¨ç¤ºæŒ‡ä»¤ç±»å‹ï¼Œgit ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤: pickï¼šä¿ç•™è¯¥commitï¼ˆç¼©å†™:pï¼‰ rewordï¼šä¿ç•™è¯¥commitï¼Œä½†æˆ‘éœ€è¦ä¿®æ”¹è¯¥commitçš„æ³¨é‡Šï¼ˆç¼©å†™:rï¼‰ editï¼šä¿ç•™è¯¥commit, ä½†æˆ‘è¦åœä¸‹æ¥ä¿®æ”¹è¯¥æäº¤(ä¸ä»…ä»…ä¿®æ”¹æ³¨é‡Š)ï¼ˆç¼©å†™:eï¼‰ squashï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼ˆç¼©å†™:sï¼‰ fixupï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼Œä½†æˆ‘ä¸è¦ä¿ç•™è¯¥æäº¤çš„æ³¨é‡Šä¿¡æ¯ï¼ˆç¼©å†™:fï¼‰ execï¼šæ‰§è¡Œshellå‘½ä»¤ï¼ˆç¼©å†™:xï¼‰ dropï¼šæˆ‘è¦ä¸¢å¼ƒè¯¥commitï¼ˆç¼©å†™:dï¼‰\nç¤ºä¾‹ git log commit 4ab2734f3380fbdace8620f461cd04c7993b6b0b (HEAD -\u0026gt; master) Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 16:38:25 2021 +0800 add something 2 commit 60d0bbbe094c0b93903ab995879d30246bbf331e Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 16:38:02 2021 +0800 add something 1 commit 1c3c12316449cf4f340c68e22c70caa60178ba5c Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 16:37:43 2021 +0800 add something commit 7a9ab6f445ce0c7525a5dce3ca15fe600282553b Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 09:31:11 2021 +0800 [update] readme ç°åœ¨åˆå¹¶æœ€è¿‘ä¸‰æ¬¡çš„commitã€‚\ngit rebase -i 7a9ab6f445ce0c7525a5dce3ca15fe600282553b pick 1c3c123 add something s 60d0bbb add something 1 s 4ab2734 add something 2 # Rebase 7a9ab6f..4ab2734 onto 7a9ab6f (3 commands) # # Commands: # p, pick \u0026lt;commit\u0026gt; = use commit # r, reword \u0026lt;commit\u0026gt; = use commit, but edit the commit message # e, edit \u0026lt;commit\u0026gt; = use commit, but stop for amending # s, squash \u0026lt;commit\u0026gt; = use commit, but meld into previous commit # f, fixup \u0026lt;commit\u0026gt; = like \u0026quot;squash\u0026quot;, but discard this commit's log message # x, exec \u0026lt;command\u0026gt; = run command (the rest of the line) using shell # b, break = stop here (continue rebase later with 'git rebase --continue') # d, drop \u0026lt;commit\u0026gt; = remove commit # l, label \u0026lt;label\u0026gt; = label current HEAD with a name # t, reset \u0026lt;label\u0026gt; = reset HEAD to a label # m, merge [-C \u0026lt;commit\u0026gt; | -c \u0026lt;commit\u0026gt;] \u0026lt;label\u0026gt; [# \u0026lt;oneline\u0026gt;] # . create a merge commit using the original merge commit's # . message (or the oneline, if no original merge commit was # . specified). Use -c \u0026lt;commit\u0026gt; to reword the commit message. # # These lines can be re-ordered; they are executed from top to bottom. # # If you remove a line here THAT COMMIT WILL BE LOST. # # However, if you remove everything, the rebase will be aborted. ç„¶åç»§ç»­ç¼–è¾‘ï¼Œé€‰æ‹©commit messageï¼Œåˆ é™¤åä¸¤æ¬¡çš„commit messageã€‚\n# This is a combination of 3 commits. # This is the 1st commit message: add something # This is the commit message #2: add something 1 # åˆ é™¤è¿™è¡Œ # This is the commit message #3: add something 2 # åˆ é™¤è¿™è¡Œ # Please enter the commit message for your changes. Lines starting # with '#' will be ignored, and an empty message aborts the commit. # # Date: Mon Aug 9 16:37:43 2021 +0800 # # interactive rebase in progress; onto 7a9ab6f # Last commands done (3 commands done): # squash 60d0bbb add something 1 # squash 4ab2734 add something 2 # No commands remaining. # You are currently rebasing branch 'master' on '7a9ab6f'. # # Changes to be committed: # modified: README.md ä¿å­˜é€€å‡ºåï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºä¿¡æ¯ï¼š\n[detached HEAD 98eef0d] add something Date: Mon Aug 9 16:37:43 2021 +0800 1 file changed, 8 insertions(+) Successfully rebased and updated refs/heads/master. å¦‚æœåç»­æ¨é€åˆ°è¿œç¨‹ï¼Œéœ€è¦ git push origin --force xxx ï¼Œå¼ºåˆ¶è¦†ç›–è¿œç¨‹ä»£ç ã€‚\nåŒæ­¥masterä»£ç  å¼€å‘æ—¶ï¼Œä»masterä¸Šcheckoutä¸€ä¸ªdevåˆ†æ”¯ï¼Œå¼€å‘ä¸€æ®µæ—¶é—´åï¼Œmasterä¸Šçš„ä»£ç æœ‰æ›´æ–°ï¼Œè¿™æ—¶ä»masterä¸Šæ‹‰å–æ›´æ–°ã€‚\ngit rebase origin master # ç­‰ä»·äº git pull origin master --rebase git rebase --continue git rebase --abort åœ¨rebaseçš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè®¸ä¼šå‡ºç°å†²çª(conflict)ï¼Œåœ¨è¿™ç§æƒ…å†µï¼ŒGitä¼šåœæ­¢rebaseå¹¶ä¼šè®©ä½ å»è§£å†³å†²çªï¼›\ngit add conflict file git rebase --continue åœ¨è§£å†³å®Œå†²çªåï¼Œç”¨git-addå»æ›´æ–°è¿™äº›å†…å®¹çš„ç´¢å¼•(index)ï¼Œ ç„¶åï¼Œä½ æ— éœ€æ‰§è¡Œ git-commit,åªè¦æ‰§è¡Œ: git rebase --continueè¿™æ ·gitä¼šç»§ç»­åº”ç”¨(apply)ä½™ä¸‹çš„è¡¥ä¸ã€‚\nåœ¨ä»»ä½•æ—¶å€™ï¼Œä½ å¯ä»¥ç”¨ git rebase --abortæ¥ç»ˆæ­¢rebaseçš„è¡ŒåŠ¨ï¼Œå¹¶ä¸”\u0026quot;mywork\u0026quot; åˆ†æ”¯ä¼šå›åˆ°rebaseå¼€å§‹å‰çš„çŠ¶æ€ã€‚\ngit merge ä¸ git rebase çš„æœ€ç»ˆæ•ˆæœæ˜¯ä¸€è‡´çš„ï¼Œä½†git mergeä¼šäº§ç”Ÿåˆå¹¶è®°å½•ï¼Œä½¿ç”¨git rebase ä¼šè®©åˆ†æ”¯çœ‹èµ·æ¥æ²¡æœ‰åˆå¹¶ä¸€æ ·ã€‚\n",
      "summary": "æ‘˜è¦ï¼šGit rebase çš„ä½¿ç”¨æ–¹æ³•ã€‚\ncommit åˆå¹¶ å½“å¤šä¸ªcommitå­˜åœ¨æ—¶ï¼Œæäº¤MRä¼šå‡ºç°å¾ˆå¤šçš„commitï¼Œreviewä¼šå¾ˆå›°éš¾ï¼Œè¿™æ—¶å¯ä»¥å°†å¤šä¸ªcommitåˆå¹¶ä¸ºä¸€ä¸ªcommitã€‚\nå‘½ä»¤è¯´æ˜ï¼š\ngit rebase -i [startpoint] [endpoint] å…¶ä¸­-içš„æ„æ€æ˜¯\u0026ndash;interactiveï¼Œå³å¼¹å‡ºäº¤äº’å¼çš„ç•Œé¢è®©ç”¨æˆ·ç¼–è¾‘å®Œæˆåˆå¹¶æ“ä½œï¼Œ[startpoint] [endpoint] åˆ™æŒ‡å®šäº†ä¸€ä¸ªç¼–è¾‘åŒºé—´ï¼Œå¦‚æœä¸æŒ‡å®š[endpoint]ï¼Œåˆ™è¯¥åŒºé—´çš„ç»ˆç‚¹é»˜è®¤æ˜¯å½“å‰åˆ†æ”¯HEADæ‰€æŒ‡å‘çš„commit(æ³¨ï¼šè¯¥åŒºé—´æŒ‡å®šçš„æ˜¯ä¸€ä¸ªå‰å¼€åé—­çš„åŒºé—´)ã€‚ åœ¨æŸ¥çœ‹åˆ°äº†logæ—¥å¿—åï¼Œæˆ‘ä»¬è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit rebase -i 36224db or git rebase -i HEAD~3 # åˆå¹¶æœ€è¿‘ä¸‰æ¬¡commit æ¯ä¸€ä¸ªcommit id å‰é¢çš„pickè¡¨ç¤ºæŒ‡ä»¤ç±»å‹ï¼Œgit ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤: pickï¼šä¿ç•™è¯¥commitï¼ˆç¼©å†™:pï¼‰ rewordï¼šä¿ç•™è¯¥commitï¼Œä½†æˆ‘éœ€è¦ä¿®æ”¹è¯¥commitçš„æ³¨é‡Šï¼ˆç¼©å†™:rï¼‰ editï¼šä¿ç•™è¯¥commit, ä½†æˆ‘è¦åœä¸‹æ¥ä¿®æ”¹è¯¥æäº¤(ä¸ä»…ä»…ä¿®æ”¹æ³¨é‡Š)ï¼ˆç¼©å†™:eï¼‰ squashï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼ˆç¼©å†™:sï¼‰ fixupï¼šå°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ï¼Œä½†æˆ‘ä¸è¦ä¿ç•™è¯¥æäº¤çš„æ³¨é‡Šä¿¡æ¯ï¼ˆç¼©å†™:fï¼‰ execï¼šæ‰§è¡Œshellå‘½ä»¤ï¼ˆç¼©å†™:xï¼‰ dropï¼šæˆ‘è¦ä¸¢å¼ƒè¯¥commitï¼ˆç¼©å†™:dï¼‰\nç¤ºä¾‹ git log commit 4ab2734f3380fbdace8620f461cd04c7993b6b0b (HEAD -\u0026gt; master) Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 16:38:25 2021 +0800 add something 2 commit 60d0bbbe094c0b93903ab995879d30246bbf331e Author: archieyao \u0026lt;archieyao@tencent.com\u0026gt; Date: Mon Aug 9 16:38:02 2021 +0800 add something 1 commit 1c3c12316449cf4f340c68e22c70caa60178ba5c Author: archieyao \u0026lt;archieyao@tencent."
    },{
      "title": "Gitå·¥ç¨‹æ‹†åˆ†",
      "url": "https://qiref.github.io/post/2021/07/08/git%E5%B7%A5%E7%A8%8B%E6%8B%86%E5%88%86/",
      "content": "æ‘˜è¦ï¼šGitå°†å·¥ç¨‹æŒ‰ç›®å½•æ‹†åˆ†ã€‚\n# /project/ # ----/test/ # å°†testç›®å½•æŠ½æˆå•ç‹¬çš„å·¥ç¨‹ cd /project/test # æ‹†åˆ†å­ç›®å½• $ git subtree split -P test -b test-new-br $ mkdir ../test-new-br $ cd ../test-new-br # åˆ›å»ºå­å·¥ç¨‹ $ git init $ git pull ../project test-new-br # git log å¯ä»¥çœ‹åˆ°å†å²commit \u0026#x1f635;\n",
      "summary": "æ‘˜è¦ï¼šGitå°†å·¥ç¨‹æŒ‰ç›®å½•æ‹†åˆ†ã€‚\n# /project/ # ----/test/ # å°†testç›®å½•æŠ½æˆå•ç‹¬çš„å·¥ç¨‹ cd /project/test # æ‹†åˆ†å­ç›®å½• $ git subtree split -P test -b test-new-br $ mkdir ../test-new-br $ cd ../test-new-br # åˆ›å»ºå­å·¥ç¨‹ $ git init $ git pull ../project test-new-br # git log å¯ä»¥çœ‹åˆ°å†å²commit \u0026#x1f635;"
    },{
      "title": "Kubernatesä¸­çš„pod",
      "url": "https://qiref.github.io/post/2021/06/29/kubernates%E4%B8%AD%E7%9A%84pod/",
      "content": "æ‘˜è¦ï¼šè¿è¡Œåœ¨Kubernatesä¸­çš„å®¹å™¨ï¼špodã€‚ç”±äºä¸èƒ½å°†å¤šä¸ªè¿›ç¨‹èšé›†åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜çº§çš„ç»“æ„å°†å®¹å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼Œå°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œç®¡ç†ï¼Œè¿™å°±æ˜¯podè¯ç”Ÿçš„åŸå› ã€‚\npodåŸºæœ¬æ¦‚å¿µ podæ˜¯Kubernetesä¸­æœ€é‡è¦çš„æ¦‚å¿µï¼Œpodæ˜¯Kubernetesä¸­éƒ¨ç½²çš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œpodæœ‰è‡ªå·±ç‹¬ç«‹çš„ç§æœ‰IPå’Œä¸»æœºåã€‚\nKubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š\nè¿è¡Œå•ä¸ªå®¹å™¨çš„ Podã€‚\u0026ldquo;æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨\u0026quot;æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚ è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨çš„ Podã€‚ Pod å¯èƒ½å°è£…ç”±å¤šä¸ªç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å…±å¤„å®¹å™¨ç»„æˆçš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨å¯èƒ½å½¢æˆå•ä¸ªå†…èšçš„æœåŠ¡å•å…ƒï¼Œä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå’Œvolumeï¼Œå¹¶ä¸”podä¸­çš„å®¹å™¨å…±äº«ç›¸åŒçš„å‘½åç©ºé—´ã€‚ï¼ˆç”±äºä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œï¼Œå› æ­¤ä¹Ÿå°±å…±äº«ç«¯å£å’ŒIPã€‚ï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æ˜¯å¤šä¸ªå®¹å™¨éœ€è¦å…±ç”¨netæˆ–volumeï¼Œå°½å¯èƒ½åœ°æŠŠä¸åŒçš„å®¹å™¨æ”¾åˆ°ä¸åŒçš„podä¸­ï¼Œæ–°å»ºä¸€ä¸ªpodä¸éœ€è¦è€—è´¹å¾ˆå¤šèµ„æºï¼ŒKuberneteså¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹podè¿›è¡Œç®¡ç†å’Œæ‰©å®¹ã€ç¼©å®¹ç­‰æ“ä½œï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨åŸºç¡€èµ„æºã€‚\næ€»ç»“æ¥è¯´ï¼Œpodå°±æ˜¯é€»è¾‘ä¸Šçš„ä¸»æœºã€‚\npodç”Ÿå‘½å‘¨æœŸ Pendingï¼šè¡¨ç¤ºpodå·²ç»è¢«åŒæ„åˆ›å»ºï¼Œæ­£åœ¨ç­‰å¾…kube-scheduleré€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹åˆ›å»ºï¼Œä¸€èˆ¬æ˜¯åœ¨å‡†å¤‡é•œåƒï¼› Runningï¼šè¡¨ç¤ºpodä¸­æ‰€æœ‰çš„å®¹å™¨å·²ç»è¢«åˆ›å»ºï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œæˆ–è€…æ˜¯æ­£åœ¨å¯åŠ¨æˆ–è€…æ˜¯æ­£åœ¨é‡å¯ï¼› Succeededï¼šè¡¨ç¤ºæ‰€æœ‰å®¹å™¨å·²ç»æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†å¯åŠ¨ï¼› Failedï¼šè¡¨ç¤ºpodä¸­æ‰€æœ‰å®¹å™¨éƒ½æ˜¯é0ï¼ˆä¸æ­£å¸¸ï¼‰çŠ¶æ€é€€å‡ºï¼› Unknownï¼šè¡¨ç¤ºæ— æ³•è¯»å–PodçŠ¶æ€ï¼Œé€šå¸¸æ˜¯kube-controller-manageræ— æ³•ä¸Podé€šä¿¡ã€‚ åˆ›å»ºpodæµç¨‹ å®¢æˆ·ç«¯æäº¤Podçš„é…ç½®ä¿¡æ¯ï¼ˆå¯ä»¥æ˜¯yamlæ–‡ä»¶å®šä¹‰å¥½çš„ä¿¡æ¯ï¼‰åˆ°kube-apiserverï¼› Apiserveræ”¶åˆ°æŒ‡ä»¤åï¼Œé€šçŸ¥ç»™controller-manageråˆ›å»ºä¸€ä¸ªèµ„æºå¯¹è±¡ï¼› Controller-manageré€šè¿‡api-serverå°†podçš„é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ETCDæ•°æ®ä¸­å¿ƒä¸­ï¼› Kube-scheduleræ£€æµ‹åˆ°podä¿¡æ¯ä¼šå¼€å§‹è°ƒåº¦é¢„é€‰ï¼Œä¼šå…ˆè¿‡æ»¤æ‰ä¸ç¬¦åˆPodèµ„æºé…ç½®è¦æ±‚çš„èŠ‚ç‚¹ï¼Œç„¶åå¼€å§‹è°ƒåº¦è°ƒä¼˜ï¼Œä¸»è¦æ˜¯æŒ‘é€‰å‡ºæ›´é€‚åˆè¿è¡Œpodçš„èŠ‚ç‚¹ï¼Œç„¶åå°†podçš„èµ„æºé…ç½®å•å‘é€åˆ°nodeèŠ‚ç‚¹ä¸Šçš„kubeletç»„ä»¶ä¸Šã€‚ Kubeletæ ¹æ®schedulerå‘æ¥çš„èµ„æºé…ç½®å•è¿è¡Œpodï¼Œè¿è¡ŒæˆåŠŸåï¼Œå°†podçš„è¿è¡Œä¿¡æ¯è¿”å›ç»™schedulerï¼Œschedulerå°†è¿”å›çš„podè¿è¡ŒçŠ¶å†µçš„ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®ä¸­å¿ƒã€‚ åˆ é™¤podæµç¨‹ podä»serviceçš„endpointåˆ—è¡¨ä¸­è¢«ç§»é™¤ï¼› å¦‚æœè¯¥podå®šä¹‰äº†ä¸€ä¸ªåœæ­¢å‰çš„é’©å­ï¼Œå…¶ä¼šåœ¨podå†…éƒ¨è¢«è°ƒç”¨ï¼Œåœæ­¢é’©å­ä¸€èˆ¬å®šä¹‰äº†å¦‚ä½•ä¼˜é›…çš„ç»“æŸè¿›ç¨‹ï¼› è¿›ç¨‹è¢«å‘é€TERMä¿¡å·ï¼ˆkill -14ï¼‰ï¼› å½“è¶…è¿‡ä¼˜é›…é€€å‡ºçš„æ—¶é—´åï¼ŒPodä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½ä¼šè¢«å‘é€SIGKILLä¿¡å·ï¼ˆkill -9ï¼‰ã€‚ podå¸¸ç”¨å‘½ä»¤ kubectl describe po cluster-admin-0 -n default # è·å–æŒ‡å®šnamespacesä¸‹çš„podè¯¦æƒ…ï¼Œå¯ä»¥çœ‹å‡ºcontainerä¿¡æ¯ kubectl get pods --all-namespaces # è·å–æ‰€æœ‰namespacesä¸‹çš„pod kubectl get pods -n default # -n è·å–æŒ‡å®šnamaspacesä¸‹çš„pod kubectl get pod podname -nkube-system -oyaml # è·å–podçš„è¯¦æƒ…ï¼Œ-oyaml ä»¥yamlæ ¼å¼è¾“å‡ºï¼Œä¹Ÿå¯ä»¥ -ojson kubectl exec -it taskcenter-0 -c loglistener -noceanus /bin/bash # è¿›å…¥æŸä¸ªpodä¸‹çš„cotainer kubectl logs tke-log-agent-2687c -c loglistener # è·å–æŸä¸ªpodä¸‹cotainerçš„logï¼Œä¹Ÿå¯ä»¥åŠ  -f å‚æ•°ï¼Œç±»ä¼¼äº tail -f åˆ›å»ºpodçš„æ–¹å¼ podæœ¬èº«ä¸å…·å¤‡æ•…éšœé‡å¯ä»¥åŠå‰¯æœ¬ç­‰åŠŸèƒ½ï¼Œä¸€èˆ¬ä½¿ç”¨å…¶ä»–çš„èµ„æºåˆ›å»ºpodã€‚\nReplicaSet æ›¿ä»£ ReplicationControllerï¼Œå¯ä»¥å§‹ç»ˆä¿æŒæ‰€éœ€æ•°é‡çš„podå‰¯æœ¬æ­£åœ¨è¿è¡Œï¼ŒReplicaSetå…·å¤‡æ›´å¼ºçš„selector expressionã€‚ DaemonSetå¯ä»¥ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªpodå®ä¾‹ï¼Œè€ŒReplicaSet å’Œ ReplicationController ä¼šå°†podéšæœºå®‰æ’åˆ°é›†ç¾¤èŠ‚ç‚¹ã€‚ Jobå¯ä»¥åˆ›å»ºæ‰¹å¤„ç†ä»»åŠ¡ï¼Œå¯ä»¥åœ¨Jobä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªpodï¼Œå‘¨æœŸæ€§è¿è¡Œæˆ–åœ¨æŸä¸ªæ—¶é—´è¿è¡Œçš„Jobå¯ä»¥é€šè¿‡CronJobå®ç°ã€‚ å‚è€ƒï¼š\nhttps://kubernetes.io/zh/docs/concepts/workloads/pods/\nã€ŠKubernetes in Actionã€‹\n",
      "summary": "æ‘˜è¦ï¼šè¿è¡Œåœ¨Kubernatesä¸­çš„å®¹å™¨ï¼špodã€‚ç”±äºä¸èƒ½å°†å¤šä¸ªè¿›ç¨‹èšé›†åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜çº§çš„ç»“æ„å°†å®¹å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼Œå°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œç®¡ç†ï¼Œè¿™å°±æ˜¯podè¯ç”Ÿçš„åŸå› ã€‚\npodåŸºæœ¬æ¦‚å¿µ podæ˜¯Kubernetesä¸­æœ€é‡è¦çš„æ¦‚å¿µï¼Œpodæ˜¯Kubernetesä¸­éƒ¨ç½²çš„æœ€å°å•å…ƒï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œpodæœ‰è‡ªå·±ç‹¬ç«‹çš„ç§æœ‰IPå’Œä¸»æœºåã€‚\nKubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š\nè¿è¡Œå•ä¸ªå®¹å™¨çš„ Podã€‚\u0026ldquo;æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨\u0026quot;æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚ è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨çš„ Podã€‚ Pod å¯èƒ½å°è£…ç”±å¤šä¸ªç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å…±å¤„å®¹å™¨ç»„æˆçš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨å¯èƒ½å½¢æˆå•ä¸ªå†…èšçš„æœåŠ¡å•å…ƒï¼Œä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå’Œvolumeï¼Œå¹¶ä¸”podä¸­çš„å®¹å™¨å…±äº«ç›¸åŒçš„å‘½åç©ºé—´ã€‚ï¼ˆç”±äºä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œï¼Œå› æ­¤ä¹Ÿå°±å…±äº«ç«¯å£å’ŒIPã€‚ï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æ˜¯å¤šä¸ªå®¹å™¨éœ€è¦å…±ç”¨netæˆ–volumeï¼Œå°½å¯èƒ½åœ°æŠŠä¸åŒçš„å®¹å™¨æ”¾åˆ°ä¸åŒçš„podä¸­ï¼Œæ–°å»ºä¸€ä¸ªpodä¸éœ€è¦è€—è´¹å¾ˆå¤šèµ„æºï¼ŒKuberneteså¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹podè¿›è¡Œç®¡ç†å’Œæ‰©å®¹ã€ç¼©å®¹ç­‰æ“ä½œï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨åŸºç¡€èµ„æºã€‚\næ€»ç»“æ¥è¯´ï¼Œpodå°±æ˜¯é€»è¾‘ä¸Šçš„ä¸»æœºã€‚\npodç”Ÿå‘½å‘¨æœŸ Pendingï¼šè¡¨ç¤ºpodå·²ç»è¢«åŒæ„åˆ›å»ºï¼Œæ­£åœ¨ç­‰å¾…kube-scheduleré€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹åˆ›å»ºï¼Œä¸€èˆ¬æ˜¯åœ¨å‡†å¤‡é•œåƒï¼› Runningï¼šè¡¨ç¤ºpodä¸­æ‰€æœ‰çš„å®¹å™¨å·²ç»è¢«åˆ›å»ºï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œæˆ–è€…æ˜¯æ­£åœ¨å¯åŠ¨æˆ–è€…æ˜¯æ­£åœ¨é‡å¯ï¼› Succeededï¼šè¡¨ç¤ºæ‰€æœ‰å®¹å™¨å·²ç»æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†å¯åŠ¨ï¼› Failedï¼šè¡¨ç¤ºpodä¸­æ‰€æœ‰å®¹å™¨éƒ½æ˜¯é0ï¼ˆä¸æ­£å¸¸ï¼‰çŠ¶æ€é€€å‡ºï¼› Unknownï¼šè¡¨ç¤ºæ— æ³•è¯»å–PodçŠ¶æ€ï¼Œé€šå¸¸æ˜¯kube-controller-manageræ— æ³•ä¸Podé€šä¿¡ã€‚ åˆ›å»ºpodæµç¨‹ å®¢æˆ·ç«¯æäº¤Podçš„é…ç½®ä¿¡æ¯ï¼ˆå¯ä»¥æ˜¯yamlæ–‡ä»¶å®šä¹‰å¥½çš„ä¿¡æ¯ï¼‰åˆ°kube-apiserverï¼› Apiserveræ”¶åˆ°æŒ‡ä»¤åï¼Œé€šçŸ¥ç»™controller-manageråˆ›å»ºä¸€ä¸ªèµ„æºå¯¹è±¡ï¼› Controller-manageré€šè¿‡api-serverå°†podçš„é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ETCDæ•°æ®ä¸­å¿ƒä¸­ï¼› Kube-scheduleræ£€æµ‹åˆ°podä¿¡æ¯ä¼šå¼€å§‹è°ƒåº¦é¢„é€‰ï¼Œä¼šå…ˆè¿‡æ»¤æ‰ä¸ç¬¦åˆPodèµ„æºé…ç½®è¦æ±‚çš„èŠ‚ç‚¹ï¼Œç„¶åå¼€å§‹è°ƒåº¦è°ƒä¼˜ï¼Œä¸»è¦æ˜¯æŒ‘é€‰å‡ºæ›´é€‚åˆè¿è¡Œpodçš„èŠ‚ç‚¹ï¼Œç„¶åå°†podçš„èµ„æºé…ç½®å•å‘é€åˆ°nodeèŠ‚ç‚¹ä¸Šçš„kubeletç»„ä»¶ä¸Šã€‚ Kubeletæ ¹æ®schedulerå‘æ¥çš„èµ„æºé…ç½®å•è¿è¡Œpodï¼Œè¿è¡ŒæˆåŠŸåï¼Œå°†podçš„è¿è¡Œä¿¡æ¯è¿”å›ç»™schedulerï¼Œschedulerå°†è¿”å›çš„podè¿è¡ŒçŠ¶å†µçš„ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®ä¸­å¿ƒã€‚ åˆ é™¤podæµç¨‹ podä»serviceçš„endpointåˆ—è¡¨ä¸­è¢«ç§»é™¤ï¼› å¦‚æœè¯¥podå®šä¹‰äº†ä¸€ä¸ªåœæ­¢å‰çš„é’©å­ï¼Œå…¶ä¼šåœ¨podå†…éƒ¨è¢«è°ƒç”¨ï¼Œåœæ­¢é’©å­ä¸€èˆ¬å®šä¹‰äº†å¦‚ä½•ä¼˜é›…çš„ç»“æŸè¿›ç¨‹ï¼› è¿›ç¨‹è¢«å‘é€TERMä¿¡å·ï¼ˆkill -14ï¼‰ï¼› å½“è¶…è¿‡ä¼˜é›…é€€å‡ºçš„æ—¶é—´åï¼ŒPodä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½ä¼šè¢«å‘é€SIGKILLä¿¡å·ï¼ˆkill -9ï¼‰ã€‚ podå¸¸ç”¨å‘½ä»¤ kubectl describe po cluster-admin-0 -n default # è·å–æŒ‡å®šnamespacesä¸‹çš„podè¯¦æƒ…ï¼Œå¯ä»¥çœ‹å‡ºcontainerä¿¡æ¯ kubectl get pods --all-namespaces # è·å–æ‰€æœ‰namespacesä¸‹çš„pod kubectl get pods -n default # -n è·å–æŒ‡å®šnamaspacesä¸‹çš„pod kubectl get pod podname -nkube-system -oyaml # è·å–podçš„è¯¦æƒ…ï¼Œ-oyaml ä»¥yamlæ ¼å¼è¾“å‡ºï¼Œä¹Ÿå¯ä»¥ -ojson kubectl exec -it taskcenter-0 -c loglistener -noceanus /bin/bash # è¿›å…¥æŸä¸ªpodä¸‹çš„cotainer kubectl logs tke-log-agent-2687c -c loglistener # è·å–æŸä¸ªpodä¸‹cotainerçš„logï¼Œä¹Ÿå¯ä»¥åŠ  -f å‚æ•°ï¼Œç±»ä¼¼äº tail -f åˆ›å»ºpodçš„æ–¹å¼ podæœ¬èº«ä¸å…·å¤‡æ•…éšœé‡å¯ä»¥åŠå‰¯æœ¬ç­‰åŠŸèƒ½ï¼Œä¸€èˆ¬ä½¿ç”¨å…¶ä»–çš„èµ„æºåˆ›å»ºpodã€‚"
    },{
      "title": "Dockeræ„å»ºGoå·¥ç¨‹é•œåƒ",
      "url": "https://qiref.github.io/post/2021/06/23/docker%E6%9E%84%E5%BB%BAgo%E5%B7%A5%E7%A8%8B%E9%95%9C%E5%83%8F/",
      "content": "æ‘˜è¦ï¼šDockeræ„å»ºGoå·¥ç¨‹é•œåƒã€‚\nå·¥ç¨‹ å·¥ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„Http serverçš„demoï¼Œç°åœ¨å°†è¿™ä¸ªå·¥ç¨‹æ„å»ºä¸ºdockeré•œåƒã€‚\nimport ( \u0026quot;fmt\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; ) func Init() { log.Println(\u0026quot;start server\u0026quot;) http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) http.Handle(\u0026quot;/test_handle\u0026quot;, \u0026amp;TestHandleStruct{content: \u0026quot;test handle\u0026quot;}) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) } func main() { // å¯åŠ¨HTTPæœåŠ¡ server.Init() } æ„å»º éœ€è¦åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªDockerfile\nå†…å®¹å¦‚ä¸‹ï¼š\n# æ‹‰å–Goè¯­è¨€çš„ç‰ˆæœ¬ FROM golang:1.16 # åœ¨å®¹å™¨å†…è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # æŠŠæ–‡ä»¶å¤åˆ¶åˆ°å½“å‰å·¥ä½œç›®å½• COPY . . FROM alpine:latest as prod # è®¾ç½®GOPROXYçš„ç¯å¢ƒå˜é‡ ENV GOPROXY=\u0026quot;https://goproxy.cn\u0026quot; # ç¼–è¯‘é¡¹ç›® #RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./bin/go_http_server_demo ./src/main/main.go ADD ./bin/go_http_server_demo ./ # æš´éœ²ç«¯å£ EXPOSE 8080 # å¯æ‰§è¡Œæ–‡ä»¶ CMD [\u0026quot;./go_http_server_demo\u0026quot;] ç„¶ååˆ°æ ¹ç›®å½•ä¸‹ç¼–è¯‘é¡¹ç›®ï¼Œæ³¨æ„ç¼–è¯‘æ—¶è¦æ ¹æ®å½“å‰æœºå™¨çš„ç±»å‹è®¾ç½®ç¯å¢ƒå˜é‡ï¼š\nCGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./bin/go_http_server_demo ./src/main/main.go binç›®å½•ä¸‹å°±ä¼šå¤šä¸ªä¸€ä¸ª go_http_server_demo æ–‡ä»¶ã€‚\nâ‡’ docker build -t go_http_server_demo . [+] Building 5.6s (7/7) FINISHED =\u0026gt; [internal] load build definition from Dockerfile 0.0s =\u0026gt; =\u0026gt; transferring dockerfile: 503B 0.0s =\u0026gt; [internal] load .dockerignore 0.0s =\u0026gt; =\u0026gt; transferring context: 2B 0.0s =\u0026gt; [internal] load metadata for docker.io/library/alpine:latest 5.4s =\u0026gt; [internal] load build context 0.0s =\u0026gt; =\u0026gt; transferring context: 70B 0.0s =\u0026gt; CACHED [prod 1/2] FROM docker.io/library/alpine:latest@sha256:234cb88d3020898631af0ccbbcca9a66ae7306ecd30c9720690858c1b007d2a0 0.0s =\u0026gt; [prod 2/2] ADD ./bin/go_http_server_demo ./ 0.0s =\u0026gt; exporting to image 0.0s =\u0026gt; =\u0026gt; exporting layers 0.0s =\u0026gt; =\u0026gt; writing image sha256:ee46f381509fe33f160de563c185b368dcd200adddcb9b663a6656f75b767621 0.0s =\u0026gt; =\u0026gt; naming to docker.io/library/go_http_server_demo 0.0s æ²¡æœ‰æŠ¥é”™è¯´æ˜é•œåƒæ„å»ºå®Œæˆã€‚\nâ‡’ docker images REPOSITORY TAG IMAGE ID CREATED SIZE go_http_server_demo latest ee46f381509f 47 minutes ago 11.7MB å¯åŠ¨ docker run --name go_http_server_demo -p 8080:8080 -d go_http_server_demo docker ps # æŸ¥çœ‹å¯åŠ¨æƒ…å†µ \u0026ndash;name go_http_server_demo æŒ‡å®šcontainerçš„åç§° -p 8080:8080 å°†æœ¬åœ°çš„8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„8080ç«¯å£ -d æŒ‡å®šå®¹å™¨åå°è¿è¡Œï¼Œæ‰§è¡Œåå½“å‰ç»ˆç«¯å¯ä»¥é€€å‡º go_http_server_demo æŒ‡å®šé•œåƒåç§° â‡’ docker exec -it 105fdcefe795 sh / # ps PID USER TIME COMMAND 1 root 0:00 ./go_http_server_demo 12 root 0:00 sh 19 root 0:00 ps / # å¯ä»¥ç™»å½•åˆ°å®¹å™¨ä¸­æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œæƒ…å†µã€‚\ncurl -X GET \u0026quot;http://127.0.0.1:8080/hello_world\u0026quot; æœ€åå¯ä»¥åœ¨æœ¬æœºè®¿é—®æ¥å£æµ‹è¯•å®¹å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚\n",
      "summary": "æ‘˜è¦ï¼šDockeræ„å»ºGoå·¥ç¨‹é•œåƒã€‚\nå·¥ç¨‹ å·¥ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„Http serverçš„demoï¼Œç°åœ¨å°†è¿™ä¸ªå·¥ç¨‹æ„å»ºä¸ºdockeré•œåƒã€‚\nimport ( \u0026quot;fmt\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; ) func Init() { log.Println(\u0026quot;start server\u0026quot;) http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) http.Handle(\u0026quot;/test_handle\u0026quot;, \u0026amp;TestHandleStruct{content: \u0026quot;test handle\u0026quot;}) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) } func main() { // å¯åŠ¨HTTPæœåŠ¡ server.Init() } æ„å»º éœ€è¦åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªDockerfile\nå†…å®¹å¦‚ä¸‹ï¼š\n# æ‹‰å–Goè¯­è¨€çš„ç‰ˆæœ¬ FROM golang:1.16 # åœ¨å®¹å™¨å†…è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # æŠŠæ–‡ä»¶å¤åˆ¶åˆ°å½“å‰å·¥ä½œç›®å½• COPY . . FROM alpine:latest as prod # è®¾ç½®GOPROXYçš„ç¯å¢ƒå˜é‡ ENV GOPROXY=\u0026quot;https://goproxy.cn\u0026quot; # ç¼–è¯‘é¡¹ç›® #RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ."
    },{
      "title": "Dockerå…¥é—¨",
      "url": "https://qiref.github.io/post/2021/06/21/docker%E5%85%A5%E9%97%A8/",
      "content": "æ‘˜è¦ï¼šDockerç®€å•ä½¿ç”¨ã€‚\nDocker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€å¼€å‘ï¼Œå¹¶éµä» Apache2.0 åè®®å¼€æºã€‚ Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚\nDockerä¸‹è½½åœ°å€ï¼šhttps://www.docker.com/get-started\nå®‰è£…å®Œæˆåï¼Œæ‰å¯ä»¥æ‰§è¡Œdockerçš„ç›¸å…³å‘½ä»¤ã€‚\n$ docker system info Client: Context: default Debug Mode: false Plugins: buildx: Build with BuildKit (Docker Inc., v0.5.1-docker) compose: Docker Compose (Docker Inc., 2.0.0-beta.3) scan: Docker Scan (Docker Inc., v0.8.0) Server: Containers: 0 Running: 0 Paused: 0 Stopped: 0 Images: 0 Server Version: 20.10.7 Storage Driver: overlay2 Backing Filesystem: extfs Supports d_type: true Native Overlay Diff: true userxattr: false Logging Driver: json-file Cgroup Driver: cgroupfs Cgroup Version: 1 Plugins: Volume: local Network: bridge host ipvlan macvlan null overlay Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog Swarm: inactive Runtimes: runc io.containerd.runc.v2 io.containerd.runtime.v1.linux Default Runtime: runc Init Binary: docker-init containerd version: d71fcd7d8303cbf684402823e425e9dd2e99285d runc version: b9ee9c6314599f1b4a7f497e1f1f856fe433d3b7 init version: de40ad0 Security Options: seccomp Profile: default Kernel Version: 5.10.25-linuxkit Operating System: Docker Desktop OSType: linux Architecture: x86_64 CPUs: 6 Total Memory: 1.941GiB Name: docker-desktop ID: TA2L:IL5R:BGA2:7NS2:RE5C:LOZ6:7RHP:275V:F5OQ:KAJP:QHWN:VOQU Docker Root Dir: /var/lib/docker Debug Mode: false HTTP Proxy: http.docker.internal:3128 HTTPS Proxy: http.docker.internal:3128 Registry: https://index.docker.io/v1/ Labels: Experimental: false Insecure Registries: 127.0.0.0/8 Live Restore Enabled: false macä¸Šåœæ­¢dockeræœåŠ¡ï¼š\nâ‡’ launchctl list |grep docker - 0 com.docker.helper 11963 0 application.com.docker.docker.10740542.10740926 â‡’ launchctl stop application.com.docker.docker.10740542.10740926 è¿è¡Œhello worldå®¹å™¨ $ docker run busybox echo \u0026quot;hello world\u0026quot; Unable to find image 'busybox:latest' locally latest: Pulling from library/busybox b71f96345d44: Pull complete Digest: sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d Status: Downloaded newer image for busybox: docker run busybox echo \u0026quot;hello world\u0026quot; è¿™è¡Œå‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ªå«busyboxçš„å®¹å™¨ï¼Œå¹¶ä¸”æ‰§è¡Œäº†echo \u0026quot;hello world\u0026quot;ã€‚\nç„¶ådockerå…ˆåœ¨æœ¬åœ°æŸ¥è¯¢busyboxï¼Œå‘ç°æ²¡æœ‰æ‰¾åˆ°ï¼Œç„¶åå°±ä»è¿œç¨‹æ‹‰å–é•œåƒï¼Œæ‹‰å–å®Œæˆåå¯åŠ¨é•œåƒã€‚\nâ‡’ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE busybox latest 69593048aa3a 13 days ago 1.24MB å¯ä»¥å‘ç°æœ¬åœ°å¤šäº†ä¸€ä¸ªbusyboxçš„é•œåƒã€‚\né•œåƒ docker image ls å¯ä»¥åˆ—å‡ºæœ¬åœ°çš„æ‰€æœ‰é•œåƒï¼Œç„¶åå…·ä½“çœ‹çœ‹é•œåƒä¿¡æ¯ã€‚\nREPOSITORY TAG IMAGE ID CREATED SIZE busybox latest 69593048aa3a 13 days ago 1.24MB å„ä¸ªé€‰é¡¹è¯´æ˜:\nREPOSITORYï¼šè¡¨ç¤ºé•œåƒçš„ä»“åº“æº TAGï¼šé•œåƒçš„æ ‡ç­¾ IMAGE IDï¼šé•œåƒID CREATEDï¼šé•œåƒåˆ›å»ºæ—¶é—´ SIZEï¼šé•œåƒå¤§å° åŒä¸€ä»“åº“æºå¯ä»¥æœ‰å¤šä¸ªTAGï¼Œä»£è¡¨è¿™ä¸ªä»“åº“æºçš„ä¸åŒä¸ªç‰ˆæœ¬ï¼Œå¦‚ ubuntu ä»“åº“æºé‡Œï¼Œæœ‰ 15.10ã€14.04 ç­‰å¤šä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨ REPOSITORY:TAG æ¥å®šä¹‰ä¸åŒçš„é•œåƒã€‚ å½“é•œåƒæ²¡æœ‰æ˜¾å¼æŒ‡å®šTAGæ—¶ï¼ŒDockerä¼šé»˜è®¤æŒ‡å®šä¸ºlatestã€‚ä¾‹å¦‚ä¸Šè¿°çš„é•œåƒã€‚\nå¦‚æœæƒ³runæŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼š\ndocker run \u0026lt;image\u0026gt;:\u0026lt;tag\u0026gt; é•œåƒå¸¸ç”¨å‘½ä»¤ $ docker images # é•œåƒåˆ—è¡¨ ç­‰ä»·äº docker image ls $ docker search httpd # æŸ¥æ‰¾é•œåƒ $ docker pull httpd # æ‹‰å–é•œåƒ $ docker push httpd # å‘é•œåƒä»“åº“æ¨é€é•œåƒ $ docker run httpd # è¿è¡Œé•œåƒ $ docker rmi httpd # åˆ é™¤é•œåƒ $ docker tag 860c279d2fec runoob/centos:dev #æ‰§è¡Œè¿™æ¡å‘½ä»¤ä¸ä¼šå¾—åˆ°æ–°é•œåƒï¼Œåªä¼šç»™ä¹‹å‰çš„é•œåƒåŠ ä¸€ä¸ªTAGï¼š #REPOSITORY TAG IMAGE ID CREATED SIZE #busybox latest 69593048aa3a 13 days ago 1.24MB #busybox v1.0 69593048aa3a 13 days ago 1.24MB $ docker commit -m=\u0026quot;has update\u0026quot; -a=\u0026quot;Archie\u0026quot; ac68f5f16776 busybox:v2 # æ›´æ–°é•œåƒï¼Œéœ€è¦å€ŸåŠ©container # -m: æäº¤çš„æè¿°ä¿¡æ¯ï¼› # -a: æŒ‡å®šé•œåƒä½œè€… # ac68f5f16776ï¼šå®¹å™¨ ID # busybox:v2ï¼šæŒ‡å®šè¦åˆ›å»ºçš„ç›®æ ‡é•œåƒåä»¥åŠTAG $ docker build -t go_http_server_demo . # æ„å»ºé•œåƒï¼Œå‰ææ˜¯å½“å‰ç›®å½•ä¸‹æœ‰Dockerfileï¼Œ-t go_http_server_demo æŒ‡å®šimageçš„åç§°ï¼Œ. åŸºäºå½“å‰ç›®å½•æ„å»ºã€‚ å®¹å™¨ å¦‚æœæŠŠé•œåƒæ¯”ä½œcalssçš„è¯ï¼Œé‚£å®¹å™¨å°±æ˜¯è¿™ä¸ªclassçš„å®ä¾‹å¯¹è±¡ã€‚\nâ‡’ docker run --name busybox -it busybox / # ls bin dev etc home proc root sys tmp usr var / # exit docker run å‘½ä»¤ä»æŒ‡å®šé•œåƒè¿è¡Œå®¹å™¨ï¼Œ-i: äº¤äº’å¼æ“ä½œï¼›-t: ç»ˆç«¯ã€‚è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exitï¼›\u0026ndash;name busybox æŒ‡å®šå®¹å™¨çš„åç§°ã€‚\ndocker run --name go_http_server_demo -p 8080:8080 -d go_http_server_demo \u0026ndash;name å¯ä»¥æŒ‡å®šcontainerçš„åç§°ï¼›-p 8080:8080 ä¼šå°†æœ¬åœ°çš„ç«¯å£8080æ˜ å°„åˆ°å®¹å™¨çš„8080ç«¯å£ï¼› -d è¡¨ç¤ºè¿™ä¸ªå®¹å™¨ä¼šè¿›å…¥åå°è¿è¡Œï¼› æœ€åæŒ‡å®šäº†é•œåƒçš„åç§°ã€‚\ndocker ps -a æŸ¥çœ‹è¿è¡Œçš„æ‰€æœ‰å®¹å™¨ã€‚\nâ‡’ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 33e3123ff520 busybox \u0026quot;sh\u0026quot; 17 seconds ago Exited (0) 2 seconds ago busybox å¦‚æœæŒ‡å®š\u0026ndash;nameï¼Œä¸‹æ¬¡å†æ‰§è¡Œrunæ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š\ndocker: Error response from daemon: Conflict. The container name \u0026quot;/busybox\u0026quot; is already in use by container \u0026quot;33e3123ff520985d12eed46e31051bf2b393fe45fa0e353d5ffa16ab835e940c\u0026quot;. You have to remove (or rename) that container to be able to reuse that name. å› ä¸ºå·²ç»æŒ‡å®šè¿‡è¿™ä¸ªnameï¼Œå¹¶ä¸”è¿™ä¸ªå®¹å™¨å·²ç»å¯åŠ¨è¿‡ï¼Œå¦‚æœè¿˜æƒ³å¯åŠ¨è¿™ä¸ªå®¹å™¨ï¼Œé‚£åªéœ€è¦å†å¯åŠ¨è¿™ä¸ªå®¹å™¨å³å¯ï¼Œæ— éœ€æ‰§è¡Œrunã€‚\nå®¹å™¨å¸¸ç”¨å‘½ä»¤ $ docker run --name busybox -it busybox # ä»é•œåƒä¸­å¯åŠ¨ä¸€ä¸ªå®¹å™¨ $ docker ps -a # åˆ—å‡ºæ‰€æœ‰å®¹å™¨ã€‚åŒ…æ‹¬å·²ç»åœæ­¢çš„ $ docker ps # åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨ $ docker stop \u0026lt;å®¹å™¨ ID\u0026gt; # åœæ­¢ä¸€ä¸ªå®¹å™¨ $ docker start \u0026lt;å®¹å™¨ ID\u0026gt; # å¯åŠ¨ä¸€ä¸ªå·²åœæ­¢çš„å®¹å™¨ $ docker restart \u0026lt;å®¹å™¨ ID\u0026gt; # é‡å¯å®¹å™¨ $ docker attach f59fcdac1cc0 # è¿›å…¥å®¹å™¨ï¼Œé€€å‡ºæ—¶ä¼šå¯¼è‡´å®¹å™¨çš„é€€å‡º $ docker exec -it 33e3123ff520 sh # è¿›å…¥å®¹å™¨ï¼Œé€€å‡ºæ—¶ä¸ä¼šå¯¼è‡´å®¹å™¨çš„é€€å‡º,sh ä¸ºrunå®¹å™¨æ—¶æŒ‡å®šçš„COMMAND $ docker container rm -f 33e3123ff520 # åˆ é™¤å®¹å™¨ ",
      "summary": "æ‘˜è¦ï¼šDockerç®€å•ä½¿ç”¨ã€‚\nDocker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€å¼€å‘ï¼Œå¹¶éµä» Apache2.0 åè®®å¼€æºã€‚ Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚\nDockerä¸‹è½½åœ°å€ï¼šhttps://www.docker.com/get-started\nå®‰è£…å®Œæˆåï¼Œæ‰å¯ä»¥æ‰§è¡Œdockerçš„ç›¸å…³å‘½ä»¤ã€‚\n$ docker system info Client: Context: default Debug Mode: false Plugins: buildx: Build with BuildKit (Docker Inc., v0.5.1-docker) compose: Docker Compose (Docker Inc., 2.0.0-beta.3) scan: Docker Scan (Docker Inc., v0.8.0) Server: Containers: 0 Running: 0 Paused: 0 Stopped: 0 Images: 0 Server Version: 20.10.7 Storage Driver: overlay2 Backing Filesystem: extfs Supports d_type: true Native Overlay Diff: true userxattr: false Logging Driver: json-file Cgroup Driver: cgroupfs Cgroup Version: 1 Plugins: Volume: local Network: bridge host ipvlan macvlan null overlay Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog Swarm: inactive Runtimes: runc io."
    },{
      "title": "Kubernatesç»„ä»¶",
      "url": "https://qiref.github.io/post/2021/06/21/kubernates%E7%BB%84%E4%BB%B6/",
      "content": "æ‘˜è¦ï¼šKubernatesåŸºç¡€æ¦‚å¿µåŠå…¶ç»„ä»¶ã€‚\nKubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¼•æ“ï¼Œç”¨æ¥å¯¹å®¹å™¨åŒ–åº”ç”¨è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©ç¼©å®¹å’Œç®¡ç†ï¼Œç®€ç§°K8sï¼ŒK8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸ºkå’Œsä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦ã€‚Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚\næ§åˆ¶é¢ç»„ä»¶ kube-apiserver apiserveræ˜¯ Kubernetes æ§åˆ¶é¢çš„ç»„ä»¶ï¼Œ è¯¥ç»„ä»¶å…¬å¼€äº† Kubernetes APIã€‚\netcd etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚\nkube-scheduler è´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹ï¼ˆnodeï¼‰çš„ Podsï¼Œé€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚\nè°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚\nkube-controller-manager ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚\nè¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬:\nèŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº” ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob controllerï¼‰: ç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod) æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account \u0026amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ cloud-controller-manager äº‘æ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯æŒ‡åµŒå…¥ç‰¹å®šäº‘çš„æ§åˆ¶é€»è¾‘çš„ æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨å…è®¸æ‚¨é“¾æ¥é›†ç¾¤åˆ°äº‘æä¾›å•†çš„åº”ç”¨ç¼–ç¨‹æ¥å£ä¸­ï¼Œ å¹¶æŠŠå’Œè¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶ä¸åªå’Œæ‚¨çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€ã€‚ cloud-controller-manager ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚\nä¸ kube-controller-manager ç±»ä¼¼ï¼Œcloud-controller-manager å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„ æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚\nä¸‹é¢çš„æ§åˆ¶å™¨éƒ½åŒ…å«å¯¹äº‘å¹³å°é©±åŠ¨çš„ä¾èµ–ï¼š\nèŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: ç”¨äºåœ¨èŠ‚ç‚¹ç»ˆæ­¢å“åº”åæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å·²è¢«åˆ é™¤ è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰: ç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”± æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰: ç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨ Node ç»„ä»¶ ç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚\nkubelet ä¸€ä¸ªåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒä¿è¯å®¹å™¨ï¼ˆcontainersï¼‰éƒ½ è¿è¡Œåœ¨ Pod ä¸­ã€‚\nkubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚\nkube-proxy kube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ å®ç° Kubernetes æœåŠ¡ï¼ˆServiceï¼‰ æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚\nkube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚è¿™äº›ç½‘ç»œè§„åˆ™å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚\nå¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†æ•°æ®åŒ…è¿‡æ»¤å±‚å¹¶å¯ç”¨çš„è¯ï¼Œkube-proxy ä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚å¦åˆ™ï¼Œ kube-proxy ä»…è½¬å‘æµé‡æœ¬èº«ã€‚\næ¥æºï¼šhttps://kubernetes.io/zh/docs/concepts/overview/components/\n",
      "summary": "æ‘˜è¦ï¼šKubernatesåŸºç¡€æ¦‚å¿µåŠå…¶ç»„ä»¶ã€‚\nKubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¼•æ“ï¼Œç”¨æ¥å¯¹å®¹å™¨åŒ–åº”ç”¨è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©ç¼©å®¹å’Œç®¡ç†ï¼Œç®€ç§°K8sï¼ŒK8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸ºkå’Œsä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦ã€‚Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚\næ§åˆ¶é¢ç»„ä»¶ kube-apiserver apiserveræ˜¯ Kubernetes æ§åˆ¶é¢çš„ç»„ä»¶ï¼Œ è¯¥ç»„ä»¶å…¬å¼€äº† Kubernetes APIã€‚\netcd etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚\nkube-scheduler è´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹ï¼ˆnodeï¼‰çš„ Podsï¼Œé€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚\nè°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚\nkube-controller-manager ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚\nè¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬:\nèŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº” ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob controllerï¼‰: ç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod) æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account \u0026amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ cloud-controller-manager äº‘æ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯æŒ‡åµŒå…¥ç‰¹å®šäº‘çš„æ§åˆ¶é€»è¾‘çš„ æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨å…è®¸æ‚¨é“¾æ¥é›†ç¾¤åˆ°äº‘æä¾›å•†çš„åº”ç”¨ç¼–ç¨‹æ¥å£ä¸­ï¼Œ å¹¶æŠŠå’Œè¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶ä¸åªå’Œæ‚¨çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€ã€‚ cloud-controller-manager ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚\nä¸ kube-controller-manager ç±»ä¼¼ï¼Œcloud-controller-manager å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„ æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚"
    },{
      "title": "Goè¯­è¨€å®ç°httpServer",
      "url": "https://qiref.github.io/post/2021/06/19/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0httpserver/",
      "content": "æ‘˜è¦ï¼šä½¿ç”¨Goè¯­è¨€åŸç”ŸåŒ…å®ç°Http Serverã€‚\nå¯åŠ¨ä¸€ä¸ªHttp Server ä½¿ç”¨Goè¯­è¨€åŸç”Ÿçš„net/httpåº“å¯ä»¥å¾ˆç®€å•å®ç°ä¸€ä¸ªhttp serverã€‚\nlog.Println(\u0026quot;start server\u0026quot;) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) æ²¡é”™ï¼Œåªè¦è¿™ä¹ˆå‡ è¡Œä»£ç ï¼Œå°±å¼€å¯äº†ä¸€ä¸ªhttp serverï¼Œç›‘å¬8080ç«¯å£ã€‚\næ¥æ”¶Httpè¯·æ±‚ http.HandleFunc å¼€å¯äº†Http serveråï¼Œæ— æ³•å¤„ç†Httpè¯·æ±‚è¿™ä¸ªå°±æ˜¯ä¸ªç©ºçš„Serverï¼Œä¸‹é¢ç»™å®ƒåŠ ä¸Šå¤„ç†Http Requestçš„èƒ½åŠ›ã€‚\nfunc init() { log.Println(\u0026quot;start server\u0026quot;) http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) } func HelloWorld(w http.ResponseWriter, r *http.Request) { _, err := w.Write([]byte(\u0026quot;hello world\u0026quot;)) if err != nil { log.Println(err) } } http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) è¿™è¡Œä»£ç æŒ‡å®šäº†ä¸€ä¸ªè·¯ç”±å¯¹åº”çš„æ–¹æ³•ï¼Œç„¶åè®¿é—®http://127.0.0.1:8080/hello_world å¯ä»¥å¾—åˆ°hello worldçš„å­—ç¬¦ä¸²ï¼Œè¿™æ®µå­—ç¬¦ä¸²ä¹Ÿæ˜¯HelloWorld(w http.ResponseWriter, r *http.Request) å‡½æ•°çš„è¾“å‡ºã€‚\nhttp.Handle func init() { log.Println(\u0026quot;start server\u0026quot;) http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) http.Handle(\u0026quot;/test_handle\u0026quot;, \u0026amp;TestHandleStruct{content: \u0026quot;test handle\u0026quot;}) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) } type TestHandleStruct struct { content string } // å®ç° Handler interface func (handle *TestHandleStruct) ServeHTTP(w http.ResponseWriter, r *http.Request) { _, err := fmt.Fprintf(w, handle.content) if err != nil { log.Fatal(\u0026quot;response failed\u0026quot;) } } è¿˜æœ‰ä¸€ç§æ–¹å¼å¯ä»¥å®ç°å¤„ç†http requestï¼Œå°±æ˜¯å®ç°Handleæ¥å£ï¼Œå®ç°æ¥å£éœ€è¦å€ŸåŠ©TestHandleStructç»“æ„ä½“å»å®ç°ï¼Œå®šä¹‰ç»“æ„ä½“çš„æ–¹æ³•å®ç°æ¥å£æ–¹æ³•ServeHTTP(w http.ResponseWriter, r *http.Request)\nç„¶åè®¿é—®http://127.0.0.1:8080/test_handle å°±å¯ä»¥å¾—åˆ°test handleå­—ç¬¦ä¸²ã€‚\nå…¶å®è¿™ä¸¤ç§å®ç°æ–¹å¼åº•å±‚éƒ½æ˜¯ä¸€æ ·çš„ï¼š\n// Handle registers the handler for the given pattern // in the DefaultServeMux. // The documentation for ServeMux explains how patterns are matched. func Handle(pattern string, handler Handler) { DefaultServeMux.Handle(pattern, handler) } // HandleFunc registers the handler function for the given pattern // in the DefaultServeMux. // The documentation for ServeMux explains how patterns are matched. func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) { DefaultServeMux.HandleFunc(pattern, handler) } ",
      "summary": "æ‘˜è¦ï¼šä½¿ç”¨Goè¯­è¨€åŸç”ŸåŒ…å®ç°Http Serverã€‚\nå¯åŠ¨ä¸€ä¸ªHttp Server ä½¿ç”¨Goè¯­è¨€åŸç”Ÿçš„net/httpåº“å¯ä»¥å¾ˆç®€å•å®ç°ä¸€ä¸ªhttp serverã€‚\nlog.Println(\u0026quot;start server\u0026quot;) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) æ²¡é”™ï¼Œåªè¦è¿™ä¹ˆå‡ è¡Œä»£ç ï¼Œå°±å¼€å¯äº†ä¸€ä¸ªhttp serverï¼Œç›‘å¬8080ç«¯å£ã€‚\næ¥æ”¶Httpè¯·æ±‚ http.HandleFunc å¼€å¯äº†Http serveråï¼Œæ— æ³•å¤„ç†Httpè¯·æ±‚è¿™ä¸ªå°±æ˜¯ä¸ªç©ºçš„Serverï¼Œä¸‹é¢ç»™å®ƒåŠ ä¸Šå¤„ç†Http Requestçš„èƒ½åŠ›ã€‚\nfunc init() { log.Println(\u0026quot;start server\u0026quot;) http.HandleFunc(\u0026quot;/hello_world\u0026quot;, HelloWorld) if err := http.ListenAndServe(\u0026quot;:8080\u0026quot;, nil); err != nil { log.Println(\u0026quot;start server on 8080\u0026quot;) } log.Fatal(\u0026quot;start server failed.\u0026quot;) } func HelloWorld(w http.ResponseWriter, r *http.Request) { _, err := w.Write([]byte(\u0026quot;hello world\u0026quot;)) if err !"
    },{
      "title": "Goè¯­è¨€åå°„",
      "url": "https://qiref.github.io/post/2021/06/17/go%E8%AF%AD%E8%A8%80%E5%8F%8D%E5%B0%84/",
      "content": "æ‘˜è¦ï¼šç†è§£Goè¯­è¨€çš„åå°„æœºåˆ¶ï¼Œåå°„æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡ŒæœŸå¯¹ç¨‹åºæœ¬èº«è¿›è¡Œè®¿é—®å’Œä¿®æ”¹çš„èƒ½åŠ›ã€‚\nåå°„åŸºç¡€ä¿¡æ¯ func reflectDemo() { str := \u0026quot;reflect\u0026quot; fmt.Println(reflect.ValueOf(str)) fmt.Println(reflect.TypeOf(str)) } // ç»“æœ // reflect // string reflect.ValueOf()è·å–æ•°æ®è¿è¡Œæ—¶çš„å€¼ã€‚ reflect.TypeOf()è·å–æ•°æ®ç±»å‹ä¿¡æ¯ã€‚\n// Type values are comparable, such as with the == operator, // so they can be used as map keys. // Two Type values are equal if they represent identical types. type Type interface { // To compare two Values, compare the results of the Interface method. // Using == on two Values does not compare the underlying values // they represent. type Value struct { ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒTypeæ˜¯ä¸ªinterfaceï¼Œè€ŒValueæ˜¯ä¸ªstructã€‚\nreflectåŒ…ä¸­é™¤äº†æœ‰TypeOfè¿˜æœ‰kindï¼Œtypeæ˜¯å…·ä½“çš„ç±»å‹ä¿¡æ¯ï¼Œkindæ˜¯ç±»å‹çš„ç§ç±»ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹typeå’Œkindæ˜¯ä¸€æ ·çš„ã€‚\nfmt.Println(reflect.TypeOf(dog{})) typeOf := reflect.TypeOf(dog{}) fmt.Println(typeOf.Kind()) // reflect_demo.dog // struct åå°„æŒ‡é’ˆå…ƒç´  func reflectDemo1() { list := \u0026amp;ListNode{} fmt.Println(\u0026quot;reflect.TypeOf \u0026quot;, reflect.TypeOf(list)) fmt.Println(\u0026quot;reflect value \u0026quot;, reflect.ValueOf(list)) fmt.Println(\u0026quot;reflect kind \u0026quot;, reflect.TypeOf(list).Kind()) } type ListNode struct { val int next *ListNode } // ç»“æœï¼š // reflect.TypeOf *reflect_demo.ListNode // reflect value \u0026amp;{0 \u0026lt;nil\u0026gt;} // reflect kind ptr ptr æ˜¯æŒ‡é’ˆç±»å‹ã€‚ ç¤ºä¾‹ä¸­çš„æŒ‡é’ˆæ˜¯ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼Œé€šè¿‡åå°„æœºåˆ¶å¯ä»¥è·å–åˆ°ç»“æ„ä½“ä¸­çš„å­—æ®µä¿¡æ¯ã€‚\nfunc reflectDemo2() { list := ListNode{val: 12, next: nil} typeOf := reflect.TypeOf(list) for i := 0; i \u0026lt; typeOf.NumField(); i++ { fieldType := typeOf.Field(i) fmt.Println(\u0026quot;fileName: \u0026quot;, fieldType.Name, \u0026quot; fileType: \u0026quot;, fieldType.Type, \u0026quot; fieldTag: \u0026quot;, fieldType.Tag) } } type ListNode struct { Name string `json:\u0026quot;Name\u0026quot;` val int next *ListNode } // è¾“å‡º // fileName: Name fileType: string fieldTag: json:\u0026quot;name\u0026quot; // fileName: val fileType: int fieldTag: // fileName: next fileType: *reflect_demo.ListNode fieldTag: typeOf.Field(i) å¯ä»¥è·å–ç»“æ„ä½“ä¸­çš„å­—æ®µä¿¡æ¯ï¼Œæ³¨æ„è¿™é‡Œçš„listä¸èƒ½æ˜¯æŒ‡é’ˆç±»å‹ï¼Œwhyï¼Ÿ å› ä¸ºè¿™æ˜¯ä¸ªæŒ‡é’ˆï¼Œä¸æ˜¯ç»“æ„ä½“ï¼Œå¯ä»¥é€šè¿‡Elemï¼ˆï¼‰æ–¹æ³•è·å–æŒ‡å‘çš„å…ƒç´ ã€‚\nlist := \u0026amp;ListNode{val: 12, next: nil} typeOf := reflect.TypeOf(list) if typeOf.Kind() == reflect.Ptr { for i := 0; i \u0026lt; typeOf.Elem().NumField(); i++ { fieldType := typeOf.Elem().Field(i) fmt.Println(\u0026quot;fileName: \u0026quot;, fieldType.Name, \u0026quot; fileType: \u0026quot;, fieldType.Type, \u0026quot; fieldTag: \u0026quot;, fieldType.Tag) } } è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡valueä¹Ÿå¯ä»¥è·å–å…ƒç´ çš„kindç­‰ä¿¡æ¯ã€‚\nfunc reflectDemo3() { list := \u0026amp;ListNode{val: 12, next: nil} indirect := reflect.Indirect(reflect.ValueOf(list)) if indirect.Kind() == reflect.Ptr { fmt.Println(\u0026quot;Ptr\u0026quot;) } if indirect.Kind() == reflect.Struct { fmt.Println(\u0026quot;struct\u0026quot;) } } // è¾“å‡º // struct ",
      "summary": "æ‘˜è¦ï¼šç†è§£Goè¯­è¨€çš„åå°„æœºåˆ¶ï¼Œåå°„æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡ŒæœŸå¯¹ç¨‹åºæœ¬èº«è¿›è¡Œè®¿é—®å’Œä¿®æ”¹çš„èƒ½åŠ›ã€‚\nåå°„åŸºç¡€ä¿¡æ¯ func reflectDemo() { str := \u0026quot;reflect\u0026quot; fmt.Println(reflect.ValueOf(str)) fmt.Println(reflect.TypeOf(str)) } // ç»“æœ // reflect // string reflect.ValueOf()è·å–æ•°æ®è¿è¡Œæ—¶çš„å€¼ã€‚ reflect.TypeOf()è·å–æ•°æ®ç±»å‹ä¿¡æ¯ã€‚\n// Type values are comparable, such as with the == operator, // so they can be used as map keys. // Two Type values are equal if they represent identical types. type Type interface { // To compare two Values, compare the results of the Interface method. // Using == on two Values does not compare the underlying values // they represent."
    },{
      "title": "Goè¯­è¨€deferã€panicã€recover",
      "url": "https://qiref.github.io/post/2021/06/15/go%E8%AF%AD%E8%A8%80deferpanicrecover/",
      "content": "æ‘˜è¦ï¼šç†è§£Goè¯­è¨€deferã€panicã€recoverã€‚\ndefer Go è¯­è¨€çš„ defer ä¼šåœ¨å½“å‰å‡½æ•°è¿”å›å‰æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå®ƒä¼šç»å¸¸è¢«ç”¨äºå…³é—­æ–‡ä»¶æè¿°ç¬¦ã€å…³é—­æ•°æ®åº“è¿æ¥ä»¥åŠè§£é”èµ„æºï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯å®Œæˆå‡½æ•°æ‰§è¡Œå®Œçš„æ”¶å°¾å·¥ä½œã€‚\nfunc DeferDemo() { defer fmt.Println(\u0026quot;this is defer println\u0026quot;) fmt.Println(\u0026quot;this is println\u0026quot;) } // è¾“å‡º // this is println // this is defer println è¿è¡Œä»¥ä¸Šä»£ç æ¯æ¬¡éƒ½æ˜¯ç¬¬äºŒä¸ªprintlnå…ˆè¾“å‡ºï¼Œç„¶åæ‰æ˜¯deferå…³é”®å­—ä¿®é¥°çš„printlnè¾“å‡ºã€‚\nå¦‚æœæœ‰å¤šä¸ªdeferï¼Œè¾“å‡ºé¡ºåºåˆä¼šå¦‚ä½•ï¼Ÿ\nfunc MultiDeferDemo() { for i := 0; i \u0026lt; 5; i++ { defer fmt.Println(\u0026quot; defer \u0026quot;, i) } } // è¾“å‡º // defer 4 // defer 3 // defer 2 // defer 1 // defer 0 æ¯æ¬¡æœ€å…ˆè¾“å‡ºçš„éƒ½æ˜¯å¾ªç¯çš„æœ€åä¸€ä¸ªprintlnï¼Œå¯ä»¥å¾—å‡ºï¼šå¤šä¸ªdeferï¼Œè¿è¡Œé¡ºåºéµå¾ªLIFOè§„åˆ™ã€‚\ndeferçš„å€¼ä¼ é€’é—®é¢˜ã€‚\nåŸºäºdeferçš„æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥ç»Ÿè®¡å‡½æ•°çš„æ‰§è¡Œè€—æ—¶ã€‚\nfunc MethodElapsedTime() { start := time.Now() defer fmt.Println(\u0026quot;elapsed \u0026quot;, time.Since(start)) time.Sleep(time.Second * 2) } // è¾“å‡º // elapsed 169ns ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸ä¼šå’Œé¢„æœŸä¸€è‡´ï¼Œè°ƒç”¨ defer å…³é”®å­—ä¼šç«‹åˆ»æ‹·è´å‡½æ•°ä¸­å¼•ç”¨çš„å¤–éƒ¨å‚æ•°ï¼Œæ‰€ä»¥ time.Since(start) çš„ç»“æœä¸æ˜¯åœ¨ main å‡½æ•°é€€å‡ºä¹‹å‰è®¡ç®—çš„ï¼Œè€Œæ˜¯åœ¨ defer å…³é”®å­—è°ƒç”¨æ—¶è®¡ç®—çš„ã€‚\nå¦‚æœæƒ³è¦è¾¾åˆ°é¢„æœŸç»“æœï¼Œå¯ä»¥ç»™deferä¼ å…¥åŒ¿åå‡½æ•°ï¼Œè¿™æ ·è°ƒç”¨deferå…³é”®å­—æ—¶ï¼Œè™½ç„¶ä¹Ÿä¼šè¿›è¡Œå‚æ•°æ‹·è´ï¼Œä½†æ˜¯æ‹·è´çš„æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå¹¶ä¸æ˜¯åŒ¿åå‡½æ•°çš„å‚æ•°ï¼Œè¿™æ ·å°±èƒ½æ‹¿åˆ°æ­£ç¡®çš„å‚æ•°ã€‚\nfunc MethodElapsedTime1() { start := time.Now() defer func() { fmt.Println(\u0026quot;elapsed \u0026quot;, time.Since(start)) }() time.Sleep(time.Second * 2) } // è¾“å‡º // elapsed 2.001068253s panic When youpanicin Go, youâ€™re freaking out, itâ€™s not someone elses problem, itâ€™s game over man.\nä»è¿™å¥è¯å¯ä»¥å¾—å‡ºï¼ŒPanicæ˜¯Goä¸­çš„ä¸¥é‡é”™è¯¯ï¼Œä¼šå½±å“åˆ°ç¨‹åºçš„è¿è¡Œã€‚\nå½“panicå¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç¨‹åºä¼šä¸­æ–­è¿è¡Œï¼Œå¹¶ç«‹å³æ‰§è¡Œåœ¨è¯¥goroutineä¸­è¢«å»¶è¿Ÿçš„å‡½æ•°ï¼ˆdefer æœºåˆ¶ï¼‰,éšåï¼Œç¨‹åºå´©æºƒå¹¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬panic valueå’Œå‡½æ•°è°ƒç”¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚\nfunc PanicDemo() { defer fmt.Println(\u0026quot;defer println\u0026quot;) go func() { defer fmt.Println(\u0026quot;goroutine defer println\u0026quot;) panic(\u0026quot;\u0026quot;) }() time.Sleep(time.Second * 2) } // è¿è¡Œç»“æœ // goroutine defer println // panic: // //goroutine 7 [running]: // archieyao.github.com/base/src/panic_demo.PanicDemo.func1() // /Users/archieyao/GoProjects/GoMod/base/src/panic_demo/panic_demo.go:16 +0x95 // created by archieyao.github.com/base/src/panic_demo.PanicDemo // /Users/archieyao/GoProjects/GoMod/base/src/panic_demo/panic_demo.go:14 +0x98 ä»¥ä¸Šç¤ºä¾‹å¯ä»¥å¾ˆå¥½æ¼”ç¤ºPanicçš„è¿è¡Œæµç¨‹ï¼Œåœ¨è¿è¡Œgoroutineçš„åŒ¿åå‡½æ•°æ—¶ï¼Œé‡åˆ°äº†Panicï¼Œæ­¤æ—¶ç¨‹åºä¼šå…ˆè¿è¡Œgoroutineå†…çš„deferä¿®é¥°çš„ä»£ç ï¼Œç„¶åè¾“å‡ºå´©æºƒæ—¥å¿—ï¼Œå…¶ä¸­ï¼Œæœ€å¤–å±‚çš„ defer fmt.Println(\u0026quot;defer println\u0026quot;) å¹¶æœªæ‰§è¡Œã€‚\nå½“panicä¸åœ¨goroutineä¸­å‡ºç°æ—¶ï¼Œä¾‹å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼š\nfunc PanicDemo1() { defer fmt.Println(\u0026quot;defer println 1\u0026quot;) panic(\u0026quot;panic\u0026quot;) defer fmt.Println(\u0026quot;defer println 2\u0026quot;) } æ­¤æ—¶ç¨‹åºè¿è¡Œçš„ç»“æœï¼Œä¼šè¿è¡ŒPanicå‰çš„deferï¼Œå¹¶ä¸”ä¼šè¿è¡ŒPanicå‰çš„æ‰€æœ‰deferã€‚\nåŸºäºPanicçš„ç‰¹æ€§ï¼Œå½“ç¨‹åºé‡åˆ°Panicæ—¶ï¼Œä¼šè¿è¡ŒPanicå‰çš„deferï¼Œå¦‚æœåœ¨deferä¸­æ„å»ºåŒ¿åå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­å†æ¬¡Panicï¼Œå°±å¯ä»¥å½¢æˆPanicåµŒå¥—ã€‚\nfunc panicDemo2() { defer func() { defer func() { panic(\u0026quot;panic 3\u0026quot;) }() panic(\u0026quot;panic 2\u0026quot;) }() panic(\u0026quot;panic 1\u0026quot;) } // panic: panic 1 // panic: panic 2 // panic: panic 3 [recovered] // panic: panic 3 å½“å¤šä¸ªPanicåµŒå¥—æ—¶ï¼Œå¦‚æœPanicéƒ½éœ€è¦è¢«æ‰§è¡Œçš„deferä¸­ï¼Œé‚£æ¯ä¸ªPanicéƒ½ä¼šæ‰§è¡Œã€‚\nrecover recoverä¸€èˆ¬éƒ½æ˜¯ç”¨äºæ¢å¤Panicï¼Œè®©ç¨‹åºå´©æºƒåç»§ç»­è¿è¡Œï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„å¼‚å¸¸å¤„ç†ï¼Œå½“å¼‚å¸¸æŠ›å‡ºåç¨‹åºå¥”æºƒï¼Œä½†å½“æ•è·å¼‚å¸¸å¹¶å¤„ç†åï¼Œç¨‹åºä¸ä¼šå´©æºƒã€‚\nfunc recoverDemo1() { catchErr() fmt.Println(\u0026quot;after recover println\u0026quot;) } func catchErr() { defer fmt.Println(\u0026quot;defer println\u0026quot;) defer func() { if err := recover(); err != nil { fmt.Println(\u0026quot;recover\u0026quot;) } }() panic(\u0026quot;panic\u0026quot;) } // è¿è¡Œç»“æœ // recover // defer println // after recover println recoverä¸€èˆ¬éƒ½æ˜¯åœ¨deferä¸­è¿è¡Œï¼Œå¸¸ç”¨å†™æ³•å¦‚ä¸‹ï¼š\nfunc simpleRecover() { defer func() { if r := recover(); r != nil { fmt.Println(\u0026quot;recover\u0026quot;) } }() panic(\u0026quot;panic\u0026quot;) // æ³¨æ„ è¿™è¡Œä¸ä¼šæ‰§è¡Œ fmt.Println(\u0026quot;bala\u0026quot;) } ä¸€èˆ¬åœ¨deferä¿®é¥°çš„åŒ¿åå‡½æ•°ä¸­recoverï¼Œå¹¶ä¸”åŠ å…¥åˆ¤æ–­ï¼Œæ˜¯å¦å·²ç»æ•è·åˆ°panicï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œfmt.Println(\u0026quot;bala\u0026quot;) è¿™è¡Œæ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå› ä¸ºåœ¨simpleRecover()å‡½æ•°ä¸­ï¼Œå·²ç»å‘ç”Ÿäº†Panicï¼Œç¨‹åºå·²ç»ä¸­æ–­äº†ï¼Œä¼šè·³è¿‡åç»­çš„ä»£ç ï¼Œç„¶åå»æ‰§è¡Œpanicå‰çš„deferä»£ç ï¼Œç„¶ååœ¨deferä¸­æ¢å¤ï¼Œæ­¤æ—¶è™½ç„¶ç¨‹åºå·²ç»æ¢å¤åˆ°æ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œä½†å†å²ç”±äºpanicè·³è¿‡çš„ä»£ç æ˜¯æ— æ³•å›æº¯çš„ã€‚\nrecover() çš„ä½œç”¨èŒƒå›´ä»…é™äºå½“å‰çš„æ‰€å± goroutineã€‚å‘ç”Ÿ panic æ—¶åªä¼šæ‰§è¡Œå½“å‰åç¨‹ä¸­çš„deferå‡½æ•°ï¼Œå…¶å®ƒåç¨‹é‡Œé¢çš„ defer ä¸ä¼šæ‰§è¡Œã€‚\nfunc simpleRecover() { defer func() { if r := recover(); r != nil { fmt.Println(\u0026quot;recover\u0026quot;) } }() go func() { panic(\u0026quot;panic\u0026quot;) }() time.Sleep(time.Second*2) fmt.Println(\u0026quot;bala\u0026quot;) } ä»¥ä¸Šä»£ç ä¸­ï¼Œç”±äºpanicæ˜¯åœ¨æ–°å¼€å¯çš„goroutineä¸­æ‰§è¡Œï¼Œrecoveræ˜¯æ— æ³•æ¢å¤è¿™ä¸ªgoroutineä¸­çš„panicï¼Œæ‰€ä»¥ä¸Šè¿°ä»£ç ä¾ç„¶ä¼šå´©æºƒã€‚\nfunc simpleRecover() { go func() { defer func() { if r := recover(); r != nil { fmt.Println(\u0026quot;recover\u0026quot;) } }() panic(\u0026quot;panic\u0026quot;) }() time.Sleep(time.Second*2) fmt.Println(\u0026quot;bala\u0026quot;) } å¦‚æœæŠŠdeferä¹Ÿæ”¾åˆ°æ–°å¼€å¯çš„goroutineä¸­ï¼Œå°±å¯ä»¥æ­£å¸¸recoverè¿™ä¸ªpanicã€‚æ­¤æ—¶ä»£ç ä¹Ÿä¼šæ­£å¸¸å¾€åè¿è¡Œï¼Œfmt.Println(\u0026quot;bala\u0026quot;) è¿™è¡Œä¹Ÿä¼šè¾“å‡ºï¼Œå› ä¸ºgoroutineä¸­panicå·²ç»æ¢å¤ï¼Œä¸ä¼šè·³è¿‡å¤–å±‚å‡½æ•°çš„ä»£ç ã€‚\nå‚è€ƒï¼š\nhttps://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-defer/\nhttps://segmentfault.com/a/1190000021141276\n",
      "summary": "æ‘˜è¦ï¼šç†è§£Goè¯­è¨€deferã€panicã€recoverã€‚\ndefer Go è¯­è¨€çš„ defer ä¼šåœ¨å½“å‰å‡½æ•°è¿”å›å‰æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå®ƒä¼šç»å¸¸è¢«ç”¨äºå…³é—­æ–‡ä»¶æè¿°ç¬¦ã€å…³é—­æ•°æ®åº“è¿æ¥ä»¥åŠè§£é”èµ„æºï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯å®Œæˆå‡½æ•°æ‰§è¡Œå®Œçš„æ”¶å°¾å·¥ä½œã€‚\nfunc DeferDemo() { defer fmt.Println(\u0026quot;this is defer println\u0026quot;) fmt.Println(\u0026quot;this is println\u0026quot;) } // è¾“å‡º // this is println // this is defer println è¿è¡Œä»¥ä¸Šä»£ç æ¯æ¬¡éƒ½æ˜¯ç¬¬äºŒä¸ªprintlnå…ˆè¾“å‡ºï¼Œç„¶åæ‰æ˜¯deferå…³é”®å­—ä¿®é¥°çš„printlnè¾“å‡ºã€‚\nå¦‚æœæœ‰å¤šä¸ªdeferï¼Œè¾“å‡ºé¡ºåºåˆä¼šå¦‚ä½•ï¼Ÿ\nfunc MultiDeferDemo() { for i := 0; i \u0026lt; 5; i++ { defer fmt.Println(\u0026quot; defer \u0026quot;, i) } } // è¾“å‡º // defer 4 // defer 3 // defer 2 // defer 1 // defer 0 æ¯æ¬¡æœ€å…ˆè¾“å‡ºçš„éƒ½æ˜¯å¾ªç¯çš„æœ€åä¸€ä¸ªprintlnï¼Œå¯ä»¥å¾—å‡ºï¼šå¤šä¸ªdeferï¼Œè¿è¡Œé¡ºåºéµå¾ªLIFOè§„åˆ™ã€‚\ndeferçš„å€¼ä¼ é€’é—®é¢˜ã€‚\nåŸºäºdeferçš„æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥ç»Ÿè®¡å‡½æ•°çš„æ‰§è¡Œè€—æ—¶ã€‚"
    },{
      "title": "Goè¯­è¨€åŒ…ç®¡ç†",
      "url": "https://qiref.github.io/post/2021/06/10/go%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AE%A1%E7%90%86/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€åŒ…ç®¡ç†ã€‚\nåŒ…ä½¿ç”¨è§„èŒƒ åŒ…çš„ä¹ æƒ¯ç”¨æ³•ï¼š\nåŒ…åä¸€èˆ¬æ˜¯å°å†™çš„ï¼Œä½¿ç”¨ä¸€ä¸ªç®€çŸ­ä¸”æœ‰æ„ä¹‰çš„åç§°ã€‚ åŒ…åä¸€èˆ¬è¦å’Œæ‰€åœ¨çš„ç›®å½•åŒåï¼Œä¹Ÿå¯ä»¥ä¸åŒï¼ŒåŒ…åä¸­ä¸èƒ½åŒ…å«- ç­‰ç‰¹æ®Šç¬¦å·ã€‚ åŒ…ä¸€èˆ¬ä½¿ç”¨åŸŸåä½œä¸ºç›®å½•åç§°ï¼Œè¿™æ ·èƒ½ä¿è¯åŒ…åçš„å”¯ä¸€æ€§ï¼Œæ¯”å¦‚ GitHub é¡¹ç›®çš„åŒ…ä¸€èˆ¬ä¼šæ”¾åˆ°GOPATH/src/github.com/userName/projectName ç›®å½•ä¸‹ã€‚ åŒ…åä¸º main çš„åŒ…ä¸ºåº”ç”¨ç¨‹åºçš„å…¥å£åŒ…ï¼Œç¼–è¯‘ä¸åŒ…å« main åŒ…çš„æºç æ–‡ä»¶æ—¶ä¸ä¼šå¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æºç æ–‡ä»¶åªèƒ½å±äºåŒä¸€ä¸ªåŒ…ï¼ŒåŒæ ·å±äºåŒä¸€ä¸ªåŒ…çš„æºç æ–‡ä»¶ä¸èƒ½æ”¾åœ¨å¤šä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ Go è¯­è¨€ä¸­ï¼Œæ‰€æœ‰çš„å®šä¹‰ï¼Œæ¯”å¦‚å‡½æ•°ã€å˜é‡ã€ç»“æ„ä½“ç­‰ï¼Œå¦‚æœé¦–å­—æ¯æ˜¯å¤§å†™ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«å…¶ä»–åŒ…ä½¿ç”¨ï¼›åŒä¸€åŒ…ä¸‹ï¼Œä¸å­˜åœ¨å¼•ç”¨é—®é¢˜ã€‚\nåŸºäºåŒ…çš„å°è£… åœ¨Goè¯­è¨€ä¸­å°è£…å°±æ˜¯æŠŠæŠ½è±¡å‡ºæ¥çš„å­—æ®µå’Œå¯¹å­—æ®µçš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ•°æ®è¢«ä¿æŠ¤åœ¨å†…éƒ¨ï¼Œç¨‹åºçš„å…¶å®ƒåŒ…åªèƒ½é€šè¿‡è¢«æˆæƒçš„æ–¹æ³•ï¼Œæ‰èƒ½å¯¹å­—æ®µè¿›è¡Œæ“ä½œã€‚\nå°è£…çš„å¥½å¤„ï¼š éšè—å®ç°ç»†èŠ‚ï¼› å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œä¿è¯æ•°æ®å®‰å…¨åˆç†ã€‚\nå°è£…çš„å®ç°æ­¥éª¤ï¼š\nå°†ç»“æ„ä½“ã€å­—æ®µçš„é¦–å­—æ¯å°å†™ï¼› ç»™ç»“æ„ä½“æ‰€åœ¨çš„åŒ…æä¾›ä¸€ä¸ªå·¥å‚æ¨¡å¼çš„å‡½æ•°ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œç±»ä¼¼ä¸€ä¸ªæ„é€ å‡½æ•°ï¼› æä¾›ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„ Set æ–¹æ³•ï¼ˆç±»ä¼¼å…¶å®ƒè¯­è¨€çš„ publicï¼‰ï¼Œç”¨äºå¯¹å±æ€§åˆ¤æ–­å¹¶èµ‹å€¼ï¼› æä¾›ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„ Get æ–¹æ³•ï¼ˆç±»ä¼¼å…¶å®ƒè¯­è¨€çš„ publicï¼‰ï¼Œç”¨äºè·å–å±æ€§çš„å€¼ã€‚ åŒ…çš„åˆå§‹åŒ– æ¯ä¸ªåŒ…éƒ½å…è®¸æœ‰ä¸€ä¸ª init å‡½æ•°ï¼Œå½“è¿™ä¸ªåŒ…è¢«å¯¼å…¥æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥åŒ…çš„è¿™ä¸ª init å‡½æ•°ï¼Œåšä¸€äº›åˆå§‹åŒ–ä»»åŠ¡ã€‚ å¯¹äº init å‡½æ•°çš„æ‰§è¡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„:\ninit å‡½æ•°ä¼˜å…ˆäº main å‡½æ•°æ‰§è¡Œ åœ¨ä¸€ä¸ªåŒ…å¼•ç”¨é“¾ä¸­ï¼ŒåŒ…çš„åˆå§‹åŒ–æ˜¯æ·±åº¦ä¼˜å…ˆçš„ã€‚æ¯”å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªåŒ…å¼•ç”¨å…³ç³»ï¼šmainâ†’Aâ†’Bâ†’Cï¼Œé‚£ä¹ˆåˆå§‹åŒ–é¡ºåºä¸º C.initâ†’B.initâ†’A.initâ†’main å°è£…å¼•ç”¨å®ä¾‹ å»ºç«‹å¦‚ä¸‹å·¥ç¨‹ç»“æ„ï¼Œåœ¨mainåŒ…ä¸­éœ€è¦è®¿é—®modelåŒ…ä¸­çš„å†…å®¹ã€‚\nproject |---src |---main -main.go |---model -student.go student.go\ntype student struct { Name string idCardNum string // ç§æœ‰ï¼Œå¤–éƒ¨åŒ…ä¸å¯è®¿é—® Age int8 } func NewStudent(stuName string, age int8) *student { return \u0026amp;student{ Name: stuName, Age: age, } } // å®šä¹‰ç»“æ„ä½“æ–¹æ³• func (stu *student) SetIdCardNum(idCN string) { stu.idCardNum = idCN } // å®šä¹‰ç»“æ„ä½“æ–¹æ³• func (stu *student) GetIdCardNum() string { return stu.idCardNum } main.go\n// å¼•å…¥modelåŒ… import \u0026quot;../model\u0026quot; func main() { stu := model.NewStudent(\u0026quot;å¼ ä¸‰\u0026quot;,34) stu.SetIdCardNum(\u0026quot;42093222324234\u0026quot;) fmt.Println(*stu) } è¿è¡Œç¨‹åºå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š\nbuild command-line-arguments: cannot find module for xxxx\nè¯¥é”™è¯¯ä¸goç¯å¢ƒå˜é‡GO111MODULEç›¸å…³ï¼š\nGO111MODULE=off æ— æ¨¡å—æ”¯æŒ,go ä¼šä» GOPATH å’Œ vendor æ–‡ä»¶å¤¹å¯»æ‰¾åŒ… GO111MODULE=on æ¨¡å—æ”¯æŒ,go ä¼šå¿½ç•¥GOPATH å’Œ vendor æ–‡ä»¶å¤¹,åªæ ¹æ® go.mod ä¸‹è½½ä¾èµ– GO111MODULE=auto åœ¨ $GOPATH/src å¤–é¢ä¸”æ ¹ç›®å½•æœ‰ go.mod æ–‡ä»¶æ—¶ï¼Œå¼€å¯æ¨¡å—æ”¯æŒ åœ¨ä½¿ç”¨æ¨¡å—çš„æ—¶å€™ï¼ŒGOPATH æ˜¯æ— æ„ä¹‰çš„,ä¸è¿‡å®ƒè¿˜æ˜¯ä¼šæŠŠä¸‹è½½çš„ä¾èµ–å‚¨å­˜åœ¨ $GOPATH/src/mod ä¸­,ä¹Ÿä¼šæŠŠ go install çš„ç»“æœæ”¾åœ¨ $GOPATH/bin ä¸­ è®¾ç½®æ–¹å¼ï¼š\ngo env -w GO111MODULE=auto go env åœ¨mainä¸­è°ƒç”¨å‘ç°åªèƒ½è®¿é—®studentç»“æ„ä½“çš„Nameå’ŒAgeå­—æ®µï¼ŒidCardNuméœ€è¦é€šè¿‡getæ–¹æ³•è·å–ï¼Œè¿™æ ·å°±è¾¾åˆ°åŒ…çš„æƒé™æ§åˆ¶æ•ˆæœã€‚\nåŒ…å¼•ç”¨ åŒ…å¼•ç”¨å¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼›å¼•ç”¨æ—¶ä¹Ÿå¯ä»¥å¯¹åŒ…è®¾ç½®aliasï¼›è¿˜å¯ä»¥åŒ¿åå¼•ç”¨ã€‚\nåŒ…çœç•¥å‰ç¼€ import ( . \u0026quot;fmt\u0026quot; ) è¿™ä¸ªç‚¹çš„å«ä¹‰å°±æ˜¯è¿™ä¸ªåŒ…å¯¼å…¥ä¹‹ååœ¨ä½ è°ƒç”¨è¿™ä¸ªåŒ…çš„å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥çœç•¥å‰ç¼€çš„åŒ…åï¼Œä¹Ÿå°±æ˜¯å‰é¢ä½ è°ƒç”¨çš„ fmt.Println (\u0026ldquo;hello world\u0026rdquo;) å¯ä»¥çœç•¥çš„å†™æˆ Println (\u0026ldquo;hello world\u0026rdquo;)\nåŒ…è®¾ç½®alias import model1 \u0026quot;../model\u0026quot; func main() { stu := model1.NewStudent(\u0026quot;å¼ ä¸‰\u0026quot;, 34) stu.SetIdCardNum(\u0026quot;42093222324234\u0026quot;) } åŒ…åŒ¿åå¼•ç”¨ import _ \u0026quot;../model\u0026quot; æ³¨æ„åŒ¿åå¼•ç”¨çš„åŒ…å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å…¶ä¸­çš„å˜é‡å’Œæ–¹æ³•ï¼Œä¸ä½¿ç”¨åŒ¿åå¼•å…¥çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¼•å…¥äº†ä¸€ä¸ªæœªä½¿ç”¨çš„åŒ…ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œä½†ä½¿ç”¨åŒ¿åå¼•å…¥åŒ…ä¸ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚\nimport ( \u0026quot;database/sql\u0026quot; _ \u0026quot;github.com/lib/pq\u0026quot; // enable support for Postgres _ \u0026quot;github.com/go-sql-driver/mysql\u0026quot; // enable support for MySQL ) db, err = sql.Open(\u0026quot;postgres\u0026quot;, dbname) // OK db, err = sql.Open(\u0026quot;mysql\u0026quot;, dbname) // OK db, err = sql.Open(\u0026quot;sqlite3\u0026quot;, dbname) // returns error: unknown driver \u0026quot;sqlite3\u0026quot; å¯¼å…¥ä¸€ä¸ªåŒ…ï¼Œåªæƒ³æ‰§è¡ŒåŒ…é‡Œçš„ init å‡½æ•°ï¼Œæ¥è¿è¡Œä¸€äº›åˆå§‹åŒ–ä»»åŠ¡ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨åŒ¿åå¯¼å…¥ã€‚\nç»å¯¹è·¯å¾„å¼•å…¥ åŸºäºä»¥ä¸Šå·¥ç¨‹ç›®å½•ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•å…¥ï¼Œç»å¯¹è·¯å¾„æ˜¯ä» $GOPATH/src æˆ– $GOROOT æˆ–è€… $GOPATH/pkg/mod ç›®å½•ä¸‹æœç´¢åŒ…å¹¶å¯¼å…¥ã€‚\nimport \u0026quot;model\u0026quot; æ³¨æ„ç»å¯¹è·¯å¾„å¼•å…¥éœ€è¦ä¿è¯GOPATHåœ¨å½“å‰ç›®å½•ä¸‹ï¼Œä½¿ç”¨golandä¹Ÿå¯ä»¥è®¾ç½®å½“å‰å·¥ç¨‹çš„GOPATHã€‚\nç›¸å¯¹è·¯å¾„å¼•å…¥ ç›¸å¯¹è·¯å¾„æ˜¯ä»å½“å‰ç›®å½•å¼€å§‹ã€‚\nmainåŒ…ä¸­å¼•ç”¨å¦‚ä¸‹ï¼š\nimport \u0026quot;../model\u0026quot; å‚è€ƒï¼š\nhttps://juejin.cn/post/6844904167073382408 http://c.biancheng.net/view/91.html\n",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€åŒ…ç®¡ç†ã€‚\nåŒ…ä½¿ç”¨è§„èŒƒ åŒ…çš„ä¹ æƒ¯ç”¨æ³•ï¼š\nåŒ…åä¸€èˆ¬æ˜¯å°å†™çš„ï¼Œä½¿ç”¨ä¸€ä¸ªç®€çŸ­ä¸”æœ‰æ„ä¹‰çš„åç§°ã€‚ åŒ…åä¸€èˆ¬è¦å’Œæ‰€åœ¨çš„ç›®å½•åŒåï¼Œä¹Ÿå¯ä»¥ä¸åŒï¼ŒåŒ…åä¸­ä¸èƒ½åŒ…å«- ç­‰ç‰¹æ®Šç¬¦å·ã€‚ åŒ…ä¸€èˆ¬ä½¿ç”¨åŸŸåä½œä¸ºç›®å½•åç§°ï¼Œè¿™æ ·èƒ½ä¿è¯åŒ…åçš„å”¯ä¸€æ€§ï¼Œæ¯”å¦‚ GitHub é¡¹ç›®çš„åŒ…ä¸€èˆ¬ä¼šæ”¾åˆ°GOPATH/src/github.com/userName/projectName ç›®å½•ä¸‹ã€‚ åŒ…åä¸º main çš„åŒ…ä¸ºåº”ç”¨ç¨‹åºçš„å…¥å£åŒ…ï¼Œç¼–è¯‘ä¸åŒ…å« main åŒ…çš„æºç æ–‡ä»¶æ—¶ä¸ä¼šå¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æºç æ–‡ä»¶åªèƒ½å±äºåŒä¸€ä¸ªåŒ…ï¼ŒåŒæ ·å±äºåŒä¸€ä¸ªåŒ…çš„æºç æ–‡ä»¶ä¸èƒ½æ”¾åœ¨å¤šä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ Go è¯­è¨€ä¸­ï¼Œæ‰€æœ‰çš„å®šä¹‰ï¼Œæ¯”å¦‚å‡½æ•°ã€å˜é‡ã€ç»“æ„ä½“ç­‰ï¼Œå¦‚æœé¦–å­—æ¯æ˜¯å¤§å†™ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«å…¶ä»–åŒ…ä½¿ç”¨ï¼›åŒä¸€åŒ…ä¸‹ï¼Œä¸å­˜åœ¨å¼•ç”¨é—®é¢˜ã€‚\nåŸºäºåŒ…çš„å°è£… åœ¨Goè¯­è¨€ä¸­å°è£…å°±æ˜¯æŠŠæŠ½è±¡å‡ºæ¥çš„å­—æ®µå’Œå¯¹å­—æ®µçš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ•°æ®è¢«ä¿æŠ¤åœ¨å†…éƒ¨ï¼Œç¨‹åºçš„å…¶å®ƒåŒ…åªèƒ½é€šè¿‡è¢«æˆæƒçš„æ–¹æ³•ï¼Œæ‰èƒ½å¯¹å­—æ®µè¿›è¡Œæ“ä½œã€‚\nå°è£…çš„å¥½å¤„ï¼š éšè—å®ç°ç»†èŠ‚ï¼› å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œä¿è¯æ•°æ®å®‰å…¨åˆç†ã€‚\nå°è£…çš„å®ç°æ­¥éª¤ï¼š\nå°†ç»“æ„ä½“ã€å­—æ®µçš„é¦–å­—æ¯å°å†™ï¼› ç»™ç»“æ„ä½“æ‰€åœ¨çš„åŒ…æä¾›ä¸€ä¸ªå·¥å‚æ¨¡å¼çš„å‡½æ•°ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œç±»ä¼¼ä¸€ä¸ªæ„é€ å‡½æ•°ï¼› æä¾›ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„ Set æ–¹æ³•ï¼ˆç±»ä¼¼å…¶å®ƒè¯­è¨€çš„ publicï¼‰ï¼Œç”¨äºå¯¹å±æ€§åˆ¤æ–­å¹¶èµ‹å€¼ï¼› æä¾›ä¸€ä¸ªé¦–å­—æ¯å¤§å†™çš„ Get æ–¹æ³•ï¼ˆç±»ä¼¼å…¶å®ƒè¯­è¨€çš„ publicï¼‰ï¼Œç”¨äºè·å–å±æ€§çš„å€¼ã€‚ åŒ…çš„åˆå§‹åŒ– æ¯ä¸ªåŒ…éƒ½å…è®¸æœ‰ä¸€ä¸ª init å‡½æ•°ï¼Œå½“è¿™ä¸ªåŒ…è¢«å¯¼å…¥æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥åŒ…çš„è¿™ä¸ª init å‡½æ•°ï¼Œåšä¸€äº›åˆå§‹åŒ–ä»»åŠ¡ã€‚ å¯¹äº init å‡½æ•°çš„æ‰§è¡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„:\ninit å‡½æ•°ä¼˜å…ˆäº main å‡½æ•°æ‰§è¡Œ åœ¨ä¸€ä¸ªåŒ…å¼•ç”¨é“¾ä¸­ï¼ŒåŒ…çš„åˆå§‹åŒ–æ˜¯æ·±åº¦ä¼˜å…ˆçš„ã€‚æ¯”å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªåŒ…å¼•ç”¨å…³ç³»ï¼šmainâ†’Aâ†’Bâ†’Cï¼Œé‚£ä¹ˆåˆå§‹åŒ–é¡ºåºä¸º C.initâ†’B.initâ†’A.initâ†’main å°è£…å¼•ç”¨å®ä¾‹ å»ºç«‹å¦‚ä¸‹å·¥ç¨‹ç»“æ„ï¼Œåœ¨mainåŒ…ä¸­éœ€è¦è®¿é—®modelåŒ…ä¸­çš„å†…å®¹ã€‚\nproject |---src |---main -main.go |---model -student.go student.go\ntype student struct { Name string idCardNum string // ç§æœ‰ï¼Œå¤–éƒ¨åŒ…ä¸å¯è®¿é—® Age int8 } func NewStudent(stuName string, age int8) *student { return \u0026amp;student{ Name: stuName, Age: age, } } // å®šä¹‰ç»“æ„ä½“æ–¹æ³• func (stu *student) SetIdCardNum(idCN string) { stu."
    },{
      "title": "Goè¯­è¨€channel",
      "url": "https://qiref.github.io/post/2021/06/09/go%E8%AF%AD%E8%A8%80channel/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€ä¸­ï¼Œåç¨‹ä¹‹é—´é€šè¿‡channelç›¸äº’é€šä¿¡ï¼Œå¯ä»¥ä»ä¸€ä¸ªGoåç¨‹å°†å€¼å‘é€åˆ°é€šé“ï¼Œç„¶ååœ¨åˆ«çš„åç¨‹ä¸­æ¥æ”¶ã€‚\nchannel å®šä¹‰ å®šä¹‰channelçš„è¯­æ³•ä¸ºï¼šmake(chan val-type)ï¼Œval-typeå°±æ˜¯éœ€è¦ä¼ é€’å€¼çš„ç±»å‹ã€‚ chan1 \u0026lt;- val è¡¨ç¤ºå°†valå‘é€åˆ°channel chann1ä¸­ï¼Œ r := \u0026lt;- chann1è¡¨ç¤ºä»chann1ä¸­è¯»å–æ¶ˆæ¯ã€‚\nfunc Ping(c *chan string, s string) { *c \u0026lt;- s } func Pong(c *chan string) string { return \u0026lt;-*c } // main func main() { c := make(chan string) go Ping(\u0026amp;c, \u0026quot;ping\u0026quot;) go func() { pong := Pong(\u0026amp;c) fmt.Println(pong) }() time.Sleep(time.Second * 2) } // ç»“æœ // ping éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘é€šé“ä¸­å‘é€æ¶ˆæ¯å’Œä»é€šé“ä¸­æ¥æ”¶æ¶ˆæ¯ï¼Œéƒ½æ˜¯é˜»å¡çš„ï¼Œå¦‚æœå‘é€å’Œæ¥æ”¶ä¸æ˜¯æˆå¯¹å‡ºç°ï¼Œå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚ å°†ä¸Šæ–‡ä¸­ä»£ç æ”¹æˆè¿™æ ·ï¼š\nc := make(chan string) Ping(\u0026amp;c, \u0026quot;ping\u0026quot;) //go func() { // pong := Pong(\u0026amp;c) // fmt.Println(pong) //}() time.Sleep(time.Second * 2) //fatal error: all goroutines are asleep - deadlock! channelæ–¹å‘ func pong(ping \u0026lt;-chan string, pong chan\u0026lt;- string) { msg := \u0026lt;-ping pong \u0026lt;- msg } åœ¨chançš„å®šä¹‰ä¸­ï¼Œç®­å¤´çš„æ–¹å‘æ˜¯å›ºå®šçš„ï¼Œ\u0026lt;-ç®­å¤´æ–¹å‘åªèƒ½å‘å·¦ã€‚\n\u0026lt;-chan è¡¨ç¤ºè¯¥channelåªèƒ½ç”¨äºæ¥æ”¶æ¶ˆæ¯ï¼Œä¸èƒ½ç”¨å…¶å‘é€æ¶ˆæ¯ã€‚ chan\u0026lt;- è¡¨ç¤ºè¯¥channelåªèƒ½ç”¨äºå‘é€æ¶ˆæ¯ï¼Œä¸èƒ½ç”¨å…¶æ¥æ”¶æ¶ˆæ¯ã€‚ channelç¼“å†² é»˜è®¤é€šé“æ˜¯ æ— ç¼“å†² çš„ï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨å¯¹åº”çš„æ¥æ”¶ï¼ˆ\u0026lt;- chanï¼‰é€šé“å‡†å¤‡å¥½æ¥æ”¶æ—¶ï¼Œæ‰å…è®¸è¿›è¡Œå‘é€ï¼ˆchan \u0026lt;-ï¼‰ã€‚å¯ç¼“å­˜é€šé“å…è®¸åœ¨æ²¡æœ‰å¯¹åº”æ¥æ”¶æ–¹çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜é™å®šæ•°é‡çš„å€¼ã€‚\nmessages := make(chan string, 2) messages \u0026lt;- \u0026quot;1\u0026quot; messages \u0026lt;- \u0026quot;2\u0026quot; make æ„å»ºä¸€ä¸ªchannelæ—¶ï¼Œå¯ä»¥æŒ‡å®šç¼“å†²åŒºå¤§å°ï¼Œå½“channelä¸­è¶…è¿‡2ä¸ªå…ƒç´ æ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚\nchannelåŒæ­¥ func work(done chan bool) { fmt.Println(\u0026quot;working ...\u0026quot;) time.Sleep(time.Second * 3) fmt.Println(\u0026quot;done\u0026quot;) done \u0026lt;- true } // main done := make(chan bool) go work(done) \u0026lt;-done // è¾“å‡º // working ... // done ç¨‹åºå°†åœ¨æ¥æ”¶åˆ°é€šé“ä¸­ work() å‘å‡ºçš„é€šçŸ¥å‰ä¸€ç›´é˜»å¡ï¼Œå¦‚æœæŠŠ \u0026lt;- done è¿™è¡Œä»£ç ä»åºä¸­ç§»é™¤ï¼Œç¨‹åºç”šè‡³ä¼šåœ¨work()è¿˜æ²¡å¼€å§‹è¿è¡Œæ—¶å°±ç»“æŸäº†ã€‚\nchanneléå† for å’Œ rangeä¸ºåŸºæœ¬çš„æ•°æ®ç»“æ„æä¾›äº†è¿­ä»£çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªè¯­æ³•æ¥éå†ä»é€šé“ä¸­å–å¾—çš„å€¼ã€‚\nfunc loop(c chan string) { fmt.Println(\u0026quot;range over chan start.\u0026quot;) for s := range c { fmt.Println(s) } fmt.Println(\u0026quot;range over chan end.\u0026quot;) } // main chanForRange := make(chan string, 3) chanForRange \u0026lt;- \u0026quot;l\u0026quot; chanForRange \u0026lt;- \u0026quot;m\u0026quot; chanForRange \u0026lt;- \u0026quot;n\u0026quot; close(chanForRange) loop(chanForRange) // è¾“å‡ºç»“æœ // range over chan start. // l // m // n // range over chan end. è¿™é‡Œéå†éœ€è¦å…³é—­chanForRangeï¼Œå¦åˆ™chanForRangeä¼šä¸€ç›´ç­‰å¾…è¾“å…¥ï¼Œä½†åç»­æ²¡æœ‰å¾€channelä¸­å†™å…¥æ¶ˆæ¯ï¼Œä¼šå¯¼è‡´æˆå‹é™·å…¥æ­»é”ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œåœ¨channelå…³é—­åï¼Œä¾ç„¶å¯ä»¥éå†channelã€‚\nselect Go è¯­è¨€ä¸­çš„ select èƒ½å¤Ÿè®© Goroutine åŒæ—¶ç­‰å¾…å¤šä¸ª Channel å¯è¯»æˆ–è€…å¯å†™ï¼Œåœ¨å¤šä¸ªæ–‡ä»¶æˆ–è€… ChannelçŠ¶æ€æ”¹å˜ä¹‹å‰ï¼Œselect ä¼šä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹æˆ–è€… Goroutineã€‚\nc1 := make(chan string) c2 := make(chan string) go func() { time.Sleep(time.Second * 1) c1 \u0026lt;- \u0026quot;1\u0026quot; }() go func() { time.Sleep(time.Second * 1) c2 \u0026lt;- \u0026quot;2\u0026quot; }() for i := 0; i \u0026lt; 2; i++ { select { case msg1 := \u0026lt;-c1: fmt.Println(i) fmt.Println(\u0026quot;receive msg1 : \u0026quot;, msg1) case msg2 := \u0026lt;-c2: fmt.Println(i) fmt.Println(\u0026quot;receive msg2 : \u0026quot;, msg2) } } // è¿è¡Œç»“æœï¼š // 0 // receive msg1 : 1 // 1 // receive msg2 : 2 è¿™é‡Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½ä¼šè¿›å…¥ä¸€æ¬¡selectï¼Œç„¶åä¼šæ‰§è¡Œå…¶ä¸­çš„ä¸€ä¸ªcaseï¼Œå¦‚æœæ²¡æœ‰è¿›å…¥caseï¼Œç¨‹åºå°±ä¼šå‡ºç°æ­»é”ï¼›å› æ­¤è¿™é‡Œçš„å¾ªç¯æ¬¡æ•°éœ€è¦å’Œchannelå‘é€æ¶ˆæ¯çš„æ¬¡æ•°ä¸€è‡´ï¼Œå› ä¸ºselecté»˜è®¤ä¼šé˜»å¡ã€‚\nfor i := 0; i \u0026lt; 5; i++ { select { case msg1 := \u0026lt;-c1: fmt.Println(i) fmt.Println(\u0026quot;receive msg1 : \u0026quot;, msg1) case msg2 := \u0026lt;-c2: fmt.Println(i) fmt.Println(\u0026quot;receive msg2 : \u0026quot;, msg2) default: fmt.Println(\u0026quot;default\u0026quot;) } } selecté…ä¸Šdefaultä¹‹åï¼Œå½“caseæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œselectå°±ä¸ä¼šé™·å…¥é˜»å¡ã€‚\nå¤šåç¨‹æ‰§è¡Œä»»åŠ¡, å¹¶æ”¶é›†æ‰§è¡Œç»“æœ import ( \u0026quot;fmt\u0026quot; \u0026quot;sync\u0026quot; \u0026quot;testing\u0026quot; \u0026quot;time\u0026quot; ) func TestMain(t *testing.T) { rstChan := make(chan map[string]int, 5) // è¿™é‡Œå¿…é¡»æŒ‡å®š chan çš„å®¹é‡ var wg sync.WaitGroup for i := 0; i \u0026lt; 5; i++ { i := i wg.Add(1) go func() { // æ¨¡æ‹Ÿæ‰§è¡Œä»»åŠ¡ defer wg.Done() if i%2 == 0 { // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œå¤±è´¥çš„åœºæ™¯, ä¼šå‡ºç°ä¸å¾€ rstChan å†™å…¥æ¶ˆæ¯çš„æƒ…å†µ m := make(map[string]int) m[fmt.Sprintf(\u0026quot;%d\u0026quot;, i)] = i time.Sleep(time.Second * 3) rstChan \u0026lt;- m } }() } fmt.Println(\u0026quot;wait\u0026quot;) wg.Wait() fmt.Println(\u0026quot;wait finish\u0026quot;) size := len(rstChan) // æå‰è¯»å– rstChan size, æ¶ˆè´¹æ•°æ® len(rstChan) ä¼šæ”¹å˜ for j := 0; j \u0026lt; size; j++ { item := \u0026lt;-rstChan fmt.Println(item) } defer close(rstChan) fmt.Println(\u0026quot;done\u0026quot;) } // è¾“å‡º === RUN TestMain wait wait finish map[2:2] map[4:4] map[0:0] done --- PASS: TestMain (3.00s) PASS ok awesome-test/src/main 3.002s ",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€ä¸­ï¼Œåç¨‹ä¹‹é—´é€šè¿‡channelç›¸äº’é€šä¿¡ï¼Œå¯ä»¥ä»ä¸€ä¸ªGoåç¨‹å°†å€¼å‘é€åˆ°é€šé“ï¼Œç„¶ååœ¨åˆ«çš„åç¨‹ä¸­æ¥æ”¶ã€‚\nchannel å®šä¹‰ å®šä¹‰channelçš„è¯­æ³•ä¸ºï¼šmake(chan val-type)ï¼Œval-typeå°±æ˜¯éœ€è¦ä¼ é€’å€¼çš„ç±»å‹ã€‚ chan1 \u0026lt;- val è¡¨ç¤ºå°†valå‘é€åˆ°channel chann1ä¸­ï¼Œ r := \u0026lt;- chann1è¡¨ç¤ºä»chann1ä¸­è¯»å–æ¶ˆæ¯ã€‚\nfunc Ping(c *chan string, s string) { *c \u0026lt;- s } func Pong(c *chan string) string { return \u0026lt;-*c } // main func main() { c := make(chan string) go Ping(\u0026amp;c, \u0026quot;ping\u0026quot;) go func() { pong := Pong(\u0026amp;c) fmt.Println(pong) }() time.Sleep(time.Second * 2) } // ç»“æœ // ping éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘é€šé“ä¸­å‘é€æ¶ˆæ¯å’Œä»é€šé“ä¸­æ¥æ”¶æ¶ˆæ¯ï¼Œéƒ½æ˜¯é˜»å¡çš„ï¼Œå¦‚æœå‘é€å’Œæ¥æ”¶ä¸æ˜¯æˆå¯¹å‡ºç°ï¼Œå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚ å°†ä¸Šæ–‡ä¸­ä»£ç æ”¹æˆè¿™æ ·ï¼š\nc := make(chan string) Ping(\u0026amp;c, \u0026quot;ping\u0026quot;) //go func() { // pong := Pong(\u0026amp;c) // fmt."
    },{
      "title": "Goè¯­è¨€æ¥å£",
      "url": "https://qiref.github.io/post/2021/06/05/go%E8%AF%AD%E8%A8%80%E6%8E%A5%E5%8F%A3/",
      "content": "æ‘˜è¦ï¼šGoæ”¯æŒæ¥å£ï¼Œæ¥å£æ˜¯æ–¹æ³•ç‰¹å¾çš„å‘½åé›†åˆã€‚\ngoè¯­è¨€æ¥å£ goè¯­è¨€ä¸­æœ‰æ¥å£çš„æ¦‚å¿µï¼Œæ¥å£æ˜¯æ–¹æ³•ç‰¹å¾çš„å‘½åé›†åˆã€‚å®ƒæŠŠæ‰€æœ‰çš„å…·æœ‰å…±æ€§çš„æ–¹æ³•å®šä¹‰åœ¨ä¸€èµ·ï¼Œä»»ä½•å…¶ä»–ç±»å‹åªè¦å®ç°äº†è¿™äº›æ–¹æ³•å°±æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\næ³¨æ„ï¼Œå®ç°äº†è¿™äº›æ–¹æ³•å°±ç®—å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\nå®šä¹‰æ¥å£ // å®šä¹‰geometryæ¥å£ type geometry interface { area() float64 peri() float64 } æ¥å£çš„å®šä¹‰ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å®šä¹‰å’Œå®ç°è§„åˆ™å¦‚ä¸‹ï¼š\n/* å®šä¹‰æ¥å£ */ type interface_name interface { method_name1 [return_type] method_name2 [return_type] method_name3 [return_type] ... method_namen [return_type] } /* å®šä¹‰ç»“æ„ä½“ */ type struct_name struct { /* variables */ } /* å®ç°æ¥å£æ–¹æ³• */ func (struct_name_variable struct_name) method_name1() [return_type] { /* æ–¹æ³•å®ç° */ } ... func (struct_name_variable struct_name) method_namen() [return_type] { /* æ–¹æ³•å®ç°*/ } å®ç°æ¥å£ Goè¯­è¨€ä¸­æ¥å£çš„å®ç°éƒ½æ˜¯éšå¼çš„ï¼Œé»˜è®¤å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•å°±éšå¼åœ°å®ç°äº†æ¥å£ã€‚\nå‡å¦‚ç°å·²å®šä¹‰ä¸Šæ–‡ä¸­çš„geometryæ¥å£ï¼Œç°åœ¨è¦å®ç°è¯¥æ¥å£ã€‚\n// å®šä¹‰rectç»“æ„ä½“ type rect struct { width, height float64 } // rect å®ç°geometryæ¥å£ï¼Œå®ç°æ¥å£çš„æ–¹å¼ä¸å®šä¹‰æ–¹æ³•ç±»ä¼¼ func (r rect) area() float64 { return r.width * r.height } // rect å®ç°geometryæ¥å£ï¼Œåªæœ‰å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•æ‰ç®—å®ç°æ¥å£ func (r rect) peri() float64 { return r.height*2 + r.width*2 } æ³¨æ„ï¼šåªæœ‰å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•æ‰ç®—å®ç°æ¥å£ã€‚\nè°ƒç”¨æ–¹å¼ï¼š\nvar geo1 geometry = rect{height: 1, width: 3} fmt.Println(\u0026quot;geo1.area()\u0026quot;, geo1.area()) fmt.Println(\u0026quot;geo1.peri()\u0026quot;, geo1.peri()) æ¥å£ä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œä¼ å‚ä¼ å…¥å…·ä½“çš„å®ç°ã€‚\n// å®šä¹‰è°ƒç”¨æ¥å£æ–¹æ³•çš„å‡½æ•° func measure(g geometry) { fmt.Println(g.peri()) fmt.Println(g.area()) } // --- main() rect1 := rect{height: 3, width: 2} measure(rect1) æ¥å£ç±»å‹ æ¥å£ä¹Ÿæ˜¯Goè¯­è¨€ä¸­çš„ä¸€ç§ç±»å‹ï¼Œè¿™ç§ç±»å‹å¯ä»¥å‡ºç°åœ¨å˜é‡çš„å®šä¹‰ã€å‡½æ•°çš„å…¥å‚ã€å‡½æ•°çš„è¿”å›å€¼ä¸­ã€‚\n// define Print func Print(i interface{}) { fmt.Println(i) } v1 := 22 v2 := \u0026quot;ss\u0026quot; v3 := make([]string, 1) v3 = append(v3, \u0026quot;333\u0026quot;) Print(v1) Print(v2) Print(v3) // ç»“æœ // 22 // ss // [ 333] Print()å‡½æ•°ä¸­ï¼Œå‚æ•°ä¸ºinterface{}ç±»å‹ï¼Œä½†å¹¶ä¸æ˜¯ä»»æ„ç±»å‹ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå°†å‚æ•°è½¬æ¢æˆäº†interface{}ç±»å‹ï¼Œè¿™é‡Œæ˜¯ç±»å‹è½¬æ¢ã€‚\næ¥å£å’ŒæŒ‡é’ˆ çœ‹ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­ï¼š\né€šè¿‡ç»“æ„ä½“å®ç°æ¥å£ // å®šä¹‰rectç»“æ„ä½“ type rect struct { width, height float64 } // rect å®ç°geometryæ¥å£ï¼Œå®ç°æ¥å£çš„æ–¹å¼ä¸å®šä¹‰æ–¹æ³•ç±»ä¼¼ func (r rect) area() float64 { return r.width * r.height } // rect å®ç°geometryæ¥å£ï¼Œåªæœ‰å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•æ‰ç®—å®ç°æ¥å£ func (r rect) peri() float64 { return r.height*2 + r.width*2 } é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£ // å®šä¹‰rectç»“æ„ä½“ type rect struct { width, height float64 } // rect å®ç°geometryæ¥å£ï¼Œå®ç°æ¥å£çš„æ–¹å¼ä¸å®šä¹‰æ–¹æ³•ç±»ä¼¼ func (r *rect) area() float64 { return r.width * r.height } // rect å®ç°geometryæ¥å£ï¼Œåªæœ‰å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•æ‰ç®—å®ç°æ¥å£ func (r *rect) peri() float64 { return r.height*2 + r.width*2 } åœ¨Goè¯­è¨€ä¸­ï¼Œç»“æ„ä½“å®ç°æ¥å£æœ‰ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡ç»“æ„ä½“å®ç°ã€é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆå®ç°ã€‚ä½†ä¸¤ç§æ–¹å¼ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼Œè¿™ä¸¤ç§å®ç°æ–¹å¼ä¹Ÿä¼šå¯¼è‡´æ¥å£çš„è°ƒç”¨æœ‰äº›å·®åˆ«ã€‚\nvar geo1 geometry = rect{height: 1, width: 3} // ä½¿ç”¨ç»“æ„ä½“åˆå§‹åŒ–å˜é‡ var geo1 geometry = \u0026amp;rect{height: 1, width: 3} // ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆåˆå§‹åŒ–å˜é‡ ç»“æ„ä½“å®ç°æ¥å£ ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£ ç»“æ„ä½“æŒ‡é’ˆåˆå§‹åŒ–å˜é‡ é€šè¿‡ é€šè¿‡ ç»“æ„ä½“åˆå§‹åŒ–å˜é‡ é€šè¿‡ ä¸é€šè¿‡ å½“ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£æ—¶ï¼Œæ— è®ºåˆå§‹åŒ–å˜é‡æ˜¯ç»“æ„ä½“è¿˜æ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼Œéƒ½å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼›å½“ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£æ—¶ï¼Œåˆå§‹åŒ–å˜é‡ä¸ºç»“æ„ä½“æ—¶æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆå®ç°æ¥å£æ—¶ï¼Œåˆå§‹åŒ–å˜é‡ä¸ºç»“æ„ä½“æ—¶æ— æ³•ç¼–è¯‘é€šè¿‡ï¼Ÿ\nåŸå› æ˜¯åœ¨å‡½æ•°è°ƒç”¨é˜¶æ®µï¼ŒGoè¯­è¨€åœ¨ä¼ é€’å‚æ•°æ—¶éƒ½æ˜¯å€¼ä¼ é€’ã€‚æ— è®ºåˆå§‹å˜é‡æ˜¯rect{}è¿˜æ˜¯\u0026amp;rect{}ï¼Œåœ¨è°ƒç”¨æ–¹æ³•æ—¶éƒ½ä¼šå‘ç”Ÿå€¼æ‹·è´ã€‚\nå¯¹äº\u0026amp;rect{}æ¥è¯´ï¼Œæ–¹æ³•è°ƒç”¨é˜¶æ®µä¼šæ‹·è´ä¸€ä¸ªæ–°çš„\u0026amp;rect{}æŒ‡é’ˆï¼Œæ–°çš„æŒ‡é’ˆä¸åŸæ¥çš„æŒ‡é’ˆéƒ½æŒ‡å‘åŒä¸€ä¸ªç»“æ„ä½“ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥éšå¼åœ°è§£å¼•ç”¨ï¼ˆdereferenceï¼‰ï¼Œè·å–åˆ°åŸå§‹çš„ç»“æ„ä½“ã€‚ å¯¹äºrect{}æ¥è¯´ï¼Œæ–¹æ³•è°ƒç”¨é˜¶æ®µä¼šæ‹·è´ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„rect{}ï¼Œä½†å› ä¸ºæ–¹æ³•çš„å‚æ•°æ˜¯*rectï¼Œç¼–è¯‘å™¨ä¸ä¼šæ— ä¸­ç”Ÿæœ‰åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆï¼Œå°±ç®—åˆ›å»ºæ–°çš„æŒ‡é’ˆï¼Œä¹Ÿä¸ä¼šæŒ‡å‘åŸå§‹çš„ç»“æ„ä½“ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆå®ç°æ¥å£æ—¶ï¼Œåªæœ‰æŒ‡é’ˆç±»å‹çš„å˜é‡æ‰ä¼šå®ç°è¯¥æ¥å£ï¼›å½“æˆ‘ä»¬ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£æ—¶ï¼ŒæŒ‡é’ˆç±»å‹å’Œç»“æ„ä½“ç±»å‹éƒ½ä¼šå®ç°è¯¥æ¥å£ã€‚å½“ç„¶è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä¸€å¾‹ä½¿ç”¨ç»“æ„ä½“å®ç°æ¥å£ï¼Œè¿™ä¸ªé—®é¢˜åœ¨å®é™…å·¥ç¨‹ä¸­ä¹Ÿæ²¡é‚£ä¹ˆé‡è¦ã€‚\nå†è°ˆæ¥å£ç±»å‹ äº†è§£äº†æ¥å£å‚æ•°çš„éšå¼è½¬æ¢åï¼Œå†çœ‹ä¸Šæ–‡æåˆ°çš„ï¼Œæ¥å£ä¸æ˜¯ä»»ä½•ä¸€ç§ç±»å‹ï¼Œçœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼š\ntype TestStruct struct{} func NilOrNot(v interface{}) bool { return v == nil } func main() { var s *TestStruct fmt.Println(s == nil) // true fmt.Println(NilOrNot(s)) // false } è°ƒç”¨NilOrNotå‡½æ•°æ—¶ï¼Œå‘ç”Ÿäº†éšå¼ç±»å‹è½¬æ¢ï¼Œé™¤äº†å‘æ–¹æ³•ä¼ å…¥å‚æ•°ä¹‹å¤–ï¼Œå˜é‡çš„èµ‹å€¼ä¹Ÿä¼šè§¦å‘éšå¼ç±»å‹è½¬æ¢ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œ*TestStructç±»å‹ä¼šè½¬æ¢ä¸ºinterface{}ç±»å‹ï¼Œè½¬æ¢åçš„å˜é‡ä¸ä»…åŒ…å«è½¬æ¢å‰çš„å˜é‡ï¼Œè¿˜åŒ…å«å˜é‡çš„ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥è½¬æ¢åçš„å˜é‡ä¸ nil ä¸ç›¸ç­‰ã€‚\n",
      "summary": "æ‘˜è¦ï¼šGoæ”¯æŒæ¥å£ï¼Œæ¥å£æ˜¯æ–¹æ³•ç‰¹å¾çš„å‘½åé›†åˆã€‚\ngoè¯­è¨€æ¥å£ goè¯­è¨€ä¸­æœ‰æ¥å£çš„æ¦‚å¿µï¼Œæ¥å£æ˜¯æ–¹æ³•ç‰¹å¾çš„å‘½åé›†åˆã€‚å®ƒæŠŠæ‰€æœ‰çš„å…·æœ‰å…±æ€§çš„æ–¹æ³•å®šä¹‰åœ¨ä¸€èµ·ï¼Œä»»ä½•å…¶ä»–ç±»å‹åªè¦å®ç°äº†è¿™äº›æ–¹æ³•å°±æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\næ³¨æ„ï¼Œå®ç°äº†è¿™äº›æ–¹æ³•å°±ç®—å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\nå®šä¹‰æ¥å£ // å®šä¹‰geometryæ¥å£ type geometry interface { area() float64 peri() float64 } æ¥å£çš„å®šä¹‰ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å®šä¹‰å’Œå®ç°è§„åˆ™å¦‚ä¸‹ï¼š\n/* å®šä¹‰æ¥å£ */ type interface_name interface { method_name1 [return_type] method_name2 [return_type] method_name3 [return_type] ... method_namen [return_type] } /* å®šä¹‰ç»“æ„ä½“ */ type struct_name struct { /* variables */ } /* å®ç°æ¥å£æ–¹æ³• */ func (struct_name_variable struct_name) method_name1() [return_type] { /* æ–¹æ³•å®ç° */ } ... func (struct_name_variable struct_name) method_namen() [return_type] { /* æ–¹æ³•å®ç°*/ } å®ç°æ¥å£ Goè¯­è¨€ä¸­æ¥å£çš„å®ç°éƒ½æ˜¯éšå¼çš„ï¼Œé»˜è®¤å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•å°±éšå¼åœ°å®ç°äº†æ¥å£ã€‚"
    },{
      "title": "Goè¯­è¨€æŒ‡é’ˆ",
      "url": "https://qiref.github.io/post/2021/06/05/go%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88/",
      "content": "æ‘˜è¦ï¼šGoæ”¯æŒæŒ‡é’ˆï¼Œå…è®¸åœ¨ç¨‹åºä¸­é€šè¿‡å¼•ç”¨ä¼ é€’å€¼æˆ–è€…æ•°æ®ç»“æ„ã€‚\ngoè¯­è¨€ä¸­çš„æŒ‡é’ˆå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»ä¼¼ï¼Œä½†æ¯”Cè¯­è¨€ä¸­çš„æŒ‡é’ˆæ›´ç®€å•ã€‚\n// Goè¯­è¨€å–åœ°å€ç¬¦å·æ˜¯\u0026amp;ï¼Œæ”¾åˆ°å˜é‡å‰ä¼šè¿”å›å¯¹åº”å˜é‡çš„å†…å­˜åœ°å€ var i1 int = 1 var j = i1 fmt.Println(\u0026amp;i1) fmt.Println(\u0026amp;j) // å®šä¹‰æŒ‡é’ˆå˜é‡ var var_name *var_type s := \u0026quot;sss\u0026quot; p := 2181 var ip *string = \u0026amp;s var port *int = \u0026amp;p fmt.Println(*ip) fmt.Println(*port) å˜é‡ã€æŒ‡é’ˆå’Œåœ°å€ä¸‰è€…çš„å…³ç³»æ˜¯ï¼Œæ¯ä¸ªå˜é‡éƒ½æ‹¥æœ‰åœ°å€ï¼ŒæŒ‡é’ˆçš„å€¼å°±æ˜¯åœ°å€ã€‚\né€šè¿‡\u0026amp; è·å–å¯¹åº”å˜é‡çš„å†…å­˜åœ°å€ã€‚ é€šè¿‡* è·å–æŒ‡é’ˆçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆå–å€¼ã€‚å–åœ°å€æ“ä½œç¬¦ \u0026amp; å’Œå–å€¼æ“ä½œç¬¦ * æ˜¯ä¸€å¯¹äº’è¡¥æ“ä½œç¬¦ï¼Œ\u0026amp; å–å‡ºåœ°å€ï¼Œ* æ ¹æ®åœ°å€å–å‡ºåœ°å€æŒ‡å‘çš„å€¼ã€‚\nå˜é‡ã€æŒ‡é’ˆåœ°å€ã€æŒ‡é’ˆå˜é‡ã€å–åœ°å€ã€å–å€¼çš„ç›¸äº’å…³ç³»å’Œç‰¹æ€§å¦‚ä¸‹ï¼š\nå¯¹å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œä½¿ç”¨\u0026amp;æ“ä½œç¬¦ï¼Œå¯ä»¥è·å¾—è¿™ä¸ªå˜é‡çš„æŒ‡é’ˆå˜é‡ã€‚ æŒ‡é’ˆå˜é‡çš„å€¼æ˜¯æŒ‡é’ˆåœ°å€ã€‚ å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€¼æ“ä½œä½¿ç”¨*æ“ä½œç¬¦ï¼Œå¯ä»¥è·å¾—æŒ‡é’ˆå˜é‡æŒ‡å‘çš„åŸå˜é‡çš„å€¼ã€‚ é€šè¿‡New()åˆ›å»ºæŒ‡é’ˆ Goè¯­è¨€è¿˜æä¾›äº†å¦å¤–ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºæŒ‡é’ˆå˜é‡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š new(type) è¿™ä¸ªtypeå¯ä»¥ä¸ºintã€‚\n// create ptr by new() func createPtr() { str := new(string) *str = \u0026quot;ssss\u0026quot; fmt.Println(\u0026quot;str is : \u0026quot;, str) fmt.Println(\u0026quot;*str is : \u0026quot;, *str) // str is : 0xc000116050 // *str is : ssss } new() å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹åº”ç±»å‹çš„æŒ‡é’ˆï¼Œåˆ›å»ºè¿‡ç¨‹ä¼šåˆ†é…å†…å­˜ï¼Œè¢«åˆ›å»ºçš„æŒ‡é’ˆæŒ‡å‘é»˜è®¤å€¼ã€‚\næ•°ç»„æŒ‡é’ˆ const numlen = 4 // æ•°ç»„æŒ‡é’ˆ nums := []int{1, 2, 3, 4} // æŒ‡é’ˆæ•°ç»„çš„é•¿åº¦å¿…é¡»ç­‰ä¸æ•°ç»„é•¿åº¦ var ptr [numlen]*int for i2 := range nums { ptr[i2] = \u0026amp;nums[i2] } for i := 0; i \u0026lt; numlen; i++ { fmt.Println(*ptr[i]) } æŒ‡é’ˆçš„æŒ‡é’ˆ // æŒ‡é’ˆçš„æŒ‡é’ˆ pp := 12 p1 := \u0026amp;pp p2 := \u0026amp;p1 fmt.Println(\u0026quot;pp: \u0026quot;, pp) fmt.Println(\u0026quot;p1: \u0026quot;, *p1) fmt.Println(\u0026quot;p2: \u0026quot;, **p2) å‡½æ•°æŒ‡é’ˆ è°ˆåˆ°å‡½æ•°æŒ‡é’ˆï¼Œå°±ä¸å¾—ä¸æåˆ°å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’äº†ã€‚å‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¦‚æœæ˜¯å€¼ä¼ é€’ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨å¾—åˆ°çš„æ˜¯å‚æ•°çš„æ‹·è´ï¼Œå¯¹å‚æ•°ä¿®æ”¹ä¸ä¼šå½±å“åŸå§‹å‚æ•°ï¼›å¦‚æœæ˜¯å¼•ç”¨ä¼ é€’ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨çš„åˆ°çš„å°±æ˜¯å‚æ•°çš„å†…å­˜åœ°å€ï¼Œå¯¹å‚æ•°çš„ä¿®æ”¹ä¼šå½±å“åŸå§‹å‚æ•°æœ¬èº«ã€‚\n// å€¼ä¼ é€’ func zeroval(ival int) { ival = 0 } // å¼•ç”¨ä¼ é€’ func zeroptr(iptr *int) { *iptr = 0 } zeroval æœ‰ä¸€ä¸ª int å‹å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨å€¼ä¼ é€’ã€‚zerovalå‡½æ•°å°†ä»è°ƒç”¨æ–¹å¾—åˆ°ä¸€ä¸ªivalå½¢å‚çš„æ‹·è´ã€‚\nzeroptr æœ‰ä¸€å’Œä¸Šé¢ä¸åŒçš„ *int å‚æ•°ï¼Œæ„å‘³ç€å®ƒç”¨äº†ä¸€ä¸ª intæŒ‡é’ˆã€‚å‡½æ•°ä½“å†…çš„ *iptr å¼•ç”¨è¿™ä¸ªæŒ‡é’ˆï¼Œä»å®ƒå†…å­˜åœ°å€å¾—åˆ°è¿™ä¸ªåœ°å€å¯¹åº”çš„å½“å‰å€¼ã€‚å¯¹ä¸€ä¸ªå¼•ç”¨çš„æŒ‡é’ˆèµ‹å€¼å°†ä¼šæ”¹å˜è¿™ä¸ªæŒ‡é’ˆå¼•ç”¨çš„çœŸå®åœ°å€çš„å€¼ã€‚\né€šè¿‡å‡½æ•°æŒ‡é’ˆå¯ä»¥ä¼˜é›…åœ°å®ç°ä¸¤å€¼äº¤æ¢ã€‚\n// å‡½æ•°æŒ‡é’ˆå‚æ•° x := 100 y := 200 fmt.Println(\u0026quot;x : \u0026quot;, x) fmt.Println(\u0026quot;y : \u0026quot;, y) swap(\u0026amp;x, \u0026amp;y) fmt.Println(\u0026quot;x : \u0026quot;, x) fmt.Println(\u0026quot;y : \u0026quot;, y) //--- func swap(x *int, y *int) { // ä¼˜é›…çš„å†™æ³• *x, *y = *y, *x //tmp := *x //*x = *y //*y = tmp } ä¼˜é›…åœ°å®ç°swapå°±æ˜¯é€šè¿‡æŒ‡é’ˆäº¤æ¢ä¸¤å€¼ï¼Œå¦‚æœè¯´äº¤æ¢æŒ‡é’ˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ\n// swap ptr func swap1(x, y *int) { x, y = y, x } // main() aa := 1 bb := 3 swap1(\u0026amp;aa, \u0026amp;bb) fmt.Println(\u0026quot;aa: \u0026quot;, aa, \u0026quot; bb: \u0026quot;, bb) // ç»“æœï¼š // aa: 1 bb: 3 ç»“æœè¡¨æ˜ï¼Œäº¤æ¢æ˜¯ä¸æˆåŠŸçš„ã€‚ä¸Šé¢ä»£ç ä¸­çš„ swap1() å‡½æ•°äº¤æ¢çš„æ˜¯ aa å’Œ bb çš„åœ°å€ï¼Œåœ¨äº¤æ¢å®Œæ¯•åï¼Œaa å’Œ bb çš„å˜é‡å€¼ç¡®å®è¢«äº¤æ¢ã€‚ä½†å’Œ aaã€bb å…³è”çš„ä¸¤ä¸ªå˜é‡å¹¶æ²¡æœ‰å®é™…å…³è”ã€‚è¿™å°±åƒå†™æœ‰ä¸¤åº§æˆ¿å­çš„å¡ç‰‡æ”¾åœ¨æ¡Œä¸Šä¸€å­—æ‘Šå¼€ï¼Œäº¤æ¢ä¸¤åº§æˆ¿å­çš„å¡ç‰‡åå¹¶ä¸ä¼šå¯¹ä¸¤åº§æˆ¿å­æœ‰ä»»ä½•å½±å“ã€‚\nç©ºæŒ‡é’ˆ å½“ä¸€ä¸ªæŒ‡é’ˆè¢«å®šä¹‰åæ²¡æœ‰åˆ†é…åˆ°ä»»ä½•å˜é‡æ—¶ï¼Œå®ƒçš„å€¼ä¸º nilã€‚\nnil æŒ‡é’ˆä¹Ÿç§°ä¸ºç©ºæŒ‡é’ˆã€‚\nnilåœ¨æ¦‚å¿µä¸Šå’Œå…¶å®ƒè¯­è¨€çš„nullã€Noneã€nilã€NULLä¸€æ ·ï¼Œéƒ½æŒ‡ä»£ç©ºå€¼ã€‚\nä¸€ä¸ªæŒ‡é’ˆå˜é‡é€šå¸¸ç¼©å†™ä¸º ptrã€‚\n// nilPtr func nilPtr() { var ptr *int fmt.Println(\u0026quot;ptr val is : \u0026quot;, ptr) } // è¾“å‡ºï¼š // ptr val is : \u0026lt;nil\u0026gt; ",
      "summary": "æ‘˜è¦ï¼šGoæ”¯æŒæŒ‡é’ˆï¼Œå…è®¸åœ¨ç¨‹åºä¸­é€šè¿‡å¼•ç”¨ä¼ é€’å€¼æˆ–è€…æ•°æ®ç»“æ„ã€‚\ngoè¯­è¨€ä¸­çš„æŒ‡é’ˆå’ŒCè¯­è¨€ä¸­çš„æŒ‡é’ˆç±»ä¼¼ï¼Œä½†æ¯”Cè¯­è¨€ä¸­çš„æŒ‡é’ˆæ›´ç®€å•ã€‚\n// Goè¯­è¨€å–åœ°å€ç¬¦å·æ˜¯\u0026amp;ï¼Œæ”¾åˆ°å˜é‡å‰ä¼šè¿”å›å¯¹åº”å˜é‡çš„å†…å­˜åœ°å€ var i1 int = 1 var j = i1 fmt.Println(\u0026amp;i1) fmt.Println(\u0026amp;j) // å®šä¹‰æŒ‡é’ˆå˜é‡ var var_name *var_type s := \u0026quot;sss\u0026quot; p := 2181 var ip *string = \u0026amp;s var port *int = \u0026amp;p fmt.Println(*ip) fmt.Println(*port) å˜é‡ã€æŒ‡é’ˆå’Œåœ°å€ä¸‰è€…çš„å…³ç³»æ˜¯ï¼Œæ¯ä¸ªå˜é‡éƒ½æ‹¥æœ‰åœ°å€ï¼ŒæŒ‡é’ˆçš„å€¼å°±æ˜¯åœ°å€ã€‚\né€šè¿‡\u0026amp; è·å–å¯¹åº”å˜é‡çš„å†…å­˜åœ°å€ã€‚ é€šè¿‡* è·å–æŒ‡é’ˆçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆå–å€¼ã€‚å–åœ°å€æ“ä½œç¬¦ \u0026amp; å’Œå–å€¼æ“ä½œç¬¦ * æ˜¯ä¸€å¯¹äº’è¡¥æ“ä½œç¬¦ï¼Œ\u0026amp; å–å‡ºåœ°å€ï¼Œ* æ ¹æ®åœ°å€å–å‡ºåœ°å€æŒ‡å‘çš„å€¼ã€‚\nå˜é‡ã€æŒ‡é’ˆåœ°å€ã€æŒ‡é’ˆå˜é‡ã€å–åœ°å€ã€å–å€¼çš„ç›¸äº’å…³ç³»å’Œç‰¹æ€§å¦‚ä¸‹ï¼š\nå¯¹å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œä½¿ç”¨\u0026amp;æ“ä½œç¬¦ï¼Œå¯ä»¥è·å¾—è¿™ä¸ªå˜é‡çš„æŒ‡é’ˆå˜é‡ã€‚ æŒ‡é’ˆå˜é‡çš„å€¼æ˜¯æŒ‡é’ˆåœ°å€ã€‚ å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€¼æ“ä½œä½¿ç”¨*æ“ä½œç¬¦ï¼Œå¯ä»¥è·å¾—æŒ‡é’ˆå˜é‡æŒ‡å‘çš„åŸå˜é‡çš„å€¼ã€‚ é€šè¿‡New()åˆ›å»ºæŒ‡é’ˆ Goè¯­è¨€è¿˜æä¾›äº†å¦å¤–ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºæŒ‡é’ˆå˜é‡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š new(type) è¿™ä¸ªtypeå¯ä»¥ä¸ºintã€‚\n// create ptr by new() func createPtr() { str := new(string) *str = \u0026quot;ssss\u0026quot; fmt."
    },{
      "title": "Goè¯­è¨€goroutine",
      "url": "https://qiref.github.io/post/2021/06/03/go%E8%AF%AD%E8%A8%80goroutine/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€goroutine\ngoroutineåç¨‹ Go åç¨‹ åœ¨æ‰§è¡Œä¸Šæ¥è¯´æ˜¯è½»é‡çº§çš„çº¿ç¨‹ã€‚goè¯­è¨€å±‚é¢å¹¶ä¸æ”¯æŒå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œä½†æ˜¯åç¨‹æ›´å¥½ç”¨ï¼Œåç¨‹è¢«ç§°ä¸ºç”¨æˆ·æ€çº¿ç¨‹ï¼Œä¸å­˜åœ¨CPUä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚\ngoè¯­è¨€ä¸­å¯åŠ¨ä¸€ä¸ªåç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰§è¡Œå‡½æ•°å‰åŠ ä¸Šgoå…³é”®å­—ï¼Œå°±å¯ä»¥å¯ç”¨goroutineã€‚\nfunc main() { // ä½¿ç”¨åŒ¿åå‡½æ•°å¯ç”¨goroutine go func() { fmt.Println(\u0026quot;goroutine\u0026quot;) }() // è°ƒç”¨å‡½æ•°å¯ç”¨goroutine go func1() } func func1() { fmt.Println(\u0026quot;f1() was called.\u0026quot;) } æ²¡é”™å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œgoroutineä¼šè¢«æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—runtime.runqputä¸­ï¼Œç„¶åç”±è°ƒåº¦å™¨è°ƒåº¦ã€‚å¹¶éæ˜¯æ¯ä¸€ä¸ªåç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œåç¨‹æ¯”çº¿ç¨‹çš„ç²’åº¦æ›´ç»†ã€‚\nä½†æ˜¯ä¸Šè¿°ä»£ç å¹¶ä¸ä¼šæœ‰è¾“å‡ºç»“æœï¼Œå› ä¸ºè¿˜æ²¡ç­‰func1()å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œmain()å°±å·²ç»æ‰§è¡Œå®Œæˆäº†ã€‚æ‰€ä»¥åœ¨main()å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹å‰sleepä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°func1()çš„æ‰§è¡Œç»“æœã€‚\ntime.Sleep(time.Second * 1) WaitGroup sleepè‚¯å®šæ˜¯ä¸é è°±çš„ï¼Œgoè¯­è¨€ä¸­å¯ä»¥ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæˆåå†å›åˆ°ä¸»çº¿ç¨‹ã€‚\n// å®šä¹‰å…¨å±€å˜é‡ var WG = sync.WaitGroup{} func main() { WG.Add(1) go func1() WG.Wait() } func func1() { fmt.Println(\u0026quot;f1() was called.\u0026quot;) WG.Done() } åœ¨è°ƒç”¨func1()ä¹‹å‰ï¼Œè°ƒç”¨å…¨å±€å˜é‡WG.Add()æ–¹æ³•ï¼Œç„¶åå¯ç”¨goroutineè°ƒç”¨func1()ï¼Œç„¶åè°ƒç”¨WG.Wait()å‡½æ•°è¿›è¡Œç­‰å¾…ï¼Œfun1()è°ƒç”¨ç»“æŸåï¼Œè°ƒç”¨WG.Done()ã€‚ é€šè¿‡è¯•éªŒå¯ä»¥å‘ç°ï¼šAdd()æ–¹æ³•ä¸­çš„æ•°å€¼ä¸Done()æ–¹æ³•çš„æ•°é‡åº”è¯¥ä¿æŒä¸€è‡´ã€‚å½“Add(2)æ—¶ï¼ŒDone()æ–¹æ³•åº”è¯¥æ‰§è¡Œä¸¤æ¬¡ã€‚ç›´åˆ° WaitGroup è®¡æ•°å™¨æ¢å¤ä¸º 0ï¼› å³æ‰€æœ‰åç¨‹çš„å·¥ä½œéƒ½å·²ç»å®Œæˆã€‚ çœ‹æºç å¯ä»¥å‘ç°ï¼ŒDone()ä¸Add()å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\n// Done decrements the WaitGroup counter by one. func (wg *WaitGroup) Done() { wg.Add(-1) } å¤šä¸ªgoroutineå¦‚ä½•æ‰§è¡Œ func main() { loop := 5 WG.Add(loop) for i := 0; i \u0026lt; loop; i++ { go func2(i) } WG.Wait() } // define func2 func func2(i int) { fmt.Println(\u0026quot;func2() was called. i is : \u0026quot;, i) WG.Done() } // è¿è¡Œç»“æœï¼š //func2() was called. i is : 4 //func2() was called. i is : 2 //func2() was called. i is : 3 //func2() was called. i is : 0 //func2() was called. i is : 1 æ¯ä¸ªgoroutineçš„è¿è¡Œå¹¶ä¸è§„åˆ™ï¼Œæ¯ä¸ªåç¨‹åœ¨å¹¶å‘æ‰§è¡Œã€‚\u0026#x1f914;\nä»å®ç°ä¸Šï¼Œæ¯ä¸€ä¸ªgoroutineéƒ½ä¼šåŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¿™ç»„åç¨‹ç”±è°ƒåº¦å™¨é€šè¿‡å„ç§è°ƒåº¦ç­–ç•¥è¿›è¡Œè°ƒåº¦ã€‚ç„¶åä¼šå¼€å¯å¤šä¸ªçº¿ç¨‹å»è°ƒåº¦åç¨‹å·¥ä½œé˜Ÿåˆ—ï¼Œ è°ƒåº¦å™¨æœ€å¤šå¯ä»¥åˆ›å»º 10000 ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å…¶ä¸­å¤§å¤šæ•°çš„çº¿ç¨‹éƒ½ä¸ä¼šæ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œå¤§éƒ¨åˆ†éƒ½è¿›è¡Œè°ƒåº¦å·¥ä½œï¼Œæœ€å¤šåªä¼šæœ‰ GOMAXPROCS ä¸ªæ´»è·ƒçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶ä¼šå°† GOMAXPROCS è®¾ç½®æˆå½“å‰æœºå™¨çš„æ ¸æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ runtime.GOMAXPROCS æ¥æ”¹å˜æœ€å¤§çš„æ´»è·ƒçº¿ç¨‹æ•°ã€‚\nfunc main() { runtime.GOMAXPROCS(1) fmt.Println(runtime.NumGoroutine()) for i := 0; i \u0026lt; 10; i++ { go say(\u0026quot;Hello World: \u0026quot; + strconv.Itoa(i)) } fmt.Println(runtime.NumGoroutine()) for { } } func say(s string) { println(s) } ç½‘ä¸Šå¾ˆå¤šåœ°æ–¹ç»™å‡ºè¿™ä¸ªä¾‹å­ï¼Œå¹¶ä¸”è¯´å½“runtime.GOMAXPROCS(1)çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸ä¼šè¿è¡Œçš„ï¼Œåªæœ‰å½“å‚æ•°å¤§äº1æ—¶ï¼Œæ‰å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯è¯¥ç¤ºä¾‹åœ¨go version go1.16.4 darwin/amd64 ç¯å¢ƒä¸‹å¯ä»¥æ­£å¸¸è¿è¡Œï¼ŒçŒœæµ‹æ˜¯goåç¨‹è°ƒåº¦ç­–ç•¥æ–°ç‰ˆæœ¬ä½œäº†ä¼˜åŒ–ã€‚\nå‚è€ƒï¼š\nhttps://zhuanlan.zhihu.com/p/74047342\nhttp://books.studygolang.com/gobyexample/goroutines/\n",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€goroutine\ngoroutineåç¨‹ Go åç¨‹ åœ¨æ‰§è¡Œä¸Šæ¥è¯´æ˜¯è½»é‡çº§çš„çº¿ç¨‹ã€‚goè¯­è¨€å±‚é¢å¹¶ä¸æ”¯æŒå¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ï¼Œä½†æ˜¯åç¨‹æ›´å¥½ç”¨ï¼Œåç¨‹è¢«ç§°ä¸ºç”¨æˆ·æ€çº¿ç¨‹ï¼Œä¸å­˜åœ¨CPUä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚\ngoè¯­è¨€ä¸­å¯åŠ¨ä¸€ä¸ªåç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰§è¡Œå‡½æ•°å‰åŠ ä¸Šgoå…³é”®å­—ï¼Œå°±å¯ä»¥å¯ç”¨goroutineã€‚\nfunc main() { // ä½¿ç”¨åŒ¿åå‡½æ•°å¯ç”¨goroutine go func() { fmt.Println(\u0026quot;goroutine\u0026quot;) }() // è°ƒç”¨å‡½æ•°å¯ç”¨goroutine go func1() } func func1() { fmt.Println(\u0026quot;f1() was called.\u0026quot;) } æ²¡é”™å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œgoroutineä¼šè¢«æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—runtime.runqputä¸­ï¼Œç„¶åç”±è°ƒåº¦å™¨è°ƒåº¦ã€‚å¹¶éæ˜¯æ¯ä¸€ä¸ªåç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹å»æ‰§è¡Œï¼Œåç¨‹æ¯”çº¿ç¨‹çš„ç²’åº¦æ›´ç»†ã€‚\nä½†æ˜¯ä¸Šè¿°ä»£ç å¹¶ä¸ä¼šæœ‰è¾“å‡ºç»“æœï¼Œå› ä¸ºè¿˜æ²¡ç­‰func1()å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œmain()å°±å·²ç»æ‰§è¡Œå®Œæˆäº†ã€‚æ‰€ä»¥åœ¨main()å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹å‰sleepä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°func1()çš„æ‰§è¡Œç»“æœã€‚\ntime.Sleep(time.Second * 1) WaitGroup sleepè‚¯å®šæ˜¯ä¸é è°±çš„ï¼Œgoè¯­è¨€ä¸­å¯ä»¥ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæˆåå†å›åˆ°ä¸»çº¿ç¨‹ã€‚\n// å®šä¹‰å…¨å±€å˜é‡ var WG = sync.WaitGroup{} func main() { WG.Add(1) go func1() WG.Wait() } func func1() { fmt.Println(\u0026quot;f1() was called.\u0026quot;) WG.Done() } åœ¨è°ƒç”¨func1()ä¹‹å‰ï¼Œè°ƒç”¨å…¨å±€å˜é‡WG.Add()æ–¹æ³•ï¼Œç„¶åå¯ç”¨goroutineè°ƒç”¨func1()ï¼Œç„¶åè°ƒç”¨WG.Wait()å‡½æ•°è¿›è¡Œç­‰å¾…ï¼Œfun1()è°ƒç”¨ç»“æŸåï¼Œè°ƒç”¨WG.Done()ã€‚ é€šè¿‡è¯•éªŒå¯ä»¥å‘ç°ï¼šAdd()æ–¹æ³•ä¸­çš„æ•°å€¼ä¸Done()æ–¹æ³•çš„æ•°é‡åº”è¯¥ä¿æŒä¸€è‡´ã€‚å½“Add(2)æ—¶ï¼ŒDone()æ–¹æ³•åº”è¯¥æ‰§è¡Œä¸¤æ¬¡ã€‚ç›´åˆ° WaitGroup è®¡æ•°å™¨æ¢å¤ä¸º 0ï¼› å³æ‰€æœ‰åç¨‹çš„å·¥ä½œéƒ½å·²ç»å®Œæˆã€‚ çœ‹æºç å¯ä»¥å‘ç°ï¼ŒDone()ä¸Add()å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\n// Done decrements the WaitGroup counter by one."
    },{
      "title": "Goè¯­è¨€åŸºæœ¬æ•°æ®ç»“æ„",
      "url": "https://qiref.github.io/post/2021/06/01/go%E8%AF%AD%E8%A8%80%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€åŸºæœ¬æ•°æ®ç»“æ„\næ•°ç»„ strings := [3]string{\u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;2\u0026quot;} intArray := [8]int{1, 2, 3, 4, 5, 5, 5, 55} å®šä¹‰ä¸¤ä¸ªæ•°ç»„,fmt.Println(len(strings)) å¯ä»¥ä½¿ç”¨len()å‡½æ•°å¾—åˆ°æ•°ç»„çš„é•¿åº¦ï¼Œstrings[1]å¯ä»¥è·å–æŒ‡å®šæ•°ç»„ä¸‹æ ‡çš„å…ƒç´ ã€‚\næ‰€ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ä»¥éå†æ•°ç»„ï¼š\nfor i := 0; i \u0026lt; len(strings); i++ { fmt.Println(strings[i]) } ä¸‹æ–‡æä¾›äº†æ›´åŠ ä¼˜é›…çš„æ–¹å¼ã€‚\nslice Goæ•°ç»„çš„é•¿åº¦ä¸å¯å˜ï¼ŒGoæä¾›äº†ä¸€ç§å†…ç½®ç±»å‹åˆ‡ç‰‡:sliceï¼Œä¸æ•°ç»„ç›¸æ¯”ï¼Œåˆ‡ç‰‡çš„é•¿åº¦ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥åŠ¨æ€æ‰©å®¹ã€æ·»åŠ å…ƒç´ ã€‚\nslice1 := make([]string, 2) fmt.Println(slice1) slice1[0] = \u0026quot;22\u0026quot; slice1[1] = \u0026quot;222\u0026quot; fmt.Println(slice1) slice1 = append(slice1, \u0026quot;33\u0026quot;, \u0026quot;44\u0026quot;, \u0026quot;55\u0026quot;) fmt.Println(slice1) fmt.Println(len(slice1)) // è£å‰ªï¼Œä»index 2 åˆ°index 4 sliceSub := slice1[2:4] fmt.Println(sliceSub) // è£å‰ªï¼Œä»index 2 åˆ°æœ€å sliceSub2 := slice1[2:] fmt.Println(sliceSub2) make() æ–¹æ³•å¯ä»¥æ„å»ºä¸€ä¸ªsliceï¼Œå¹¶å¯ä»¥æŒ‡å®šåˆå§‹åŒ–å¤§å°å’Œå®¹é‡ï¼› len() å¯ä»¥è·å–sliceçš„å¤§å°ï¼› append() å¯ä»¥æƒ³sliceä¸­æ·»åŠ å…ƒç´ ï¼› å¯ä»¥é€šè¿‡è£å‰ªï¼Œä¸‹æ ‡ç§»åŠ¨ç­‰æ–¹å¼åˆ é™¤sliceã€‚ sliceä»å¤´éƒ¨åˆ é™¤ a = []int{1, 2, 3} a = a[1:] // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´  a = a[N:] // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´  a = append(a[:0], a[1:]...) // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´  a = append(a[:0], a[N:]...) // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´  a = a[:copy(a, a[1:])] // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´  a = a[:copy(a, a[N:])] // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´  sliceä»ä¸­é—´åˆ é™¤ a = append(a[:i], a[i+1:]...) // åˆ é™¤ä¸­é—´1ä¸ªå…ƒç´  a = append(a[:i], a[i+N:]...) // åˆ é™¤ä¸­é—´Nä¸ªå…ƒç´  a = a[:i+copy(a[i:], a[i+1:])] // åˆ é™¤ä¸­é—´1ä¸ªå…ƒç´  a = a[:i+copy(a[i:], a[i+N:])] // åˆ é™¤ä¸­é—´Nä¸ªå…ƒç´  sliceä»å°¾éƒ¨åˆ é™¤ a = a[:len(a)-1] // åˆ é™¤å°¾éƒ¨1ä¸ªå…ƒç´  a = a[:len(a)-N] // åˆ é™¤å°¾éƒ¨Nä¸ªå…ƒç´  slice æ‰©å®¹ slice2 := make([]string, 1, 1) // cap()å‡½æ•°, è®¡ç®—sliceé•¿åº¦å¯ä»¥è¾¾åˆ°å¤šå°‘ fmt.Println(\u0026quot;cap(slice1) is :\u0026quot;, cap(slice1)) slice2[0] = \u0026quot;0\u0026quot; slice2 = append(slice2, \u0026quot;3\u0026quot;) fmt.Println(\u0026quot;cap(slice2) is :\u0026quot;, cap(slice2)) numbers := []int{0, 1, 2, 3, 4, 5} numbers = append(numbers, 6) fmt.Println(numbers) fmt.Println(cap(numbers)) é€šè¿‡cap()å‡½æ•°å¯ä»¥è·å–sliceçš„å®¹é‡ï¼Œå®¹é‡æ˜¯make()å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè¶…è¿‡è®¾ç½®çš„å®¹é‡å†å¾€sliceä¸­æ·»åŠ å…ƒç´ å°±ä¼šä½¿sliceæ‰©å®¹ã€‚\næ‰‹åŠ¨å®ç°æ‰©å®¹ï¼š\n// å®ç°åˆ‡ç‰‡æ‰©å®¹ var capslice = make([]int, 10, 10) for i := range capslice { capslice[i] = i } fmt.Println(capslice) // åˆ›å»ºæ–°çš„åˆ‡ç‰‡ï¼Œå¹¶ä¸”å®¹é‡æ˜¯ä¹‹å‰åˆ‡ç‰‡çš„2å€ var capslice1 = make([]int, len(capslice), cap(capslice)*2) copy(capslice1, capslice) fmt.Println(capslice1, \u0026quot;caplice cap is :\u0026quot;, cap(capslice1)) map mapæ˜¯goé¢„åˆ¶çš„ä¸€ç§å­—å…¸æ•°æ®ç»“æ„ã€‚\n// map[key-type]val-type map1 := make(map[string]string) map1[\u0026quot;1\u0026quot;] = \u0026quot;11\u0026quot; map2 := make(map[string]int) map2[\u0026quot;2\u0026quot;] = 2 map2[\u0026quot;3\u0026quot;] = 3 fmt.Println(\u0026quot;map1:\u0026quot;, map1) fmt.Println(\u0026quot;map2\u0026quot;, map2) mapç»“æ„ä¹Ÿå¯ä»¥åµŒå¥—ï¼š\nmap3 := make(map[string]int) map3[\u0026quot;a\u0026quot;] = 1 map3[\u0026quot;b\u0026quot;] = 33 delete(map3, \u0026quot;b\u0026quot;) fmt.Println(map3) fmt.Println(len(map3)) m := map[string]map[string]int{} m[\u0026quot;aa\u0026quot;] = map3 fmt.Println(m) mapä¸­æœ‰ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ç‰¹æ€§ï¼Œè·å–æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨mapä¸­å­˜åœ¨ã€‚\n// æœ‰æ„æ€çš„ç‰¹æ€§ï¼Œ_, psr := èµ‹å€¼ç»“æœä¸ºbool _, psr := map3[\u0026quot;a\u0026quot;] fmt.Println(psr) // è¾“å‡ºç»“æœä¸ºï¼š true ä½¿ç”¨rangeéå† nums := []int{1, 2, 3, 4, 5, 6} // éå†slice for i := range nums { fmt.Println(nums[i]) } // éå†map map1 := map[string]string{\u0026quot;aa\u0026quot;: \u0026quot;11\u0026quot;, \u0026quot;bb\u0026quot;: \u0026quot;22\u0026quot;} for s := range map1 { fmt.Println(map1[s]) } // ä¼˜é›…åœ°éå†map for k, v := range map1 { fmt.Println(\u0026quot;k : \u0026quot;, k, \u0026quot; v : \u0026quot;, v) } // éå†å­—ç¬¦ä¸²ï¼Œè·å–Unicode for i, c := range \u0026quot;balabala\u0026quot; { fmt.Println(i, \u0026quot; -\u0026gt; \u0026quot;, c) } ",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€åŸºæœ¬æ•°æ®ç»“æ„\næ•°ç»„ strings := [3]string{\u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;2\u0026quot;} intArray := [8]int{1, 2, 3, 4, 5, 5, 5, 55} å®šä¹‰ä¸¤ä¸ªæ•°ç»„,fmt.Println(len(strings)) å¯ä»¥ä½¿ç”¨len()å‡½æ•°å¾—åˆ°æ•°ç»„çš„é•¿åº¦ï¼Œstrings[1]å¯ä»¥è·å–æŒ‡å®šæ•°ç»„ä¸‹æ ‡çš„å…ƒç´ ã€‚\næ‰€ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ä»¥éå†æ•°ç»„ï¼š\nfor i := 0; i \u0026lt; len(strings); i++ { fmt.Println(strings[i]) } ä¸‹æ–‡æä¾›äº†æ›´åŠ ä¼˜é›…çš„æ–¹å¼ã€‚\nslice Goæ•°ç»„çš„é•¿åº¦ä¸å¯å˜ï¼ŒGoæä¾›äº†ä¸€ç§å†…ç½®ç±»å‹åˆ‡ç‰‡:sliceï¼Œä¸æ•°ç»„ç›¸æ¯”ï¼Œåˆ‡ç‰‡çš„é•¿åº¦ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥åŠ¨æ€æ‰©å®¹ã€æ·»åŠ å…ƒç´ ã€‚\nslice1 := make([]string, 2) fmt.Println(slice1) slice1[0] = \u0026quot;22\u0026quot; slice1[1] = \u0026quot;222\u0026quot; fmt.Println(slice1) slice1 = append(slice1, \u0026quot;33\u0026quot;, \u0026quot;44\u0026quot;, \u0026quot;55\u0026quot;) fmt.Println(slice1) fmt.Println(len(slice1)) // è£å‰ªï¼Œä»index 2 åˆ°index 4 sliceSub := slice1[2:4] fmt.Println(sliceSub) // è£å‰ªï¼Œä»index 2 åˆ°æœ€å sliceSub2 := slice1[2:] fmt."
    },{
      "title": "Goè¯­è¨€å˜é‡",
      "url": "https://qiref.github.io/post/2021/05/31/go%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F/",
      "content": "æ‘˜è¦ï¼šGoè¯­è¨€å˜é‡\nGoè¯­è¨€ä¸­çš„å˜é‡å®šä¹‰ç›¸å¯¹ä¸¥æ ¼ï¼Œå½“å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸ºä½¿ç”¨æ—¶ï¼Œä¼šç¼–è¯‘æŠ¥é”™ï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œæ— éœ€è¦å¤šä½™çš„ä»£ç ã€‚ä½†å…¨å±€å˜é‡é™¤å¤–ï¼Œå®šä¹‰å…¨å±€å˜é‡å…è®¸æš‚ä¸ä½¿ç”¨ã€‚\nå…¨å±€å˜é‡ å…¨å±€å˜é‡å¯ä»¥è¢«å…¨å±€è®¿é—®\nå®šä¹‰å…¨å±€å˜é‡ï¼š\n// global variable var x, y int var ( a int b bool ) åŸºæœ¬å¸¸é‡ å¸¸é‡ä¸€ç»è¢«å®šä¹‰åæ— æ³•è¢«é‡æ–°èµ‹å€¼ï¼Œå¸¸é‡å¯ä»¥å®šä¹‰ä¸ºå…¨å±€çš„ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸ºå±€éƒ¨çš„ã€‚\nå®šä¹‰å¸¸é‡ï¼š\n// è¿™æ˜¯ä¸€ä¸ªå¸¸é‡ const CONST1 = 111 iotaå¸¸é‡ iotaï¼Œç‰¹æ®Šå¸¸é‡ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ã€‚ iota åœ¨ constå…³é”®å­—å‡ºç°æ—¶å°†è¢«é‡ç½®ä¸º 0(const å†…éƒ¨çš„ç¬¬ä¸€è¡Œä¹‹å‰)ï¼Œconst ä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿ iota è®¡æ•°ä¸€æ¬¡(iota å¯ç†è§£ä¸º const è¯­å¥å—ä¸­çš„è¡Œç´¢å¼•)ã€‚\nconst ( a = iota b = iota c = iota ) // ä»¥ä¸Šå†™æ³•å¯ä»¥ç®€å†™ä¸º const ( d = iota e f ) fmt.Println(a, b, c) fmt.Println(d, e, f) // è¾“å‡ºç»“æœï¼š // 0 1 2 // 0 1 2 iotaå¸¸é‡å¯ä»¥æ¢å¤è®¡æ•°\n// iotaå¯ä»¥æ¢å¤è®¡æ•° const ( aa = iota bb cc dd = \u0026quot;lalala\u0026quot; ee = 2 ff = true gg = iota // æ¢å¤è®¡æ•° hh ) fmt.Println(aa, bb, cc, dd, ee, ff, gg, hh) // è¾“å‡ºç»“æœä¸ºï¼š // 0 1 2 lalala 2 true 6 7 å…³äºiotaä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­\n// iota ç§»ä½è¿ç®— const ( ii = 1 \u0026lt;\u0026lt; iota jj = 2 \u0026lt;\u0026lt; iota kk = 3 \u0026lt;\u0026lt; iota ll // æ­¤å¤„ç­‰ä»·äº ll = 3 \u0026lt;\u0026lt; iota mm // æ­¤å¤„ç­‰ä»·äº ll = 3 \u0026lt;\u0026lt; iota ) fmt.Println(ii, jj, kk, ll, mm) // è¾“å‡ºç»“æœä¸ºï¼š // 1 4 12 24 48 å˜é‡ å®šä¹‰å˜é‡ï¼š\n// å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶å¯¹å…¶èµ‹å€¼ var intVal int intVal = 1 // å®šä¹‰ä¸€ä¸ªå˜é‡å¯¹å…¶èµ‹å€¼ï¼Œä¸ä¸Šæ–‡ä¸­çš„æ•ˆæœä¸€æ · intVal1 := 1 goè¯­è¨€ä¸­ï¼Œintç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥æœ‰å¤šç§ç±»å‹çš„intã€‚\n// int æ•°æ®ç±»å‹ åŒ…å«äº†ä»¥ä¸‹æ‰€æœ‰æ•°æ®ç±»å‹ var var1 int = -9223372036854775808 // æ— ç¬¦å· 8 ä½æ•´å‹ (0 åˆ° 255) var var2 uint8 = 255 // æ— ç¬¦å· 16 ä½æ•´å‹ (0 åˆ° 65535) var var3 uint16 = 65535 // æ— ç¬¦å· 32 ä½æ•´å‹ (0 åˆ° 4294967295) var var4 uint32 = 4294967295 // æ— ç¬¦å· 64 ä½æ•´å‹ (0 åˆ° 18446744073709551615) var var5 uint64 = 18446744073709551615 // æœ‰ç¬¦å· 8 ä½æ•´å‹ (-128 åˆ° 127) var var6 int8 = 127 // æœ‰ç¬¦å· 16 ä½æ•´å‹ (-32768 åˆ° 32767) var var7 int16 = 32767 // æœ‰ç¬¦å· 32 ä½æ•´å‹ (-2147483648 åˆ° 2147483647) var var8 int32 = 2147483647 // æœ‰ç¬¦å· 64 ä½æ•´å‹ (-9223372036854775808 åˆ° 9223372036854775807) var var9 int64 = 9223372036854775807 fmt.Println(var1, var2, var3, var4, var5, var6, var7, var8, var9) goç±»å‹å¼ºè½¬ // go ç±»å‹è½¬æ¢ var sum int = 16 var sumf float32 sumf = float32(sum / 2) fmt.Printf(\u0026quot;%f\\n\u0026quot;, sumf) ",
      "summary": "æ‘˜è¦ï¼šGoè¯­è¨€å˜é‡\nGoè¯­è¨€ä¸­çš„å˜é‡å®šä¹‰ç›¸å¯¹ä¸¥æ ¼ï¼Œå½“å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸ºä½¿ç”¨æ—¶ï¼Œä¼šç¼–è¯‘æŠ¥é”™ï¼Œåœ¨goè¯­è¨€ä¸­ï¼Œæ— éœ€è¦å¤šä½™çš„ä»£ç ã€‚ä½†å…¨å±€å˜é‡é™¤å¤–ï¼Œå®šä¹‰å…¨å±€å˜é‡å…è®¸æš‚ä¸ä½¿ç”¨ã€‚\nå…¨å±€å˜é‡ å…¨å±€å˜é‡å¯ä»¥è¢«å…¨å±€è®¿é—®\nå®šä¹‰å…¨å±€å˜é‡ï¼š\n// global variable var x, y int var ( a int b bool ) åŸºæœ¬å¸¸é‡ å¸¸é‡ä¸€ç»è¢«å®šä¹‰åæ— æ³•è¢«é‡æ–°èµ‹å€¼ï¼Œå¸¸é‡å¯ä»¥å®šä¹‰ä¸ºå…¨å±€çš„ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸ºå±€éƒ¨çš„ã€‚\nå®šä¹‰å¸¸é‡ï¼š\n// è¿™æ˜¯ä¸€ä¸ªå¸¸é‡ const CONST1 = 111 iotaå¸¸é‡ iotaï¼Œç‰¹æ®Šå¸¸é‡ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ã€‚ iota åœ¨ constå…³é”®å­—å‡ºç°æ—¶å°†è¢«é‡ç½®ä¸º 0(const å†…éƒ¨çš„ç¬¬ä¸€è¡Œä¹‹å‰)ï¼Œconst ä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿ iota è®¡æ•°ä¸€æ¬¡(iota å¯ç†è§£ä¸º const è¯­å¥å—ä¸­çš„è¡Œç´¢å¼•)ã€‚\nconst ( a = iota b = iota c = iota ) // ä»¥ä¸Šå†™æ³•å¯ä»¥ç®€å†™ä¸º const ( d = iota e f ) fmt.Println(a, b, c) fmt.Println(d, e, f) // è¾“å‡ºç»“æœï¼š // 0 1 2 // 0 1 2 iotaå¸¸é‡å¯ä»¥æ¢å¤è®¡æ•°"
    },{
      "title": "MySQLæ‰§è¡Œè®¡åˆ’",
      "url": "https://qiref.github.io/post/2020/10/21/mysql%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/",
      "content": "ä»€ä¹ˆæ˜¯SQLæ‰§è¡Œè®¡åˆ’ EXPLAINå‘½ä»¤æ˜¯æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨å¦‚ä½•å†³å®šæ‰§è¡ŒæŸ¥è¯¢çš„ä¸»è¦çš„æ–¹æ³•ï¼Œå­¦ä¼šè§£é‡ŠEXPLAINå°†å¸®åŠ©æˆ‘ä»¬äº†è§£SQLä¼˜åŒ–å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æ‰§è¡Œè®¡åˆ’å¯ä»¥å‘Šè¯‰æˆ‘ä»¬SQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•ï¼Œè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåºï¼ŒæŸ¥è¯¢çš„æ•°æ®è¡Œæ•°ã€‚ è¦ä½¿ç”¨EXPLAIN,åªéœ€è¦åœ¨æŸ¥è¯¢çš„SELECTå…³é”®å­—ä¹‹å‰å¢åŠ EXPLAINè¿™ä¸ªè¯ã€‚\nMySQL [dev]\u0026gt; explain select * from TableName where Name like '%c'; +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ | 1 | SIMPLE | ClusterGroup | NULL | ALL | NULL | NULL | NULL | NULL | 254 | 11.11 | Using where | +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ 1 row in set, 1 warning (0.01 sec) æ‰§è¡Œè®¡åˆ’å‚æ•°è¯´æ˜ id æ˜¯ä¸€ä½æ•°å­—ï¼Œè¡¨ç¤ºselectè¯­å¥çš„é¡ºåºã€‚ idå€¼ç›¸åŒæ—¶ï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ã€‚idå€¼ä¸åŒæ—¶ï¼Œidå€¼å¤§çš„å…ˆæ‰§è¡Œã€‚\nselect_type è¿™ä¸€åˆ—æ˜¾ç¤ºäº†å¯¹åº”è¡Œæ˜¯ç®€å•è¿˜æ˜¯å¤æ‚çš„selectï¼Œå¦‚æœæ˜¯simpleæ„å‘³ç€æŸ¥è¯¢ä¸åŒ…æ‹¬å­æŸ¥è¯¢å’ŒUNIONã€‚\nselect type è¯´æ˜ SIMPLE ä¸åŒ…å«å­æŸ¥è¯¢å’Œunionæ“ä½œ PRIMARY æŸ¥è¯¢ä¸­åŒ…å«ä»»ä½•å­æŸ¥è¯¢ï¼Œé‚£ä¹ˆæœ€å¤–å±‚çš„æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸ºPRIMARY SUBQUERY selectä¸­çš„å­æŸ¥è¯¢ DEPENDENT SUBQUERY ä¾èµ–å¤–éƒ¨ç»“æœçš„å­æŸ¥è¯¢ partitions å¯¹äºåˆ†åŒºè¡¨ï¼Œæ˜¾ç¤ºæŸ¥è¯¢çš„åˆ†åŒºidï¼Œå¯¹äºéåˆ†åŒºè¡¨ï¼Œæ˜¾ç¤ºä¸ºNULLã€‚\ntype select type å€¼ è¯´æ˜ æ€§èƒ½ å€¼ å«ä¹‰ é«˜ system è¿™æ˜¯constè”æ¥ç±»å‹çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œæ—¶ä½¿ç”¨ã€‚ const è¡¨ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªåŒ¹é…çš„è¡Œæ—¶ä½¿ç”¨ï¼Œå¦‚å¯¹ä¸»é”®æˆ–æ˜¯å”¯ä¸€ç´¢å¼•çš„æŸ¥è¯¢ï¼Œè¿™æ˜¯æ•ˆç‡æœ€é«˜çš„è”æ¥æ–¹å¼ã€‚ eq_ref å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ç´¢å¼•æŸ¥æ‰¾ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚ ref éå”¯ä¸€ç´¢å¼•ï¼ŒæŸ¥æ‰¾ï¼Œè¿”å›æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚ ref_or_null ç±»ä¼¼äºrefç±»å‹çš„æŸ¥è¯¢ï¼Œä½†æ˜¯é™„åŠ äº†å¯¹nullå€¼åˆ—çš„æŸ¥è¯¢ã€‚ index_merge è¯¥è”æ¥ç±»å‹è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•åˆå¹¶ä¼˜åŒ–æ–¹æ³•ã€‚ range ç´¢å¼•èŒƒå›´æ‰«æï¼Œå¸¸è§äºbetwteenã€\u0026gt;ã€\u0026lt;è¿™æ ·çš„æŸ¥è¯¢æ¡ä»¶ã€‚ index FULL INDEX SCAN å…¨ç´¢å¼•æ‰«æï¼Œè·ŸALLçš„åŒºåˆ«æ˜¯è¿™é‡Œéå†çš„æ˜¯ç´¢å¼•æ ‘ã€‚ ä½ ALL FULL TABLE SCAN å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯æ•ˆç‡æœ€å·®çš„è”æ¥æ–¹å¼ã€‚ possible keys æŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªäº›ç´¢å¼•æ¥ä¼˜åŒ–æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ‰€æ¶‰åŠçš„åˆ—ä¸Šçš„ç´¢å¼•éƒ½ä¼šè¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šä¼šè¢«ä½¿ç”¨ã€‚\nkey æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼˜åŒ–æŸ¥è¯¢å®é™…æ‰€ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„ç´¢å¼•ï¼Œåˆ™æ˜¾ç¤ºä¸ºNULLï¼Œå¦‚æŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨åˆ—ä¸­ã€‚\nkey_len è¡¨ç¤ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œkey_lençš„é•¿åº¦ç”±å­—æ®µå®šä¹‰è€Œæ¥ï¼Œå¹¶éæ•°æ®çš„å®é™…é•¿åº¦ã€‚\nref è¡¨ç¤ºå“ªäº›åˆ—æˆ–è€…å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚\nrows è¡¨ç¤ºMySQLé€šè¿‡å“ªäº›åˆ—æˆ–è€…å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—å±±çš„å€¼ï¼Œrowså€¼çš„å¤§å°æ˜¯ä¸ªç»Ÿè®¡æŠ½æ ·ç»“æœï¼Œå¹¶ä¸ååˆ†å‡†ç¡®ã€‚\nfiltered è¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼ŒFilteråˆ—çš„å€¼è¶Šå¤§è¶Šå¥½ã€‚\nExtra distinct ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œã€‚ Not exists ä½¿ç”¨not existsæ¥ä¼˜åŒ–æŸ¥è¯¢ã€‚ using filesort ä½¿ç”¨é¢å¤–æ“ä½œè¿›è¡Œæ’åºï¼Œé€šå¸¸ä¼šå‡ºç°åœ¨order by æˆ–åœ¨group byæŸ¥è¯¢ä¸­ã€‚ using index ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ã€‚\n",
      "summary": "ä»€ä¹ˆæ˜¯SQLæ‰§è¡Œè®¡åˆ’ EXPLAINå‘½ä»¤æ˜¯æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨å¦‚ä½•å†³å®šæ‰§è¡ŒæŸ¥è¯¢çš„ä¸»è¦çš„æ–¹æ³•ï¼Œå­¦ä¼šè§£é‡ŠEXPLAINå°†å¸®åŠ©æˆ‘ä»¬äº†è§£SQLä¼˜åŒ–å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æ‰§è¡Œè®¡åˆ’å¯ä»¥å‘Šè¯‰æˆ‘ä»¬SQLå¦‚ä½•ä½¿ç”¨ç´¢å¼•ï¼Œè¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåºï¼ŒæŸ¥è¯¢çš„æ•°æ®è¡Œæ•°ã€‚ è¦ä½¿ç”¨EXPLAIN,åªéœ€è¦åœ¨æŸ¥è¯¢çš„SELECTå…³é”®å­—ä¹‹å‰å¢åŠ EXPLAINè¿™ä¸ªè¯ã€‚\nMySQL [dev]\u0026gt; explain select * from TableName where Name like '%c'; +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ | 1 | SIMPLE | ClusterGroup | NULL | ALL | NULL | NULL | NULL | NULL | 254 | 11.11 | Using where | +----+-------------+--------------+------------+------+---------------+------+---------+------+------+----------+-------------+ 1 row in set, 1 warning (0."
    },{
      "title": "Centosæ­å»ºå…¬å…±yumæº",
      "url": "https://qiref.github.io/post/2019/12/14/centos%E6%90%AD%E5%BB%BA%E5%85%AC%E5%85%B1yum%E6%BA%90/",
      "content": "æ‘˜è¦ï¼šè®°å½•åœ¨Centos7ä¸­å¦‚ä½•æŒ‚è½½ISOé•œåƒä½œyumæºï¼Œå¹¶å€ŸåŠ©httpæœåŠ¡ä½œå…¬å…±yumæºã€‚\néƒ¨ç½²yumç§æœ ä¸Šä¼ centosé•œåƒæ–‡ä»¶åˆ°æœåŠ¡å™¨\nmountÂ -tÂ iso9660Â -oÂ loop centos-7-x86_64-dvd-1511.isoÂ /mnt/cdrom/ ï¼ˆå¸è½½ï¼šumoutn /mnt/cdrom)\næŒ‚è½½æˆåŠŸï¼ å°†è½¯ä»¶é“¾æ¥åˆ°httpæœåŠ¡å‘å¸ƒè·¯å¾„ä¸‹ ç¡®å®šå½“å‰æœåŠ¡å™¨æ˜¯å¦å®‰è£…äº†httpdæœåŠ¡\nlnÂ -sÂ /mnt/cdrom/Â /var/www/html/CentOS7 æ£€æŸ¥httpæœåŠ¡\nsystemctlÂ status httpd.service å¯åŠ¨HTTPæœåŠ¡å™¨\nsystemctlÂ enable httpd.service systemctlÂ startÂ httpd.service ç•Œé¢æŸ¥çœ‹\ncdÂ /etc/yum.repos.d/ mkdirÂ bak mvÂ centos-*Â bak viÂ CentOS-Base.repo [base] name=CentOS-$releaseverÂ -Â Base baseurl=http://192.168.67.15/CentOS7/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 åˆ†å‘åˆ°æ‰€æœ‰æœåŠ¡å™¨\nscpÂ -rÂ /etc/yum.repos.d/Â hadoop-01:/etc/ scpÂ -rÂ /etc/yum.repos.d/Â hadoop-02:/etc/ æ£€æŸ¥æ˜¯å¦æ­£æˆåŠŸå®‰è£…yumÂ æº\nyumÂ cleanÂ all yumÂ makecache yumÂ list å¦‚æœèƒ½çœ‹åˆ°è½¯ä»¶åˆ—è¡¨åˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚\n",
      "summary": "æ‘˜è¦ï¼šè®°å½•åœ¨Centos7ä¸­å¦‚ä½•æŒ‚è½½ISOé•œåƒä½œyumæºï¼Œå¹¶å€ŸåŠ©httpæœåŠ¡ä½œå…¬å…±yumæºã€‚\néƒ¨ç½²yumç§æœ ä¸Šä¼ centosé•œåƒæ–‡ä»¶åˆ°æœåŠ¡å™¨\nmountÂ -tÂ iso9660Â -oÂ loop centos-7-x86_64-dvd-1511.isoÂ /mnt/cdrom/ ï¼ˆå¸è½½ï¼šumoutn /mnt/cdrom)\næŒ‚è½½æˆåŠŸï¼ å°†è½¯ä»¶é“¾æ¥åˆ°httpæœåŠ¡å‘å¸ƒè·¯å¾„ä¸‹ ç¡®å®šå½“å‰æœåŠ¡å™¨æ˜¯å¦å®‰è£…äº†httpdæœåŠ¡\nlnÂ -sÂ /mnt/cdrom/Â /var/www/html/CentOS7 æ£€æŸ¥httpæœåŠ¡\nsystemctlÂ status httpd.service å¯åŠ¨HTTPæœåŠ¡å™¨\nsystemctlÂ enable httpd.service systemctlÂ startÂ httpd.service ç•Œé¢æŸ¥çœ‹\ncdÂ /etc/yum.repos.d/ mkdirÂ bak mvÂ centos-*Â bak viÂ CentOS-Base.repo [base] name=CentOS-$releaseverÂ -Â Base baseurl=http://192.168.67.15/CentOS7/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 åˆ†å‘åˆ°æ‰€æœ‰æœåŠ¡å™¨\nscpÂ -rÂ /etc/yum.repos.d/Â hadoop-01:/etc/ scpÂ -rÂ /etc/yum.repos.d/Â hadoop-02:/etc/ æ£€æŸ¥æ˜¯å¦æ­£æˆåŠŸå®‰è£…yumÂ æº\nyumÂ cleanÂ all yumÂ makecache yumÂ list å¦‚æœèƒ½çœ‹åˆ°è½¯ä»¶åˆ—è¡¨åˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚"
    },{
      "title": "é€†æ³¢å…°è¡¨è¾¾å¼ç®—æ³•",
      "url": "https://qiref.github.io/post/2019/09/04/%E9%80%86%E6%B3%A2%E5%85%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AE%97%E6%B3%95/",
      "content": "æ‘˜è¦ï¼šå°†ä¸­ç¼€è¡¨è¾¾å¼è½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œä»¥åŠè®¡ç®—åç¼€è¡¨è¾¾å¼çš„ç®—æ³•ã€‚\nimport org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.util.HashSet; import java.util.Scanner; import java.util.Stack; /** * @author YaoQi * Date: 2019/1/5 15:45 * Modified: * Description: ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼ */ public class InfixToSuffixHandler { private static final Logger logger = LoggerFactory.getLogger(InfixToSuffixHandler.class); private static HashSet\u0026lt;Character\u0026gt; opStr = new HashSet\u0026lt;\u0026gt;(); static { logger.info(\u0026quot;Initialization operator\u0026quot;); opStr.add('+'); opStr.add('-'); opStr.add('*'); opStr.add('/'); logger.info(\u0026quot;Initialization finished\u0026quot;); } /** * åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºæ“ä½œç¬¦ * * @param c å­—ç¬¦ * @return */ private static boolean isOpStr(char c) { return opStr.contains(c); } /** * åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºæ“ä½œæ•° * * @param c å­—ç¬¦ * @return */ private static boolean isOperand(char c) { return c \u0026gt;= '0' \u0026amp;\u0026amp; c \u0026lt;= '9'; } /** * å¾—åˆ°å½“å‰æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ * * @param c æ“ä½œç¬¦ * @return */ private static int priority(char c) { switch (c) { case '*': case '/': return 3; case '+': case '-': return 2; case '(': return 1; default: { logger.error(\u0026quot;c: {} is not operator marks\u0026quot;, c); return 0; } } } /** * ç”¨åç¼€è¡¨è¾¾å¼æ±‚å€¼ * * @param suffixExpr åç¼€è¡¨è¾¾å¼ * @return */ public static int numberCalculate(String suffixExpr) { Stack\u0026lt;Integer\u0026gt; count = new Stack\u0026lt;\u0026gt;(); char c; int number1, number2; for (int i = 0; i \u0026lt; suffixExpr.length(); i++) { if (isOperand(c = suffixExpr.charAt(i))) { count.push(c - '0'); } else { number2 = count.pop(); number1 = count.pop(); switch (c) { case '+': count.push(number1 + number2); break; case '-': count.push(number1 - number2); break; case '*': count.push(number1 * number2); break; case '/': count.push(number1 / number2); break; default: break; } } } return count.pop(); } /** * å°†ä¸­ç¼€è¡¨è¾¾å¼è½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼ * * @param expression ä¸­ç¼€è¡¨è¾¾å¼ * @return è¿”å›åç¼€è¡¨è¾¾å¼ */ public static StringBuilder getSuffixExpression(String expression) { //ä¿å­˜å·²å°†å»ºç«‹çš„åç¼€è¡¨è¾¾å¼ StringBuilder suffixExpr = new StringBuilder(); //æ“ä½œç¬¦æ ˆ Stack\u0026lt;Character\u0026gt; opStr = new Stack\u0026lt;\u0026gt;(); //è¾“å…¥è¡¨è¾¾å¼æŸä¸ªä½ç½®çš„å­—ç¬¦ char c; //è¿ç®—ç¬¦æ ˆä¸­å¼¹å‡ºçš„å­—ç¬¦ char pop; for (int i = 0; i \u0026lt; expression.length(); i++) { c = expression.charAt(i); //å¦‚æœå½“å‰å­—ç¬¦ä¸ºæ“ä½œæ•° if (isOperand(c)) { suffixExpr.append(c); } else if (isOpStr(c)) { //å¦‚æœå½“å‰å­—ç¬¦ä¸ºæ“ä½œç¬¦ if (opStr.isEmpty()) { opStr.push(c); } else { while (!opStr.isEmpty() \u0026amp;\u0026amp; priority(opStr.peek()) \u0026gt;= priority(c)) { pop = opStr.pop(); suffixExpr.append(pop); } opStr.push(c); } } else if ('(' == c) { //å¦‚æœå½“å‰å­—ç¬¦ä¸ºâ€˜(â€™ opStr.push(c); } else if (')' == c) { //å¦‚æœå½“å‰å­—ç¬¦ä¸ºâ€˜)â€™ while ((pop = opStr.pop()) != '(') { suffixExpr.append(pop); } } else { logger.error(\u0026quot;c: {} is not valid in {}\u0026quot;, c, expression); } } while (!opStr.isEmpty()) { suffixExpr.append(opStr.pop()); } System.out.println(\u0026quot;è½¬æ¢åçš„åç¼€è¡¨è¾¾å¼ä¸ºï¼š\u0026quot; + suffixExpr); return suffixExpr; } public static void main(String[] args) { Scanner scan = new Scanner(System.in, \u0026quot;UTF-8\u0026quot;); //è¾“å…¥çš„è¡¨è¾¾å¼ String expression = scan.nextLine(); // ç”Ÿæˆåç¼€è¡¨è¾¾å¼ StringBuilder suffixExpr = getSuffixExpression(expression); System.out.println(\u0026quot;åç¼€è¡¨è¾¾å¼è®¡ç®—çš„ç»“æœä¸ºï¼š\u0026quot; + numberCalculate(suffixExpr.toString())); } } tips ä¸€èˆ¬çš„ä»£æ•°è¡¨è¾¾å¼éƒ½æ˜¯ä¸­ç¼€è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯æ“ä½œæ•°åœ¨æ“ä½œç¬¦ä¸¤è¾¹ï¼Œåç¼€è¡¨è¾¾å¼ï¼ˆé€†æ³¢å…°è¡¨è¾¾å¼ï¼‰å°±æ˜¯æ“ä½œç¬¦åœ¨æ“ä½œæ•°åé¢ã€‚\nä¾‹å¦‚ï¼š\na+b \u0026mdash;\u0026gt; a,b,+\na+(b-c) \u0026mdash;\u0026gt; a,b,c,-,+\na+(b-c)d \u0026mdash;\u0026gt; a,b,c,-,d,,+\nç®—æ³•æ ¸å¿ƒæ€æƒ³ï¼šå°†ä¸­ç¼€è¡¨è¾¾å¼è½¬ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œå†ä½¿ç”¨æ ˆæ¥å¯¹åç¼€è¡¨è¾¾å¼æ±‚å€¼ã€‚ æ±‚å€¼çš„è¿‡ç¨‹å°±æ˜¯é‡åˆ°æ“ä½œç¬¦å°±è®¡ç®—æ ˆå†…çš„è¡¨è¾¾å¼ï¼Œé‡åˆ°æ“ä½œæ•°å°±å…¥æ ˆï¼Œæœ€ç»ˆæ ˆä¸­çš„å…ƒç´ å°±æ˜¯æœ€ç»ˆçš„ç»“æœäº†ã€‚\nè¯¥ç®—æ³•è¿˜å¯ä»¥æ‰©å±•ä¸ºé€»è¾‘è¿ç®—ç¬¦ï¼Œä¾‹å¦‚: B and C not D åœ¨å¤„ç†ç±»ä¼¼äºè¿™ç§é€»è¾‘è¡¨è¾¾å¼è½¬æ¢çš„æ—¶å€™ä¹Ÿèƒ½ä½¿ç”¨è¯¥ç®—æ³•ï¼Œç¬”è€…æ›¾åœ¨å®è·µä¸­ä½¿ç”¨è¿‡æ”¹é€ è¯¥ç®—æ³•è¿›è¡ŒESæŸ¥è¯¢è¯­å¥çš„æ„å»ºï¼Œæ”¯æŒé€»è¾‘è¡¨è¾¾å¼çš„æœç´¢ã€‚\n",
      "summary": "æ‘˜è¦ï¼šå°†ä¸­ç¼€è¡¨è¾¾å¼è½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œä»¥åŠè®¡ç®—åç¼€è¡¨è¾¾å¼çš„ç®—æ³•ã€‚\nimport org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.util.HashSet; import java.util.Scanner; import java.util.Stack; /** * @author YaoQi * Date: 2019/1/5 15:45 * Modified: * Description: ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼ */ public class InfixToSuffixHandler { private static final Logger logger = LoggerFactory.getLogger(InfixToSuffixHandler.class); private static HashSet\u0026lt;Character\u0026gt; opStr = new HashSet\u0026lt;\u0026gt;(); static { logger.info(\u0026quot;Initialization operator\u0026quot;); opStr.add('+'); opStr.add('-'); opStr.add('*'); opStr.add('/'); logger.info(\u0026quot;Initialization finished\u0026quot;); } /** * åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºæ“ä½œç¬¦ * * @param c å­—ç¬¦ * @return */ private static boolean isOpStr(char c) { return opStr."
    },{
      "title": "sparkå­¦ä¹ ç¬”è®°-RDDåŸºç¡€ç®—å­",
      "url": "https://qiref.github.io/post/2019/07/27/spark%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-rdd%E5%9F%BA%E7%A1%80%E7%AE%97%E5%AD%90/",
      "content": "æ‘˜è¦ï¼šå­¦ä¹ sparkè¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œè®°å½•sparkä¸­çš„åŸºç¡€ç®—å­ï¼Œä»¥åŠRDDçš„åŸºæœ¬æ¦‚å¿µã€‚\nspark transform operation æºç åœ°å€ï¼šhttps://github.com/YaoQi17/sparkLearning/tree/master/sparkRDD\næ€»ç»“ RDD(Resilient Distributed Dataset) å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯ä¸€ç»„åˆ†å¸ƒå¼çš„æ•°æ®é›†åˆï¼Œé‡Œé¢çš„å…ƒç´ å¯å¹¶è¡Œè®¡ç®—ï¼Œå¯åˆ†åŒºï¼› RDDå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æ—¶æ˜¾ç¤ºåœ°å°†å·¥ä½œé›†ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¾‹å¦‚persist()ï¼›\nåˆ›å»ºæ–¹å¼ åˆ›å»ºRDDçš„ä¸¤ç§æ–¹å¼ï¼š\nè¯»å–å¤–ç•Œæ–‡ä»¶ å¤–ç•Œæ–‡ä»¶ä¸å±€é™äºç³»ç»Ÿæ–‡ä»¶ï¼ŒåŒ…æ‹¬HDFSã€HBaseç­‰\nsparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) é€šè¿‡å¹¶è¡ŒåŒ–çš„æ–¹å¼åˆ›å»º val sparkSession = getDefaultSparkSession val dataArray = Array(1, 2, 3, 4, 5, 6) // åˆ›å»ºä¸€ä¸ªRDD val rdd = sparkSession.sparkContext.parallelize(dataArray) é€šè¿‡å¹¶è¡ŒåŒ–çš„æ–¹å¼åˆ›å»ºè¿˜å¯ä»¥æŒ‡å®šåˆ†åŒºçš„æ•°é‡\n/** Distribute a local Scala collection to form an RDD. * * @note Parallelize acts lazily. If `seq` is a mutable collection and is altered after the call * to parallelize and before the first action on the RDD, the resultant RDD will reflect the * modified collection. Pass a copy of the argument to avoid this. * @note avoid using `parallelize(Seq())` to create an empty `RDD`. Consider `emptyRDD` for an * RDD with no partitions, or `parallelize(Seq[T]())` for an RDD of `T` with empty partitions. * @param seq Scala collection to distribute * @param numSlices number of partitions to divide the collection into * @return RDD representing distributed collection */ def parallelize[T: ClassTag]( seq: Seq[T], numSlices: Int = defaultParallelism): RDD[T] = withScope { assertNotStopped() new ParallelCollectionRDD[T](this, seq, numSlices, Map[Int, Seq[String]]()) } RDDç¼–ç¨‹ RDDä¸­åŒ…å«ä¸¤ç§ç±»å‹çš„ç®—å­ï¼šTransformationå’ŒActionï¼›\nTransformation ç®—å­ Transformation è½¬æ¢æ“ä½œï¼Œå°†ä¸€ä¸ªRDDè½¬åŒ–ä¸ºå¦å¤–ä¸€ä¸ªRDDï¼Œä½†æ˜¯è¯¥è¿‡ç¨‹å…·æœ‰å»¶è¿ŸåŠ è½½æ€§ï¼› Transformationç®—å­ä¸ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œåªæœ‰å½“é‡åˆ°Actionç®—å­æ—¶æ‰ä¼šæ‰§è¡Œã€‚\nå¸¸è§çš„Transformationç®—å­ï¼š\nmap(function) ç”±ä¸€ä¸ªRDDè½¬åŒ–ä¸ºå¦å¤–ä¸€ä¸ªRDDï¼Œfunctionçš„æ¯ä¸€æ¬¡è¾“å‡ºç»„æˆå¦å¤–ä¸€ä¸ªRDDï¼›\nfilter(function) ç”±ä¸€ä¸ªRDDçš„å…ƒç´ ç»è¿‡ç­›é€‰ï¼Œæ»¡è¶³functionæ¡ä»¶çš„å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„RDDï¼›\nflatMap(function) ç±»ä¼¼äºmapï¼Œä½†æ˜¯æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥è¢«è½¬åŒ–ä¸ºå¤šä¸ªå…ƒç´ ï¼Œfunctionåº”è¯¥è¿”å›ä¸€ä¸ªåºåˆ—ï¼›\n/** * flatMapå®ä¾‹ï¼ŒflatMapè¿”å›çš„æ˜¯ä¸€ç»„å…ƒç´ ï¼Œå®˜ç½‘è¯´æ˜¯ä¸€ä¸ªSeq ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…ƒç´  */ def flatMapDemo(): Unit = { val sparkSession = getDefaultSparkSession val textData = sparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) // val flatData = textData.flatMap(row =\u0026gt; row.split(\u0026quot; \u0026quot;)) val flatData = textData.map(row =\u0026gt; row.split(\u0026quot; \u0026quot;)) flatData.collect().foreach(println(_)) } mapPartitions(function) ç±»ä¼¼äºmapï¼Œä½†ç‹¬ç«‹åœ°åœ¨RDDçš„æ¯ä¸€ä¸ªåˆ†ç‰‡ä¸Šè¿è¡Œï¼Œå‡½æ•°ç±»å‹æ˜¯ï¼šIterator[T] =\u0026gt; Iterator[U]ï¼›\nä¼ å€¼è°ƒç”¨ï¼ˆcall-by-valueï¼‰ï¼šå…ˆè®¡ç®—å‚æ•°è¡¨è¾¾å¼çš„å€¼ï¼Œå†åº”ç”¨åˆ°å‡½æ•°å†…éƒ¨ï¼Œåœ¨å‡½æ•°å¤–éƒ¨æ±‚å€¼ï¼›\nä¼ åè°ƒç”¨ï¼ˆcall-by-nameï¼‰ï¼šå°†æœªè®¡ç®—çš„å‚æ•°è¡¨è¾¾å¼ç›´æ¥åº”ç”¨åˆ°å‡½æ•°å†…éƒ¨ï¼Œåœ¨å‡½æ•°å†…éƒ¨æ±‚å€¼ï¼›\nIterator[T] =\u0026gt; Iterator[U] å°±æ˜¯è¡¨ç¤ºè¯¥å‡½æ•°ä¸ºä¼ åè°ƒç”¨ã€‚\nmapPartitionsWithIndex(function) ç±»ä¼¼äºmapPartitionsï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°ä¸­å¤šäº†ä¸€ä¸ªç´¢å¼•å€¼ï¼Œè¯¥ç´¢å¼•å€¼ä¸ºRDDåˆ†ç‰‡æ•°çš„ç´¢å¼•å€¼ï¼› ï¼ˆä¼ å…¥çš„å‡½æ•°ç±»å‹ä¸ºï¼š(Int, Iterator) =\u0026gt; Iteratorï¼‰\n/** * mapPartitionsWithIndexä½¿ç”¨ç¤ºä¾‹ */ def mapPartitionsWithIndexDemo(): Unit = { val sparkSession = getDefaultSparkSession val rddData = sparkSession.sparkContext.parallelize(Array(\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;d\u0026quot;, \u0026quot;e\u0026quot;)) val data = rddData.mapPartitionsWithIndex((index: Int, row: Iterator[String]) =\u0026gt; { row.toList.map(x =\u0026gt; \u0026quot;[partID:\u0026quot; + index + \u0026quot;:\u0026quot; + x + \u0026quot;]\u0026quot;).iterator }) data.collect().foreach(println(_)) } sample(withReplacement, fraction, seed) æ ¹æ®fractionæŒ‡å®šçš„æ¯”ä¾‹å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨éšæœºæ•°è¿›è¡Œæ›¿æ¢ï¼Œseedç”¨äºæŒ‡å®šéšæœºæ•°ç”Ÿæˆå™¨ç§å­ï¼›\nunion(otherDataset) å¯¹æºRDDå’Œå‚æ•°ä¸­çš„RDDæ±‚å¹¶é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDDï¼›\n/** * æ±‚å¹¶é›†ç¤ºä¾‹ */ def unionRDD(): Unit = { val sparkSession = getDefaultSparkSession val rddData1 = sparkSession.sparkContext.parallelize(List(\u0026quot;s\u0026quot;, \u0026quot;d\u0026quot;, \u0026quot;f\u0026quot;, \u0026quot;a\u0026quot;)) val rddData2 = rddData1.map(row =\u0026gt; { if (row.equals(\u0026quot;s\u0026quot;)) { row + \u0026quot;s\u0026quot; } else { row } }) println(\u0026quot;æ±‚å¹¶é›†:\u0026quot;) rddData1.union(rddData2).foreach(println(_)) println(\u0026quot;æ±‚äº¤é›†:\u0026quot;) rddData1.intersection(rddData2).foreach(println(_)) val rddData3 = rddData1.union(rddData2) println(\u0026quot;å»é‡:\u0026quot;) rddData3.distinct().collect().foreach(println(_)) } intersection(otherDataset) å¯¹æºRDDå’Œå‚æ•°ä¸­çš„RDDæ±‚äº¤é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDDï¼›\ndistinct([numTasks])) å¯¹æºRDDè¿›è¡Œå»é‡åè¿”å›ä¸€ä¸ªæ–°çš„RDDï¼›\ngroupByKey([numTasks]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K, Iterator[V])çš„RDDï¼›\n/** * åˆ†ç»„ç¤ºä¾‹ */ def groupByKeyDemo(): Unit = { val sparkSession = getDefaultSparkSession val textFileRDD = sparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) val rddData = textFileRDD.flatMap(_.split(\u0026quot; \u0026quot;)).map(row =\u0026gt; (row, 1)) rddData.groupByKey().map(row =\u0026gt; { val count = row._2.sum (row._1, count) }).collect().foreach(println(_)) rddData.reduceByKey((x, y) =\u0026gt; x + y).collect().foreach(println(_)) // rddData.groupByKey().collect().foreach(println(_)) } reduceByKey(func, [numTasks]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,V)çš„RDDï¼Œä½¿ç”¨æŒ‡å®šçš„reduceå‡½æ•°ï¼Œå°†ç›¸åŒkeyçš„å€¼èšåˆåˆ°ä¸€èµ·ï¼Œä¸groupByKeyç±»ä¼¼ï¼Œreduceä»»åŠ¡çš„ä¸ªæ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå¯é€‰çš„å‚æ•°æ¥è®¾ç½®ï¼› ä¸groupByKeyçš„ä¸åŒåœ¨äºreduceByKeyä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¤„ç†è§„çº¦åçš„æ¯ä¸ªå€¼ï¼›groupByKeyåˆ™æ˜¯å°†åˆ†ç»„åçš„å€¼éƒ½æ”¾åˆ°Iteratorä¸­ï¼› val textFileRDD = sparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) val rddData = textFileRDD.flatMap(_.split(\u0026quot; \u0026quot;)).map(row =\u0026gt; (row, 1)) rddData.groupByKey().map(row =\u0026gt; { val count = row._2.sum (row._1, count) }).collect().foreach(println(_)) rddData.reduceByKey((x, y) =\u0026gt; x + y).collect().foreach(println(_)) çœ‹å®ŒreduceByKeyä¹‹åå†å»çœ‹çœ‹distinct()çš„æºç ï¼Œå°±ä¼šå‘ç°å¾ˆæœ‰æ„æ€ï¼š\ndef distinct(numPartitions: Int)(implicit ord: Ordering[T] = null): RDD[T] = withScope { map(x =\u0026gt; (x, null)).reduceByKey((x, y) =\u0026gt; x, numPartitions).map(_._1) } å…ˆæ˜¯å°†ä¸€ä¸ªRDDè½¬åŒ–ä¸º(x,null) è¿™ç§äºŒå…ƒç»“æ„ï¼Œç„¶åæŒ‰ç…§æ¯ä¸ªkeyè¿›è¡Œè§„çº¦ï¼Œè¿™æ ·å°±èƒ½ä¿è¯keyåªæœ‰ä¸€ä¸ªï¼Œè€Œx,yéƒ½ä¸ºnullï¼Œæœ€ååªéœ€è¦å†å°†è§„çº¦åçš„keyå–å‡ºæ¥ï¼Œå°±æ˜¯å»é‡åçš„RDDäº†ã€‚\naggregateByKey (zeroValue)(seqOp, combOp, [numTasks]) å…ˆæŒ‰åˆ†åŒºèšåˆ ï¼Œå†æ€»çš„èšåˆ ï¼›æ¯æ¬¡è¦è·Ÿåˆå§‹å€¼äº¤æµ ä¾‹å¦‚ï¼šaggregateByKey(0)(+,+) å¯¹k/yçš„RDDè¿›è¡Œæ“ä½œï¼› /** * èšåˆï¼Œæš‚æ—¶è¿˜æ²¡ç†è§£ */ def aggregateByKeyDemo(): Unit = { val sparkSession = getDefaultSparkSession val textFileRDD = sparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) val rddData = textFileRDD.flatMap(_.split(\u0026quot; \u0026quot;)).map(row =\u0026gt; (row, 1)) val aggregateRDD = rddData.aggregateByKey(0)(_ + _, _ + _) aggregateRDD.collect().foreach(println(_)) } sortByKey([ascending], [numPartitions]) åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼ŒKå¿…é¡»å®ç°Orderedæ¥å£ï¼Œè¿”å›ä¸€ä¸ªæŒ‰ç…§keyè¿›è¡Œæ’åºçš„(K,V)çš„RDDï¼› /** * ç‰¹æ®Šçš„æ’åº */ def sortByKeyDemo(): Unit = { val sparkSession = getDefaultSparkSession val rddData2 = sparkSession.sparkContext.parallelize(List(\u0026quot;CSDN\u0026quot;, \u0026quot;ITEYE\u0026quot;, \u0026quot;CNBLOG\u0026quot;, \u0026quot;OSCHINA\u0026quot;, \u0026quot;GITHUB\u0026quot;)) val rddData3 = sparkSession.sparkContext.parallelize(1 to rddData2.count().toInt) val rddData4 = rddData2.zip(rddData3) rddData4.sortByKey().collect().foreach(println(_)) } sortBy(func,[ascending], [numTasks]) ä¸sortByKeyç±»ä¼¼ï¼Œæ’åºçš„å¯¹è±¡ä¹Ÿæ˜¯ï¼ˆK,Vï¼‰ç»“æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¹æ®ä»€ä¹ˆæ’åºï¼Œ ç¬¬äºŒä¸ªæ˜¯æ€ä¹ˆæ’åº falseå€’åº ï¼Œç¬¬ä¸‰ä¸ªæ’åºååˆ†åŒºæ•° ï¼Œé»˜è®¤ä¸åŸRDDä¸€æ ·ï¼› def sortByDemo(): Unit = { val sparkSession = getDefaultSparkSession val rddData = sparkSession.sparkContext.parallelize(List(3, 23, 4, 6, 234, 87)) val newRdd = rddData.mapPartitionsWithIndex((index: Int, row: Iterator[Int]) =\u0026gt; { row.toList.map(r =\u0026gt; (index, r)).iterator }) newRdd.sortBy(_._2, ascending = false).collect().foreach(println(_)) } join(otherDataset, [numTasks]) åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç›¸åŒkeyå¯¹åº”çš„æ‰€æœ‰å…ƒç´ å¯¹åœ¨ä¸€èµ·çš„(K,(V,W))çš„RDD ,ç›¸å½“äºå†…è¿æ¥ï¼ˆæ±‚äº¤é›†)ï¼› /** * zip å’Œ join æ“ä½œ */ def joinDemo(): Unit = { val sparkSession = getDefaultSparkSession val rddDataName = sparkSession.sparkContext.parallelize(List(\u0026quot;Tom\u0026quot;, \u0026quot;Rose\u0026quot;, \u0026quot;Jack\u0026quot;, \u0026quot;Jerry\u0026quot;)) val rddDataId = sparkSession.sparkContext.parallelize(List(\u0026quot;1001\u0026quot;, \u0026quot;1002\u0026quot;, \u0026quot;1003\u0026quot;, \u0026quot;1004\u0026quot;)) val rddDataAge = sparkSession.sparkContext.parallelize(List(12, 22, 13, 20)) val rddIdAndName = rddDataId.zip(rddDataName) rddIdAndName.collect().foreach(println(_)) val rddIdAndAge = rddDataId.zip(rddDataAge) rddIdAndAge.collect().foreach(println(_)) val fullRdd = rddIdAndName.join(rddIdAndAge) fullRdd.collect().foreach(println(_)) } cogroup(otherDataset, [numTasks]) åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,(Iterable,Iterable))ç±»å‹çš„RDDï¼›åœ¨2.3ä¹‹åæ²¡æœ‰è¯¥æ–¹æ³•ã€‚ å°ç»†èŠ‚1 å¼•ç”¨æˆå‘˜å˜é‡ ä»¥ä¸‹ä»£ç ä¸­mapä¸­å¼•ç”¨äº†classä¸­çš„æˆå‘˜å˜é‡ï¼›\nclass MyClass { val field = \u0026quot;Hello\u0026quot; def doStuff(rdd: RDD[String]): RDD[String] = { rdd.map(x =\u0026gt; field + x) } } ä½†è¿™ç§æ–¹å¼ç­‰ä»·äºï¼š scala rdd.map(x =\u0026gt; this.field + x) ï¼Œè¿™ç§æƒ…å†µä¼šå¼•ç”¨æ•´ä¸ªthisï¼› æ­£ç¡®çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼š\ndef doStuff(rdd: RDD[String]): RDD[String] = { // å¤åˆ¶ä¸€ä»½å‰¯æœ¬åˆ°æœ¬åœ° val field_ = this.field rdd.map(x =\u0026gt; field_ + x) } åœ¨mapä¸­å¼•ç”¨æˆå‘˜å˜é‡ï¼Œåº”è¯¥åœ¨è¿›è¡Œè½¬æ¢ä¹‹å‰å°±å¤åˆ¶ä¸€ä»½å‰¯æœ¬åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨æœ¬åœ°çš„å‰¯æœ¬è€Œä¸æ˜¯å»å¼•ç”¨æˆå‘˜å˜é‡ï¼›\nå°ç»†èŠ‚2 æ±‚å’Œæ“ä½œ ä¸èƒ½åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨foreachæ±‚å’Œ\nvar counter = 0 var rdd = sc.parallelize(data) // Wrong: Don't do this!! rdd.foreach(x =\u0026gt; counter += x) println(\u0026quot;Counter value: \u0026quot; + counter) ",
      "summary": "æ‘˜è¦ï¼šå­¦ä¹ sparkè¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œè®°å½•sparkä¸­çš„åŸºç¡€ç®—å­ï¼Œä»¥åŠRDDçš„åŸºæœ¬æ¦‚å¿µã€‚\nspark transform operation æºç åœ°å€ï¼šhttps://github.com/YaoQi17/sparkLearning/tree/master/sparkRDD\næ€»ç»“ RDD(Resilient Distributed Dataset) å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ˜¯ä¸€ç»„åˆ†å¸ƒå¼çš„æ•°æ®é›†åˆï¼Œé‡Œé¢çš„å…ƒç´ å¯å¹¶è¡Œè®¡ç®—ï¼Œå¯åˆ†åŒºï¼› RDDå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æ—¶æ˜¾ç¤ºåœ°å°†å·¥ä½œé›†ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¾‹å¦‚persist()ï¼›\nåˆ›å»ºæ–¹å¼ åˆ›å»ºRDDçš„ä¸¤ç§æ–¹å¼ï¼š\nè¯»å–å¤–ç•Œæ–‡ä»¶ å¤–ç•Œæ–‡ä»¶ä¸å±€é™äºç³»ç»Ÿæ–‡ä»¶ï¼ŒåŒ…æ‹¬HDFSã€HBaseç­‰\nsparkSession.sparkContext.textFile(\u0026quot;sparkRDD/src/main/resources/data.txt\u0026quot;) é€šè¿‡å¹¶è¡ŒåŒ–çš„æ–¹å¼åˆ›å»º val sparkSession = getDefaultSparkSession val dataArray = Array(1, 2, 3, 4, 5, 6) // åˆ›å»ºä¸€ä¸ªRDD val rdd = sparkSession.sparkContext.parallelize(dataArray) é€šè¿‡å¹¶è¡ŒåŒ–çš„æ–¹å¼åˆ›å»ºè¿˜å¯ä»¥æŒ‡å®šåˆ†åŒºçš„æ•°é‡\n/** Distribute a local Scala collection to form an RDD. * * @note Parallelize acts lazily. If `seq` is a mutable collection and is altered after the call * to parallelize and before the first action on the RDD, the resultant RDD will reflect the * modified collection."
    },{
      "title": "SpringBoot HBase",
      "url": "https://qiref.github.io/post/2019/07/11/springboot-hbase/",
      "content": "æ‘˜è¦:è®°å½•è‡ªå·±å†™çš„ä¸€ä¸ªåŸºäºSpringBootæ“ä½œHBaseçš„ç»„ä»¶ï¼Œæ”¯æŒkerberosè®¤è¯æ–¹å¼è®¿é—®ï¼Œæœ¬æ–‡ç›¸å½“äºAPIæ–‡æ¡£ã€‚\nHBase ç»„ä»¶æ¥å£æ–‡æ¡£ æºç åœ°å€ï¼šhttps://github.com/YaoQi17/HBase-Component\nä½¿ç”¨è¯´æ˜ åŸºæœ¬æ¦‚å¿µ\ntable: è¡¨\ncolumnFamily:åˆ—æ—ï¼Œä¸€ä¸ªè¡¨ä¸‹å¯ä»¥æœ‰å¤šä¸ªåˆ—æ—ï¼Œä½†æ˜¯ä¸å»ºè®®è®¾ç½®å¤šä¸ªåˆ—æ—ï¼ŒHBaseå»ºè®®è®¾è®¡é•¿çª„å‹çš„è¡¨è€Œä¸æ˜¯çŸ­å®½å‹ã€‚\nqualifier:åˆ—ï¼Œä¸€ä¸ªåˆ—æ—ä¸‹å¯ä»¥æœ‰å¤šåˆ—ï¼Œä¸€ä¸ªè¡¨ä¸­çš„åˆ—å¯ä»¥æ˜¯ä¸å¯¹é½çš„ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼ŒåŒä¸€å¼ è¡¨ä¸­çš„åˆ—æœ€å¥½æ˜¯ç›¸åŒçš„ã€‚\ncell:ä¸€åˆ—æ•°æ®ä¸‹çš„ä¸€ä¸ªå•å…ƒæ ¼ï¼Œä¸€ä¸ªåˆ—ä¸‹å¯ä»¥æœ‰å¤šä¸ªå•å…ƒæ ¼ï¼Œæ ¹æ®ç‰ˆæœ¬å·åŒºåˆ†ï¼Œé»˜è®¤æ¯æ¬¡è¯»å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œcellä¸‹çš„å­˜å‚¨æ˜¯æ•°æ®æœ¬èº«ã€‚\nrow: è¡Œï¼Œå¤šåˆ—æ•°æ®ç»„æˆä¸€è¡Œï¼Œä¸€è¡Œä¸­æœ‰å¤šä¸ªqualifierã€‚\nrowKey: è¡Œå¥ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€è¡Œæ•°æ®ï¼Œä¸€è¡Œä¸‹æœ‰å¤šåˆ—ï¼Œè¡Œå¥çš„è®¾è®¡ç›´æ¥å…³ç³»åˆ°æŸ¥è¯¢çš„æ•ˆç‡ã€‚\nHBaseé…ç½® ä»¥ä¸‹é…ç½®ä¸ºæœ€åŸºç¡€é…ç½®ï¼Œç¼ºä¸€ä¸å¯ã€‚\nHBase: conf: quorum: 192.168.80.234:2181,192.168.80.235:2181,192.168.80.241:2181 znodeParent: /hbase-unsecure #å¦‚æœæœ‰æ›´å¤šé…ç½®ï¼Œå†™åœ¨configä¸‹ï¼Œä¾‹å¦‚ï¼š #config: # key: value # key: value å¦‚æœéœ€è¦æ›´å¤šé…ç½®ï¼Œéœ€è¦åœ¨configä¸­é…ç½®ï¼Œä»¥key-valueçš„å½¢å¼ä¹¦å†™ã€‚\nå‚æ•°è¯´æ˜ quorumæ˜¯HBaseä¸­zookeeperçš„é…ç½®ï¼ŒznodeParentæ˜¯HBaseé…ç½®åœ¨zookeeperä¸­çš„è·¯å¾„ã€‚\nç®€å•ç¤ºä¾‹ å¼•å…¥ç»„ä»¶jaråŒ…ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.semptian.hbase.component\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hbase-component\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨éœ€è¦çš„åœ°æ–¹æ³¨å…¥HBaseOperationsæ¥å£ï¼Œè¯¥æ¥å£çš„å®ç°ç±»æ˜¯HBaseTemplateï¼Œé€šè¿‡è¿™ä¸ªç±»æ¥æ“ä½œHBaseã€‚\n@Autowired private HBaseOperations hBaseDao; æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œé€šè¿‡rowKeyæŸ¥è¯¢ï¼š\npublic void testQueryTable() { Result result = hBaseDao.queryByTableNameAndRowKey( \u0026quot;LBS\u0026quot;, 9223372036854775803L); System.out.println(result.isEmpty()); result.listCells().forEach(cell -\u0026gt; { System.out.println( \u0026quot;row:\u0026quot; + Bytes.toLong(CellUtil.cloneRow(cell)) + \u0026quot;,family:\u0026quot;+ Bytes.toString(CellUtil.cloneFamily(cell)) + \u0026quot;, qualifier: \u0026quot; + Bytes.toString(CellUtil.cloneQualifier(cell)) + \u0026quot;, value:\u0026quot; + Bytes.toString(CellUtil.cloneValue(cell))); }); } è¡¨çš„åŸºæœ¬æ“ä½œ æ–°å»ºè¡¨ åˆ›å»ºè¡¨é€šè¿‡HBaseTemplateå°±å¯ä»¥å®ç°ï¼ŒHBaseTemplateç±»ä¸­å¸¦æœ‰è¿™ä¸ªæ–¹æ³•ã€‚\næ“ä½œç¤ºä¾‹ï¼š\nhBaseDao.createTable(\u0026quot;HBASE-COMPONENT_1\u0026quot;, \u0026quot;CF1\u0026quot;, \u0026quot;CF2\u0026quot;); ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€å¼ è¡¨ï¼ŒHBASE-COMPONENT_1 æ˜¯è¡¨åï¼ŒCF1,CF2ä»£è¡¨è¿™ä¸ªè¡¨æœ‰ä¸¤ä¸ªåˆ—æ—ã€‚\nå¦‚æœæœ‰å¤šä¸ªåˆ—æ—å¯ä»¥å¾€åé¢åŠ ï¼Œåˆ—æ—ä¸å»ºè®®è®¾ç½®å¾ˆå¤šä¸ªã€‚\nåˆ é™¤è¡¨ hBaseDao.dropTable(\u0026quot;HBASE-COMPONENT_1\u0026quot;); å‚æ•°æ˜¯è¡¨åï¼Œé€šè¿‡è¡¨ååˆ é™¤è¡¨ã€‚\nåˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨ hBaseDao.tableExists(\u0026quot;lbs\u0026quot;); è¿™é‡Œçš„è¡¨åæ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚è¿”å›å€¼ï¼šbooleanã€‚\næ–°å¢æ•°æ® æ–°å¢ä¸€æ¡æ•°æ® éœ€è¦æ³¨æ„çš„æ˜¯åœ¨HBaseä¸­çš„å­˜å‚¨çš„æ•°æ®æ˜¯ä¸åˆ†æ ¼å¼çš„ï¼Œéƒ½æ˜¯ä»¥å­—èŠ‚æ•°ç»„çš„å½¢å¼å­˜å‚¨ï¼Œå› æ­¤åœ¨å­˜å‚¨ä¸€æ¡æ•°æ®æ—¶éœ€è¦å°†æ•°æ®éƒ½è½¬åŒ–æˆå­—èŠ‚æ•°ç»„ã€‚\nStringæ ¼å¼çš„æ•°æ®èƒ½ç›´æ¥è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„getBytes()ï¼Œä½†æ˜¯å…¶ä»–æ ¼å¼çš„æ•°æ®éœ€è¦å€ŸåŠ©å·¥å…·ä½œè½¬æ¢ã€‚\nè¿™é‡Œéœ€è¦æ ¼å¤–æ³¨æ„rowKeyçš„æ ¼å¼ï¼Œç”¨ä»€ä¹ˆæ ¼å¼å­˜å°±å†³å®šäº†ç”¨ä»€ä¹ˆæ ¼å¼å–ã€‚\nhBaseDao.put(\u0026quot;HBase-component\u0026quot;, \u0026quot;1534154424340\u0026quot;, \u0026quot;CF1\u0026quot;, \u0026quot;test_1\u0026quot;, Bytes.toBytes(\u0026quot;testData\u0026quot;)); å‚æ•°è¯´æ˜ï¼š\n(1) tableName ç›®æ ‡æ•°æ®è¡¨ (2) rowName rowKey (3) familyName åˆ—æ—å (4) qualifier åˆ—å (5) data å­—èŠ‚æ•°ç»„ç±»å‹çš„æ•°æ® è¿™é‡Œæ–°å¢ä¸€æ¡æ•°æ®æ˜¯å¡«å……æ•°æ®åˆ°ä¸€ä¸ªcellä¸­å»ã€‚\næ‰¹é‡æ–°å¢æ•°æ® String rowKey = String.valueOf(System.currentTimeMillis()); Put put = new Put(rowKey.getBytes()); String defaultColumn = \u0026quot;CF1\u0026quot;; String column1 = \u0026quot;col1\u0026quot;; String column2 = \u0026quot;col2\u0026quot;; String column3 = \u0026quot;col3\u0026quot;; String value = \u0026quot;test\u0026quot;; put.addColumn(defaultColumn.getBytes(), column1.getBytes(), value.getBytes()); put.addColumn(defaultColumn.getBytes(), column2.getBytes(), value.getBytes()); put.addColumn(defaultColumn.getBytes(), column3.getBytes(), value.getBytes()); List\u0026lt;Put\u0026gt; putList = new ArrayList\u0026lt;\u0026gt;(); putList.add(put); putList.add(put); putList.add(put); putList.add(put); putList.add(put); hBaseDao.putBatch(\u0026quot;HBase-component\u0026quot;, putList); æ‰¹é‡æ’å…¥æ•°æ®å°±æ˜¯ä½¿ç”¨å¤šä¸ªPutå¯¹è±¡ï¼ŒputBatch(\u0026hellip;)æ–¹æ³•çš„å‚æ•°ï¼šè¡¨åï¼ŒputList(å¤šä¸ªputçš„é›†åˆ)ã€‚ æ³¨æ„æ‰¹é‡æ’å…¥æ•°æ®ä¹Ÿéƒ½æ˜¯æ’å…¥å­—èŠ‚æ•°ç»„æ ¼å¼çš„æ•°æ®ã€‚\nåˆ é™¤æ•°æ® åˆ é™¤ä¸€æ¡æ•°æ® hBaseDao.delete(\u0026quot;HBase-component\u0026quot;, \u0026quot;1534210201115\u0026quot;, \u0026quot;CF1\u0026quot;, \u0026quot;col2\u0026quot;); å‚æ•°è¯´æ˜ï¼š\n(1) è¡¨å\n(2) rowKey\n(3) åˆ—æ—å\n(4) åˆ—å\nè¿™é‡Œåˆ é™¤æ˜¯åˆ é™¤ä¸€ä¸ªcellä¸‹çš„æ•°æ®\næ‰¹é‡åˆ é™¤æ•°æ® String tableName = \u0026quot;HBase-component\u0026quot;; String rowKey1 = \u0026quot;1534164113922\u0026quot;; String rowKey2 = \u0026quot;1534168248328\u0026quot;; List\u0026lt;Delete\u0026gt; deleteList = new ArrayList\u0026lt;\u0026gt;(); Delete delete = new Delete(rowKey1.getBytes()); Delete delete1 = new Delete(rowKey2.getBytes()); deleteList.add(delete); deleteList.add(delete1); hBaseDao.deleteBatch(tableName, deleteList); æ‰¹é‡åˆ é™¤éœ€è¦å€ŸåŠ©Deleteå¯¹è±¡ã€‚\næŸ¥è¯¢ å•æ¡ç»“æœæŸ¥è¯¢ Result result = hBaseDao.queryByTableNameAndRowKey(\u0026quot;LBS\u0026quot;, 9223372036854775803L); System.out.println(result.isEmpty()); result.listCells().forEach(cell -\u0026gt; { System.out.println( \u0026quot; row:\u0026quot; + Bytes.toLong(CellUtil.cloneRow(cell)) + \u0026quot; family:\u0026quot;+ Bytes.toString(CellUtil.cloneFamily(cell)) + \u0026quot; qualifier: \u0026quot; + Bytes.toString(CellUtil.cloneQualifier(cell)) + \u0026quot; value:\u0026quot; + Bytes.toString(CellUtil.cloneValue(cell))); }); queryByTableNameAndRowKey()è¯¥æ–¹æ³•æ˜¯é€šè¿‡è¡¨åå’ŒrowKeyæŸ¥è¯¢æ•°æ®ï¼Œè¿™é‡Œçš„rowKeyæ”¯æŒå¤šç§ç±»å‹ï¼ŒLongï¼Œdoubleï¼ŒIntegerå‡ ç§ç±»å‹ã€‚ è‡³äºè¿™é‡Œä¼ ä»€ä¹ˆç±»å‹çš„å‚æ•°ï¼Œå–å†³äºæ’å…¥æ•°æ®æ—¶rowKeyçš„ç±»å‹ï¼Œè™½ç„¶HBaseé‡Œå­˜å‚¨çš„éƒ½æ˜¯å­—èŠ‚æ•°ç»„ï¼Œä½†æ˜¯å¯¹ç±»å‹æ˜¯æ•æ„Ÿçš„ï¼Œå¦‚æœç±»å‹å¯¹ä¸ä¸Šå¯èƒ½ä¼šå‡ºé”™ã€‚\næ‰¹é‡æ‰«æ // æ„å»ºscan Scan scan = new Scan(); // è®¾ç½®æ—¶é—´æˆ³,è®¡ç®—æ—¶é—´å·® Long timeDifference = 2L * 30L * 24L * 60L * 60L * 1000L; Long endTime = System.currentTimeMillis(); Long fromTime = endTime - timeDifference; // è®¾ç½®æ—¶é—´è¿‡æ»¤å™¨ FilterList filterList = new FilterList(); Filter startTimeFilter = new SingleColumnValueFilter( DEFAULT_COLUMN_FAMILY.getBytes(), DATA_CREATE_TIME.getBytes(), CompareFilter.CompareOp.GREATER, Bytes.toBytes(fromTime) ); Filter endTimeFilter = new SingleColumnValueFilter( DEFAULT_COLUMN_FAMILY.getBytes(), DATA_CREATE_TIME.getBytes(), CompareFilter.CompareOp.LESS, Bytes.toBytes(endTime) ); filterList.addFilter(startTimeFilter); filterList.addFilter(endTimeFilter); scan.setFilter(filterList); // è·å–ç»“æœé›† ResultScanner resultScanner = hBaseTemplate.queryByScan(TABLE_NAME, scan); // éå†ç»“æœé›† try{ if (resultScanner != null) { resultScanner.forEach(result -\u0026gt; { List\u0026lt;Cell\u0026gt; cellList = result.listCells(); ... } } }finally{ if (resultScanner != null) { resultScanner.close(); } } æ‰¹é‡æŸ¥è¯¢å¯ä»¥é€šè¿‡queryByScan()æ–¹æ³•å®ç°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯scanï¼Œé€šè¿‡æ„å»ºä¸åŒçš„scanæ¥æŸ¥è¯¢ï¼Œè¿‡æ»¤å™¨ä¹Ÿæ˜¯åœ¨æ„å»ºscanå¯¹è±¡æ˜¯æ·»åŠ çš„ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªè¿‡æ»¤å™¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ResultScannerç±»ï¼Œåœ¨éå†ç»“æœé›†æ—¶éœ€è¦ä½¿ç”¨try-finallyç»“æ„ï¼Œåœ¨ä½¿ç”¨å®ŒresultScannerå¯¹è±¡ä¹‹åå…³é—­è¯¥å¯¹è±¡ã€‚HBaseå®˜æ–¹æ–‡æ¡£ä¸Šå¼ºè°ƒäº†è¿™ä¸€ç‚¹ã€‚å› æ­¤åœ¨ä½¿ç”¨ResultScannerå¯¹è±¡æ—¶éœ€è¦æ ¼å¤–æ³¨æ„ã€‚\nå¸¸è§è¿‡æ»¤å™¨ï¼š\nè¡Œå¥è¿‡æ»¤å™¨ï¼šRowFilter\nåˆ—æ—è¿‡æ»¤å™¨ï¼šFamilyFilter\nå€¼è¿‡æ»¤å™¨ï¼šValueFilter\nåˆ—è¿‡æ»¤å™¨ï¼šQualifierFilter\nå•åˆ—å€¼è¿‡æ»¤å™¨ï¼šSingleColumnValueFilter(ä¼šè¿”å›æ»¡è¶³æ¡ä»¶çš„è¡Œ)\nå•åˆ—å€¼æ’é™¤è¿‡æ»¤å™¨ï¼šSingleColumnExcludeFilter(è¿”å›æ’é™¤äº†è¯¥åˆ—çš„ç»“æœï¼Œä¸å•åˆ—å€¼è¿‡æ»¤å™¨ç›¸å)\nå‰ç¼€è¿‡æ»¤å™¨ï¼šPrefixFilter(è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯é’ˆå¯¹è¡Œå¥çš„ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥å­—èŠ‚æ•°ç»„å½¢å¼çš„å†…å®¹ï¼Œè¿‡æ»¤å™¨ä¼šå»åŒ¹é…è¡Œå¥)\né¡µæ•°è¿‡æ»¤å™¨ï¼šPageFilter(ä½¿ç”¨pageFilterè¿‡æ»¤å™¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯è®¾ç½®äº†é¡µæ•°å¤§å°å°±èƒ½è¿”å›ç›¸åº”æ•°ç›®çš„ç»“æœ)\nString tableName = \u0026quot;RECOMMEND_ENGINE_DATA_MODEL\u0026quot;; Scan scan = new Scan(); PageFilter pageFilter = new PageFilter(1); scan.setFilter(pageFilter); ResultScanner resultScanner = hBaseDao.queryByScan(tableName, scan); try{ resultScanner.forEach(result -\u0026gt; { result.listCells().forEach(cell -\u0026gt; { // process }); }finally{ if (resultScanner != null) { resultScanner.close(); } } ä¸Šé¢è¿™æ®µä»£ç ä¸­è®¾ç½®äº†é¡µé¢å¤§å°ä¸º1ï¼Œé¢„æœŸæ˜¯è¿”å›ä¸€æ¡æ•°æ®ï¼Œä½†æ˜¯ç»“æœä¼šè¿”å›ä¸¤æ¡æ•°æ®ï¼Œè¿™æ—¶è¿”å›çš„ç»“æœæ•°ä¼šå–å†³äºregionServerçš„æ•°é‡ã€‚\nå¦‚æœæ˜¯FilterListï¼ŒFilterListçš„é¡ºåºä¼šå½±å“PageFilterçš„æ•ˆæœã€‚\nä¸€èˆ¬æ¯”è¾ƒå‹è¿‡æ»¤å™¨ï¼Œéœ€è¦ç”¨CompareFilter.CompareOpä¸­çš„æ¯”è¾ƒè¿ç®—ç¬¦ã€‚æ‰€æœ‰çš„è¿‡æ»¤å™¨éƒ½æ˜¯ç”¨Scanå¯¹è±¡å»è®¾ç½®ã€‚\nå¤šè¿‡æ»¤å™¨æŸ¥è¯¢ String tableName = \u0026quot;HBase-component\u0026quot;; Scan scan = new Scan(); PageFilter pageFilter = new PageFilter(1); SingleColumnValueFilter singleColumnValueFilter = new SingleColumnValueFilter( \u0026quot;CF1\u0026quot;.getBytes(), \u0026quot;col1\u0026quot;.getBytes(), CompareFilter.CompareOp.EQUAL, new SubstringComparator(\u0026quot;group\u0026quot;)); singleColumnValueFilter.setFilterIfMissing(true); FilterList filterList = new FilterList(); filterList.addFilter(singleColumnValueFilter); filterList.addFilter(pageFilter); scan.setFilter(filterList); ResultScanner resultScanner = hBaseDao.queryByScan(tableName, scan); try { resultScanner.forEach(result -\u0026gt; { result.listCells().forEach(cell -\u0026gt; { System.out.println( \u0026quot; row:\u0026quot; + Bytes.toString(CellUtil.cloneRow(cell)) + \u0026quot; family:\u0026quot;+ Bytes.toString(CellUtil.cloneFamily(cell)) + \u0026quot; qualifier: \u0026quot; + Bytes.toString(CellUtil.cloneQualifier(cell))+ \u0026quot; value:\u0026quot; + Bytes.toString(CellUtil.cloneValue(cell))); }); }); } finally { if (resultScanner != null) { resultScanner.close(); } } å¤šè¿‡æ»¤å™¨éœ€è¦ç”¨åˆ°FilterListï¼Œä¹Ÿæ˜¯ç›´æ¥è®¾ç½®åˆ°Scanå¯¹è±¡ä¸­ã€‚å¤šè¿‡æ»¤å™¨çš„æ—¶å€™éœ€è¦æ³¨æ„è¿‡æ»¤å™¨çš„é¡ºåºé—®é¢˜ï¼Œä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­å¦‚æœå°†ä¸¤ä¸ªè¿‡æ»¤å™¨è°ƒæ¢é¡ºåºï¼ŒæŸ¥è¯¢çš„ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚\nç»“æœé›†çš„æ˜ å°„ åœ¨HBaseä¸­ï¼Œé»˜è®¤æ‰€æœ‰çš„é¡ºåºéƒ½æ˜¯æŒ‰ç…§å­—æ¯åºæ’åˆ—ï¼Œä¾‹å¦‚CF1åˆ—æ—ä¸‹æœ‰å¤šä¸ªåˆ—ï¼šcol1ã€col2ã€col3ï¼Œé‚£ä¹ˆåœ¨éå†ç»“æœé›†æ—¶ï¼ŒlistCells()ä¸­çš„cellçš„é¡ºåºæ€»æ˜¯æŒ‰ç…§åˆ—åçš„å­—æ¯åºæ¥æ’åˆ—çš„ã€‚\næ‰€ä»¥cellList.get(0)å°±æ˜¯å¯¹åº”col1ä¸­çš„æ•°æ®ï¼ŒcellList.get(1)å°±æ˜¯å¯¹åº”col2ä¸­çš„æ•°æ®ï¼ŒcellList.get(2)å°±æ˜¯å¯¹åº”col3ä¸­çš„æ•°æ®ã€‚\nå¦‚æœåˆ—åä¸ºaã€bã€cé‚£åˆ†åˆ«å¯¹åº”çš„ä¸‹æ ‡ä¸ºcellList.get(0)ã€cellList.get(1)ã€cellList.get(2)\n",
      "summary": "æ‘˜è¦:è®°å½•è‡ªå·±å†™çš„ä¸€ä¸ªåŸºäºSpringBootæ“ä½œHBaseçš„ç»„ä»¶ï¼Œæ”¯æŒkerberosè®¤è¯æ–¹å¼è®¿é—®ï¼Œæœ¬æ–‡ç›¸å½“äºAPIæ–‡æ¡£ã€‚\nHBase ç»„ä»¶æ¥å£æ–‡æ¡£ æºç åœ°å€ï¼šhttps://github.com/YaoQi17/HBase-Component\nä½¿ç”¨è¯´æ˜ åŸºæœ¬æ¦‚å¿µ\ntable: è¡¨\ncolumnFamily:åˆ—æ—ï¼Œä¸€ä¸ªè¡¨ä¸‹å¯ä»¥æœ‰å¤šä¸ªåˆ—æ—ï¼Œä½†æ˜¯ä¸å»ºè®®è®¾ç½®å¤šä¸ªåˆ—æ—ï¼ŒHBaseå»ºè®®è®¾è®¡é•¿çª„å‹çš„è¡¨è€Œä¸æ˜¯çŸ­å®½å‹ã€‚\nqualifier:åˆ—ï¼Œä¸€ä¸ªåˆ—æ—ä¸‹å¯ä»¥æœ‰å¤šåˆ—ï¼Œä¸€ä¸ªè¡¨ä¸­çš„åˆ—å¯ä»¥æ˜¯ä¸å¯¹é½çš„ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼ŒåŒä¸€å¼ è¡¨ä¸­çš„åˆ—æœ€å¥½æ˜¯ç›¸åŒçš„ã€‚\ncell:ä¸€åˆ—æ•°æ®ä¸‹çš„ä¸€ä¸ªå•å…ƒæ ¼ï¼Œä¸€ä¸ªåˆ—ä¸‹å¯ä»¥æœ‰å¤šä¸ªå•å…ƒæ ¼ï¼Œæ ¹æ®ç‰ˆæœ¬å·åŒºåˆ†ï¼Œé»˜è®¤æ¯æ¬¡è¯»å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œcellä¸‹çš„å­˜å‚¨æ˜¯æ•°æ®æœ¬èº«ã€‚\nrow: è¡Œï¼Œå¤šåˆ—æ•°æ®ç»„æˆä¸€è¡Œï¼Œä¸€è¡Œä¸­æœ‰å¤šä¸ªqualifierã€‚\nrowKey: è¡Œå¥ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€è¡Œæ•°æ®ï¼Œä¸€è¡Œä¸‹æœ‰å¤šåˆ—ï¼Œè¡Œå¥çš„è®¾è®¡ç›´æ¥å…³ç³»åˆ°æŸ¥è¯¢çš„æ•ˆç‡ã€‚\nHBaseé…ç½® ä»¥ä¸‹é…ç½®ä¸ºæœ€åŸºç¡€é…ç½®ï¼Œç¼ºä¸€ä¸å¯ã€‚\nHBase: conf: quorum: 192.168.80.234:2181,192.168.80.235:2181,192.168.80.241:2181 znodeParent: /hbase-unsecure #å¦‚æœæœ‰æ›´å¤šé…ç½®ï¼Œå†™åœ¨configä¸‹ï¼Œä¾‹å¦‚ï¼š #config: # key: value # key: value å¦‚æœéœ€è¦æ›´å¤šé…ç½®ï¼Œéœ€è¦åœ¨configä¸­é…ç½®ï¼Œä»¥key-valueçš„å½¢å¼ä¹¦å†™ã€‚\nå‚æ•°è¯´æ˜ quorumæ˜¯HBaseä¸­zookeeperçš„é…ç½®ï¼ŒznodeParentæ˜¯HBaseé…ç½®åœ¨zookeeperä¸­çš„è·¯å¾„ã€‚\nç®€å•ç¤ºä¾‹ å¼•å…¥ç»„ä»¶jaråŒ…ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.semptian.hbase.component\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hbase-component\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨éœ€è¦çš„åœ°æ–¹æ³¨å…¥HBaseOperationsæ¥å£ï¼Œè¯¥æ¥å£çš„å®ç°ç±»æ˜¯HBaseTemplateï¼Œé€šè¿‡è¿™ä¸ªç±»æ¥æ“ä½œHBaseã€‚\n@Autowired private HBaseOperations hBaseDao; æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œé€šè¿‡rowKeyæŸ¥è¯¢ï¼š\npublic void testQueryTable() { Result result = hBaseDao.queryByTableNameAndRowKey( \u0026quot;LBS\u0026quot;, 9223372036854775803L); System.out.println(result.isEmpty()); result.listCells().forEach(cell -\u0026gt; { System.out.println( \u0026quot;row:\u0026quot; + Bytes.toLong(CellUtil.cloneRow(cell)) + \u0026quot;,family:\u0026quot;+ Bytes.toString(CellUtil.cloneFamily(cell)) + \u0026quot;, qualifier: \u0026quot; + Bytes."
    },{
      "title": "å·¥å‚æ¨¡å¼",
      "url": "https://qiref.github.io/post/2019/07/11/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/",
      "content": "æ‘˜è¦ï¼šè¯¦ç»†ç»“æŸå·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰çš„ä½¿ç”¨ï¼Œä»¥åŠåœ¨Javaä¸­çš„å®ç°æ–¹å¼ã€‚\nç®€ä»‹ å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯è§£å†³åˆ›å»ºå¯¹è±¡çš„é—®é¢˜ï¼Œå…¸å‹çš„åº”ç”¨å°±æ˜¯åœ¨springä¸­çš„IOCï¼Œåè½¬æ§åˆ¶ï¼Œåè½¬æ§åˆ¶å°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„æƒé™äº¤ç»™æ¡†æ¶ï¼Œæ‰€ä»¥springå°±æ˜¯ä¸€ä¸ªç”Ÿäº§å¯¹è±¡çš„å·¥å‚ã€‚\næ€è·¯ å·¥å‚æ¨¡å¼çš„æ€è·¯å°±æ˜¯è®¾è®¡ä¸€ä¸ªäº§ç”Ÿå¯¹è±¡çš„æœºåˆ¶ï¼Œè®©ç”Ÿäº§å¯¹è±¡çš„è¿‡ç¨‹äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”ä½¿ç”¨é€šç”¨æ¥å£æ¥æ”¶æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚\nå®ç°è¿‡ç¨‹ æ–°å»ºæŠ½è±¡çš„æ¥å£ æ–°å»ºå…·ä½“çš„å®ä½“ç±»ï¼Œå®ç°æŠ½è±¡çš„æ¥å£ åˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡çš„å·¥å‚ åœ¨å®¢æˆ·ç«¯ä¸­é€šè¿‡å·¥å‚åˆ›å»ºå…·ä½“çš„å®ä½“å¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥ç”¨æŠ½è±¡æ¥å£æ¥æ”¶ã€‚ è¿™ç§æ–¹å¼æ˜¯æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼š\n// åˆ›å»ºæ¥å£ public interface Shape { void draw(); } // åˆ›å»ºå®ä½“ç±»Circle public class Circle implements Shape { @Override public void draw() { System.out.println(\u0026quot;drawing a circle\u0026quot;); } } // åˆ›å»ºå®ä½“ç±»Rectangle public class Rectangle implements Shape { @Override public void draw() { System.out.println(\u0026quot;drawing a Rectangle\u0026quot;); } } // åˆ›å»ºå®ä½“ç±»Square public class Square implements Shape { @Override public void draw() { System.out.println(\u0026quot;drawing a square\u0026quot;); } } ç„¶ååˆ›å»ºå·¥å‚ç±»ï¼Œç”Ÿæˆå¯¹åº”çš„å®ä½“ç±»ã€‚\npublic class ShapeFactory { public static Shape getShapes(String shapeType) { if (shapeType == null) { System.out.println(\u0026quot;shapeType is null\u0026quot;); throw new RuntimeException(); } else if (shapeType.equalsIgnoreCase(\u0026quot;Rectangle\u0026quot;)) { return new Rectangle(); } else if (shapeType.equalsIgnoreCase(\u0026quot;Square\u0026quot;)) { return new Square(); }else if(shapeType.equalsIgnoreCase(\u0026quot;Circle\u0026quot;)){ return new Circle(); }else { System.out.println(\u0026quot;nothing to do\u0026quot;); return null; } } // æµ‹è¯•ç®€å•å·¥å‚æ¨¡å¼ @Test public void testSimpleFactoryPattern(){ Shape circle = ShapeFactory.getShapes(\u0026quot;circle\u0026quot;); circle.draw(); Shape rectangle = ShapeFactory.getShapes(\u0026quot;Rectangle\u0026quot;); rectangle.draw(); Shape square = ShapeFactory.getShapes(\u0026quot;Square\u0026quot;); square.draw(); } } è¿™ç§æ–¹å¼å®ç°å·¥å‚æ¨¡å¼å¾ˆç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯”å¦‚ï¼Œåœ¨å¢åŠ ä¸€ä¸ªå®ç°Shapeæ¥å£çš„å®ä½“ç±»ï¼Œåˆéœ€è¦å»ä¿®æ”¹ShapeFactoryä¸­çš„ä»£ç ï¼Œè¿™æ ·å…¶å®ä¸ç¬¦åˆè®¾è®¡æ¨¡å¼çš„åŸåˆ™ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚\nå·¥å‚æ¨¡å¼çš„æ”¹è¿› åˆ†æä¸€ä¸‹ï¼Œä¹‹æ‰€ä»¥æ¯æ–°å¢ä¸€ä¸ªç±»éƒ½éœ€è¦å»ä¿®æ”¹å·¥å‚çš„ä»£ç ï¼Œæ˜¯å› ä¸ºåœ¨å·¥å‚ä¸­ï¼Œç”Ÿæˆç±»çš„ä»£ç å¤ªå…·ä½“äº†ï¼Œè¦æƒ³æ”¹å˜è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦æŠŠè¿™ä¸ªå·¥å‚ç”Ÿæˆç±»å®ä¾‹çš„è¿‡ç¨‹å˜å¾—æŠ½è±¡åŒ–ï¼Œåœ¨Javaä¸­ï¼Œç”Ÿæˆå¯¹è±¡çš„æ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œè¿˜å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶ï¼Œå·¥å‚æ¥æ”¶çš„æ˜¯å’Œç±»ç›¸å…³çš„å‚æ•°ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‚æ•°æ¢æˆéœ€è¦ç”Ÿæˆå®ä¾‹çš„ç±»ï¼Œè¿™æ ·å·¥å‚ä¸­ç”Ÿæˆç±»çš„ä»£ç å°±å¾ˆæŠ½è±¡äº†ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\npublic class ShapeFactory { public static Shape getClass(Class\u0026lt;? extends Shape\u0026gt; clazz) { Shape shape = null; try { // é€šè¿‡åå°„ç”Ÿæˆä¸€ä¸ªç±»çš„å®ä¾‹ shape = (Shape) Class.forName(clazz.getName()).newInstance(); } catch (InstantiationException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (ClassNotFoundException e) { e.printStackTrace(); } return shape; } // æµ‹è¯•åå°„æ”¹è¿›åçš„å·¥å‚ @Test public void testReflectShapeFac(){ Shape rectangle = ShapeFactory.getClass(Rectangle.class); rectangle.draw(); Shape square = ShapeFactory.getClass(Square.class); square.draw(); Shape circle = ShapeFactory.getClass(Circle.class); circle.draw(); } } è¿™æ ·å·¥å‚çš„ç”Ÿäº§è¿‡ç¨‹å°±å¾ˆæŠ½è±¡äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå·¥å‚åªèƒ½ç”Ÿæˆå®ç°Shapeæ¥å£çš„ç±»å®ä¾‹ï¼Œå¦‚æœå‡ºç°äº†å¦å¤–ä¸€ç§æ¥å£ï¼Œå°±æœ‰éœ€è¦æ–°å¢ä¸€ä¸ªå·¥å‚ï¼Œè¿™æ ·ä¹Ÿæœªå°ä¸å¯ï¼Œå› ä¸ºåªæ˜¯æ‰©å±•è€Œå·²ï¼Œä½†æ˜¯åˆå‡ºç°äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œè¿™äº›å·¥å‚ä¸­çš„ç”Ÿäº§å¯¹è±¡çš„ä»£ç éƒ½å·®ä¸å¤šï¼Œåªæ˜¯å¼ºè½¬çš„æ¥å£ä¸åŒï¼Œä»£ç è¿˜æ˜¯æœ‰ä¼˜åŒ–çš„ç©ºé—´çš„ã€‚å·¥å‚å¯ä»¥è¿›ä¸€æ­¥æŠ½è±¡ï¼š\n// æ”¹è¿›åçš„å·¥å‚æ–¹æ³• public static \u0026lt;T\u0026gt; T getClass(Class\u0026lt;? extends T\u0026gt; clazz){ T obj = null; try { obj= (T) Class.forName(clazz.getName()).newInstance(); } catch (InstantiationException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (ClassNotFoundException e) { e.printStackTrace(); } return obj; } å€ŸåŠ©é…ç½®æ–‡ä»¶çš„å·¥å‚æ¨¡å¼ åˆ°è¿™é‡Œï¼Œå¯ä»¥å»æ€è€ƒä¸€ä¸‹åœ¨springä¸­ï¼Œæ˜¯æ€ä¹ˆåˆ©ç”¨å·¥å‚æ¨¡å¼çš„ï¼Œé¦–å…ˆä½ éœ€è¦å»xmlä¸­é…ç½®ä½ éœ€è¦å®ä¾‹åŒ–çš„ç±»ï¼Œç„¶åè¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åå°„ç”Ÿæˆè¿™ä¸ªç±»çš„å®ä¾‹è¿”å›ã€‚å…¶å®è¿™é‡Œä¹Ÿå¯ä»¥ç®€å•æ¨¡ä»¿ä¸€ä¸‹ï¼š\n// è§£æPropertiesé…ç½®æ–‡ä»¶ public class PropertiesUtil { private static Properties properties = new Properties(); public static String getPackageByName(String name) { return properties.getProperty(name); } // è§£æé…ç½®æ–‡ä»¶ private static Map\u0026lt;String, String\u0026gt; parseProperties() { Map\u0026lt;String, String\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); InputStream inputStream = PropertiesUtil.class.getClassLoader().getResourceAsStream(\u0026quot;application.properties\u0026quot;); try { properties.load(inputStream); } catch (IOException e) { System.err.println(\u0026quot;file is not exists\u0026quot;); e.printStackTrace(); } return map; } } é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š\n# ç±»åå’ŒåŒ…åçš„æ˜ å°„ circle=com.factory.pattern.simple.Circle rectangle=com.factory.pattern.simple.Rectangle square=com.factory.pattern.simple.Square ç„¶åæ ¹æ®æä¾›çš„é…ç½®æ–‡ä»¶çš„æŠ¥åï¼Œé€šè¿‡åå°„å®ä¾‹åŒ–å¯¹åº”çš„ç±»ï¼š\npublic class ConfigFactory { // é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„åŒ…åç”Ÿæˆå®ä¾‹ public static \u0026lt;T\u0026gt; T getNewInstance(String className) { String packageName = PropertiesUtil.getPackageByName(className); try { return (T) Class.forName(packageName).newInstance(); } catch (InstantiationException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (ClassNotFoundException e) { e.printStackTrace(); } return null; } } è¿™ç§æ–¹å¼éœ€è¦éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ä¸€å®šæ˜¯åœ¨è°ƒç”¨å·¥å‚çš„å‰é¢ï¼Œå› ä¸ºéœ€è¦è¯»å–æŠ¥åï¼ŒæŠŠå¯¹åº”çš„æ•°æ®è¯»åˆ°å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿå°±æ˜¯springä¸­å…ˆå¯åŠ¨å®¹å™¨çš„åŸå› ã€‚\n",
      "summary": "æ‘˜è¦ï¼šè¯¦ç»†ç»“æŸå·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰çš„ä½¿ç”¨ï¼Œä»¥åŠåœ¨Javaä¸­çš„å®ç°æ–¹å¼ã€‚\nç®€ä»‹ å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯è§£å†³åˆ›å»ºå¯¹è±¡çš„é—®é¢˜ï¼Œå…¸å‹çš„åº”ç”¨å°±æ˜¯åœ¨springä¸­çš„IOCï¼Œåè½¬æ§åˆ¶ï¼Œåè½¬æ§åˆ¶å°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„æƒé™äº¤ç»™æ¡†æ¶ï¼Œæ‰€ä»¥springå°±æ˜¯ä¸€ä¸ªç”Ÿäº§å¯¹è±¡çš„å·¥å‚ã€‚\næ€è·¯ å·¥å‚æ¨¡å¼çš„æ€è·¯å°±æ˜¯è®¾è®¡ä¸€ä¸ªäº§ç”Ÿå¯¹è±¡çš„æœºåˆ¶ï¼Œè®©ç”Ÿäº§å¯¹è±¡çš„è¿‡ç¨‹äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”ä½¿ç”¨é€šç”¨æ¥å£æ¥æ”¶æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚\nå®ç°è¿‡ç¨‹ æ–°å»ºæŠ½è±¡çš„æ¥å£ æ–°å»ºå…·ä½“çš„å®ä½“ç±»ï¼Œå®ç°æŠ½è±¡çš„æ¥å£ åˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡çš„å·¥å‚ åœ¨å®¢æˆ·ç«¯ä¸­é€šè¿‡å·¥å‚åˆ›å»ºå…·ä½“çš„å®ä½“å¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥ç”¨æŠ½è±¡æ¥å£æ¥æ”¶ã€‚ è¿™ç§æ–¹å¼æ˜¯æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼š\n// åˆ›å»ºæ¥å£ public interface Shape { void draw(); } // åˆ›å»ºå®ä½“ç±»Circle public class Circle implements Shape { @Override public void draw() { System.out.println(\u0026quot;drawing a circle\u0026quot;); } } // åˆ›å»ºå®ä½“ç±»Rectangle public class Rectangle implements Shape { @Override public void draw() { System.out.println(\u0026quot;drawing a Rectangle\u0026quot;); } } // åˆ›å»ºå®ä½“ç±»Square public class Square implements Shape { @Override public void draw() { System."
    },{
      "title": "Gitå­¦ä¹ ç¬”è®°",
      "url": "https://qiref.github.io/post/2019/06/16/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
      "content": "æ‘˜è¦ï¼šå­¦ä¹ Gitçš„ä¸€äº›ç¬”è®°ï¼Œè®°å½•äº†Gitçš„ä¸€äº›å¸¸è§å‘½ä»¤ï¼Œä»¥åŠGitä¸­æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚\ngitæ–‡ä»¶çŠ¶æ€å˜åŒ– çŠ¶æ€è¯´æ˜ï¼š çŠ¶æ€è½¬æ¢: æ­£å¸¸æµç¨‹ git clone ä»è¿œç¨‹æ‹‰ä¸€ä¸ªå·¥ç¨‹ä¸‹æ¥ å¢åŠ ä¸€ä¸ªæ–‡ä»¶ git status æŸ¥çœ‹çŠ¶æ€ git add æŠŠæ–‡ä»¶ä»Untracked\u0026ndash;\u0026gt;Staged git rm \u0026ndash;cached git commit æäº¤ git push æŠŠmasteråˆ†æ”¯çš„å†…å®¹æäº¤åˆ°è¿œç«¯ git diff æŸ¥çœ‹å˜åŒ– æ“ä½œå®ä¾‹ å›æ»šè¿˜æ²¡æœ‰commitçš„æ–‡ä»¶ æ“ä½œå®ä¾‹ å›æ»šæŸä¸ªæäº¤ æ“ä½œå®ä¾‹ åˆ†æ”¯æ“ä½œ æŸ¥çœ‹åˆ†æ”¯ åˆ›å»ºåˆ†æ”¯ åˆ†æ”¯ä¸Šå¢åŠ å†…å®¹ æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ ä¸¤ä¸ªåˆ†æ”¯è¿›è¡Œæ¯”è¾ƒ åˆ†æ”¯åˆå¹¶åˆ°masterä¸Š ä»è¿œç¨‹æ‹‰ä¸€ä¸ªåˆ†æ”¯ tagæ“ä½œ å…¶ä»– gitè¦†ç›–æœ¬åœ°ä¿®æ”¹ï¼Œpull è¿œç¨‹ gitä¿®æ”¹ä¸Šä¸€æ¬¡commit message gité‡å‘½ååˆ†æ”¯ gitæ–‡ä»¶çŠ¶æ€å˜åŒ– çŠ¶æ€è¯´æ˜ï¼š Untracked: åˆšæ–°åŠ çš„æ–‡ä»¶ï¼Œè¿˜æ²¡æœ‰çº³å…¥gitç®¡ç†èŒƒå›´\nUnModified: å·²ç»committedçš„æ–‡ä»¶\nModified: å·²ç»committedçš„æ–‡ä»¶ï¼Œé€šè¿‡viç­‰ä¿®æ”¹åï¼Œå°±å˜æˆModified\nStaged: git add åçš„æ–‡ä»¶\nçŠ¶æ€è½¬æ¢: Untracked-\u0026gt;Staged: é€šè¿‡git add æ¥å®Œæˆ\nUnModified-\u0026gt;Modified: ä¿®æ”¹æ–‡ä»¶å†…å®¹æ¥å®Œæˆï¼Œæ¯”å¦‚viå‘½ä»¤\nModified-\u0026gt;Staged: é€šè¿‡git add æ¥å®Œæˆ\nUnModified-\u0026gt;Untracked: é€šè¿‡git rm æ¥å®Œæˆ\nStaged-\u0026gt;UnModified: é€šè¿‡git commit æ¥å®Œæˆ\næ­£å¸¸æµç¨‹ git clone ä»è¿œç¨‹æ‹‰ä¸€ä¸ªå·¥ç¨‹ä¸‹æ¥ $ git clone git@github.com:sotrip/gittest.git Cloning into 'gittest'... warning: You appear to have cloned an empty repository. Checking connectivity... done. å¢åŠ ä¸€ä¸ªæ–‡ä»¶ $ vi 1.txt #é‡Œé¢å†…å®¹å¦‚ä¸‹: the first line git status æŸ¥çœ‹çŠ¶æ€ $ git status On branch master #è¡¨ç¤ºæˆ‘ä»¬ç›®å‰åœ¨masteråˆ†æ”¯ä¸Š Initial commit Untracked files: #æœ‰å“ªäº›æ–‡ä»¶æ˜¯UntrackedçŠ¶æ€ï¼Œæœ‰1.txt (use \u0026quot;git add ...\u0026quot; to include in what will be committed) 1.txt nothing added to commit but untracked files present (use \u0026quot;git add\u0026quot; to track) git add æŠŠæ–‡ä»¶ä»Untracked\u0026ndash;\u0026gt;Staged $ git add 1.txt #æˆåŠŸåï¼Œæ²¡æœ‰è¾“å‡º $ git status #å†æ¬¡æŸ¥çœ‹ On branch master Initial commit Changes to be committed: #è¡¨ç¤º1.txtå·²ç»æ˜¯stagedäº†ï¼Œå¯ä»¥è¢«æäº¤äº† (use \u0026quot;git rm --cached ...\u0026quot; to unstage) #å¦‚æœä¸æƒ³æäº¤äº†ï¼Œå¯ä»¥ç”¨git rm --cached 1.txt new file: 1.txt git rm \u0026ndash;cached æ–‡ä»¶å·²ç»æ˜¯stagedäº†ï¼Œä½†æƒ³è¦é€€å›åŸæ¥çš„çŠ¶æ€\n$ git rm --cached 1.txt rm '1.txt' $ git status # å†æ¥çœ‹åˆå›æ¥2.3è¿™ä¸€æ­¥äº† On branch master Initial commit Untracked files: (use \u0026quot;git add ...\u0026quot; to include in what will be committed) 1.txt $ git add 1.txt # æˆ‘ä»¬è¿˜æ˜¯å†åŠ ä¸Š $ git status On branch master Initial commit Changes to be committed: # 1.txt åˆæ”¹ä¸ºstagedçŠ¶æ€ å‡†å¤‡æäº¤ (use \u0026quot;git rm --cached ...\u0026quot; to unstage) new file: 1.txt git commit æäº¤ $ git commit -m \u0026quot;first commit\u0026quot; #-måé¢æ˜¯æˆ‘ä»¬è¿™ä¸€æ¬¡æäº¤çš„æ³¨é‡Š [master (root-commit) e6b0e7d] first commit 1 file changed, 1 insertion(+) create mode 100644 1.txt git push æŠŠmasteråˆ†æ”¯çš„å†…å®¹æäº¤åˆ°è¿œç«¯ $ git push origin master Warning: Permanently added the RSA host key for IP address '*.*.*.*' to the list of known hosts. Counting objects: 3, done. Writing objects: 100% (3/3), 214 bytes | 0 bytes/s, done. Total 3 (delta 0), reused 0 (delta 0) To git@github.com:sotrip/gittest.git * [new branch] master -\u0026gt; master git diff æŸ¥çœ‹å˜åŒ– å‘½ä»¤æ¦‚æ‹¬\ngit diff #æŸ¥çœ‹ Modifiedçš„æ–‡ä»¶ï¼Œåšäº†å“ªäº›ä¿®æ”¹ git diff --staged # æŸ¥çœ‹ Stagedçš„æ–‡ä»¶ï¼Œåšäº†å“ªäº›ä¿®æ”¹ æ“ä½œå®ä¾‹ $ vi 1.txt #åœ¨åé¢å¢åŠ ä¸€è¡Œ,å˜æˆå¦‚ä¸‹ the first line the second line $ git status On branch master Your branch is up-to-date with 'origin/master'. Changes not staged for commit: #è¿™ä¸ªè¡¨ç¤º1.txtå·²ç»å˜ä¸ºModifiedäº†ï¼Œnot staged (use \u0026quot;git add ...\u0026quot; to update what will be committed) (use \u0026quot;git checkout -- ...\u0026quot; to discard changes in working directory) modified: 1.txt no changes added to commit (use \u0026quot;git add\u0026quot; and/or \u0026quot;git commit -a\u0026quot;) $ git diff #æŸ¥çœ‹Modifiedçš„æ–‡ä»¶ï¼Œä¿®æ”¹äº†å“ªäº›åœ°æ–¹ diff --git a/1.txt b/1.txt index 137b7fd..067030b 100644 --- a/1.txt +++ b/1.txt @@ -1 +1,2 @@ the first line +the second line $ git add 1.txt #æŠŠ1.txtåŠ å…¥åˆ°stagedä¸­ $ git status On branch master Your branch is up-to-date with 'origin/master'. Changes to be committed: (use \u0026quot;git reset HEAD ...\u0026quot; to unstage) modified: 1.txt $ git diff #è¿™ä¸ªæ—¶å€™ä¸ä¼šè¾“å‡ºä»»ä½•ä¸œè¥¿ï¼Œå› ä¸ºæ²¡æœ‰Modifiedçš„æ–‡ä»¶äº† $ git diff --staged #æŸ¥çœ‹stagedçš„æ–‡ä»¶å’Œä¸Šä¸€æ¬¡commitæœ‰å“ªäº›ä¿®æ”¹ diff --git a/1.txt b/1.txt index 137b7fd..067030b 100644 --- a/1.txt +++ b/1.txt @@ -1 +1,2 @@ the first line +the second line å›æ»šè¿˜æ²¡æœ‰commitçš„æ–‡ä»¶ å‘½ä»¤æ¦‚æ‹¬\n$ git reset HEAD 1.txt #æ–‡ä»¶å·²ç»Stagedçš„äº†ï¼Œç”¨è¿™ä¸ªæ¥å›æ»šåˆ°ModifiedçŠ¶æ€ï¼Œä½†æ˜¯å†…å®¹ä¸ä¼šå›æ»š $ git checkout 1.txt #å¦‚æœæ–‡ä»¶æ˜¯Modifiedï¼Œä¸æƒ³åšä¿®æ”¹äº†ï¼Œæ¢å¤åŸæ ·ï¼Œä½¿ç”¨è¿™ä¸ª æ“ä½œå®ä¾‹ $ git status On branch master Your branch is up-to-date with 'origin/master'. Changes to be committed: (use \u0026quot;git reset HEAD ...\u0026quot; to unstage) modified: 1.txt $ git diff --staged diff --git a/1.txt b/1.txt index 137b7fd..067030b 100644 --- a/1.txt +++ b/1.txt @@ -1 +1,2 @@ the first line +the second line $ git reset HEAD 1.txt #æŠŠ1.txt çš„çŠ¶æ€ç”±Stagedå˜ä¸ºStagedï¼Œ ä½†æ˜¯1.txtçš„å†…å®¹ä¸ä¼šå˜ Unstaged changes after reset: M1.txt $ git status On branch master Your branch is up-to-date with 'origin/master'. Changes not staged for commit: #å¯ä»¥çœ‹å‡º1.txt ç”±Stagedå˜ä¸ºModified (use \u0026quot;git add ...\u0026quot; to update what will be committed) (use \u0026quot;git checkout -- ...\u0026quot; to discard changes in working directory) modified: 1.txt no changes added to commit (use \u0026quot;git add\u0026quot; and/or \u0026quot;git commit -a\u0026quot;) $ cat 1.txt #æŸ¥çœ‹å†…å®¹ï¼Œå‘ç° 1.txtçš„å†…å®¹å¹¶æ²¡æœ‰å›æ»š the first line the second line $ git checkout 1.txt #å›æ»š $ git status On branch master Your branch is up-to-date with 'origin/master'. nothing to commit, working directory clean $ cat 1.txt #å†…å®¹å·²ç»å›æ»š the first line å›æ»šæŸä¸ªæäº¤ å‘½ä»¤æ¦‚æ‹¬\n$ git revert HEAD #å›æ»šä¸Šä¸€æ¬¡æäº¤ $ git revert HEAD^ #å›æ»šä¸Šä¸Šæ¬¡æäº¤ $ git revert #commit no# #å›æ»šæŸä¸€æ¬¡æäº¤ $ git revert -m 1 #commit no# #å›æ»šæŸä¸€æ¬¡mergeæäº¤ æ“ä½œå®ä¾‹ å¢åŠ äº†2.txt å¹¶æäº¤äº†ï¼Œç°åœ¨æƒ³å›æ»š\n$ vi 2.txt #åœ¨é‡Œé¢å¢åŠ å†…å®¹ $ git add 2.txt #æŠŠæ–‡ä»¶ç”±Untracked å˜ä¸º Staged $ git commit -m \u0026quot;2.txt commit\u0026quot; #æäº¤ $ git log æŸ¥çœ‹æäº¤æ—¥å¿— commit 710c5e84bd02e5d041b537b8732b9e80fee257a1 #è¿™ä¸ªæ˜¯æˆ‘ä»¬2.txtçš„æäº¤ Author: xxx Date: Thu Apr 7 22:10:00 2016 +0800 2.txt commit commit e6b0e7d844154d5473a37baed2ef56807dca16b3 Author: xxx Date: Wed Apr 6 22:42:44 2016 +0800 first commit $ git show 710c5e84bd02e5d041b537b8732b9e80fee257a1 #å¯ä»¥æŸ¥çœ‹è¿™æ¬¡ä¿®æ”¹çš„å†…å®¹ $ git revert 710c5e84bd02e5d041b537b8732b9e80fee257a1 #å›æ»šæäº¤ [master d3ab103] Revert \u0026quot;2.txt commit\u0026quot; 1 file changed, 1 deletion(-) delete mode 100644 2.txt $ git revert -m 1 9d55502f0e05bef943d6b4e7cf57aafe08e42d63 #ä¿ç•™master,å»é™¤åˆ«çš„åˆ†æ”¯æäº¤è¿‡æ¥çš„ åˆ†æ”¯æ“ä½œ æŸ¥çœ‹åˆ†æ”¯ $ git branch #æŸ¥çœ‹ç›®å‰æœ‰å“ªäº›åˆ†æ”¯ * master #åªæœ‰ä¸€ä¸ªåˆ†æ”¯,\u0026quot;*\u0026quot;è¡¨ç¤ºå½“å‰æ˜¯åœ¨masteråˆ†æ”¯ä¸Š åˆ›å»ºåˆ†æ”¯ $ git branch first-branch #æ‰“å‡ºç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼Œåå­—æ˜¯first-branch $ git branch first-branch # åˆ†æ”¯å·²ç»æœ‰äº† * master #\u0026quot;*\u0026quot;è¡¨ç¤ºå½“å‰æ˜¯åœ¨masteråˆ†æ”¯ä¸Š $ git checkout first-branch Switched to branch 'first-branch' $ git branch * first-branch #å·²ç»æˆåŠŸåˆ‡æ¢åˆ°è‡ªå·±æ‰“çš„åˆ†æ”¯ä¸Šäº† master åˆ†æ”¯ä¸Šå¢åŠ å†…å®¹ $ vi 2.txt $ cat 2.txt #å¢åŠ çš„å†…å®¹å¦‚ä¸‹ edit in first-branch $ git add 2.txt $ git commit -m \u0026quot;2.txt commit in first-branch\u0026quot; #åœ¨åˆ†æ”¯ä¸Šæäº¤ [first-branch 9abd8f2] 2.txt commit in first-branch 1 file changed, 2 insertions(+) create mode 100644 2.txt æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯éœ€è¦æ·»åŠ ä¸€ä¸ªè¿œç¨‹åœ°å€, åŒæ—¶è®¾ç½®ç”¨æˆ·å’Œé‚®ç®±\ngit remote add origin xxx.git # è®¾ç½®ç”¨æˆ· git config user.name \u0026quot;foo\u0026quot; # è®¾ç½®é‚®ç®± git config user.email \u0026quot;bar@mail.com\u0026quot; # å¦‚æœåŠ ä¸Š --global å‚æ•°, åˆ™æ˜¯å…¨å±€é…ç½®, å¦åˆ™æ˜¯è®¾ç½®å½“å‰projectçš„çš„é…ç½® git config --global $ git push origin first-branch Counting objects: 7, done. Delta compression using up to 4 threads. Compressing objects: 100% (5/5), done. Writing objects: 100% (7/7), 692 bytes | 0 bytes/s, done. Total 7 (delta 0), reused 0 (delta 0) To git@github.com:sotrip/gittest.git * [new branch] first-branch -\u0026gt; first-branch ä¸¤ä¸ªåˆ†æ”¯è¿›è¡Œæ¯”è¾ƒ $ git diff master first-branch # æ¯”è¾ƒmasterä¸first-branch diff --git a/2.txt b/2.txt new file mode 100644 index 0000000..b09edf1 --- /dev/null +++ b/2.txt # è¡¨ç¤ºfirst-branchä¸Šå¤šäº†ä¸€ä¸ª2.txt @@ -0,0 +1,2 @@ +edit in first-branch+ åˆ†æ”¯åˆå¹¶åˆ°masterä¸Š $ git checkout master $ git merge first-branch #æŠŠfirst-branchçš„å†…å®¹åˆå¹¶åˆ°masterä¸Š Updating d3ab103..9abd8f2 Fast-forward 2.txt | 2 ++ 1 file changed, 2 insertions(+) create mode 100644 2.txt $ ls 1.txt 2.txt $ cat 2.txt edit in first-branch $ git log commit 9abd8f2d8fe7c08ca246464552dae25397694582 Author: xxx Date: Thu Apr 7 22:26:26 2016 +0800 2.txt commit in first-branch #åœ¨first-branchä¸Šæäº¤çš„å†…å®¹ä¹Ÿæ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­ ä»è¿œç¨‹æ‹‰ä¸€ä¸ªåˆ†æ”¯ æœ‰ä¸¤ä¸ªåŠæ³•ï¼Œç¬¬ä¸€ç§æ˜¯:\n$ git fecth origin $ git checkout first-branch Branch first-branch set up to track remote branch first-branch from origin. Switched to a new branch 'first-branch' ç¬¬äºŒä¸ªåŠæ³•:\n$ git checkout -t origin/first-branch Branch first-branch set up to track remote branch first-branch from origin. Switched to a new branch 'first-branch' tagæ“ä½œ tagä¸€èˆ¬ç»´æŠ¤ä¸€ä¸ªåªè¯»çš„ç‰ˆæœ¬ï¼Œä¸å†è¿›è¡Œä¿®æ”¹\n$ git tag -a v1.0 -m \u0026quot;v1.0 ready for publish\u0026quot; #åˆ›å»ºä¸€ä¸ªtag ,åå­—æ˜¯\u0026quot;v1.0\u0026quot; $ git tag #æŸ¥çœ‹tag v1.0 $ git push origin v1.0 #æ¨é€tag åˆ°githubä¸Š Counting objects: 1, done. Writing objects: 100% (1/1), 162 bytes | 0 bytes/s, done. Total 1 (delta 0), reused 0 (delta 0) To git@github.com:sotrip/gittest.git * [new tag] v1.0 -\u0026gt; v1.0 $ git checkout v1.0 #åˆ‡æ¢åˆ°è¿™ä¸ªtag ä¸Š æ³¨æ„ æœ€å¥½ä¸è¦åœ¨tagè¿›è¡Œä¿®æ”¹ä¸œè¥¿ï¼Œå°±æŠŠtagç»´æŠ¤æˆä¸€ä¸ªåªè¯»çš„ç‰ˆæœ¬\nå…¶ä»– $ git rm 2.txt #åˆ é™¤2.txt è¿™ä¸ªæ–‡ä»¶ $ git remote -v #å¯ä»¥æŸ¥çœ‹è¿œç¨‹çš„gitçš„åœ°å€ gitè¦†ç›–æœ¬åœ°ä¿®æ”¹ï¼Œpull è¿œç¨‹ $ git fetch --all $ git reset --hard origin/master $ git pull gitä¿®æ”¹ä¸Šä¸€æ¬¡commit message $ git commit --amend gité‡å‘½ååˆ†æ”¯ $ git branch -m oldname newname $ git push origin :oldbranch # æ­¤å‘½ä»¤ä¼šåœ¨originä»“åº“ä¸­åŒ¹é…oldbranchåˆ†æ”¯ï¼Œç„¶ååˆ é™¤å®ƒã€‚ ",
      "summary": "æ‘˜è¦ï¼šå­¦ä¹ Gitçš„ä¸€äº›ç¬”è®°ï¼Œè®°å½•äº†Gitçš„ä¸€äº›å¸¸è§å‘½ä»¤ï¼Œä»¥åŠGitä¸­æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚\ngitæ–‡ä»¶çŠ¶æ€å˜åŒ– çŠ¶æ€è¯´æ˜ï¼š çŠ¶æ€è½¬æ¢: æ­£å¸¸æµç¨‹ git clone ä»è¿œç¨‹æ‹‰ä¸€ä¸ªå·¥ç¨‹ä¸‹æ¥ å¢åŠ ä¸€ä¸ªæ–‡ä»¶ git status æŸ¥çœ‹çŠ¶æ€ git add æŠŠæ–‡ä»¶ä»Untracked\u0026ndash;\u0026gt;Staged git rm \u0026ndash;cached git commit æäº¤ git push æŠŠmasteråˆ†æ”¯çš„å†…å®¹æäº¤åˆ°è¿œç«¯ git diff æŸ¥çœ‹å˜åŒ– æ“ä½œå®ä¾‹ å›æ»šè¿˜æ²¡æœ‰commitçš„æ–‡ä»¶ æ“ä½œå®ä¾‹ å›æ»šæŸä¸ªæäº¤ æ“ä½œå®ä¾‹ åˆ†æ”¯æ“ä½œ æŸ¥çœ‹åˆ†æ”¯ åˆ›å»ºåˆ†æ”¯ åˆ†æ”¯ä¸Šå¢åŠ å†…å®¹ æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ ä¸¤ä¸ªåˆ†æ”¯è¿›è¡Œæ¯”è¾ƒ åˆ†æ”¯åˆå¹¶åˆ°masterä¸Š ä»è¿œç¨‹æ‹‰ä¸€ä¸ªåˆ†æ”¯ tagæ“ä½œ å…¶ä»– gitè¦†ç›–æœ¬åœ°ä¿®æ”¹ï¼Œpull è¿œç¨‹ gitä¿®æ”¹ä¸Šä¸€æ¬¡commit message gité‡å‘½ååˆ†æ”¯ gitæ–‡ä»¶çŠ¶æ€å˜åŒ– çŠ¶æ€è¯´æ˜ï¼š Untracked: åˆšæ–°åŠ çš„æ–‡ä»¶ï¼Œè¿˜æ²¡æœ‰çº³å…¥gitç®¡ç†èŒƒå›´\nUnModified: å·²ç»committedçš„æ–‡ä»¶\nModified: å·²ç»committedçš„æ–‡ä»¶ï¼Œé€šè¿‡viç­‰ä¿®æ”¹åï¼Œå°±å˜æˆModified\nStaged: git add åçš„æ–‡ä»¶\nçŠ¶æ€è½¬æ¢: Untracked-\u0026gt;Staged: é€šè¿‡git add æ¥å®Œæˆ\nUnModified-\u0026gt;Modified: ä¿®æ”¹æ–‡ä»¶å†…å®¹æ¥å®Œæˆï¼Œæ¯”å¦‚viå‘½ä»¤\nModified-\u0026gt;Staged: é€šè¿‡git add æ¥å®Œæˆ"
    },{
      "title": "SpringBootä¸­ä½¿ç”¨AOP",
      "url": "https://qiref.github.io/post/2019/06/16/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8aop/",
      "content": "æ‘˜è¦ï¼šSpringä¸­å¦‚ä½•ä½¿ç”¨æ³¨è§£å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ã€‚\nåœºæ™¯ æ¯”å¦‚ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªè¯·æ±‚å‘èµ·ä¹‹å‰éƒ½ä¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½å»åˆ¤æ–­ä¸€æ¬¡ï¼Œé‚£å°±é‡å¤åœ°åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œåªè¦æ˜¯æœ‰é‡å¤çš„åœ°æ–¹ï¼Œå°±æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚ç°åœ¨å°±æŠŠé‡å¤çš„åœ°æ–¹æŠ½å–å‡ºæ¥ï¼Œæš‚ä¸”ç§°ä¹‹ä¸º \u0026quot; æ‹¦æˆªå™¨ \u0026ldquo;ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚ä¹‹å‰å°±å…ˆç»è¿‡\u0026rdquo; æ‹¦æˆªå™¨ \u0026ldquo;ï¼Œè¿™ä¸ªç¼–ç¨‹çš„æ€æƒ³å°±å¯ä»¥ç§°ä¹‹ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚AOP(Aspect Oriented Program)\næœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯äº‹åŠ¡ç®¡ç†å’Œæƒé™éªŒè¯ï¼Œè¿˜æœ‰æ—¥å¿—ç»Ÿè®¡ï¼Œä¸‹æ–‡ä¸­çš„æ¡ˆä¾‹å°±æ˜¯æ¥å£æ‰§è¡Œæ—¶é—´çš„ç»Ÿè®¡ã€‚\nspringä¸­ä½¿ç”¨AOPï¼ˆåŸºäºæ³¨è§£ï¼‰ ä¸å¾—ä¸è¯´æ³¨è§£æ˜¯ä¸ªå¾ˆå·§å¦™çš„è®¾è®¡ï¼Œä½¿ç”¨å¾ˆå°‘é‡çš„ä¿¡æ¯æè¿°æ•°æ®ï¼Œè¿™ç±»æ•°æ®ç§°ä¹‹ä¸ºå…ƒæ•°æ®ï¼Œæè¿°æ•°æ®çš„æ•°æ®ã€‚å…³äºæ³¨è§£çš„ç†è§£ï¼Œè¿™é‡Œæœ‰ä¸ªä¼ é€é—¨ï¼šhttp://www.importnew.com/10294.html\nä¸‹é¢çš„æ¡ˆä¾‹æ˜¯åœ¨springBootä¸­è¿›è¡Œçš„ï¼Œç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ³¨è§£å®ŒæˆAOPã€‚\n@Service public class UserService { public void getUser() { //To do something System.out.println(\u0026quot;getUser() has been called\u0026quot;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } } } åˆ‡é¢æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š\n@Component @Aspect public class LoggerAspect { /** * getUser()æ‰§è¡Œä¹‹å‰æ‰§è¡Œ */ @Before(\u0026quot;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026quot;) public void callBefore() { System.out.println(\u0026quot;before call method\u0026quot;); System.out.println(\u0026quot;begin........................\u0026quot;); } /** * getUser()æ‰§è¡Œä¹‹åæ‰§è¡Œ */ @After(\u0026quot;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026quot;) public void callAfter() { System.out.println(\u0026quot;after call method\u0026quot;); System.out.println(\u0026quot;end..............................\u0026quot;); } } æ¥ä¸ªå•å…ƒæµ‹è¯•éªŒè¯ä¸€ä¸‹ï¼š\n@RunWith(SpringRunner.class) @SpringBootTest public class UserServiceTest { @Autowired private UserService userService; @Test public void getUserTest() { userService.getUser(); } } æ¡ˆä¾‹ å‡å¦‚æœ‰ä»¥ä¸‹çš„ä¸šåŠ¡åœºæ™¯: UserServiceä¸šåŠ¡ç±»ä¸­æœ‰ä¸ªgetUser()è¿™ä¸ªæ–¹æ³•ï¼Œç°åœ¨æƒ³ç»Ÿè®¡ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œå¯èƒ½éœ€è¦æµ‹è¯•è¿™ä¸ªæ¥å£çš„æ€§èƒ½ã€‚é€šå¸¸åšæ³•æ˜¯æ–¹æ³•å¼€å§‹æ—¶è·å–ç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œç„¶åæ–¹æ³•ç»“æŸæ—¶è·å–å½“å‰æ—¶é—´ï¼Œæœ€å excuteTime=endTime-startTimeã€‚\nå¦‚æœç°åœ¨ä¸ä»…æ˜¯è¿™ä¸ªæ–¹æ³•éœ€è¦ç»Ÿè®¡ï¼Œè¿˜æœ‰getUserByName()ã€getUserById()éœ€è¦ç»Ÿè®¡ï¼Œä¸Šè¿°çš„æ–¹æ³•æ˜æ˜¾å¾ˆç¬¨äº†ã€‚\nä½¿ç”¨AOPæ€ä¹ˆè§£å†³ï¼Ÿ æŠ½å–å…¬å…±éƒ¨åˆ†ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œæ–¹æ³•æ‰§è¡Œå‰è®°å½•æ—¶é—´ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæœ€åï¼Œç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åå†è·å–ä¸€æ¬¡ç³»ç»Ÿæ—¶é—´ã€‚\nå…·ä½“å®ç°å¦‚ä¸‹ï¼šåœ¨LoggerAspectä¸­å†å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè®°å½•getUser()æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚\n/** * è®°å½•æ‰§è¡Œæ—¶é—´ * @param point åˆ‡ç‚¹ * @return * @throws Throwable */ @Around(\u0026quot;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026quot;) public Object getMethodExecuteTime(ProceedingJoinPoint point) throws Throwable { System.out.println(\u0026quot;---------------getMethodExecuteTime------------------\u0026quot;); long startTime = System.currentTimeMillis(); //è°ƒç”¨ç›®æ ‡æ–¹æ³• Object result = point.proceed(); long endTime = System.currentTimeMillis(); long executeTime = endTime - startTime; System.out.println(\u0026quot;executeTime=\u0026quot; + executeTime + \u0026quot;------------------\u0026quot;); return result; } @Aroundå°†ç›®æ ‡æ–¹æ³•å†æ¬¡å°è£…ï¼Œæ§åˆ¶äº†å®ƒçš„è°ƒç”¨æ—¶æœºï¼Œä»¥æ­¤æ¥è®°å½•getUser()çš„æ‰§è¡Œæ—¶é—´ã€‚ä½†æ˜¯å¥½åƒå¹¶æ²¡æœ‰è¾¾åˆ°è®°å½•UserServiceä¸­çš„å¤šä¸ªæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´çš„ç›®çš„ã€‚\n@Around(\u0026ldquo;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026rdquo;)\nå…¶ä¸­æŒ‡å®šäº†åˆ‡ç‚¹æ˜¯getUser()è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œçš„è¡¨è¾¾å¼å¾ˆä¸°å¯Œï¼Œå¯ä»¥è®¾ç½®ä¸ºï¼š\n* com.springboot.demo.service.UserService.*(..)\nè¡¨ç¤ºUserServiceä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯åˆ‡ç‚¹ï¼Œç”šè‡³å¯ä»¥æ˜¯è¿™æ ·ï¼š\n* com.springboot.demo.service..(..)\nè¡¨ç¤ºserviceåŒ…ä¸‹çš„æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åˆ‡ç‚¹ï¼Œä½†æ˜¯è¿™æ ·å¾ˆæ˜æ˜¾ä¸å¤Ÿçµæ´»ï¼Œå¦‚æœèƒ½è‡ªå®šä¹‰åœ°æ§åˆ¶å°±æ›´å¥½äº†ã€‚\nè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ å¦‚æœç”¨ä¸€ä¸ªæ³¨è§£æ ‡æ³¨æŸä¸ªæ–¹æ³•éœ€è¦è®°å½•å…¶æ‰§è¡Œæ—¶é—´ï¼Œå²‚ä¸æ˜¯æ›´åŠ ä¼˜é›…ã€‚\n/** * @Description æ ‡æ³¨æŸä¸ªæ–¹æ³•éœ€è¦è®°å½•æ‰§è¡Œæ—¶é—´ * @Author YaoQi * @Date 2018/7/6 15:51 */ @Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) @Documented public @interface Logger { String value() default \u0026quot;\u0026quot;; } æ³¨è§£æ˜¯ç”¨æ¥æè¿°æ•°æ®çš„ï¼Œä¸Šé¢çš„è¿™ä¸ªæ³¨è§£çš„æ„æ€æ˜¯ï¼šè¿™ä¸ªæ³¨è§£å°†ä½œç”¨äºæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚ä½†æ˜¯è¿™æ ·åªæ˜¯æ ‡æ³¨äº†ï¼Œå¦‚ä½•è¯»å–è¿™ä¸ªæ ‡æ³¨çš„ä¿¡æ¯ï¼Ÿ\nåœ¨LoggerAspectä¸­åŠ å…¥è¿™ä¸€ä¸ªæ–¹æ³•ï¼š\n/** * @param point * @return * @throws Throwable */ @Around(\u0026quot;@annotation(com.springboot.demo.annotation.Logger)\u0026quot;) public Object getMethodExecuteTimeForLogger(ProceedingJoinPoint point) throws Throwable { System.out.println(\u0026quot;---------------getMethodExecuteTime------------------\u0026quot;); long startTime = System.currentTimeMillis(); Object result = point.proceed(); long endTime = System.currentTimeMillis(); long executeTime = endTime - startTime; System.out.println(\u0026quot;executeTime=\u0026quot; + executeTime + \u0026quot;------------------\u0026quot;); return result; } å“ªä¸ªæ–¹æ³•éœ€è¦è®°å½•æ‰§è¡Œæ—¶é—´å°±å°†@Loggeræ”¾åœ¨å¯¹åº”çš„æ–¹æ³•ä¸Šï¼š\n@Logger public void getUser() { System.out.println(\u0026quot;getUser() has been called\u0026quot;); } ",
      "summary": "æ‘˜è¦ï¼šSpringä¸­å¦‚ä½•ä½¿ç”¨æ³¨è§£å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ã€‚\nåœºæ™¯ æ¯”å¦‚ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªè¯·æ±‚å‘èµ·ä¹‹å‰éƒ½ä¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½å»åˆ¤æ–­ä¸€æ¬¡ï¼Œé‚£å°±é‡å¤åœ°åšäº†å¾ˆå¤šäº‹æƒ…ï¼Œåªè¦æ˜¯æœ‰é‡å¤çš„åœ°æ–¹ï¼Œå°±æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚ç°åœ¨å°±æŠŠé‡å¤çš„åœ°æ–¹æŠ½å–å‡ºæ¥ï¼Œæš‚ä¸”ç§°ä¹‹ä¸º \u0026quot; æ‹¦æˆªå™¨ \u0026ldquo;ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚ä¹‹å‰å°±å…ˆç»è¿‡\u0026rdquo; æ‹¦æˆªå™¨ \u0026ldquo;ï¼Œè¿™ä¸ªç¼–ç¨‹çš„æ€æƒ³å°±å¯ä»¥ç§°ä¹‹ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚AOP(Aspect Oriented Program)\næœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯äº‹åŠ¡ç®¡ç†å’Œæƒé™éªŒè¯ï¼Œè¿˜æœ‰æ—¥å¿—ç»Ÿè®¡ï¼Œä¸‹æ–‡ä¸­çš„æ¡ˆä¾‹å°±æ˜¯æ¥å£æ‰§è¡Œæ—¶é—´çš„ç»Ÿè®¡ã€‚\nspringä¸­ä½¿ç”¨AOPï¼ˆåŸºäºæ³¨è§£ï¼‰ ä¸å¾—ä¸è¯´æ³¨è§£æ˜¯ä¸ªå¾ˆå·§å¦™çš„è®¾è®¡ï¼Œä½¿ç”¨å¾ˆå°‘é‡çš„ä¿¡æ¯æè¿°æ•°æ®ï¼Œè¿™ç±»æ•°æ®ç§°ä¹‹ä¸ºå…ƒæ•°æ®ï¼Œæè¿°æ•°æ®çš„æ•°æ®ã€‚å…³äºæ³¨è§£çš„ç†è§£ï¼Œè¿™é‡Œæœ‰ä¸ªä¼ é€é—¨ï¼šhttp://www.importnew.com/10294.html\nä¸‹é¢çš„æ¡ˆä¾‹æ˜¯åœ¨springBootä¸­è¿›è¡Œçš„ï¼Œç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ³¨è§£å®ŒæˆAOPã€‚\n@Service public class UserService { public void getUser() { //To do something System.out.println(\u0026quot;getUser() has been called\u0026quot;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } } } åˆ‡é¢æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š\n@Component @Aspect public class LoggerAspect { /** * getUser()æ‰§è¡Œä¹‹å‰æ‰§è¡Œ */ @Before(\u0026quot;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026quot;) public void callBefore() { System.out.println(\u0026quot;before call method\u0026quot;); System.out.println(\u0026quot;begin........................\u0026quot;); } /** * getUser()æ‰§è¡Œä¹‹åæ‰§è¡Œ */ @After(\u0026quot;execution(* com.springboot.demo.service.UserService.getUser(..))\u0026quot;) public void callAfter() { System."
    },{
      "title": "About Hugo XMin",
      "url": "https://qiref.github.io/about/",
      "content": "XMin is the first Hugo theme I have designed. The original reason that I wrote it was I needed a minimal example of Hugo themes when I was writing the blogdown book. Basically I wanted a simple theme that supports a navigation menu, a home page, other single pages, lists of pages, blog posts, categories, tags, and RSS. That is all. Nothing fancy. In terms of CSS and JavaScript, I really want to keep them minimal. In fact, this theme does not contain any JavaScript code at all, although on this example website I did introduce some JavaScript code (still relatively simple anyway). The theme does not contain any images, either, and is pretty much a plain-text theme.\nThe theme name \u0026ldquo;XMin\u0026rdquo; can be interpreted as \u0026ldquo;Xie\u0026rsquo;s Minimal theme\u0026rdquo; (Xie is my last name) or \u0026ldquo;eXtremely Minimal theme\u0026rdquo;.\nhugo.yaml (the config file) For this example site, I defined permalinks for two sections, post and note, so that the links to pages under these directories will contain the date info, e.g., https://xmin.yihui.org/post/2016/02/14/a-plain-markdown-post/. This is optional, and it is up to your personal taste of URLs.\npermalinks: note: \u0026quot;/note/:year/:month/:day/:slug/\u0026quot; post: \u0026quot;/post/:year/:month/:day/:slug/\u0026quot; You can define the menu through menu.main, e.g.,\nmenu: main: - name: Home url: \u0026quot;\u0026quot; weight: 1 - name: About url: \u0026quot;about/\u0026quot; weight: 2 - name: Categories url: \u0026quot;categories/\u0026quot; weight: 3 - name: Tags url: \u0026quot;tags/\u0026quot; weight: 4 - name: Subscribe url: \u0026quot;index.xml\u0026quot; Alternatively, you can add menu: main to the YAML metadata of any of your pages, so that these pages will appear in the menu.\nThe page footer can be defined in .Params.footer, and the text is treated as Markdown, e.g.,\nparams: footer: \u0026quot;\u0026amp;copy; [Yihui Xie](https://yihui.org) 2017 -- {Year}\u0026quot; Here {Year} means the year in which the site is built (usually the current year).\nCustom layouts There are two layout files under layouts/partials/ that you may want to override: head_custom.html and foot_custom.html. This is how you inject arbitrary HTML code to the head and foot areas. For example, this site has a file layouts/partials/foot_custom.html to support LaTeX math via KaTeX and center images automatically:\n\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;//cdn.jsdelivr.net/npm/katex/dist/katex.min.css\u0026quot;\u0026gt; \u0026lt;script src=\u0026quot;//cdn.jsdelivr.net/combine/npm/katex/dist/katex.min.js,npm/katex/dist/contrib/auto-render.min.js,npm/@xiee/utils/js/render-katex.js\u0026quot; defer\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026quot;//cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.min.js\u0026quot; defer\u0026gt;\u0026lt;/script\u0026gt; You can certainly enable highlight.js for syntax highlighting by yourself through head_custom.html and foot_custom.html if you want.\nIf you do not like the default fonts (e.g., Palatino), you may provide your own static/css/fonts.css under the root directory of your website to override the fonts.css in the theme.\nOther features I could have added more features to this theme, but I decided not to, since I have no intention to make this theme feature-rich. However, I will teach you how. I have prepared several examples via pull requests at https://github.com/yihui/hugo-xmin/pulls, so that you can see the implementations of these features when you check out the diffs in the pull requests. For example, you can:\nEnable Google Analytics\nEnable Disqus comments\nEnable highlight.js for syntax highlighting of code blocks\nDisplay categories and tags on a page\nAdd a table of contents\nAdd a link in the footer of each page to \u0026ldquo;Edit this page\u0026rdquo; on Github\nTo fully understand these examples, you have to read the section on Hugo templates in the blogdown book.\nDesign philosophy Lastly, a few words about my design philosophy for this theme: I have been relying on existing frameworks like Bootstrap for years since I\u0026rsquo;m not really a designer, and I was always scared by the complexity of CSS.\nWhen I started writing this theme, I asked myself, \u0026ldquo;What if I just write from scratch?\u0026rdquo; No Bootstrap. No Normalize.css. I don\u0026rsquo;t care about IE (life could be so much easier without IE) or inconsistencies among browsers (for personal websites). As long as the theme looks okay in Chrome, Firefox, and Safari, I\u0026rsquo;m done. Thanks to the simplicity of Markdown, you cannot really produce very complicated HTML, and I think styling the HTML output from Markdown is much simpler than general HTML documents. For example, I do not need to care much about form elements like textareas or buttons.\nAfter I finished this theme, I started to wonder why I\u0026rsquo;d need normalize.css at all. The default appearance of modern browsers actually looks pretty good in my eyes, after I tweak the typeface a little bit.\nCompared to inconsistencies across browsers, I care much more about these properties of HTML elements:\nTables should always be centered, and striped tables are easier to read especially when they are wide. Tables should not have vertical borders. An image should be centered if it is the only child element of a paragraph. The max-width of images, videos, and iframes should be 100%. I hope you can enjoy this theme. The source code is on Github. Happy hacking!\n",
      "summary": "XMin is the first Hugo theme I have designed. The original reason that I wrote it was I needed a minimal example of Hugo themes when I was writing the blogdown book. Basically I wanted a simple theme that supports a navigation menu, a home page, other single pages, lists of pages, blog posts, categories, tags, and RSS. That is all. Nothing fancy. In terms of CSS and JavaScript, I really want to keep them minimal."
    }]
}